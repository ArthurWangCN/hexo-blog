{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"source/sentence/favicon.ico","path":"sentence/favicon.ico","modified":0,"renderable":0},{"_id":"source/sentence/index.html","path":"sentence/index.html","modified":0,"renderable":0},{"_id":"source/sentence/images/1.jpg","path":"sentence/images/1.jpg","modified":0,"renderable":0},{"_id":"source/sentence/images/2.jpg","path":"sentence/images/2.jpg","modified":0,"renderable":0},{"_id":"source/sentence/images/4.jpg","path":"sentence/images/4.jpg","modified":0,"renderable":0},{"_id":"source/sentence/images/3.jpg","path":"sentence/images/3.jpg","modified":0,"renderable":0},{"_id":"source/sentence/js/jquery-1.8.3.min.js","path":"sentence/js/jquery-1.8.3.min.js","modified":0,"renderable":0},{"_id":"source/sentence/js/jquery.fullPage.js","path":"sentence/js/jquery.fullPage.js","modified":0,"renderable":0},{"_id":"source/sentence/css/jquery.fullPage.css","path":"sentence/css/jquery.fullPage.css","modified":0,"renderable":0},{"_id":"source/sentence/js/jquery.fullPage.min.js","path":"sentence/js/jquery.fullPage.min.js","modified":0,"renderable":0},{"_id":"themes/next/source/CNAME","path":"CNAME","modified":0,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/lib/anime.min.js","path":"lib/anime.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/algolia-search.js","path":"js/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/all.min.css","path":"lib/font-awesome/css/all.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-brands-400.woff2","path":"lib/font-awesome/webfonts/fa-brands-400.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-regular-400.woff2","path":"lib/font-awesome/webfonts/fa-regular-400.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-solid-900.woff2","path":"lib/font-awesome/webfonts/fa-solid-900.woff2","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"28bf2345ab2aebaac6541c21967d76ce04c4e71f","modified":1691594360296},{"_id":"source/categories/index.md","hash":"f57bcae9b3e94a97bb93f61aa6a892f3679bcd6a","modified":1651489269334},{"_id":"source/about/index.md","hash":"ce3175de14f141c833a52930d5e8ad6e9b09dd17","modified":1651489324437},{"_id":"source/_posts/.DS_Store","hash":"0425998f2e58ea8187e31c94a45f97a1899b5c22","modified":1676428717697},{"_id":"source/links/index.md","hash":"850bf1058ec4b921a4efc220001ecdd574fc2775","modified":1653614073686},{"_id":"source/_posts/algorithm-brackets.md","hash":"c9d4d986e091f65d368b8716af07e6df4a885d0e","modified":1652532249738},{"_id":"source/_posts/big-file-upload.md","hash":"4a1df66499407a9edd57170d15c95bd501fa2c7e","modified":1679315243424},{"_id":"source/_posts/array-not-duplicate.md","hash":"9db4b16c2757528dbc38c2e49b89e16971fa7076","modified":1652532957000},{"_id":"source/_posts/blog-next-links.md","hash":"a65ef2b009cb5142fb4a218139888b7eb0841c6b","modified":1653408869668},{"_id":"source/_posts/breakpoint-upload.md","hash":"a98a214e27c148deb02094702f069da7d9c9aaf5","modified":1679315227682},{"_id":"source/_posts/browser-cache.md","hash":"149b4766a97ed5c2dfbd2fc5b7864605d4e45ba5","modified":1676687813511},{"_id":"source/_posts/canvas-svg.md","hash":"9fee47f3fc9abd3d06b3da6ac6e4c73c5c4154ef","modified":1652199672144},{"_id":"source/_posts/css-basic-layout.md","hash":"03605faf774cda7f6ea9e95e01ec6caa7befe97a","modified":1655824810372},{"_id":"source/_posts/debounce-throttle.md","hash":"6386988badcb0adb0b8f0532f48d9f8014ee3559","modified":1676687826714},{"_id":"source/_posts/click-coordinate.md","hash":"416e666dff454f2b7ad429e62accd963a48d153a","modified":1652533179158},{"_id":"source/_posts/centos-nginx.md","hash":"60d72eaac9ab546794514c9de62ad929d785f9ad","modified":1652508123331},{"_id":"source/_posts/deep-copy.md","hash":"06f78bf2c83130da1352b62f2a4af06a2c22373d","modified":1676689195832},{"_id":"source/_posts/fe-code-review.md","hash":"19d7cdbce3055320d2344fae3a3779f152163027","modified":1679318449553},{"_id":"source/_posts/flex-1.md","hash":"684f0e2d061effb0856efe80085a076e37077d95","modified":1678552969733},{"_id":"source/_posts/handwrite-ajax.md","hash":"0a10f4889f5a04efcf0ccddca5c8be90b0367a9a","modified":1652189301933},{"_id":"source/_posts/handwrite-call-apply.md","hash":"c26d038d07a02042f5c61dfe8743d39a6ac50947","modified":1651491719635},{"_id":"source/_posts/handwrite-delegate.md","hash":"873e535f9d9d6e59980d41368dd5b900586cfa18","modified":1652017068326},{"_id":"source/_posts/handwrite-drag-div.md","hash":"73e52d61df488bafb5f4256e703f92ab1ac8068f","modified":1651761387171},{"_id":"source/_posts/node-module-rule.md","hash":"13eb042152b75dfaf26b3ff7aec96b67e2617014","modified":1678555031517},{"_id":"source/_posts/npm-taobao.md","hash":"9a8979b53fb143ec1f1d0d54f6eba64b2385ea3c","modified":1652509164520},{"_id":"source/_posts/git-hooks.md","hash":"6df98f86abc79b543a5f7562b91cf22c55476ac1","modified":1678554770653},{"_id":"source/_posts/pdfjs-font-missing.md","hash":"8f2b30c09eea9d47fd1885403eaa7120ac45cac0","modified":1691594254908},{"_id":"source/_posts/office-add-in-debug.md","hash":"f044258f6e4de3d624fcda9a404134567ced33a3","modified":1681393704304},{"_id":"source/_posts/picgo.md","hash":"1c603c226295a6a2ec340cb17245e37c035520cf","modified":1652189738750},{"_id":"source/_posts/pinia101.md","hash":"d674103f784dcf90007261b6f87959b755155ce8","modified":1678200806403},{"_id":"source/_posts/project-husky.md","hash":"b906016b7f4562b8716bd7bd7eaad81e61b714e8","modified":1678554553022},{"_id":"source/_posts/reduce.md","hash":"0bcfe6f3d6ebea2474c37635853acff3ed0dbf7c","modified":1654611469318},{"_id":"source/_posts/reflow-repaint.md","hash":"87b3da319401516cd32f8fc78e01f8223ff3a21d","modified":1652189883253},{"_id":"source/_posts/react-devtools.md","hash":"74ca2105a145da1f15b5a7138e4959098e59e7a9","modified":1652508957328},{"_id":"source/_posts/project-flash-files.md","hash":"10f45bec1d2c12676ba183cf4d376ff29b5196b2","modified":1652510033360},{"_id":"source/_posts/cookie18.md","hash":"f2d8723adede92fbbc220d6f74fe35a1753aa5fd","modified":1679318092531},{"_id":"source/_posts/tsconfig-json.md","hash":"cf71e5f4e3f9be763de3f174211e918ba1d868ed","modified":1678283412517},{"_id":"source/_posts/ts000.md","hash":"19d598b58436e052e566ef571e4b0f48d8ef9701","modified":1678200571555},{"_id":"source/_posts/vue-devtools.md","hash":"ea2e5d0f3c1d3a5ac9a08cba9d0868201d6fdad7","modified":1678552836823},{"_id":"source/_posts/vue3-scene.md","hash":"20648085ca42e91c0a1f7b0cc24d7d7bc80d0ade","modified":1679318983320},{"_id":"source/_posts/tailwindcss101.md","hash":"5b5f1c8006729bf4a01934b444a441fef1e3e3bb","modified":1681393532902},{"_id":"source/_posts/vuepress101.md","hash":"c26e5c338a40ddf1c7af916940a6cc9f1bb3a904","modified":1652508359190},{"_id":"source/schedule/index.md","hash":"74a476f0a6d407e90eb485714488c899030a3187","modified":1651498382680},{"_id":"source/sentence/favicon.ico","hash":"164ddd0d96ed9f2da768144abeda52b61c731a3d","modified":1651505914628},{"_id":"source/_posts/scss101.md","hash":"b7e5c50a994968a79f38285211f3bc08e430a19a","modified":1678200329647},{"_id":"source/tags/index.md","hash":"a4bc7902610fca84cb8cc9fd1f44a3ed69b0f07b","modified":1651489227542},{"_id":"source/sentence/index.html","hash":"13d39eb17a90846d843e8ae0962ac5928cd5faa0","modified":1676295186991},{"_id":"source/_posts/vue3-scoped.md","hash":"6fdbe5c5b0097cc58ef4d975c27285379a3007a4","modified":1679405300267},{"_id":"source/sentence/css/jquery.fullPage.css","hash":"8b1a354749e0516830e463053e814e21772aceb0","modified":1421413986000},{"_id":"source/sentence/js/jquery.fullPage.min.js","hash":"7f36d0c6089b6400ea655625b943aacf853e607d","modified":1421413986000},{"_id":"source/sentence/js/jquery.fullPage.js","hash":"574e5a2c378b4ed6ef0b2e132db6320705ca3a4d","modified":1421413986000},{"_id":"source/sentence/js/jquery-1.8.3.min.js","hash":"d3662db46dd6559d468f173e162a2212da07dc19","modified":1384740718000},{"_id":"source/sentence/images/1.jpg","hash":"1a124b38a0d1a4838842dcf648dbc6d6112e038d","modified":1421889959148},{"_id":"source/sentence/images/4.jpg","hash":"c4e924676e1510779dd23c7a6def20abbedec029","modified":1421890060406},{"_id":"source/sentence/images/2.jpg","hash":"8b069bf02a7fc43027cefe39ab173d174a4357da","modified":1421890033491},{"_id":"source/sentence/images/3.jpg","hash":"2101cb22f4ab853d780d69ec68cf1ba6e2cfc857","modified":1421890043514},{"_id":"themes/next/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1627608806000},{"_id":"themes/next/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1627608806000},{"_id":"themes/next/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1627608806000},{"_id":"themes/next/.travis.yml","hash":"ecca3b919a5b15886e3eca58aa84aafc395590da","modified":1627608806000},{"_id":"themes/next/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1627608806000},{"_id":"themes/next/README.md","hash":"9b4b7d66aca47f9c65d6321b14eef48d95c4dff1","modified":1627608806000},{"_id":"themes/next/package.json","hash":"62fad6de02adbbba9fb096cbe2dcc15fe25f2435","modified":1627608806000},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1627608806000},{"_id":"themes/next/.DS_Store","hash":"d366b0542acc0529820cac26effdd04fd72e3041","modified":1676379745096},{"_id":"themes/next/_config.yml","hash":"7e69a5e02b041d62a5ba412fe6facdbe67f7db6c","modified":1676379171631},{"_id":"themes/next/.gitignore","hash":"56f3470755c20311ddd30d421b377697a6e5e68b","modified":1627608806000},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"aa4cb7aff595ca628cb58160ee1eee117989ec4e","modified":1627608806000},{"_id":"themes/next/gulpfile.js","hash":"1b4fc262b89948937b9e3794de812a7c1f2f3592","modified":1627608806000},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"e554931b98f251fd49ff1d2443006d9ea2c20461","modified":1627608806000},{"_id":"themes/next/.github/config.yml","hash":"1d3f4e8794986817c0fead095c74f756d45f91ed","modified":1627608806000},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"1a435c20ae8fa183d49bbf96ac956f7c6c25c8af","modified":1627608806000},{"_id":"themes/next/.github/issue-close-app.yml","hash":"7cba457eec47dbfcfd4086acd1c69eaafca2f0cd","modified":1627608806000},{"_id":"themes/next/.github/mergeable.yml","hash":"0ee56e23bbc71e1e76427d2bd255a9879bd36e22","modified":1627608806000},{"_id":"themes/next/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1627608806000},{"_id":"themes/next/.github/stale.yml","hash":"fdf82de9284f8bc8e0b0712b4cc1cb081a94de59","modified":1627608806000},{"_id":"themes/next/.github/release-drafter.yml","hash":"3cc10ce75ecc03a5ce86b00363e2a17eb65d15ea","modified":1627608806000},{"_id":"themes/next/.github/support.yml","hash":"d75db6ffa7b4ca3b865a925f9de9aef3fc51925c","modified":1627608806000},{"_id":"themes/next/docs/AUTHORS.md","hash":"10135a2f78ac40e9f46b3add3e360c025400752f","modified":1627608806000},{"_id":"themes/next/docs/INSTALLATION.md","hash":"af88bcce035780aaa061261ed9d0d6c697678618","modified":1627608806000},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"c7a994b9542040317d8f99affa1405c143a94a38","modified":1627608806000},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1627608806000},{"_id":"themes/next/docs/DATA-FILES.md","hash":"cddbdc91ee9e65c37a50bec12194f93d36161616","modified":1627608806000},{"_id":"themes/next/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1627608806000},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"94dc3404ccb0e5f663af2aa883c1af1d6eae553d","modified":1627608806000},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"8b6e4b2c9cfcb969833092bdeaed78534082e3e6","modified":1627608806000},{"_id":"themes/next/scripts/renderer.js","hash":"49a65df2028a1bc24814dc72fa50d52231ca4f05","modified":1627608806000},{"_id":"themes/next/docs/MATH.md","hash":"d645b025ec7fb9fbf799b9bb76af33b9f5b9ed93","modified":1627608806000},{"_id":"themes/next/.github/lock.yml","hash":"61173b9522ebac13db2c544e138808295624f7fd","modified":1627608806000},{"_id":"themes/next/layout/_layout.swig","hash":"6a6e92a4664cdb981890a27ac11fd057f44de1d5","modified":1627608806000},{"_id":"themes/next/layout/archive.swig","hash":"e4e31317a8df68f23156cfc49e9b1aa9a12ad2ed","modified":1627608806000},{"_id":"themes/next/layout/category.swig","hash":"1bde61cf4d2d171647311a0ac2c5c7933f6a53b0","modified":1627608806000},{"_id":"themes/next/layout/index.swig","hash":"7f403a18a68e6d662ae3e154b2c1d3bbe0801a23","modified":1627608806000},{"_id":"themes/next/layout/tag.swig","hash":"0dfb653bd5de980426d55a0606d1ab122bd8c017","modified":1627608806000},{"_id":"themes/next/layout/post.swig","hash":"2f6d992ced7e067521fdce05ffe4fd75481f41c5","modified":1627608806000},{"_id":"themes/next/layout/page.swig","hash":"db581bdeac5c75fabb0f17d7c5e746e47f2a9168","modified":1627608806000},{"_id":"themes/next/source/CNAME","hash":"af0f2b80275224d3ad4d75b19bb77ceaca69106e","modified":1613839463278},{"_id":"themes/next/languages/ar.yml","hash":"9815e84e53d750c8bcbd9193c2d44d8d910e3444","modified":1627608806000},{"_id":"themes/next/languages/de.yml","hash":"74c59f2744217003b717b59d96e275b54635abf5","modified":1627608806000},{"_id":"themes/next/languages/en.yml","hash":"45bc5118828bdc72dcaa25282cd367c8622758cb","modified":1627608806000},{"_id":"themes/next/languages/fr.yml","hash":"752bf309f46a2cd43890b82300b342d7218d625f","modified":1627608806000},{"_id":"themes/next/languages/id.yml","hash":"572ed855d47aafe26f58c73b1394530754881ec2","modified":1627608806000},{"_id":"themes/next/languages/ja.yml","hash":"0cf0baa663d530f22ff380a051881216d6adcdd8","modified":1627608806000},{"_id":"themes/next/languages/it.yml","hash":"44759f779ce9c260b895532de1d209ad4bd144bf","modified":1627608806000},{"_id":"themes/next/languages/nl.yml","hash":"5af3473d9f22897204afabc08bb984b247493330","modified":1627608806000},{"_id":"themes/next/languages/ko.yml","hash":"0feea9e43cd399f3610b94d755a39fff1d371e97","modified":1627608806000},{"_id":"themes/next/languages/default.yml","hash":"45bc5118828bdc72dcaa25282cd367c8622758cb","modified":1627608806000},{"_id":"themes/next/languages/pt.yml","hash":"718d131f42f214842337776e1eaddd1e9a584054","modified":1627608806000},{"_id":"themes/next/languages/pt-BR.yml","hash":"67555b1ba31a0242b12fc6ce3add28531160e35b","modified":1627608806000},{"_id":"themes/next/languages/ru.yml","hash":"e993d5ca072f7f6887e30fc0c19b4da791ca7a88","modified":1627608806000},{"_id":"themes/next/languages/uk.yml","hash":"3a6d635b1035423b22fc86d9455dba9003724de9","modified":1627608806000},{"_id":"themes/next/languages/vi.yml","hash":"93393b01df148dcbf0863f6eee8e404e2d94ef9e","modified":1627608806000},{"_id":"themes/next/languages/zh-CN.yml","hash":"a1f15571ee7e1e84e3cc0985c3ec4ba1a113f6f8","modified":1627608806000},{"_id":"themes/next/languages/zh-HK.yml","hash":"3789f94010f948e9f23e21235ef422a191753c65","modified":1627608806000},{"_id":"themes/next/languages/tr.yml","hash":"2b041eeb8bd096f549464f191cfc1ea0181daca4","modified":1627608806000},{"_id":"themes/next/languages/es.yml","hash":"c64cf05f356096f1464b4b1439da3c6c9b941062","modified":1627608806000},{"_id":"themes/next/languages/fa.yml","hash":"3676b32fda37e122f3c1a655085a1868fb6ad66b","modified":1627608806000},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"c3e6b8196c983c40fd140bdeca012d03e6e86967","modified":1627608806000},{"_id":"themes/next/.github/ISSUE_TEMPLATE/question.md","hash":"53df7d537e26aaf062d70d86835c5fd8f81412f3","modified":1627608806000},{"_id":"themes/next/languages/zh-TW.yml","hash":"8c09da7c4ec3fca2c6ee897b2eea260596a2baa1","modified":1627608806000},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"12d99fb8b62bd9e34d9672f306c9ae4ace7e053e","modified":1627608806000},{"_id":"themes/next/scripts/events/index.js","hash":"5743cde07f3d2aa11532a168a652e52ec28514fd","modified":1627608806000},{"_id":"themes/next/.github/ISSUE_TEMPLATE/other.md","hash":"d3efc0df0275c98440e69476f733097916a2d579","modified":1627608806000},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"9c4fe2873123bf9ceacab5c50d17d8a0f1baef27","modified":1627608806000},{"_id":"themes/next/languages/hu.yml","hash":"b1ebb77a5fd101195b79f94de293bcf9001d996f","modified":1627608806000},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"aec50ed57b9d5d3faf2db3c88374f107203617e0","modified":1627608806000},{"_id":"themes/next/docs/ru/README.md","hash":"85dd68ed1250897a8e4a444a53a68c1d49eb7e11","modified":1627608806000},{"_id":"themes/next/scripts/filters/front-matter.js","hash":"703bdd142a671b4b67d3d9dfb4a19d1dd7e7e8f7","modified":1627608806000},{"_id":"themes/next/scripts/filters/locals.js","hash":"b193a936ee63451f09f8886343dcfdca577c0141","modified":1627608806000},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"5237a368ab99123749d724b6c379415f2c142a96","modified":1627608806000},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"0bd2d696f62a997a11a7d84fec0130122234174e","modified":1627608806000},{"_id":"themes/next/scripts/filters/minify.js","hash":"19985723b9f677ff775f3b17dcebf314819a76ac","modified":1627608806000},{"_id":"themes/next/scripts/filters/post.js","hash":"44ba9b1c0bdda57590b53141306bb90adf0678db","modified":1627608806000},{"_id":"themes/next/scripts/helpers/font.js","hash":"40cf00e9f2b7aa6e5f33d412e03ed10304b15fd7","modified":1627608806000},{"_id":"themes/next/scripts/helpers/engine.js","hash":"bdb424c3cc0d145bd0c6015bb1d2443c8a9c6cda","modified":1627608806000},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"958e86b2bd24e4fdfcbf9ce73e998efe3491a71f","modified":1627608806000},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"5e11f30ddb5093a88a687446617a46b048fa02e5","modified":1627608806000},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"fb23b85db6f7d8279d73ae1f41631f92f64fc864","modified":1627608806000},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"d3f03be036b75dc71cf3c366cd75aee7c127c874","modified":1627608806000},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"ca1030efdfca5e20f9db2e7a428998e66a24c0d0","modified":1627608806000},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"579c7bd8341873fb8be4732476d412814f1a3df7","modified":1627608806000},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"8b18f84503a361fc712b0fe4d4568e2f086ca97d","modified":1627608806000},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"b92585d251f1f9ebe401abb5d932cb920f9b8b10","modified":1627608806000},{"_id":"themes/next/scripts/tags/button.js","hash":"8c6b45f36e324820c919a822674703769e6da32c","modified":1627608806000},{"_id":"themes/next/docs/zh-CN/README.md","hash":"c038629ff8f3f24e8593c4c8ecf0bef3a35c750d","modified":1627608806000},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"94e0bbc7999b359baa42fa3731bdcf89c79ae2b3","modified":1627608806000},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"f1826ade2d135e2f60e2d95cb035383685b3370c","modified":1627608806000},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"d9ce7331c1236bbe0a551d56cef2405e47e65325","modified":1627608806000},{"_id":"themes/next/scripts/tags/label.js","hash":"fc5b267d903facb7a35001792db28b801cccb1f8","modified":1627608806000},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"d902fd313e8d35c3cc36f237607c2a0536c9edf1","modified":1627608806000},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"983c6c4adea86160ecc0ba2204bc312aa338121d","modified":1627608806000},{"_id":"themes/next/scripts/tags/note.js","hash":"0a02bb4c15aec41f6d5f1271cdb5c65889e265d9","modified":1627608806000},{"_id":"themes/next/scripts/tags/pdf.js","hash":"8c613b39e7bff735473e35244b5629d02ee20618","modified":1627608806000},{"_id":"themes/next/scripts/tags/tabs.js","hash":"93d8a734a3035c1d3f04933167b500517557ba3e","modified":1627608806000},{"_id":"themes/next/scripts/tags/video.js","hash":"e5ff4c44faee604dd3ea9db6b222828c4750c227","modified":1627608806000},{"_id":"themes/next/source/css/_colors.styl","hash":"a8442520f719d3d7a19811cb3b85bcfd4a596e1f","modified":1627608806000},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"34b88784ec120dfdc20fa82aadeb5f64ef614d14","modified":1627608806000},{"_id":"themes/next/source/css/_mixins.styl","hash":"e31a557f8879c2f4d8d5567ee1800b3e03f91f6e","modified":1627608806000},{"_id":"themes/next/source/css/main.styl","hash":"a3a3bbb5a973052f0186b3523911cb2539ff7b88","modified":1627608806000},{"_id":"themes/next/source/js/algolia-search.js","hash":"498d233eb5c7af6940baf94c1a1c36fdf1dd2636","modified":1627608806000},{"_id":"themes/next/source/js/local-search.js","hash":"35ccf100d8f9c0fd6bfbb7fa88c2a76c42a69110","modified":1627608806000},{"_id":"themes/next/source/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1627608806000},{"_id":"themes/next/source/js/bookmark.js","hash":"9734ebcb9b83489686f5c2da67dc9e6157e988ad","modified":1627608806000},{"_id":"themes/next/source/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1627608806000},{"_id":"themes/next/source/js/next-boot.js","hash":"a1b0636423009d4a4e4cea97bcbf1842bfab582c","modified":1627608806000},{"_id":"themes/next/source/js/utils.js","hash":"730cca7f164eaf258661a61ff3f769851ff1e5da","modified":1627608806000},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1627608806000},{"_id":"themes/next/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1627608806000},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1627608806000},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1627608806000},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1627608806000},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1627608806000},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1627608806000},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1627608806000},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1627608806000},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1627608806000},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1627608806000},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1627608806000},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1627608806000},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"71655ca21907e9061b6e8ac52d0d8fbf54d0062b","modified":1627608806000},{"_id":"themes/next/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1627608806000},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"d1f2bfde6f1da51a2b35a7ab9e7e8eb6eefd1c6b","modified":1627608806000},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"ef38c213679e7b6d2a4116f56c9e55d678446069","modified":1627608806000},{"_id":"themes/next/layout/_scripts/three.swig","hash":"a4f42f2301866bd25a784a2281069d8b66836d0b","modified":1627608806000},{"_id":"themes/next/layout/_macro/post.swig","hash":"090b5a9b6fca8e968178004cbd6cff205b7eba57","modified":1627608806000},{"_id":"themes/next/layout/_partials/comments.swig","hash":"db6ab5421b5f4b7cb32ac73ad0e053fdf065f83e","modified":1627608806000},{"_id":"themes/next/layout/_partials/languages.swig","hash":"ba9e272f1065b8f0e8848648caa7dea3f02c6be1","modified":1627608806000},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1627608806000},{"_id":"themes/next/layout/_third-party/baidu-push.swig","hash":"b782eb2e34c0c15440837040b5d65b093ab6ec04","modified":1627608806000},{"_id":"themes/next/layout/_partials/footer.swig","hash":"4369b313cbbeae742cb35f86d23d99d4285f7359","modified":1627608806000},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"a54708fd9309b4357c423a3730eb67f395344a5e","modified":1627608806000},{"_id":"themes/next/layout/_partials/widgets.swig","hash":"83a40ce83dfd5cada417444fb2d6f5470aae6bb0","modified":1627608806000},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"2731e262a6b88eaee2a3ca61e6a3583a7f594702","modified":1627608806000},{"_id":"themes/next/layout/_third-party/quicklink.swig","hash":"311e5eceec9e949f1ea8d623b083cec0b8700ff2","modified":1627608806000},{"_id":"themes/next/layout/_third-party/index.swig","hash":"70c3c01dd181de81270c57f3d99b6d8f4c723404","modified":1627608806000},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"7f2d93af012c1e14b8596fecbfc7febb43d9b7f5","modified":1627608806000},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"4c0c99c7e0f00849003dfce02a131104fb671137","modified":1627608806000},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"7f8b92913d21070b489457fa5ed996d2a55f2c32","modified":1627608806000},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"e51dc3072c1ba0ea3008f09ecae8b46242ec6021","modified":1627608806000},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"d5fefc31fba4ab0188305b1af1feb61da49fdeb0","modified":1627608806000},{"_id":"themes/next/layout/_scripts/pjax.swig","hash":"4d2c93c66e069852bb0e3ea2e268d213d07bfa3f","modified":1627608806000},{"_id":"themes/next/scripts/filters/comment/valine.js","hash":"6cbd85f9433c06bae22225ccf75ac55e04f2d106","modified":1627608806000},{"_id":"themes/next/scripts/events/lib/config.js","hash":"d34c6040b13649714939f59be5175e137de65ede","modified":1627608806000},{"_id":"themes/next/scripts/events/lib/injects-point.js","hash":"6661c1c91c7cbdefc6a5e6a034b443b8811235a1","modified":1627608806000},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"f233d8d0103ae7f9b861344aa65c1a3c1de8a845","modified":1627608806000},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"2486f3e0150c753e5f3af1a3665d074704b8ee2c","modified":1627608806000},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1627608806000},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1627608806000},{"_id":"themes/next/source/js/schemes/muse.js","hash":"1eb9b88103ddcf8827b1a7cbc56471a9c5592d53","modified":1627608806000},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"f4e694e5db81e57442c7e34505a416d818b3044a","modified":1627608806000},{"_id":"themes/next/source/js/schemes/pisces.js","hash":"0ac5ce155bc58c972fe21c4c447f85e6f8755c62","modified":1627608806000},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"f70be8e229da7e1715c11dd0e975a2e71e453ac8","modified":1627608806000},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"62df49459d552bbf73841753da8011a1f5e875c8","modified":1627608806000},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1627608806000},{"_id":"themes/next/layout/_scripts/pages/schedule.swig","hash":"077b5d66f6309f2e7dcf08645058ff2e03143e6c","modified":1627608806000},{"_id":"themes/next/source/css/_variables/base.styl","hash":"818508748b7a62e02035e87fe58e75b603ed56dc","modified":1627608806000},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1627608806000},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1627608806000},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"000bad572d76ee95d9c0a78f9ccdc8d97cc7d4b4","modified":1627608806000},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"810d544019e4a8651b756dd23e5592ee851eda71","modified":1627608806000},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"612ec843372dae709acb17112c1145a53450cc59","modified":1627608806000},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1627608806000},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"d31f896680a6c2f2c3f5128b4d4dd46c87ce2130","modified":1627608806000},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"7dbe93b8297b746afb89700b4d29289556e85267","modified":1627608806000},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"ae2261bea836581918a1c2b0d1028a78718434e0","modified":1627608806000},{"_id":"themes/next/layout/_partials/page/breadcrumb.swig","hash":"c851717497ca64789f2176c9ecd1dedab237b752","modified":1627608806000},{"_id":"themes/next/layout/_partials/header/menu-item.swig","hash":"9440d8a3a181698b80e1fa47f5104f4565d8cdf3","modified":1627608806000},{"_id":"themes/next/layout/_partials/page/page-header.swig","hash":"9b7a66791d7822c52117fe167612265356512477","modified":1627608806000},{"_id":"themes/next/layout/_partials/post/post-copyright.swig","hash":"954ad71536b6eb08bd1f30ac6e2f5493b69d1c04","modified":1627608806000},{"_id":"themes/next/layout/_partials/post/post-followme.swig","hash":"ceba16b9bd3a0c5c8811af7e7e49d0f9dcb2f41e","modified":1627608806000},{"_id":"themes/next/layout/_partials/post/post-reward.swig","hash":"2b1a73556595c37951e39574df5a3f20b2edeaef","modified":1627608806000},{"_id":"themes/next/layout/_partials/search/algolia-search.swig","hash":"48430bd03b8f19c9b8cdb2642005ed67d56c6e0b","modified":1627608806000},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"2be50f9bfb1c56b85b3b6910a7df27f51143632c","modified":1627608806000},{"_id":"themes/next/layout/_partials/sidebar/site-overview.swig","hash":"c46849e0af8f8fb78baccd40d2af14df04a074af","modified":1627608806000},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"4790058691b7d36cf6d2d6b4e93795a7b8d608ad","modified":1627608806000},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"2fa2b51d56bfac6a1ea76d651c93b9c20b01c09b","modified":1627608806000},{"_id":"themes/next/layout/_third-party/analytics/growingio.swig","hash":"5adea065641e8c55994dd2328ddae53215604928","modified":1627608806000},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"1472cabb0181f60a6a0b7fec8899a4d03dfb2040","modified":1627608806000},{"_id":"themes/next/layout/_partials/post/post-footer.swig","hash":"8f14f3f8a1b2998d5114cc56b680fb5c419a6b07","modified":1627608806000},{"_id":"themes/next/layout/_third-party/chat/chatra.swig","hash":"f910618292c63871ca2e6c6e66c491f344fa7b1f","modified":1627608806000},{"_id":"themes/next/layout/_third-party/chat/tidio.swig","hash":"cba0e6e0fad08568a9e74ba9a5bee5341cfc04c1","modified":1627608806000},{"_id":"themes/next/layout/_third-party/search/algolia-search.swig","hash":"d35a999d67f4c302f76fdf13744ceef3c6506481","modified":1627608806000},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"767b6c714c22588bcd26ba70b0fc19b6810cbacd","modified":1627608806000},{"_id":"themes/next/layout/_third-party/search/swiftype.swig","hash":"ba0dbc06b9d244073a1c681ff7a722dcbf920b51","modified":1627608806000},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.swig","hash":"4b1986e43d6abce13450d2b41a736dd6a5620a10","modified":1627608806000},{"_id":"themes/next/layout/_scripts/index.swig","hash":"cea942b450bcb0f352da78d76dc6d6f1d23d5029","modified":1627608806000},{"_id":"themes/next/layout/_partials/post/post-related.swig","hash":"f79c44692451db26efce704813f7a8872b7e63a0","modified":1627608806000},{"_id":"themes/next/layout/_third-party/statistics/cnzz-analytics.swig","hash":"a17ace37876822327a2f9306a472974442c9005d","modified":1627608806000},{"_id":"themes/next/layout/_third-party/statistics/firestore.swig","hash":"b26ac2bfbe91dd88267f8b96aee6bb222b265b7a","modified":1627608806000},{"_id":"themes/next/layout/_third-party/tags/mermaid.swig","hash":"f3c43664a071ff3c0b28bd7e59b5523446829576","modified":1627608806000},{"_id":"themes/next/layout/_third-party/statistics/index.swig","hash":"5f6a966c509680dbfa70433f9d658cee59c304d7","modified":1627608806000},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"f48a6a8eba04eb962470ce76dd731e13074d4c45","modified":1627608806000},{"_id":"themes/next/layout/_third-party/tags/pdf.swig","hash":"d30b0e255a8092043bac46441243f943ed6fb09b","modified":1627608806000},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"9c8dc0b8170679cdc1ee9ee8dbcbaebf3f42897b","modified":1627608806000},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"f39a5bf3ce9ee9adad282501235e0c588e4356ec","modified":1627608806000},{"_id":"themes/next/layout/_third-party/comments/gitalk.swig","hash":"d6ceb70648555338a80ae5724b778c8c58d7060d","modified":1627608806000},{"_id":"themes/next/layout/_third-party/comments/disqusjs.swig","hash":"82f5b6822aa5ec958aa987b101ef860494c6cf1f","modified":1627608806000},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.swig","hash":"d56d5af427cdfecc33a0f62ee62c056b4e33d095","modified":1627608806000},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"be0a8eccf1f6dc21154af297fc79555343031277","modified":1627608806000},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"ecf751321e799f0fb3bf94d049e535130e2547aa","modified":1627608806000},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"4791c977a730f29c846efcf6c9c15131b9400ead","modified":1627608806000},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"c70f8e71e026e878a4e9d5ab3bbbf9b0b23c240c","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"7785bd756e0c4acede3a47fec1ed7b55988385a5","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"7104b9cef90ca3b140d7a7afcf15540a250218fc","modified":1627608806000},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"f7a9eca599a682479e8ca863db59be7c9c7508c8","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"bb7ace23345364eb14983e860a7172e1683a4c94","modified":1627608806000},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"b14908644225d78c864cd0a9b60c52407de56183","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"6136da4bbb7e70cec99f5c7ae8c7e74f5e7c261a","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"f0131db6275ceaecae7e1a6a3798b8f89f6c850d","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"a717969829fa6ef88225095737df3f8ee86c286b","modified":1627608806000},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"6c5976621efd5db5f7c4c6b4f11bc79d6554885f","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"4d1c17345d2d39ef7698f7acf82dfc0f59308c34","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"f6516d0f7d89dc7b6c6e143a5af54b926f585d82","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"93db5dafe9294542a6b5f647643cb9deaced8e06","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"2b2e7b5cea7783c9c8bb92655e26a67c266886f0","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"e282df938bd029f391c466168d0e68389978f120","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"70a4324b70501132855b5e59029acfc5d3da1ebd","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"85da2f3006f4bef9a2199416ecfab4d288f848c4","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"e740deadcfc4f29c5cb01e40f9df6277262ba4e3","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"ca5e70662dcfb261c25191cc5db5084dcf661c76","modified":1627608806000},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"44f47c88c06d89d06f220f102649057118715828","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"a47725574e1bee3bc3b63b0ff2039cc982b17eff","modified":1627608806000},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1627608806000},{"_id":"themes/next/source/lib/font-awesome/css/all.min.css","hash":"0038dc97c79451578b7bd48af60ba62282b4082b","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"681d33e3bc85bdca407d93b134c089264837378c","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"8e7b57a72e757cf95278239641726bb2d5b869d1","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"0b2c4b78eead410020d7c4ded59c75592a648df8","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"a2e9e00962e43e98ec2614d6d248ef1773bb9b78","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"2e3bf7baf383c9073ec5e67f157d3cb3823c0957","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"b1f0fab7344a20ed6748b04065b141ad423cf4d9","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"a1690e035b505d28bdef2b4424c13fc6312ab049","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"179e33b8ac7f4d8a8e76736a7e4f965fe9ab8b42","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"8f58570a1bbc34c4989a47a1b7d42a8030f38b06","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"18ce72d90459c9aa66910ac64eae115f2dde3767","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"e771dcb0b4673e063c0f3e2d73e7336ac05bcd57","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"fafc96c86926b22afba8bb9418c05e6afbc05a57","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"902569a9dea90548bec21a823dd3efd94ff7c133","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"e75693f33dbc92afc55489438267869ae2f3db54","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f49ca072b5a800f735e8f01fc3518f885951dd8e","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"ded41fd9d20a5e8db66aaff7cc50f105f5ef2952","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"1e4190c10c9e0c9ce92653b0dbcec21754b0b69d","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"d21d4ac1982c13d02f125a67c065412085a92ff2","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"72d495a88f7d6515af425c12cbc67308a57d88ea","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"6a97bcfa635d637dc59005be3b931109e0d1ead5","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"f5c2788a78790aca1a2f37f7149d6058afb539e0","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"99e12c9ce3d14d4837e3d3f12fc867ba9c565317","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"65cb6edb69e94e70e3291e9132408361148d41d5","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"5b5649b9749e3fd8b63aef22ceeece0a6e1df605","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"8a7fc03a568b95be8d3337195e38bc7ec5ba2b23","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"d114b2a531129e739a27ba6271cfe6857aa9a865","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"a760ee83ba6216871a9f14c5e56dc9bd0d9e2103","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"9f0b93d109c9aec79450c8a0cf4a4eab717d674d","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"b49e9fbd3c182b8fc066b8c2caf248e3eb748619","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"e2d606f1ac343e9be4f15dbbaf3464bc4df8bf81","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"e7a9fdb6478b8674b1cdf94de4f8052843fb71d9","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"45a239edca44acecf971d99b04f30a1aafbf6906","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/footer/footer.styl","hash":"454a4aebfabb4469b92a8cbb49f46c49ac9bf165","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/header/header.styl","hash":"a793cfff86ad4af818faef04c18013077873f8f0","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"b2fc519828fe89a1f8f03ff7b809ad68cd46f3d7","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"5f432a6ed9ca80a413c68b00e93d4a411abf280a","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/header/headerband.styl","hash":"0caf32492692ba8e854da43697a2ec8a41612194","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"2cb1876e9e0c9ac32160888af27b1178dbcb0616","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"44487d9ab290dc97871fa8dd4487016deb56e123","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"9b479c2f9a9bfed77885e5093b8245cc5d768ec7","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"a05a4031e799bc864a4536f9ef61fe643cd421af","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"b3220db827e1adbca7880c2bb23e78fa7cbe95cb","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"fa0222197b5eee47e18ac864cdc6eac75678b8fe","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"2bd0eb1512415325653b26d62a4463e6de83c5ac","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar.styl","hash":"a9cd93c36bae5af9223e7804963096274e8a4f03","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"a960a2dd587b15d3b3fe1b59525d6fa971c6a6ec","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"1f0e7fbe80956f47087c2458ea880acf7a83078b","modified":1627608806000},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"2a47f8a6bb589c2fb635e6c1e4a2563c7f63c407","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"f71a3e86c05ea668b008cf05a81f67d92b6d65e4","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/highlight/diff.styl","hash":"d3f73688bb7423e3ab0de1efdf6db46db5e34f80","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/highlight/highlight.styl","hash":"35c871a809afa8306c8cde13651010e282548bc6","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"1d2778ca5aeeeafaa690dc2766b01b352ab76a02","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"709d10f763e357e1472d6471f8be384ec9e2d983","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/highlight/theme.styl","hash":"3b3acc5caa0b95a2598bef4eeacb21bab21bea56","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"d7fce4b51b5f4b7c31d93a9edb6c6ce740aa0d6b","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"f23670f1d8e749f3e83766d446790d8fd9620278","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"e4d9a77ffe98e851c1202676940097ba28253313","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b49c64f8e9a6ca1c45c0ba98febf1974fdd03616","modified":1627608806000},{"_id":"themes/next/source/css/_common/scaffolding/tags/tags.styl","hash":"9e4c0653cfd3cc6908fa0d97581bcf80861fb1e7","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"e2992846b39bf3857b5104675af02ba73e72eed5","modified":1627608806000},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"9a878d0119785a2316f42aebcceaa05a120b9a7a","modified":1627608806000},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1627608806000},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1627608806000},{"_id":"public/about/index.html","hash":"76d5ed1cd33e96a0c6c69a5606e1396adecc156b","modified":1691594264541},{"_id":"public/categories/index.html","hash":"bf6e38dec1bc0d884e124f0196ed6923b4c575bc","modified":1691594264541},{"_id":"public/schedule/index.html","hash":"ddeb8f86677c71c52d8ebc78cc2283f648fd8a99","modified":1691594264541},{"_id":"public/tags/index.html","hash":"eb385abb9e883f3067f72636d192099af912b12a","modified":1691594264541},{"_id":"public/2023/04/13/office-add-in-debug/index.html","hash":"2176f4568dcbea5db2037c63744dd261674afb22","modified":1691594264541},{"_id":"public/2023/03/21/vue3-scoped/index.html","hash":"bd3334271e15b5fa1b1c3fa47ee293868dff0dfa","modified":1691594264541},{"_id":"public/2023/03/08/node-module-rule/index.html","hash":"d6094bf157a01d7352973cdae40a8e52145a4a8e","modified":1691594264541},{"_id":"public/2023/02/18/deep-copy/index.html","hash":"363a2250ccdebac606467b96b900ab349a415e3f","modified":1691594264541},{"_id":"public/2022/05/14/npm-taobao/index.html","hash":"e7bb17a14f64ec312f9f8d3c7dc62a8e981e7ec5","modified":1691594264541},{"_id":"public/2022/05/14/react-devtools/index.html","hash":"e2bc078f2f74b8628afce1ca2c0643a69a40fd89","modified":1691594264541},{"_id":"public/2022/05/10/handwrite-ajax/index.html","hash":"398a76be3560479ae864352c651ed7af264fc75a","modified":1691594264541},{"_id":"public/2022/05/08/picgo/index.html","hash":"77141ce5ff8ff7bbee094d5535cade9ec5116e3c","modified":1691594264541},{"_id":"public/archives/index.html","hash":"6a675d677ff7b36f4683a8fee472844b37073bbb","modified":1691594264541},{"_id":"public/archives/page/2/index.html","hash":"2ee8371d52214f9f561f2f5164e46fbcf40608b4","modified":1691594264541},{"_id":"public/archives/page/3/index.html","hash":"396acd27947e7cad4ead2c78e5101b7c7fcf5dc3","modified":1691594264541},{"_id":"public/archives/page/4/index.html","hash":"47e6b9112788ce46803afb6b2108765c48b1e417","modified":1691594264541},{"_id":"public/archives/2022/index.html","hash":"c4410e667efef5686557ef72031e41d054ae8802","modified":1691594264541},{"_id":"public/archives/2022/page/2/index.html","hash":"32c504b2049bdd712c775188309fa348a499fe6f","modified":1691594264541},{"_id":"public/archives/2022/page/3/index.html","hash":"c9f5e2284b15d92a1202fd3d815de2c1b4be446b","modified":1691594264541},{"_id":"public/archives/2022/02/index.html","hash":"f7478cdac629f954c6fc061cebf87153aeb23e81","modified":1691594264541},{"_id":"public/archives/2022/03/index.html","hash":"9f2489723884bdc82b63684ac7b1b16bb4844384","modified":1691594264541},{"_id":"public/archives/2022/05/index.html","hash":"fd31e4014f4be2d167cb1dc5beca42e7c3bf717b","modified":1691594264541},{"_id":"public/archives/2022/05/page/2/index.html","hash":"b00398921b091f8f62ee28f33761fb495f11ff15","modified":1691594264541},{"_id":"public/archives/2022/06/index.html","hash":"9fff3052df6c8937fdc0d009f27222d9f9b59da9","modified":1691594264541},{"_id":"public/archives/2023/index.html","hash":"91c3dff6a5b1a0cdcbc32685056b85a775f48689","modified":1691594264541},{"_id":"public/archives/2023/page/2/index.html","hash":"34edfce308681ef22bdc0002360defb8232fa6ac","modified":1691594264541},{"_id":"public/archives/2023/02/index.html","hash":"e224dfe46cd3425f6a505523b9c300b40b34b585","modified":1691594264541},{"_id":"public/archives/2023/03/index.html","hash":"0935d5e8164ddf4b41b32fb43039a964d6ded35f","modified":1691594264541},{"_id":"public/archives/2023/03/page/2/index.html","hash":"04328e55ae378113e25752044d7af7306b45330c","modified":1691594264541},{"_id":"public/archives/2023/04/index.html","hash":"54a72031b8af9331b7f7e83ead278ca7d30f7a46","modified":1691594264541},{"_id":"public/archives/2023/08/index.html","hash":"f76f980fa1782aa43e77be3a2fa01385c84c8fd0","modified":1691594264541},{"_id":"public/categories/算法/index.html","hash":"17880f58883a698e1bab1664c62b2b4439ae6534","modified":1691594264541},{"_id":"public/categories/JavaScript/index.html","hash":"df5b33448bf311ac88e78088446ca34dae7081c9","modified":1691594264541},{"_id":"public/categories/JavaScript/page/2/index.html","hash":"0eef4e0eaaefd13a8985a74a036124d41f3a7cfb","modified":1691594264541},{"_id":"public/categories/博客/index.html","hash":"5dcba0efd0f34e76ba5679a9cdfbf96e3d21ccf0","modified":1691594264541},{"_id":"public/categories/服务器/index.html","hash":"db8b4383fec9f76cfa126746279e8b2787411eb6","modified":1691594264541},{"_id":"public/categories/浏览器/index.html","hash":"f547d2bb5eb424153563697e0774edb83b6bccff","modified":1691594264541},{"_id":"public/categories/前端/index.html","hash":"65545fb6f1bdd015ab22f0d697d24ed6fd70cd43","modified":1691594264541},{"_id":"public/categories/CSS/index.html","hash":"3a84f98921a9b77f21e55a6c631aa973616e5c6c","modified":1691594264541},{"_id":"public/categories/Node-js/index.html","hash":"85a49d12b4d38fc9099184dbcc487c279ee44451","modified":1691594264541},{"_id":"public/categories/工程化/index.html","hash":"35632829c8cc3a9578aa936a8753fe2968315683","modified":1691594264541},{"_id":"public/categories/工具/index.html","hash":"327c0b3ea39d443a5a1d0d956f586d6349b608ef","modified":1691594264541},{"_id":"public/categories/项目/index.html","hash":"c5bbad3079ac276fee5ea6ff49f34dc2f59289ab","modified":1691594264541},{"_id":"public/tags/算法/index.html","hash":"46087f94e49cefaa2f6fd8bac7b55f8eeeea6c57","modified":1691594264541},{"_id":"public/tags/JavaScript/index.html","hash":"8624abd8b0ec0f3bc09998cb8f787ea76e2da300","modified":1691594264541},{"_id":"public/tags/HTTP/index.html","hash":"eb8ab2da6f808ed7e49d66661e425f083cf351aa","modified":1691594264541},{"_id":"public/tags/高频/index.html","hash":"4774b5717c1973441c71ce8e3d2ced889fdf4d76","modified":1691594264541},{"_id":"public/tags/服务器/index.html","hash":"886880592739886eb254f37acf08d39c4bc103e5","modified":1691594264541},{"_id":"public/tags/浏览器/index.html","hash":"62fa6711e0d7875a5fc1b9b8515cc9cf2775d4dc","modified":1691594264541},{"_id":"public/tags/前端/index.html","hash":"248f40d0b7b56b5c5a60aae1af14b537b68b0629","modified":1691594264541},{"_id":"public/tags/手写/index.html","hash":"d34eeec01290691387ddecb0fe35ef390d0cd4e6","modified":1691594264541},{"_id":"public/tags/Node-js/index.html","hash":"06202bb13d0168cf01781a3d6a1330e91084eacc","modified":1691594264541},{"_id":"public/tags/npm/index.html","hash":"3ecbe31f9400f979bc02091a649494e4c85fbb2a","modified":1691594264541},{"_id":"public/tags/pdfs/index.html","hash":"0c9269b6f929cc6563936fd256830f34066515b2","modified":1691594264541},{"_id":"public/tags/office加载项/index.html","hash":"1ec22739c68e23ef09fa1b69e2a7685ae4d9b54f","modified":1691594264541},{"_id":"public/tags/Vue-js/index.html","hash":"3cf0c8c1412209747b4dead7f7d1bf6d7ac529b1","modified":1691594264541},{"_id":"public/tags/工具/index.html","hash":"1dfa5c951491db18443a5b36ed24276840e00838","modified":1691594264541},{"_id":"public/tags/react/index.html","hash":"5b0f0e15ac63f2a72a4190249af5bfc3a8b8e7cf","modified":1691594264541},{"_id":"public/tags/工程化/index.html","hash":"1c7520770f22db178346be1e3452c363ca33ea10","modified":1691594264541},{"_id":"public/tags/golang/index.html","hash":"cc864f0b8151c4af7cd7ea30b6a7ce2402d21026","modified":1691594264541},{"_id":"public/tags/CSS/index.html","hash":"898231008ea3e9e87210f88cc35bc81afeed4f9f","modified":1691594264541},{"_id":"public/tags/TypeScript/index.html","hash":"ac633570fa37ebdb10bc548bc8d3ecf18b9ddd1e","modified":1691594264541},{"_id":"public/tags/博客/index.html","hash":"719a9602f8ca1fb5ef2dd0dc50b2d79f17dff5d8","modified":1691594264541},{"_id":"public/links/index.html","hash":"fe57ba777cd6bcb7e180772a0697904bd27cc007","modified":1691594264541},{"_id":"public/2023/08/09/pdfjs-font-missing/index.html","hash":"e5521c1765565ca79b5abdd5c6e12cbd355d3b88","modified":1691594264541},{"_id":"public/2023/03/21/tailwindcss101/index.html","hash":"bf0c0aa386d5ae6f794ee4bfbdaa1342e5448821","modified":1691594264541},{"_id":"public/2023/03/20/breakpoint-upload/index.html","hash":"58033ee7f3d76642560a771daaccd7ddcf8b8a39","modified":1691594264541},{"_id":"public/2023/03/18/big-file-upload/index.html","hash":"549a5e017adebc34b5171eb1e589cfc0aef2e694","modified":1691594264541},{"_id":"public/2023/03/12/project-husky/index.html","hash":"1d68e78e85b6c1424a8a46f7aac9b16bbc13a473","modified":1691594264541},{"_id":"public/2023/03/11/git-hooks/index.html","hash":"6687d9f959891e32e29ecafba0dd97318700dc91","modified":1691594264541},{"_id":"public/2023/03/07/vue-devtools/index.html","hash":"fbef6130a057965cac2eaaeb0c674c0cfc979f92","modified":1691594264541},{"_id":"public/2023/03/07/tsconfig-json/index.html","hash":"f41b08e0473b496537ced99ab61a0a1870f6c926","modified":1691594264541},{"_id":"public/2023/03/06/scss101/index.html","hash":"f7ebf058888844bcdf34e36eeea10d27360966ff","modified":1691594264541},{"_id":"public/2023/03/06/pinia101/index.html","hash":"7b8f26c38766f28c21c830f6a20aaaac2ad210ca","modified":1691594264541},{"_id":"public/2023/03/01/vue3-scene/index.html","hash":"de02d9e6691bdb81645eddb33becbbb5ec969983","modified":1691594264541},{"_id":"public/2023/02/18/flex-1/index.html","hash":"4d80cbe5548d1e34b2b7d8986dc2bd58bb654355","modified":1691594264541},{"_id":"public/2023/02/15/browser-cache/index.html","hash":"4432b2a0c38fc81ef187f036a3b1b4a06575f25a","modified":1691594264541},{"_id":"public/2023/02/15/debounce-throttle/index.html","hash":"ba5a5e9b0af30abda8a6663e0417fbd3b183889a","modified":1691594264541},{"_id":"public/2022/06/21/css-basic-layout/index.html","hash":"164331bf0ddaf52146844bec9ba2e46d6e9db14f","modified":1691594264541},{"_id":"public/2022/06/07/ts000/index.html","hash":"dbe5996db814417fb18caa9c744eef2fe44cc7d6","modified":1691594264541},{"_id":"public/2022/05/25/blog-next-links/index.html","hash":"c40ae77a2d397fb58af7256e5941590e8eafc2ac","modified":1691594264541},{"_id":"public/2022/06/07/reduce/index.html","hash":"0e381c296bdd8cac9530b08ff16bfc8be70790c7","modified":1691594264541},{"_id":"public/2022/05/14/click-coordinate/index.html","hash":"cdc1b52b42ccaa4ddabb81fe8e61a397368fa563","modified":1691594264541},{"_id":"public/2022/05/14/array-not-duplicate/index.html","hash":"c842a317ae071b868587d949dc98f0df3813ec6c","modified":1691594264541},{"_id":"public/2022/05/14/algorithm-brackets/index.html","hash":"8dffe1e14df7b37711f041c844175c7e3ec13082","modified":1691594264541},{"_id":"public/2022/05/14/project-flash-files/index.html","hash":"f6ddd7933e46b4cc861e2e902e5142ce77d497a4","modified":1691594264541},{"_id":"public/2022/05/14/vuepress101/index.html","hash":"b4c9147d95c391c36d9bb75ed66631f265064583","modified":1691594264541},{"_id":"public/2022/05/14/centos-nginx/index.html","hash":"ca48a470108f0728bf47718fdca12f0f225f621d","modified":1691594264541},{"_id":"public/2022/05/06/handwrite-delegate/index.html","hash":"d1856dee4a094aa8a0e8e08773e2ae8461459091","modified":1691594264541},{"_id":"public/2022/05/05/reflow-repaint/index.html","hash":"bf0f9ea8a465cc56ad36418385682a8ed9e5d0d5","modified":1691594264541},{"_id":"public/2022/05/05/handwrite-drag-div/index.html","hash":"9ddeff1a3d39a7d3ad90ef46ad07b285b5254116","modified":1691594264541},{"_id":"public/2022/05/04/canvas-svg/index.html","hash":"546ff66924274319c17f06e37e3606411a14d7da","modified":1691594264541},{"_id":"public/2022/05/02/handwrite-call-apply/index.html","hash":"bf7f6f4f03a90c95e8e25fc0114ad88d6b7bf0d2","modified":1691594264541},{"_id":"public/2022/03/20/cookie18/index.html","hash":"74c81edcf09834435dff53f5fae87fc5d606ac57","modified":1691594264541},{"_id":"public/2022/02/20/fe-code-review/index.html","hash":"0c3b2d9ce4a871ad5d59313a59b5c1873c8e4ddf","modified":1691594264541},{"_id":"public/index.html","hash":"9f937f52d5b89d103780b1c542ebd807829d2bc3","modified":1691594264541},{"_id":"public/page/2/index.html","hash":"df7be5b87d251ed2779195c09cab546e7f477a21","modified":1691594264541},{"_id":"public/page/3/index.html","hash":"c19c7006f84612cdd0289d2fd29c0a10c509676b","modified":1691594264541},{"_id":"public/page/4/index.html","hash":"58946234afe31ecfe7b8a203679d305e75e3bd9c","modified":1691594264541},{"_id":"public/sentence/index.html","hash":"13d39eb17a90846d843e8ae0962ac5928cd5faa0","modified":1691594264541},{"_id":"public/sentence/favicon.ico","hash":"164ddd0d96ed9f2da768144abeda52b61c731a3d","modified":1691594264541},{"_id":"public/sentence/css/jquery.fullPage.css","hash":"8b1a354749e0516830e463053e814e21772aceb0","modified":1691594264541},{"_id":"public/sentence/js/jquery.fullPage.min.js","hash":"7f36d0c6089b6400ea655625b943aacf853e607d","modified":1691594264541},{"_id":"public/CNAME","hash":"af0f2b80275224d3ad4d75b19bb77ceaca69106e","modified":1691594264541},{"_id":"public/sentence/js/jquery.fullPage.js","hash":"574e5a2c378b4ed6ef0b2e132db6320705ca3a4d","modified":1691594264541},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1691594264541},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1691594264541},{"_id":"public/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1691594264541},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1691594264541},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1691594264541},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1691594264541},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1691594264541},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1691594264541},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1691594264541},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1691594264541},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1691594264541},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1691594264541},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1691594264541},{"_id":"public/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1691594264541},{"_id":"public/js/algolia-search.js","hash":"498d233eb5c7af6940baf94c1a1c36fdf1dd2636","modified":1691594264541},{"_id":"public/js/bookmark.js","hash":"9734ebcb9b83489686f5c2da67dc9e6157e988ad","modified":1691594264541},{"_id":"public/js/local-search.js","hash":"35ccf100d8f9c0fd6bfbb7fa88c2a76c42a69110","modified":1691594264541},{"_id":"public/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1691594264541},{"_id":"public/js/next-boot.js","hash":"a1b0636423009d4a4e4cea97bcbf1842bfab582c","modified":1691594264541},{"_id":"public/js/utils.js","hash":"730cca7f164eaf258661a61ff3f769851ff1e5da","modified":1691594264541},{"_id":"public/js/schemes/muse.js","hash":"1eb9b88103ddcf8827b1a7cbc56471a9c5592d53","modified":1691594264541},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1691594264541},{"_id":"public/js/schemes/pisces.js","hash":"0ac5ce155bc58c972fe21c4c447f85e6f8755c62","modified":1691594264541},{"_id":"public/css/main.css","hash":"8bc00c8b6cdf356188d568d9f855370667d44c67","modified":1691594264541},{"_id":"public/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1691594264541},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1691594264541},{"_id":"public/lib/font-awesome/css/all.min.css","hash":"0038dc97c79451578b7bd48af60ba62282b4082b","modified":1691594264541},{"_id":"public/sentence/js/jquery-1.8.3.min.js","hash":"d3662db46dd6559d468f173e162a2212da07dc19","modified":1691594264541},{"_id":"public/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1691594264541},{"_id":"public/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1691594264541},{"_id":"public/sentence/images/1.jpg","hash":"1a124b38a0d1a4838842dcf648dbc6d6112e038d","modified":1691594264541},{"_id":"public/sentence/images/4.jpg","hash":"c4e924676e1510779dd23c7a6def20abbedec029","modified":1691594264541},{"_id":"public/sentence/images/3.jpg","hash":"2101cb22f4ab853d780d69ec68cf1ba6e2cfc857","modified":1691594264541},{"_id":"public/sentence/images/2.jpg","hash":"8b069bf02a7fc43027cefe39ab173d174a4357da","modified":1691594264541}],"Category":[{"name":"算法","_id":"cll3vjsh90004yt8w81w17bzo"},{"name":"JavaScript","_id":"cll3vjshg000cyt8w8kkkg3pf"},{"name":"博客","_id":"cll3vjshp000oyt8wf0jkaua4"},{"name":"服务器","_id":"cll3vjshv0011yt8wgt6fb1oa"},{"name":"浏览器","_id":"cll3vjshx001ayt8wgme7c144"},{"name":"前端","_id":"cll3vjsi0001iyt8wa9qx6p4x"},{"name":"CSS","_id":"cll3vjsi4001xyt8wbeagdrql"},{"name":"Node.js","_id":"cll3vjsi60024yt8w9b5d9yrl"},{"name":"工程化","_id":"cll3vjsi8002byt8w7nbe5pl0"},{"name":"工具","_id":"cll3vjsic002lyt8w92azhnco"},{"name":"项目","_id":"cll3vjsie002syt8wg5p268yk"}],"Data":[],"Page":[{"title":"关于我","date":"2022-05-02T10:46:45.000Z","type":"about","_content":"","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2022-05-02 18:46:45\ntype: \"about\"\n---\n","updated":"2022-05-02T11:02:04.437Z","path":"about/index.html","comments":1,"layout":"page","_id":"cll3vjsgy0000yt8w97ygah4q","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"分类","date":"2022-05-02T10:46:56.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2022-05-02 18:46:56\ntype: \"categories\"\n---\n","updated":"2022-05-02T11:01:09.334Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cll3vjsh70002yt8w7kenctgo","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"友情链接","date":"2021-06-15T16:34:27.000Z","type":"links","_content":"\n<div class=\"post-body\">\n   <div id=\"links\">\n      <style>\n         .links-content{\n         margin-top:1rem;\n         }\n         .link-navigation::after {\n         content: \" \";\n         display: block;\n         clear: both;\n         }\n         .card {\n         width: 45%;\n         font-size: 1rem;\n         padding: 10px 20px;\n         border-radius: 4px;\n         transition-duration: 0.15s;\n         margin-bottom: 1rem;\n         display:flex;\n         }\n         .card:nth-child(odd) {\n         float: left;\n         }\n         .card:nth-child(even) {\n         float: right;\n         }\n         .card:hover {\n         transform: scale(1.1);\n         box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.12), 0 0 6px 0 rgba(0, 0, 0, 0.04);\n         }\n         .card a {\n         border:none;\n         }\n         .card .ava {\n         width: 3rem!important;\n         height: 3rem!important;\n         margin:0!important;\n         margin-top: 6px!important;\n         margin-right: 1em!important;\n         border-radius:4px;\n         }\n         .card .card-header {\n         font-style: italic;\n         overflow: hidden;\n         width: 100%;\n         }\n         .card .card-header a {\n         font-style: normal;\n         color: #2bbc8a;\n         font-weight: bold;\n         text-decoration: none;\n         }\n         .card .card-header a:hover {\n         color: #d480aa;\n         text-decoration: none;\n         }\n         .card .card-header .info {\n         font-style:normal;\n         color:#a3a3a3;\n         font-size:14px;\n         min-width: 0;\n         overflow: hidden;\n         white-space: nowrap;\n         }\n      </style>\n      <div class=\"links-content\">\n         <div class=\"link-navigation\">\n            <div class=\"card\">\n               <img class=\"ava\" src=\"data:image/x-icon;base64,AAABAAEAIBoAAAEAIACQDQAAFgAAACgAAAAgAAAANAAAAAEAIAAAAAAAAA0AAEZcAABGXAAAAAAAAAAAAABTU1P3U1NT8lNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PyU1NT+FNTU/BTU1NnU1NTMlNTUzVTU1MzU1NTMVNTUzFTU1MxU1NTMlNTUzVTU1M1U1NTNVNTUzVTU1M0U1NTNVNTUzVTU1M1U1NTNVNTUzVTU1M1U1NTM1NTUzFTU1MwU1NTMVNTUzJTU1M1U1NTNVNTUzVTU1M1U1NTMlNTU2dTU1PwU1NT7VNTUz1TU1MAU1NTAFNTUxVTU1NIU1NTT1NTU05TU1MnU1NTAFNTUwBTU1MAU1NTAFNTUwJTU1MAU1NTAFNTUwBTU1MBU1NTAFNTUwBTU1MYU1NTSlNTU09TU1NNU1NTJFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTPVNTU+1TU1PtU1NTP1NTUwBTU1MRU1NTsVNTU9FTU1O/U1NTx1NTU9JTU1M2U1NTAFNTUwBTU1NDU1NTi1NTUwhTU1MAU1NTWlNTU3tTU1MAU1NTFlNTU7lTU1PPU1NTv1NTU8hTU1POU1NTLlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUy9TU1PXU1NTNFNTUwlTU1MTU1NTvVNTU3FTU1MAU1NTAFNTU19TU1PFU1NTC1NTUwBTU1N+U1NTrlNTUwBTU1M5U1NT11NTUy5TU1MJU1NTF1NTU8ZTU1NjU1NTAAAAAAAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTMVNTU9FTU1MiU1NTAFNTUwNTU1OxU1NTdVNTUwBTU1MAU1NTXlNTU8JTU1MLU1NTAFNTU3xTU1OrU1NTAFNTUzxTU1PRU1NTHFNTUwBTU1MHU1NTvFNTU2ZTU1MAAAAAAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MxU1NT0VNTUyNTU1MAU1NTBFNTU7FTU1N1U1NTAFNTUwBTU1NeU1NTwlNTUwtTU1MAU1NTfFNTU6tTU1MAU1NTO1NTU9JTU1MdU1NTAFNTUwhTU1O8U1NTZlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzFTU1PSU1NTIFNTUwBTU1MAU1NTsVNTU3ZTU1MAU1NTAFNTU1xTU1PDU1NTC1NTUwBTU1N8U1NTrFNTUwBTU1M8U1NT0lNTUxpTU1MAU1NTBFNTU7xTU1NnU1NTAAAAAAAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTI1NTU9ZTU1OCU1NTXFNTU2hTU1PXU1NTXVNTUwBTU1MGU1NTmlNTU7FTU1MEU1NTD1NTU7ZTU1OTU1NTAFNTUyxTU1PaU1NTfVNTU1xTU1NrU1NT2lNTU1FTU1MAAAAAAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MDU1NTYFNTU7hTU1O9U1NTvVNTU4hTU1MRU1NTAFNTUwtTU1OCU1NTPFNTUwBTU1MYU1NTiVNTUylTU1MAU1NTBFNTU2hTU1O5U1NTvVNTU7xTU1OBU1NTDlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUwBTU1MAU1NTBVNTUwlTU1MIU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwFTU1MAU1NTAFNTUwZTU1MJU1NTCFNTUwBTU1MAU1NTAFNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTAVNTU0hTU1OcU1NTpVNTU6NTU1NrU1NTClNTUwBTU1MAU1NTEVNTUyRTU1MCU1NTAFNTUz1TU1OZU1NTplNTU6VTU1N1U1NTD1NTUwBTU1MAU1NTDVNTUyZTU1MEU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MfU1NT0VNTU55TU1N9U1NTiFNTU9tTU1NTU1NTAFNTUwBTU1NXU1NTtFNTUwlTU1MTU1NTxlNTU6hTU1N9U1NTg1NTU9dTU1NnU1NTAFNTUwBTU1NBU1NTv1NTUxVTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzFTU1PTU1NTIVNTUwBTU1MBU1NTslNTU3VTU1MAU1NTAFNTU15TU1PDU1NTCVNTUyNTU1PVU1NTMlNTUwBTU1MAU1NTn1NTU4dTU1MAU1NTAFNTU0ZTU1PPU1NTFlNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTMVNTU9FTU1MjU1NTAFNTUwRTU1OxU1NTdVNTUwBTU1MAU1NTXlNTU8JTU1MJU1NTI1NTU9RTU1MzU1NTAFNTUwBTU1OeU1NThlNTUwBTU1MAU1NTRlNTU85TU1MWU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MxU1NT0VNTUyNTU1MAU1NTA1NTU7FTU1N1U1NTAFNTUwBTU1NdU1NTwlNTUwlTU1MkU1NT1FNTUzJTU1MAU1NTAFNTU55TU1OGU1NTAFNTUwBTU1NGU1NTzlNTUxZTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzBTU1PVU1NTKlNTUwBTU1MIU1NTuFNTU3NTU1MAU1NTAFNTU2VTU1PCU1NTCFNTUyJTU1PWU1NTOlNTUwBTU1MDU1NTpVNTU4ZTU1MAU1NTAFNTU05TU1PPU1NTFVNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTFlNTU8FTU1PCU1NTqlNTU7NTU1PaU1NTQlNTUwBTU1MMU1NTtFNTU5JTU1MBU1NTDVNTU7NTU1PIU1NTqlNTU7BTU1PcU1NTVFNTUwBTU1MGU1NTo1NTU6VTU1MGU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MAU1NTKFNTU2pTU1NxU1NTcFNTU0FTU1MDU1NTAFNTUwZTU1NDU1NTFVNTUwBTU1MAU1NTIVNTU2ZTU1NxU1NTcFNTU0lTU1MGU1NTAFNTUwNTU1M/U1NTHFNTUwBTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M8U1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUzxTU1PtU1NT9FBQUJZOTk5xTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5xUFBQllNTU/RVVVX7eHh4/4GBgf+CgoL/g4OD/39/f/+Dg4P/goKC/4CAgP+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4SEhP93d3f/VVVV+1paWvmlpaX/f39//5iYmP+xsbH/d3d3/6urq/+goKD/enp6/76+vv/Z2dn/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2tra/7e3t/9ZWVn5XFxc+ZaWlv9aWlr/dnZ2/5WVlf9SUlL/jY2N/4CAgP9UVFT/rKys/9zc3P/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/c3Nz/uLi4/1lZWflYWFj5np6e/5eXl/+kpKT/sbGx/5KSkv+urq7/qKio/5OTk/+1tbX/vb29/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/76+vv+ioqL/WFhY+VNTU/laWlr/X19f/15eXv9dXV3/X19f/11dXf9dXV3/X19f/11dXf9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1paWv9TU1P5AAAAAAAAAAAAAAAAAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/fe-life/\" target=\"_blank\">前端知识总结</a>\n                  </div>\n                  <div class=\"info\">汇总前端知识点</div>\n               </div>\n            </div>\n             <div class=\"card\">\n               <img class=\"ava\" src=\"https://cn.vuejs.org/images/logo.svg\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/vue-source-code/\" target=\"_blank\">Vue.js源码分析</a>\n                  </div>\n                  <div class=\"info\">剖析Vue.js源码</div>\n               </div>\n            </div>\n            <div class=\"card\">\n               <img class=\"ava\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMS41IC0xMC4yMzE3NCAyMyAyMC40NjM0OCI+CiAgPHRpdGxlPlJlYWN0IExvZ288L3RpdGxlPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIyLjA1IiBmaWxsPSIjNjFkYWZiIi8+CiAgPGcgc3Ryb2tlPSIjNjFkYWZiIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIi8+CiAgICA8ZWxsaXBzZSByeD0iMTEiIHJ5PSI0LjIiIHRyYW5zZm9ybT0icm90YXRlKDYwKSIvPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIiB0cmFuc2Zvcm09InJvdGF0ZSgxMjApIi8+CiAgPC9nPgo8L3N2Zz4K\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/reactdoc/\" target=\"_blank\">React文档</a>\n                  </div>\n                  <div class=\"info\">一个比官方文档好用的React文档</div>\n               </div>\n            </div>\n         </div>\n      </div>\n   </div>\n</div>\n","source":"links/index.md","raw":"---\ntitle: 友情链接\ndate: 2021-06-16 00:34:27\ntype: \"links\"\n---\n\n<div class=\"post-body\">\n   <div id=\"links\">\n      <style>\n         .links-content{\n         margin-top:1rem;\n         }\n         .link-navigation::after {\n         content: \" \";\n         display: block;\n         clear: both;\n         }\n         .card {\n         width: 45%;\n         font-size: 1rem;\n         padding: 10px 20px;\n         border-radius: 4px;\n         transition-duration: 0.15s;\n         margin-bottom: 1rem;\n         display:flex;\n         }\n         .card:nth-child(odd) {\n         float: left;\n         }\n         .card:nth-child(even) {\n         float: right;\n         }\n         .card:hover {\n         transform: scale(1.1);\n         box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.12), 0 0 6px 0 rgba(0, 0, 0, 0.04);\n         }\n         .card a {\n         border:none;\n         }\n         .card .ava {\n         width: 3rem!important;\n         height: 3rem!important;\n         margin:0!important;\n         margin-top: 6px!important;\n         margin-right: 1em!important;\n         border-radius:4px;\n         }\n         .card .card-header {\n         font-style: italic;\n         overflow: hidden;\n         width: 100%;\n         }\n         .card .card-header a {\n         font-style: normal;\n         color: #2bbc8a;\n         font-weight: bold;\n         text-decoration: none;\n         }\n         .card .card-header a:hover {\n         color: #d480aa;\n         text-decoration: none;\n         }\n         .card .card-header .info {\n         font-style:normal;\n         color:#a3a3a3;\n         font-size:14px;\n         min-width: 0;\n         overflow: hidden;\n         white-space: nowrap;\n         }\n      </style>\n      <div class=\"links-content\">\n         <div class=\"link-navigation\">\n            <div class=\"card\">\n               <img class=\"ava\" src=\"data:image/x-icon;base64,AAABAAEAIBoAAAEAIACQDQAAFgAAACgAAAAgAAAANAAAAAEAIAAAAAAAAA0AAEZcAABGXAAAAAAAAAAAAABTU1P3U1NT8lNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PyU1NT+FNTU/BTU1NnU1NTMlNTUzVTU1MzU1NTMVNTUzFTU1MxU1NTMlNTUzVTU1M1U1NTNVNTUzVTU1M0U1NTNVNTUzVTU1M1U1NTNVNTUzVTU1M1U1NTM1NTUzFTU1MwU1NTMVNTUzJTU1M1U1NTNVNTUzVTU1M1U1NTMlNTU2dTU1PwU1NT7VNTUz1TU1MAU1NTAFNTUxVTU1NIU1NTT1NTU05TU1MnU1NTAFNTUwBTU1MAU1NTAFNTUwJTU1MAU1NTAFNTUwBTU1MBU1NTAFNTUwBTU1MYU1NTSlNTU09TU1NNU1NTJFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTPVNTU+1TU1PtU1NTP1NTUwBTU1MRU1NTsVNTU9FTU1O/U1NTx1NTU9JTU1M2U1NTAFNTUwBTU1NDU1NTi1NTUwhTU1MAU1NTWlNTU3tTU1MAU1NTFlNTU7lTU1PPU1NTv1NTU8hTU1POU1NTLlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUy9TU1PXU1NTNFNTUwlTU1MTU1NTvVNTU3FTU1MAU1NTAFNTU19TU1PFU1NTC1NTUwBTU1N+U1NTrlNTUwBTU1M5U1NT11NTUy5TU1MJU1NTF1NTU8ZTU1NjU1NTAAAAAAAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTMVNTU9FTU1MiU1NTAFNTUwNTU1OxU1NTdVNTUwBTU1MAU1NTXlNTU8JTU1MLU1NTAFNTU3xTU1OrU1NTAFNTUzxTU1PRU1NTHFNTUwBTU1MHU1NTvFNTU2ZTU1MAAAAAAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MxU1NT0VNTUyNTU1MAU1NTBFNTU7FTU1N1U1NTAFNTUwBTU1NeU1NTwlNTUwtTU1MAU1NTfFNTU6tTU1MAU1NTO1NTU9JTU1MdU1NTAFNTUwhTU1O8U1NTZlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzFTU1PSU1NTIFNTUwBTU1MAU1NTsVNTU3ZTU1MAU1NTAFNTU1xTU1PDU1NTC1NTUwBTU1N8U1NTrFNTUwBTU1M8U1NT0lNTUxpTU1MAU1NTBFNTU7xTU1NnU1NTAAAAAAAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTI1NTU9ZTU1OCU1NTXFNTU2hTU1PXU1NTXVNTUwBTU1MGU1NTmlNTU7FTU1MEU1NTD1NTU7ZTU1OTU1NTAFNTUyxTU1PaU1NTfVNTU1xTU1NrU1NT2lNTU1FTU1MAAAAAAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MDU1NTYFNTU7hTU1O9U1NTvVNTU4hTU1MRU1NTAFNTUwtTU1OCU1NTPFNTUwBTU1MYU1NTiVNTUylTU1MAU1NTBFNTU2hTU1O5U1NTvVNTU7xTU1OBU1NTDlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUwBTU1MAU1NTBVNTUwlTU1MIU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwFTU1MAU1NTAFNTUwZTU1MJU1NTCFNTUwBTU1MAU1NTAFNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTAVNTU0hTU1OcU1NTpVNTU6NTU1NrU1NTClNTUwBTU1MAU1NTEVNTUyRTU1MCU1NTAFNTUz1TU1OZU1NTplNTU6VTU1N1U1NTD1NTUwBTU1MAU1NTDVNTUyZTU1MEU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MfU1NT0VNTU55TU1N9U1NTiFNTU9tTU1NTU1NTAFNTUwBTU1NXU1NTtFNTUwlTU1MTU1NTxlNTU6hTU1N9U1NTg1NTU9dTU1NnU1NTAFNTUwBTU1NBU1NTv1NTUxVTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzFTU1PTU1NTIVNTUwBTU1MBU1NTslNTU3VTU1MAU1NTAFNTU15TU1PDU1NTCVNTUyNTU1PVU1NTMlNTUwBTU1MAU1NTn1NTU4dTU1MAU1NTAFNTU0ZTU1PPU1NTFlNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTMVNTU9FTU1MjU1NTAFNTUwRTU1OxU1NTdVNTUwBTU1MAU1NTXlNTU8JTU1MJU1NTI1NTU9RTU1MzU1NTAFNTUwBTU1OeU1NThlNTUwBTU1MAU1NTRlNTU85TU1MWU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MxU1NT0VNTUyNTU1MAU1NTA1NTU7FTU1N1U1NTAFNTUwBTU1NdU1NTwlNTUwlTU1MkU1NT1FNTUzJTU1MAU1NTAFNTU55TU1OGU1NTAFNTUwBTU1NGU1NTzlNTUxZTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzBTU1PVU1NTKlNTUwBTU1MIU1NTuFNTU3NTU1MAU1NTAFNTU2VTU1PCU1NTCFNTUyJTU1PWU1NTOlNTUwBTU1MDU1NTpVNTU4ZTU1MAU1NTAFNTU05TU1PPU1NTFVNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTFlNTU8FTU1PCU1NTqlNTU7NTU1PaU1NTQlNTUwBTU1MMU1NTtFNTU5JTU1MBU1NTDVNTU7NTU1PIU1NTqlNTU7BTU1PcU1NTVFNTUwBTU1MGU1NTo1NTU6VTU1MGU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MAU1NTKFNTU2pTU1NxU1NTcFNTU0FTU1MDU1NTAFNTUwZTU1NDU1NTFVNTUwBTU1MAU1NTIVNTU2ZTU1NxU1NTcFNTU0lTU1MGU1NTAFNTUwNTU1M/U1NTHFNTUwBTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M8U1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUzxTU1PtU1NT9FBQUJZOTk5xTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5xUFBQllNTU/RVVVX7eHh4/4GBgf+CgoL/g4OD/39/f/+Dg4P/goKC/4CAgP+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4SEhP93d3f/VVVV+1paWvmlpaX/f39//5iYmP+xsbH/d3d3/6urq/+goKD/enp6/76+vv/Z2dn/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2tra/7e3t/9ZWVn5XFxc+ZaWlv9aWlr/dnZ2/5WVlf9SUlL/jY2N/4CAgP9UVFT/rKys/9zc3P/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/c3Nz/uLi4/1lZWflYWFj5np6e/5eXl/+kpKT/sbGx/5KSkv+urq7/qKio/5OTk/+1tbX/vb29/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/76+vv+ioqL/WFhY+VNTU/laWlr/X19f/15eXv9dXV3/X19f/11dXf9dXV3/X19f/11dXf9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1paWv9TU1P5AAAAAAAAAAAAAAAAAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/fe-life/\" target=\"_blank\">前端知识总结</a>\n                  </div>\n                  <div class=\"info\">汇总前端知识点</div>\n               </div>\n            </div>\n             <div class=\"card\">\n               <img class=\"ava\" src=\"https://cn.vuejs.org/images/logo.svg\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/vue-source-code/\" target=\"_blank\">Vue.js源码分析</a>\n                  </div>\n                  <div class=\"info\">剖析Vue.js源码</div>\n               </div>\n            </div>\n            <div class=\"card\">\n               <img class=\"ava\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMS41IC0xMC4yMzE3NCAyMyAyMC40NjM0OCI+CiAgPHRpdGxlPlJlYWN0IExvZ288L3RpdGxlPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIyLjA1IiBmaWxsPSIjNjFkYWZiIi8+CiAgPGcgc3Ryb2tlPSIjNjFkYWZiIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIi8+CiAgICA8ZWxsaXBzZSByeD0iMTEiIHJ5PSI0LjIiIHRyYW5zZm9ybT0icm90YXRlKDYwKSIvPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIiB0cmFuc2Zvcm09InJvdGF0ZSgxMjApIi8+CiAgPC9nPgo8L3N2Zz4K\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/reactdoc/\" target=\"_blank\">React文档</a>\n                  </div>\n                  <div class=\"info\">一个比官方文档好用的React文档</div>\n               </div>\n            </div>\n         </div>\n      </div>\n   </div>\n</div>\n","updated":"2022-05-27T01:14:33.686Z","path":"links/index.html","comments":1,"layout":"page","_id":"cll3vjshc0006yt8w1q1bfpsp","content":"<div class=\"post-body\">\n   <div id=\"links\">\n      <style>\n         .links-content{\n         margin-top:1rem;\n         }\n         .link-navigation::after {\n         content: \" \";\n         display: block;\n         clear: both;\n         }\n         .card {\n         width: 45%;\n         font-size: 1rem;\n         padding: 10px 20px;\n         border-radius: 4px;\n         transition-duration: 0.15s;\n         margin-bottom: 1rem;\n         display:flex;\n         }\n         .card:nth-child(odd) {\n         float: left;\n         }\n         .card:nth-child(even) {\n         float: right;\n         }\n         .card:hover {\n         transform: scale(1.1);\n         box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.12), 0 0 6px 0 rgba(0, 0, 0, 0.04);\n         }\n         .card a {\n         border:none;\n         }\n         .card .ava {\n         width: 3rem!important;\n         height: 3rem!important;\n         margin:0!important;\n         margin-top: 6px!important;\n         margin-right: 1em!important;\n         border-radius:4px;\n         }\n         .card .card-header {\n         font-style: italic;\n         overflow: hidden;\n         width: 100%;\n         }\n         .card .card-header a {\n         font-style: normal;\n         color: #2bbc8a;\n         font-weight: bold;\n         text-decoration: none;\n         }\n         .card .card-header a:hover {\n         color: #d480aa;\n         text-decoration: none;\n         }\n         .card .card-header .info {\n         font-style:normal;\n         color:#a3a3a3;\n         font-size:14px;\n         min-width: 0;\n         overflow: hidden;\n         white-space: nowrap;\n         }\n      </style>\n      <div class=\"links-content\">\n         <div class=\"link-navigation\">\n            <div class=\"card\">\n               <img class=\"ava\" src=\"data:image/x-icon;base64,AAABAAEAIBoAAAEAIACQDQAAFgAAACgAAAAgAAAANAAAAAEAIAAAAAAAAA0AAEZcAABGXAAAAAAAAAAAAABTU1P3U1NT8lNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PyU1NT+FNTU/BTU1NnU1NTMlNTUzVTU1MzU1NTMVNTUzFTU1MxU1NTMlNTUzVTU1M1U1NTNVNTUzVTU1M0U1NTNVNTUzVTU1M1U1NTNVNTUzVTU1M1U1NTM1NTUzFTU1MwU1NTMVNTUzJTU1M1U1NTNVNTUzVTU1M1U1NTMlNTU2dTU1PwU1NT7VNTUz1TU1MAU1NTAFNTUxVTU1NIU1NTT1NTU05TU1MnU1NTAFNTUwBTU1MAU1NTAFNTUwJTU1MAU1NTAFNTUwBTU1MBU1NTAFNTUwBTU1MYU1NTSlNTU09TU1NNU1NTJFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTPVNTU+1TU1PtU1NTP1NTUwBTU1MRU1NTsVNTU9FTU1O/U1NTx1NTU9JTU1M2U1NTAFNTUwBTU1NDU1NTi1NTUwhTU1MAU1NTWlNTU3tTU1MAU1NTFlNTU7lTU1PPU1NTv1NTU8hTU1POU1NTLlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUy9TU1PXU1NTNFNTUwlTU1MTU1NTvVNTU3FTU1MAU1NTAFNTU19TU1PFU1NTC1NTUwBTU1N+U1NTrlNTUwBTU1M5U1NT11NTUy5TU1MJU1NTF1NTU8ZTU1NjU1NTAAAAAAAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTMVNTU9FTU1MiU1NTAFNTUwNTU1OxU1NTdVNTUwBTU1MAU1NTXlNTU8JTU1MLU1NTAFNTU3xTU1OrU1NTAFNTUzxTU1PRU1NTHFNTUwBTU1MHU1NTvFNTU2ZTU1MAAAAAAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MxU1NT0VNTUyNTU1MAU1NTBFNTU7FTU1N1U1NTAFNTUwBTU1NeU1NTwlNTUwtTU1MAU1NTfFNTU6tTU1MAU1NTO1NTU9JTU1MdU1NTAFNTUwhTU1O8U1NTZlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzFTU1PSU1NTIFNTUwBTU1MAU1NTsVNTU3ZTU1MAU1NTAFNTU1xTU1PDU1NTC1NTUwBTU1N8U1NTrFNTUwBTU1M8U1NT0lNTUxpTU1MAU1NTBFNTU7xTU1NnU1NTAAAAAAAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTI1NTU9ZTU1OCU1NTXFNTU2hTU1PXU1NTXVNTUwBTU1MGU1NTmlNTU7FTU1MEU1NTD1NTU7ZTU1OTU1NTAFNTUyxTU1PaU1NTfVNTU1xTU1NrU1NT2lNTU1FTU1MAAAAAAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MDU1NTYFNTU7hTU1O9U1NTvVNTU4hTU1MRU1NTAFNTUwtTU1OCU1NTPFNTUwBTU1MYU1NTiVNTUylTU1MAU1NTBFNTU2hTU1O5U1NTvVNTU7xTU1OBU1NTDlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUwBTU1MAU1NTBVNTUwlTU1MIU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwFTU1MAU1NTAFNTUwZTU1MJU1NTCFNTUwBTU1MAU1NTAFNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTAVNTU0hTU1OcU1NTpVNTU6NTU1NrU1NTClNTUwBTU1MAU1NTEVNTUyRTU1MCU1NTAFNTUz1TU1OZU1NTplNTU6VTU1N1U1NTD1NTUwBTU1MAU1NTDVNTUyZTU1MEU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MfU1NT0VNTU55TU1N9U1NTiFNTU9tTU1NTU1NTAFNTUwBTU1NXU1NTtFNTUwlTU1MTU1NTxlNTU6hTU1N9U1NTg1NTU9dTU1NnU1NTAFNTUwBTU1NBU1NTv1NTUxVTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzFTU1PTU1NTIVNTUwBTU1MBU1NTslNTU3VTU1MAU1NTAFNTU15TU1PDU1NTCVNTUyNTU1PVU1NTMlNTUwBTU1MAU1NTn1NTU4dTU1MAU1NTAFNTU0ZTU1PPU1NTFlNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTMVNTU9FTU1MjU1NTAFNTUwRTU1OxU1NTdVNTUwBTU1MAU1NTXlNTU8JTU1MJU1NTI1NTU9RTU1MzU1NTAFNTUwBTU1OeU1NThlNTUwBTU1MAU1NTRlNTU85TU1MWU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MxU1NT0VNTUyNTU1MAU1NTA1NTU7FTU1N1U1NTAFNTUwBTU1NdU1NTwlNTUwlTU1MkU1NT1FNTUzJTU1MAU1NTAFNTU55TU1OGU1NTAFNTUwBTU1NGU1NTzlNTUxZTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzBTU1PVU1NTKlNTUwBTU1MIU1NTuFNTU3NTU1MAU1NTAFNTU2VTU1PCU1NTCFNTUyJTU1PWU1NTOlNTUwBTU1MDU1NTpVNTU4ZTU1MAU1NTAFNTU05TU1PPU1NTFVNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTFlNTU8FTU1PCU1NTqlNTU7NTU1PaU1NTQlNTUwBTU1MMU1NTtFNTU5JTU1MBU1NTDVNTU7NTU1PIU1NTqlNTU7BTU1PcU1NTVFNTUwBTU1MGU1NTo1NTU6VTU1MGU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MAU1NTKFNTU2pTU1NxU1NTcFNTU0FTU1MDU1NTAFNTUwZTU1NDU1NTFVNTUwBTU1MAU1NTIVNTU2ZTU1NxU1NTcFNTU0lTU1MGU1NTAFNTUwNTU1M/U1NTHFNTUwBTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M8U1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUzxTU1PtU1NT9FBQUJZOTk5xTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5xUFBQllNTU/RVVVX7eHh4/4GBgf+CgoL/g4OD/39/f/+Dg4P/goKC/4CAgP+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4SEhP93d3f/VVVV+1paWvmlpaX/f39//5iYmP+xsbH/d3d3/6urq/+goKD/enp6/76+vv/Z2dn/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2tra/7e3t/9ZWVn5XFxc+ZaWlv9aWlr/dnZ2/5WVlf9SUlL/jY2N/4CAgP9UVFT/rKys/9zc3P/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/c3Nz/uLi4/1lZWflYWFj5np6e/5eXl/+kpKT/sbGx/5KSkv+urq7/qKio/5OTk/+1tbX/vb29/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/76+vv+ioqL/WFhY+VNTU/laWlr/X19f/15eXv9dXV3/X19f/11dXf9dXV3/X19f/11dXf9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1paWv9TU1P5AAAAAAAAAAAAAAAAAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/fe-life/\" target=\"_blank\">前端知识总结</a>\n                  </div>\n                  <div class=\"info\">汇总前端知识点</div>\n               </div>\n            </div>\n             <div class=\"card\">\n               <img class=\"ava\" src=\"https://cn.vuejs.org/images/logo.svg\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/vue-source-code/\" target=\"_blank\">Vue.js源码分析</a>\n                  </div>\n                  <div class=\"info\">剖析Vue.js源码</div>\n               </div>\n            </div>\n            <div class=\"card\">\n               <img class=\"ava\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMS41IC0xMC4yMzE3NCAyMyAyMC40NjM0OCI+CiAgPHRpdGxlPlJlYWN0IExvZ288L3RpdGxlPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIyLjA1IiBmaWxsPSIjNjFkYWZiIi8+CiAgPGcgc3Ryb2tlPSIjNjFkYWZiIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIi8+CiAgICA8ZWxsaXBzZSByeD0iMTEiIHJ5PSI0LjIiIHRyYW5zZm9ybT0icm90YXRlKDYwKSIvPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIiB0cmFuc2Zvcm09InJvdGF0ZSgxMjApIi8+CiAgPC9nPgo8L3N2Zz4K\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/reactdoc/\" target=\"_blank\">React文档</a>\n                  </div>\n                  <div class=\"info\">一个比官方文档好用的React文档</div>\n               </div>\n            </div>\n         </div>\n      </div>\n   </div>\n</div>\n","site":{"data":{}},"excerpt":"","more":"<div class=\"post-body\">\n   <div id=\"links\">\n      <style>\n         .links-content{\n         margin-top:1rem;\n         }\n         .link-navigation::after {\n         content: \" \";\n         display: block;\n         clear: both;\n         }\n         .card {\n         width: 45%;\n         font-size: 1rem;\n         padding: 10px 20px;\n         border-radius: 4px;\n         transition-duration: 0.15s;\n         margin-bottom: 1rem;\n         display:flex;\n         }\n         .card:nth-child(odd) {\n         float: left;\n         }\n         .card:nth-child(even) {\n         float: right;\n         }\n         .card:hover {\n         transform: scale(1.1);\n         box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.12), 0 0 6px 0 rgba(0, 0, 0, 0.04);\n         }\n         .card a {\n         border:none;\n         }\n         .card .ava {\n         width: 3rem!important;\n         height: 3rem!important;\n         margin:0!important;\n         margin-top: 6px!important;\n         margin-right: 1em!important;\n         border-radius:4px;\n         }\n         .card .card-header {\n         font-style: italic;\n         overflow: hidden;\n         width: 100%;\n         }\n         .card .card-header a {\n         font-style: normal;\n         color: #2bbc8a;\n         font-weight: bold;\n         text-decoration: none;\n         }\n         .card .card-header a:hover {\n         color: #d480aa;\n         text-decoration: none;\n         }\n         .card .card-header .info {\n         font-style:normal;\n         color:#a3a3a3;\n         font-size:14px;\n         min-width: 0;\n         overflow: hidden;\n         white-space: nowrap;\n         }\n      </style>\n      <div class=\"links-content\">\n         <div class=\"link-navigation\">\n            <div class=\"card\">\n               <img class=\"ava\" src=\"data:image/x-icon;base64,AAABAAEAIBoAAAEAIACQDQAAFgAAACgAAAAgAAAANAAAAAEAIAAAAAAAAA0AAEZcAABGXAAAAAAAAAAAAABTU1P3U1NT8lNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PtU1NT7VNTU+1TU1PyU1NT+FNTU/BTU1NnU1NTMlNTUzVTU1MzU1NTMVNTUzFTU1MxU1NTMlNTUzVTU1M1U1NTNVNTUzVTU1M0U1NTNVNTUzVTU1M1U1NTNVNTUzVTU1M1U1NTM1NTUzFTU1MwU1NTMVNTUzJTU1M1U1NTNVNTUzVTU1M1U1NTMlNTU2dTU1PwU1NT7VNTUz1TU1MAU1NTAFNTUxVTU1NIU1NTT1NTU05TU1MnU1NTAFNTUwBTU1MAU1NTAFNTUwJTU1MAU1NTAFNTUwBTU1MBU1NTAFNTUwBTU1MYU1NTSlNTU09TU1NNU1NTJFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTPVNTU+1TU1PtU1NTP1NTUwBTU1MRU1NTsVNTU9FTU1O/U1NTx1NTU9JTU1M2U1NTAFNTUwBTU1NDU1NTi1NTUwhTU1MAU1NTWlNTU3tTU1MAU1NTFlNTU7lTU1PPU1NTv1NTU8hTU1POU1NTLlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUy9TU1PXU1NTNFNTUwlTU1MTU1NTvVNTU3FTU1MAU1NTAFNTU19TU1PFU1NTC1NTUwBTU1N+U1NTrlNTUwBTU1M5U1NT11NTUy5TU1MJU1NTF1NTU8ZTU1NjU1NTAAAAAAAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTMVNTU9FTU1MiU1NTAFNTUwNTU1OxU1NTdVNTUwBTU1MAU1NTXlNTU8JTU1MLU1NTAFNTU3xTU1OrU1NTAFNTUzxTU1PRU1NTHFNTUwBTU1MHU1NTvFNTU2ZTU1MAAAAAAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MxU1NT0VNTUyNTU1MAU1NTBFNTU7FTU1N1U1NTAFNTUwBTU1NeU1NTwlNTUwtTU1MAU1NTfFNTU6tTU1MAU1NTO1NTU9JTU1MdU1NTAFNTUwhTU1O8U1NTZlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzFTU1PSU1NTIFNTUwBTU1MAU1NTsVNTU3ZTU1MAU1NTAFNTU1xTU1PDU1NTC1NTUwBTU1N8U1NTrFNTUwBTU1M8U1NT0lNTUxpTU1MAU1NTBFNTU7xTU1NnU1NTAAAAAAAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTI1NTU9ZTU1OCU1NTXFNTU2hTU1PXU1NTXVNTUwBTU1MGU1NTmlNTU7FTU1MEU1NTD1NTU7ZTU1OTU1NTAFNTUyxTU1PaU1NTfVNTU1xTU1NrU1NT2lNTU1FTU1MAAAAAAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MDU1NTYFNTU7hTU1O9U1NTvVNTU4hTU1MRU1NTAFNTUwtTU1OCU1NTPFNTUwBTU1MYU1NTiVNTUylTU1MAU1NTBFNTU2hTU1O5U1NTvVNTU7xTU1OBU1NTDlNTUwAAAAAAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUwBTU1MAU1NTBVNTUwlTU1MIU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwFTU1MAU1NTAFNTUwZTU1MJU1NTCFNTUwBTU1MAU1NTAFNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTAVNTU0hTU1OcU1NTpVNTU6NTU1NrU1NTClNTUwBTU1MAU1NTEVNTUyRTU1MCU1NTAFNTUz1TU1OZU1NTplNTU6VTU1N1U1NTD1NTUwBTU1MAU1NTDVNTUyZTU1MEU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MfU1NT0VNTU55TU1N9U1NTiFNTU9tTU1NTU1NTAFNTUwBTU1NXU1NTtFNTUwlTU1MTU1NTxlNTU6hTU1N9U1NTg1NTU9dTU1NnU1NTAFNTUwBTU1NBU1NTv1NTUxVTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzFTU1PTU1NTIVNTUwBTU1MBU1NTslNTU3VTU1MAU1NTAFNTU15TU1PDU1NTCVNTUyNTU1PVU1NTMlNTUwBTU1MAU1NTn1NTU4dTU1MAU1NTAFNTU0ZTU1PPU1NTFlNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTMVNTU9FTU1MjU1NTAFNTUwRTU1OxU1NTdVNTUwBTU1MAU1NTXlNTU8JTU1MJU1NTI1NTU9RTU1MzU1NTAFNTUwBTU1OeU1NThlNTUwBTU1MAU1NTRlNTU85TU1MWU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MxU1NT0VNTUyNTU1MAU1NTA1NTU7FTU1N1U1NTAFNTUwBTU1NdU1NTwlNTUwlTU1MkU1NT1FNTUzJTU1MAU1NTAFNTU55TU1OGU1NTAFNTUwBTU1NGU1NTzlNTUxZTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M/U1NTAFNTUzBTU1PVU1NTKlNTUwBTU1MIU1NTuFNTU3NTU1MAU1NTAFNTU2VTU1PCU1NTCFNTUyJTU1PWU1NTOlNTUwBTU1MDU1NTpVNTU4ZTU1MAU1NTAFNTU05TU1PPU1NTFVNTUwAAAAAAU1NTAFNTUz9TU1PtU1NT7VNTUz9TU1MAU1NTFlNTU8FTU1PCU1NTqlNTU7NTU1PaU1NTQlNTUwBTU1MMU1NTtFNTU5JTU1MBU1NTDVNTU7NTU1PIU1NTqlNTU7BTU1PcU1NTVFNTUwBTU1MGU1NTo1NTU6VTU1MGU1NTAAAAAABTU1MAU1NTP1NTU+1TU1PtU1NTP1NTUwBTU1MAU1NTKFNTU2pTU1NxU1NTcFNTU0FTU1MDU1NTAFNTUwZTU1NDU1NTFVNTUwBTU1MAU1NTIVNTU2ZTU1NxU1NTcFNTU0lTU1MGU1NTAFNTUwNTU1M/U1NTHFNTUwBTU1MAAAAAAFNTUwBTU1M/U1NT7VNTU+1TU1M8U1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUwBTU1MAU1NTAFNTUzxTU1PtU1NT9FBQUJZOTk5xTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5zTk5Oc05OTnNOTk5xUFBQllNTU/RVVVX7eHh4/4GBgf+CgoL/g4OD/39/f/+Dg4P/goKC/4CAgP+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4SEhP93d3f/VVVV+1paWvmlpaX/f39//5iYmP+xsbH/d3d3/6urq/+goKD/enp6/76+vv/Z2dn/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2NjY/9jY2P/Y2Nj/2tra/7e3t/9ZWVn5XFxc+ZaWlv9aWlr/dnZ2/5WVlf9SUlL/jY2N/4CAgP9UVFT/rKys/9zc3P/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/a2tr/2tra/9ra2v/c3Nz/uLi4/1lZWflYWFj5np6e/5eXl/+kpKT/sbGx/5KSkv+urq7/qKio/5OTk/+1tbX/vb29/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/7y8vP+8vLz/vLy8/76+vv+ioqL/WFhY+VNTU/laWlr/X19f/15eXv9dXV3/X19f/11dXf9dXV3/X19f/11dXf9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1xcXP9cXFz/XFxc/1paWv9TU1P5AAAAAAAAAAAAAAAAAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/fe-life/\" target=\"_blank\">前端知识总结</a>\n                  </div>\n                  <div class=\"info\">汇总前端知识点</div>\n               </div>\n            </div>\n             <div class=\"card\">\n               <img class=\"ava\" src=\"https://cn.vuejs.org/images/logo.svg\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/vue-source-code/\" target=\"_blank\">Vue.js源码分析</a>\n                  </div>\n                  <div class=\"info\">剖析Vue.js源码</div>\n               </div>\n            </div>\n            <div class=\"card\">\n               <img class=\"ava\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMS41IC0xMC4yMzE3NCAyMyAyMC40NjM0OCI+CiAgPHRpdGxlPlJlYWN0IExvZ288L3RpdGxlPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIyLjA1IiBmaWxsPSIjNjFkYWZiIi8+CiAgPGcgc3Ryb2tlPSIjNjFkYWZiIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIi8+CiAgICA8ZWxsaXBzZSByeD0iMTEiIHJ5PSI0LjIiIHRyYW5zZm9ybT0icm90YXRlKDYwKSIvPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIiB0cmFuc2Zvcm09InJvdGF0ZSgxMjApIi8+CiAgPC9nPgo8L3N2Zz4K\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://awstudio.cn/reactdoc/\" target=\"_blank\">React文档</a>\n                  </div>\n                  <div class=\"info\">一个比官方文档好用的React文档</div>\n               </div>\n            </div>\n         </div>\n      </div>\n   </div>\n</div>\n"},{"title":"日程","date":"2022-05-02T10:46:52.000Z","type":"schedule","_content":"","source":"schedule/index.md","raw":"---\ntitle: 日程\ndate: 2022-05-02 18:46:52\ntype: \"schedule\"\n---\n","updated":"2022-05-02T13:33:02.680Z","path":"schedule/index.html","comments":1,"layout":"page","_id":"cll3vjshe0008yt8wcr49gci3","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"标签云","date":"2022-05-02T10:46:52.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签云\ndate: 2022-05-02 18:46:52\ntype: \"tags\"\n---\n","updated":"2022-05-02T11:00:27.542Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cll3vjshf000ayt8wbfa506dh","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"有效的括号","date":"2022-05-14T12:41:37.000Z","description":"有效的括号","_content":"\n## 一、问题描述\n给定一个只包括 '('，')'，'{'，'}'，'['，']' 的字符串 s ，判断字符串是否有效。\n\n有效字符串需满足：\n\n+ 左括号必须用相同类型的右括号闭合。\n+ 左括号必须以正确的顺序闭合。\n题目链接：有效的括号。\n\n\n\n\n## 二、题目要求\n样例 1\n```js\n输入： s = \"()\"\n输出： true\n```\n\n样例 2\n```js\n输入： s = \"([)]\"\n输出： false\n```\n\n考察\n1. 字符串、栈、哈希\n2. 建议用时20~35min\n\n\n\n## 三、问题分析\n这一题需要用到栈的相关知识点，如果没了解过栈的可以看一下这一篇文章，栈其实就是先进后出的存储结构。\n\n对于这一题的有效括号，我们可以先定义哈希表m特定化不同的6个括号。\n\n```js\nmap<char,int>m={{'(',1},{'{',2},{'[',3},\n                {')',4},{'}',5},{']',6}};\n```\n\n![有效的括号](https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/0221b6342a7f4eb48d7d4482b2a2a0e7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)\n\n如上面的动态图所示：\n\n只要前3个括号出现，那么就存储到栈里面去，后三个出现那么肯定要进行括号匹配消除的。消除的话，如果和栈第一个括号匹配成功，那么就弹出栈顶。\n\n如果匹配不成功，后三个括号入栈，那就完了，因为无论你后面有再多的括号，它也匹配不了，直接退出就行。\n\n\n\n\n## 四、编码实现\n```c++\nclass Solution {\npublic:\n    bool isValid(string s) {\n        int i,n=s.size();//初始化数据\n        bool flag=true;//一开始判断匹配成功\n        stack<char>k;\n        map<char,int>m={{'(',1},{'{',2},{'[',3},//哈希存储括号\n                        {')',4},{'}',5},{']',6}};\n        for(i=0;i<n;i++)//循环判断\n        {\n            if(m[s[i]]<=3)//前三个直接存储\n                k.push(s[i]);\n           \n            else if(!k.empty()&&m[s[i]]-3==m[k.top()])//后三个与栈顶匹配消除\n                    k.pop();\n            else//匹配失败\n            {\n                flag=false;\n                break;\n            }\n        }\n        if(!k.empty())//如果栈不为空，那也匹配失败\n            flag=false;\n        return flag;//返回结果\n        \n    }\n};\n```\n","source":"_posts/algorithm-brackets.md","raw":"---\ntitle: 有效的括号\ndate: 2022-05-14 20:41:37\ntags: 算法\ncategories: 算法\ndescription: 有效的括号\n---\n\n## 一、问题描述\n给定一个只包括 '('，')'，'{'，'}'，'['，']' 的字符串 s ，判断字符串是否有效。\n\n有效字符串需满足：\n\n+ 左括号必须用相同类型的右括号闭合。\n+ 左括号必须以正确的顺序闭合。\n题目链接：有效的括号。\n\n\n\n\n## 二、题目要求\n样例 1\n```js\n输入： s = \"()\"\n输出： true\n```\n\n样例 2\n```js\n输入： s = \"([)]\"\n输出： false\n```\n\n考察\n1. 字符串、栈、哈希\n2. 建议用时20~35min\n\n\n\n## 三、问题分析\n这一题需要用到栈的相关知识点，如果没了解过栈的可以看一下这一篇文章，栈其实就是先进后出的存储结构。\n\n对于这一题的有效括号，我们可以先定义哈希表m特定化不同的6个括号。\n\n```js\nmap<char,int>m={{'(',1},{'{',2},{'[',3},\n                {')',4},{'}',5},{']',6}};\n```\n\n![有效的括号](https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/0221b6342a7f4eb48d7d4482b2a2a0e7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)\n\n如上面的动态图所示：\n\n只要前3个括号出现，那么就存储到栈里面去，后三个出现那么肯定要进行括号匹配消除的。消除的话，如果和栈第一个括号匹配成功，那么就弹出栈顶。\n\n如果匹配不成功，后三个括号入栈，那就完了，因为无论你后面有再多的括号，它也匹配不了，直接退出就行。\n\n\n\n\n## 四、编码实现\n```c++\nclass Solution {\npublic:\n    bool isValid(string s) {\n        int i,n=s.size();//初始化数据\n        bool flag=true;//一开始判断匹配成功\n        stack<char>k;\n        map<char,int>m={{'(',1},{'{',2},{'[',3},//哈希存储括号\n                        {')',4},{'}',5},{']',6}};\n        for(i=0;i<n;i++)//循环判断\n        {\n            if(m[s[i]]<=3)//前三个直接存储\n                k.push(s[i]);\n           \n            else if(!k.empty()&&m[s[i]]-3==m[k.top()])//后三个与栈顶匹配消除\n                    k.pop();\n            else//匹配失败\n            {\n                flag=false;\n                break;\n            }\n        }\n        if(!k.empty())//如果栈不为空，那也匹配失败\n            flag=false;\n        return flag;//返回结果\n        \n    }\n};\n```\n","slug":"algorithm-brackets","published":1,"updated":"2022-05-14T12:44:09.738Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsh20001yt8wg1ua3sws","content":"<h2 id=\"一、问题描述\"><a href=\"#一、问题描述\" class=\"headerlink\" title=\"一、问题描述\"></a>一、问题描述</h2><p>给定一个只包括 ‘(‘，’)’，’{‘，’}’，’[‘，’]’ 的字符串 s ，判断字符串是否有效。</p>\n<p>有效字符串需满足：</p>\n<ul>\n<li>左括号必须用相同类型的右括号闭合。</li>\n<li>左括号必须以正确的顺序闭合。<br>题目链接：有效的括号。</li>\n</ul>\n<h2 id=\"二、题目要求\"><a href=\"#二、题目要求\" class=\"headerlink\" title=\"二、题目要求\"></a>二、题目要求</h2><p>样例 1</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">输入： s = <span class=\"string\">&quot;()&quot;</span></span><br><span class=\"line\">输出： <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>样例 2</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">输入： s = <span class=\"string\">&quot;([)]&quot;</span></span><br><span class=\"line\">输出： <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<p>考察</p>\n<ol>\n<li>字符串、栈、哈希</li>\n<li>建议用时20~35min</li>\n</ol>\n<h2 id=\"三、问题分析\"><a href=\"#三、问题分析\" class=\"headerlink\" title=\"三、问题分析\"></a>三、问题分析</h2><p>这一题需要用到栈的相关知识点，如果没了解过栈的可以看一下这一篇文章，栈其实就是先进后出的存储结构。</p>\n<p>对于这一题的有效括号，我们可以先定义哈希表m特定化不同的6个括号。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map&lt;char,int&gt;m=&#123;&#123;<span class=\"string\">&#x27;(&#x27;</span>,<span class=\"number\">1</span>&#125;,&#123;<span class=\"string\">&#x27;&#123;&#x27;</span>,<span class=\"number\">2</span>&#125;,&#123;<span class=\"string\">&#x27;[&#x27;</span>,<span class=\"number\">3</span>&#125;,</span><br><span class=\"line\">                &#123;<span class=\"string\">&#x27;)&#x27;</span>,<span class=\"number\">4</span>&#125;,&#123;<span class=\"string\">&#x27;&#125;&#x27;</span>,<span class=\"number\">5</span>&#125;,&#123;<span class=\"string\">&#x27;]&#x27;</span>,<span class=\"number\">6</span>&#125;&#125;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/0221b6342a7f4eb48d7d4482b2a2a0e7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"有效的括号\"></p>\n<p>如上面的动态图所示：</p>\n<p>只要前3个括号出现，那么就存储到栈里面去，后三个出现那么肯定要进行括号匹配消除的。消除的话，如果和栈第一个括号匹配成功，那么就弹出栈顶。</p>\n<p>如果匹配不成功，后三个括号入栈，那就完了，因为无论你后面有再多的括号，它也匹配不了，直接退出就行。</p>\n<h2 id=\"四、编码实现\"><a href=\"#四、编码实现\" class=\"headerlink\" title=\"四、编码实现\"></a>四、编码实现</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">isValid</span><span class=\"params\">(string s)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> i,n=s.<span class=\"built_in\">size</span>();<span class=\"comment\">//初始化数据</span></span><br><span class=\"line\">        <span class=\"type\">bool</span> flag=<span class=\"literal\">true</span>;<span class=\"comment\">//一开始判断匹配成功</span></span><br><span class=\"line\">        stack&lt;<span class=\"type\">char</span>&gt;k;</span><br><span class=\"line\">        map&lt;<span class=\"type\">char</span>,<span class=\"type\">int</span>&gt;m=&#123;&#123;<span class=\"string\">&#x27;(&#x27;</span>,<span class=\"number\">1</span>&#125;,&#123;<span class=\"string\">&#x27;&#123;&#x27;</span>,<span class=\"number\">2</span>&#125;,&#123;<span class=\"string\">&#x27;[&#x27;</span>,<span class=\"number\">3</span>&#125;,<span class=\"comment\">//哈希存储括号</span></span><br><span class=\"line\">                        &#123;<span class=\"string\">&#x27;)&#x27;</span>,<span class=\"number\">4</span>&#125;,&#123;<span class=\"string\">&#x27;&#125;&#x27;</span>,<span class=\"number\">5</span>&#125;,&#123;<span class=\"string\">&#x27;]&#x27;</span>,<span class=\"number\">6</span>&#125;&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;n;i++)<span class=\"comment\">//循环判断</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(m[s[i]]&lt;=<span class=\"number\">3</span>)<span class=\"comment\">//前三个直接存储</span></span><br><span class=\"line\">                k.<span class=\"built_in\">push</span>(s[i]);</span><br><span class=\"line\">           </span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(!k.<span class=\"built_in\">empty</span>()&amp;&amp;m[s[i]]<span class=\"number\">-3</span>==m[k.<span class=\"built_in\">top</span>()])<span class=\"comment\">//后三个与栈顶匹配消除</span></span><br><span class=\"line\">                    k.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">            <span class=\"keyword\">else</span><span class=\"comment\">//匹配失败</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                flag=<span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!k.<span class=\"built_in\">empty</span>())<span class=\"comment\">//如果栈不为空，那也匹配失败</span></span><br><span class=\"line\">            flag=<span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> flag;<span class=\"comment\">//返回结果</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、问题描述\"><a href=\"#一、问题描述\" class=\"headerlink\" title=\"一、问题描述\"></a>一、问题描述</h2><p>给定一个只包括 ‘(‘，’)’，’{‘，’}’，’[‘，’]’ 的字符串 s ，判断字符串是否有效。</p>\n<p>有效字符串需满足：</p>\n<ul>\n<li>左括号必须用相同类型的右括号闭合。</li>\n<li>左括号必须以正确的顺序闭合。<br>题目链接：有效的括号。</li>\n</ul>\n<h2 id=\"二、题目要求\"><a href=\"#二、题目要求\" class=\"headerlink\" title=\"二、题目要求\"></a>二、题目要求</h2><p>样例 1</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">输入： s = <span class=\"string\">&quot;()&quot;</span></span><br><span class=\"line\">输出： <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>样例 2</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">输入： s = <span class=\"string\">&quot;([)]&quot;</span></span><br><span class=\"line\">输出： <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<p>考察</p>\n<ol>\n<li>字符串、栈、哈希</li>\n<li>建议用时20~35min</li>\n</ol>\n<h2 id=\"三、问题分析\"><a href=\"#三、问题分析\" class=\"headerlink\" title=\"三、问题分析\"></a>三、问题分析</h2><p>这一题需要用到栈的相关知识点，如果没了解过栈的可以看一下这一篇文章，栈其实就是先进后出的存储结构。</p>\n<p>对于这一题的有效括号，我们可以先定义哈希表m特定化不同的6个括号。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map&lt;char,int&gt;m=&#123;&#123;<span class=\"string\">&#x27;(&#x27;</span>,<span class=\"number\">1</span>&#125;,&#123;<span class=\"string\">&#x27;&#123;&#x27;</span>,<span class=\"number\">2</span>&#125;,&#123;<span class=\"string\">&#x27;[&#x27;</span>,<span class=\"number\">3</span>&#125;,</span><br><span class=\"line\">                &#123;<span class=\"string\">&#x27;)&#x27;</span>,<span class=\"number\">4</span>&#125;,&#123;<span class=\"string\">&#x27;&#125;&#x27;</span>,<span class=\"number\">5</span>&#125;,&#123;<span class=\"string\">&#x27;]&#x27;</span>,<span class=\"number\">6</span>&#125;&#125;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/0221b6342a7f4eb48d7d4482b2a2a0e7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"有效的括号\"></p>\n<p>如上面的动态图所示：</p>\n<p>只要前3个括号出现，那么就存储到栈里面去，后三个出现那么肯定要进行括号匹配消除的。消除的话，如果和栈第一个括号匹配成功，那么就弹出栈顶。</p>\n<p>如果匹配不成功，后三个括号入栈，那就完了，因为无论你后面有再多的括号，它也匹配不了，直接退出就行。</p>\n<h2 id=\"四、编码实现\"><a href=\"#四、编码实现\" class=\"headerlink\" title=\"四、编码实现\"></a>四、编码实现</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">isValid</span><span class=\"params\">(string s)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> i,n=s.<span class=\"built_in\">size</span>();<span class=\"comment\">//初始化数据</span></span><br><span class=\"line\">        <span class=\"type\">bool</span> flag=<span class=\"literal\">true</span>;<span class=\"comment\">//一开始判断匹配成功</span></span><br><span class=\"line\">        stack&lt;<span class=\"type\">char</span>&gt;k;</span><br><span class=\"line\">        map&lt;<span class=\"type\">char</span>,<span class=\"type\">int</span>&gt;m=&#123;&#123;<span class=\"string\">&#x27;(&#x27;</span>,<span class=\"number\">1</span>&#125;,&#123;<span class=\"string\">&#x27;&#123;&#x27;</span>,<span class=\"number\">2</span>&#125;,&#123;<span class=\"string\">&#x27;[&#x27;</span>,<span class=\"number\">3</span>&#125;,<span class=\"comment\">//哈希存储括号</span></span><br><span class=\"line\">                        &#123;<span class=\"string\">&#x27;)&#x27;</span>,<span class=\"number\">4</span>&#125;,&#123;<span class=\"string\">&#x27;&#125;&#x27;</span>,<span class=\"number\">5</span>&#125;,&#123;<span class=\"string\">&#x27;]&#x27;</span>,<span class=\"number\">6</span>&#125;&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;n;i++)<span class=\"comment\">//循环判断</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(m[s[i]]&lt;=<span class=\"number\">3</span>)<span class=\"comment\">//前三个直接存储</span></span><br><span class=\"line\">                k.<span class=\"built_in\">push</span>(s[i]);</span><br><span class=\"line\">           </span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(!k.<span class=\"built_in\">empty</span>()&amp;&amp;m[s[i]]<span class=\"number\">-3</span>==m[k.<span class=\"built_in\">top</span>()])<span class=\"comment\">//后三个与栈顶匹配消除</span></span><br><span class=\"line\">                    k.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">            <span class=\"keyword\">else</span><span class=\"comment\">//匹配失败</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                flag=<span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!k.<span class=\"built_in\">empty</span>())<span class=\"comment\">//如果栈不为空，那也匹配失败</span></span><br><span class=\"line\">            flag=<span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> flag;<span class=\"comment\">//返回结果</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n"},{"title":"大文件上传实现","date":"2023-03-18T14:23:15.000Z","description":"本文从零搭建前端和服务端，实现一个大文件上传的 demo","_content":"\n本文从零搭建前端和服务端，实现一个大文件上传的 demo\n\n前端：Vue@2 + Element-ui\n\n服务端：Nodejs@14 + multiparty\n\n## 整体思路\n\n### 前端\n\n前端大文件上传网上的大部分文章已经给出了解决方案，核心是利用 `Blob.prototype.slice` 方法，和数组的 slice 方法相似，文件的 slice 方法可以返回原文件的某个切片。\n\n预先定义好单个切片大小，将文件切分为一个个切片，然后借助 http 的可并发性，同时上传多个切片。这样从原本传一个大文件，变成了并发传多个小的文件切片，可以大大减少上传时间。\n\n另外由于是并发，传输到服务端的顺序可能会发生变化，因此我们还需要给每个切片记录顺序。\n\n### 服务端\n\n服务端负责接受前端传输的切片，并在接收到所有切片后合并所有切片\n\n这里又引伸出两个问题\n\n1. 何时合并切片，即切片什么时候传输完成\n2. 如何合并切片\n\n第一个问题需要前端配合，前端在每个切片中都携带切片最大数量的信息，当服务端接受到这个数量的切片时自动合并。或者也可以额外发一个请求，主动通知服务端进行切片的合并。\n\n第二个问题，具体如何合并切片呢？这里可以使用 Nodejs 的 读写流（readStream/writeStream），将所有切片的流传输到最终文件的流里。\n\n## 前端部分\n前端使用 Vue 作为开发框架，对界面没有太大要求，原生也可以，考虑到美观使用 Element-ui 作为 UI 框架\n\n### 上传控件\n\n首先创建选择文件的控件并监听 change 事件，另外就是上传按钮\n\n```html\n<template>\n   <div>\n    <input type=\"file\" @change=\"handleFileChange\" />\n    <el-button @click=\"handleUpload\">upload</el-button>\n  </div>\n</template>\n\n<script>\nexport default {\n  data: () => ({\n    container: {\n      file: null\n    }\n  }),\n  methods: {\n     handleFileChange(e) {\n      const [file] = e.target.files;\n      if (!file) return;\n      Object.assign(this.$data, this.$options.data());\n      this.container.file = file;\n    },\n    async handleUpload() {}\n  }\n};\n</script>\n```\n\n### 请求逻辑\n\n考虑到通用性，这里没有用第三方的请求库，而是用原生 XMLHttpRequest 做一层简单的封装来发请求\n\n```js\nrequest({\n      url,\n      method = \"post\",\n      data,\n      headers = {},\n      requestList\n    }) {\n      return new Promise(resolve => {\n        const xhr = new XMLHttpRequest();\n        xhr.open(method, url);\n        Object.keys(headers).forEach(key =>\n          xhr.setRequestHeader(key, headers[key])\n        );\n        xhr.send(data);\n        xhr.onload = e => {\n          resolve({\n            data: e.target.response\n          });\n        };\n      });\n    }\n```\n\n### 上传切片\n\n接着实现比较重要的上传功能，上传需要做两件事\n\n1. 对文件进行切片\n2. 将切片传输给服务端\n\n```diff\n<template>\n  <div>\n    <input type=\"file\" @change=\"handleFileChange\" />\n    <el-button @click=\"handleUpload\">上传</el-button>\n  </div>\n</template>\n\n<script>\n+ // 切片大小\n+ // the chunk size\n+ const SIZE = 10 * 1024 * 1024; \n\nexport default {\n  data: () => ({\n    container: {\n      file: null\n    }，\n+   data: []\n  }),\n  methods: {\n    request() {},\n    handleFileChange() {},\n+    // 生成文件切片\n+    createFileChunk(file, size = SIZE) {\n+     const fileChunkList = [];\n+      let cur = 0;\n+      while (cur < file.size) {\n+        fileChunkList.push({ file: file.slice(cur, cur + size) });\n+        cur += size;\n+      }\n+      return fileChunkList;\n+    },\n+   // 上传切片\n+    async uploadChunks() {\n+      const requestList = this.data\n+        .map(({ chunk，hash }) => {\n+          const formData = new FormData();\n+          formData.append(\"chunk\", chunk);\n+          formData.append(\"hash\", hash);\n+          formData.append(\"filename\", this.container.file.name);\n+          return { formData };\n+        })\n+        .map(({ formData }) =>\n+          this.request({\n+            url: \"http://localhost:3000\",\n+            data: formData\n+          })\n+        );\n+      // 并发请求\n+      await Promise.all(requestList); \n+    },\n+    async handleUpload() {\n+      if (!this.container.file) return;\n+      const fileChunkList = this.createFileChunk(this.container.file);\n+      this.data = fileChunkList.map(({ file }，index) => ({\n+        chunk: file,\n+        // 文件名 + 数组下标\n+        hash: this.container.file.name + \"-\" + index\n+      }));\n+      await this.uploadChunks();\n+    }\n  }\n};\n</script>\n```\n\n当点击上传按钮时，调用 createFileChunk 将文件切片，切片数量通过文件大小控制，这里设置 10MB，也就是说一个 100 MB 的文件会被分成 10 个 10MB 的切片。\n\ncreateFileChunk 内使用 while 循环和 slice 方法将切片放入 fileChunkList 数组中返回。\n\n在生成文件切片时，需要给每个切片一个标识作为 hash，这里暂时使用文件名 + 下标，这样后端可以知道当前切片是第几个切片，用于之后的合并切片。\n\n随后调用 uploadChunks 上传所有的文件切片，将文件切片，切片 hash，以及文件名放入 formData 中，再调用上一步的 request 函数返回一个 proimise，最后调用 Promise.all 并发上传所有的切片。\n\n### 发送合并请求\n\n使用整体思路中提到的第二种合并切片的方式，即前端主动通知服务端进行合并\n\n前端发送额外的合并请求，服务端接受到请求时合并切片\n\n```diff\n<template>\n  <div>\n    <input type=\"file\" @change=\"handleFileChange\" />\n    <el-button @click=\"handleUpload\">upload</el-button>\n  </div>\n</template>\n\n<script>\nexport default {\n  data: () => ({\n    container: {\n      file: null\n    },\n    data: []\n  }),\n  methods: {\n    request() {},\n    handleFileChange() {},\n    createFileChunk() {},\n    async uploadChunks() {\n      const requestList = this.data\n        .map(({ chunk，hash }) => {\n          const formData = new FormData();\n          formData.append(\"chunk\", chunk);\n          formData.append(\"hash\", hash);\n          formData.append(\"filename\", this.container.file.name);\n          return { formData };\n        })\n        .map(({ formData }) =>\n          this.request({\n            url: \"http://localhost:3000\",\n            data: formData\n          })\n        );\n      await Promise.all(requestList);\n+     // 合并切片\n+     await this.mergeRequest();\n    },\n+    async mergeRequest() {\n+      await this.request({\n+        url: \"http://localhost:3000/merge\",\n+        headers: {\n+          \"content-type\": \"application/json\"\n+        },\n+        data: JSON.stringify({\n+          filename: this.container.file.name\n+        })\n+      });\n+    },    \n    async handleUpload() {}\n  }\n};\n</script>\n```\n\n## 服务端部分\n\n使用 http 模块搭建一个简单服务端\n\n```js\nconst http = require(\"http\");\nconst server = http.createServer();\n\nserver.on(\"request\", async (req, res) => {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  res.setHeader(\"Access-Control-Allow-Headers\", \"*\");\n  if (req.method === \"OPTIONS\") {\n    res.status = 200;\n    res.end();\n    return;\n  }\n});\n\nserver.listen(3000, () => console.log(\"listening port 3000\"));\n```\n\n### 接受切片\n\n使用 multiparty 处理前端传来的 formData\n\n在 multiparty.parse 的回调中，files 参数保存了 formData 中文件，fields 参数保存了 formData 中非文件的字段\n\n```diff\nconst http = require(\"http\");\nconst path = require(\"path\");\n+ const fse = require(\"fs-extra\");\n+ const multiparty = require(\"multiparty\");\n\nconst server = http.createServer();\n+ // 大文件存储目录\n+ const UPLOAD_DIR = path.resolve(__dirname, \"..\", \"target\");\n\nserver.on(\"request\", async (req, res) => {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  res.setHeader(\"Access-Control-Allow-Headers\", \"*\");\n  if (req.method === \"OPTIONS\") {\n    res.status = 200;\n    res.end();\n    return;\n  }\n\n+  const multipart = new multiparty.Form();\n\n+  multipart.parse(req, async (err, fields, files) => {\n+    if (err) {\n+      return;\n+    }\n+    const [chunk] = files.chunk;\n+    const [hash] = fields.hash;\n+    const [filename] = fields.filename;\n+    // 创建临时文件夹用于临时存储 chunk\n+    // 添加 chunkDir 前缀与文件名做区分\n+    const chunkDir = path.resolve(UPLOAD_DIR, 'chunkDir' + filename);\n\n+    if (!fse.existsSync(chunkDir)) {\n+      await fse.mkdirs(chunkDir);\n+    }\n\n+    // fs-extra 的 rename 方法 windows 平台会有权限问题\n+    // @see https://github.com/meteor/meteor/issues/7852#issuecomment-255767835\n+    await fse.move(chunk.path, `${chunkDir}/${hash}`);\n+    res.end(\"received file chunk\");\n+  });\n});\n\nserver.listen(3000, () => console.log(\"listening port 3000\"));\n```\n\n查看 multiparty 处理后的 chunk 对象，path 是存储临时文件的路径，size 是临时文件大小，在 multiparty 文档中提到可以使用 fs.rename（这里换成了 fs.remove, 因为 fs-extra 的 rename 方法在 windows 平台存在权限问题）\n\n在接受文件切片时，需要先创建临时存储切片的文件夹，以 chunkDir 作为前缀，文件名作为后缀。\n\n由于前端在发送每个切片时额外携带了唯一值 hash，所以以 hash 作为文件名，将切片从临时路径移动切片文件夹中。\n\n### 合并切片\n\n在接收到前端发送的合并请求后，服务端将文件夹下的所有切片进行合并\n\n```diff\nconst http = require(\"http\");\nconst path = require(\"path\");\nconst fse = require(\"fs-extra\");\n\nconst server = http.createServer();\nconst UPLOAD_DIR = path.resolve(__dirname, \"..\", \"target\");\n\n+ const resolvePost = req =>\n+   new Promise(resolve => {\n+     let chunk = \"\";\n+     req.on(\"data\", data => {\n+       chunk += data;\n+     });\n+     req.on(\"end\", () => {\n+       resolve(JSON.parse(chunk));\n+     });\n+   });\n\n+ // 写入文件流\n+ const pipeStream = (path, writeStream) =>\n+  new Promise(resolve => {\n+    const readStream = fse.createReadStream(path);\n+    readStream.on(\"end\", () => {\n+      fse.unlinkSync(path);\n+      resolve();\n+    });\n+    readStream.pipe(writeStream);\n+  });\n\n// 合并切片\n+ const mergeFileChunk = async (filePath, filename, size) => {\n+   const chunkDir = path.resolve(UPLOAD_DIR, 'chunkDir' + filename);\n+   const chunkPaths = await fse.readdir(chunkDir);\n+   // 根据切片下标进行排序\n+   // 否则直接读取目录的获得的顺序会错乱\n+   chunkPaths.sort((a, b) => a.split(\"-\")[1] - b.split(\"-\")[1]);\n+   // 并发写入文件\n+   await Promise.all(\n+     chunkPaths.map((chunkPath, index) =>\n+       pipeStream(\n+         path.resolve(chunkDir, chunkPath),\n+         // 根据 size 在指定位置创建可写流\n+         fse.createWriteStream(filePath, {\n+           start: index * size,\n+         })\n+       )\n+     )\n+  );\n+  // 合并后删除保存切片的目录\n+  fse.rmdirSync(chunkDir);\n+};\n\nserver.on(\"request\", async (req, res) => {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  res.setHeader(\"Access-Control-Allow-Headers\", \"*\");\n  if (req.method === \"OPTIONS\") {\n    res.status = 200;\n    res.end();\n    return;\n  }\n\n+   if (req.url === \"/merge\") {\n+     const data = await resolvePost(req);\n+     const { filename,size } = data;\n+     const filePath = path.resolve(UPLOAD_DIR, `${filename}`);\n+     await mergeFileChunk(filePath, filename);\n+     res.end(\n+       JSON.stringify({\n+         code: 0,\n+         message: \"file merged success\"\n+       })\n+     );\n+   }\n\n});\n\nserver.listen(3000, () => console.log(\"listening port 3000\"));\n```\n\n由于前端在发送合并请求时会携带文件名，服务端根据文件名可以找到上一步创建的切片文件夹\n\n接着使用 fs.createWriteStream 创建一个可写流，可写流文件名就是上传时的文件名\n\n随后遍历整个切片文件夹，将切片通过 fs.createReadStream 创建可读流，传输合并到目标文件中\n\n值得注意的是每次可读流都会传输到可写流的指定位置，这是通过 createWriteStream 的第二个参数 start 控制的，目的是能够并发合并多个可读流至可写流中，这样即使并发时流的顺序不同，也能传输到正确的位置\n\n所以还需要让前端在请求的时候提供之前设定好的 size 给服务端，服务端根据 size 指定可读流的起始位置\n\n```diff\n  async mergeRequest() {\n     await this.request({\n       url: \"http://localhost:3000/merge\",\n       headers: {\n         \"content-type\": \"application/json\"\n       },\n       data: JSON.stringify({\n+        size: SIZE,\n         filename: this.container.file.name\n       })\n     });\n   },\n```\n\n其实也可以等上一个切片合并完后再合并下个切片，这样就不需要指定位置，但传输速度会降低，所以使用了并发合并的手段。接着只要保证每次合并完成后删除这个切片，等所有切片都合并完毕后最后删除切片文件夹即可\n\n至此一个简单的大文件上传就完成了，接下来我们再此基础上扩展一些额外的功能。\n\n\n## 显示上传进度条\n上传进度分两种，一个是每个切片的上传进度，另一个是整个文件的上传进度，而整个文件的上传进度是基于每个切片上传进度计算而来，所以我们先实现单个切片的进度条。\n\n### 单个切片进度条\n\nXMLHttpRequest 原生支持上传进度的监听，只需要监听 upload.onprogress 即可，我们在原来的 request 基础上传入 onProgress 参数，给 XMLHttpRequest 注册监听事件\n\n```diff\n // xhr\n    request({\n      url,\n      method = \"post\",\n      data,\n      headers = {},\n+     onProgress = e => e,\n      requestList\n    }) {\n      return new Promise(resolve => {\n        const xhr = new XMLHttpRequest();\n+       xhr.upload.onprogress = onProgress;\n        xhr.open(method, url);\n        Object.keys(headers).forEach(key =>\n          xhr.setRequestHeader(key, headers[key])\n        );\n        xhr.send(data);\n        xhr.onload = e => {\n          resolve({\n            data: e.target.response\n          });\n        };\n      });\n    }\n```\n\n由于每个切片都需要触发独立的监听事件，所以需要一个工厂函数，根据传入的切片返回不同的监听函数\n\n在原先的前端上传逻辑中新增监听函数部分\n\n```diff\n    // 上传切片，同时过滤已上传的切片\n    async uploadChunks(uploadedList = []) {\n      const requestList = this.data\n+       .map(({ chunk,hash,index }) => {\n          const formData = new FormData();\n          formData.append(\"chunk\", chunk);\n          formData.append(\"hash\", hash);\n          formData.append(\"filename\", this.container.file.name);\n+         return { formData,index };\n        })\n+       .map(({ formData,index }) =>\n          this.request({\n            url: \"http://localhost:3000\",\n            data: formData，\n+           onProgress: this.createProgressHandler(this.data[index]),\n          })\n        );\n      await Promise.all(requestList);\n      await this.mergeRequest();\n    },\n    async handleUpload() {\n      if (!this.container.file) return;\n      const fileChunkList = this.createFileChunk(this.container.file);\n      this.data = fileChunkList.map(({ file }，index) => ({\n        chunk: file,\n+       index,\n        hash: this.container.file.name + \"-\" + index\n+       percentage:0\n      }));\n      await this.uploadChunks();\n    }    \n+   createProgressHandler(item) {\n+      return e => {\n+        item.percentage = parseInt(String((e.loaded / e.total) * 100));\n+      };\n+   }\n```\n\n每个切片在上传时都会通过监听函数更新 data 数组对应元素的 percentage 属性，之后把将 data 数组放到视图中展示即可。\n\n### 总进度条\n\n将每个切片已上传的部分累加，除以整个文件的大小，就能得出当前文件的上传进度，所以这里使用 Vue 的计算属性\n\n```js\n computed: {\n      uploadPercentage() {\n         if (!this.container.file || !this.data.length) return 0;\n         const loaded = this.data\n           .map(item => item.size * item.percentage)\n           .reduce((acc, cur) => acc + cur);\n         return parseInt((loaded / this.container.file.size).toFixed(2));\n       }\n}\n```\n\n## 总结\n\n大文件上传：\n\n- 前端上传大文件时使用 Blob.prototype.slice 将文件切片，并发上传多个切片，最后发送一个合并的请求通知服务端合并切片\n- 服务端接收切片并存储，收到合并请求后使用流将切片合并到最终文件\n- 原生 XMLHttpRequest 的 upload.onprogress 对切片上传进度的监听\n- 使用 Vue 计算属性根据每个切片的进度算出整个文件的上传进度\n\n\n参考 https://juejin.cn/post/6844904046436843527#heading-24","source":"_posts/big-file-upload.md","raw":"---\ntitle: 大文件上传实现\ndate: 2023-03-18 22:23:15\ntags: JavaScript\ncategories: JavaScript\ndescription: 本文从零搭建前端和服务端，实现一个大文件上传的 demo\n---\n\n本文从零搭建前端和服务端，实现一个大文件上传的 demo\n\n前端：Vue@2 + Element-ui\n\n服务端：Nodejs@14 + multiparty\n\n## 整体思路\n\n### 前端\n\n前端大文件上传网上的大部分文章已经给出了解决方案，核心是利用 `Blob.prototype.slice` 方法，和数组的 slice 方法相似，文件的 slice 方法可以返回原文件的某个切片。\n\n预先定义好单个切片大小，将文件切分为一个个切片，然后借助 http 的可并发性，同时上传多个切片。这样从原本传一个大文件，变成了并发传多个小的文件切片，可以大大减少上传时间。\n\n另外由于是并发，传输到服务端的顺序可能会发生变化，因此我们还需要给每个切片记录顺序。\n\n### 服务端\n\n服务端负责接受前端传输的切片，并在接收到所有切片后合并所有切片\n\n这里又引伸出两个问题\n\n1. 何时合并切片，即切片什么时候传输完成\n2. 如何合并切片\n\n第一个问题需要前端配合，前端在每个切片中都携带切片最大数量的信息，当服务端接受到这个数量的切片时自动合并。或者也可以额外发一个请求，主动通知服务端进行切片的合并。\n\n第二个问题，具体如何合并切片呢？这里可以使用 Nodejs 的 读写流（readStream/writeStream），将所有切片的流传输到最终文件的流里。\n\n## 前端部分\n前端使用 Vue 作为开发框架，对界面没有太大要求，原生也可以，考虑到美观使用 Element-ui 作为 UI 框架\n\n### 上传控件\n\n首先创建选择文件的控件并监听 change 事件，另外就是上传按钮\n\n```html\n<template>\n   <div>\n    <input type=\"file\" @change=\"handleFileChange\" />\n    <el-button @click=\"handleUpload\">upload</el-button>\n  </div>\n</template>\n\n<script>\nexport default {\n  data: () => ({\n    container: {\n      file: null\n    }\n  }),\n  methods: {\n     handleFileChange(e) {\n      const [file] = e.target.files;\n      if (!file) return;\n      Object.assign(this.$data, this.$options.data());\n      this.container.file = file;\n    },\n    async handleUpload() {}\n  }\n};\n</script>\n```\n\n### 请求逻辑\n\n考虑到通用性，这里没有用第三方的请求库，而是用原生 XMLHttpRequest 做一层简单的封装来发请求\n\n```js\nrequest({\n      url,\n      method = \"post\",\n      data,\n      headers = {},\n      requestList\n    }) {\n      return new Promise(resolve => {\n        const xhr = new XMLHttpRequest();\n        xhr.open(method, url);\n        Object.keys(headers).forEach(key =>\n          xhr.setRequestHeader(key, headers[key])\n        );\n        xhr.send(data);\n        xhr.onload = e => {\n          resolve({\n            data: e.target.response\n          });\n        };\n      });\n    }\n```\n\n### 上传切片\n\n接着实现比较重要的上传功能，上传需要做两件事\n\n1. 对文件进行切片\n2. 将切片传输给服务端\n\n```diff\n<template>\n  <div>\n    <input type=\"file\" @change=\"handleFileChange\" />\n    <el-button @click=\"handleUpload\">上传</el-button>\n  </div>\n</template>\n\n<script>\n+ // 切片大小\n+ // the chunk size\n+ const SIZE = 10 * 1024 * 1024; \n\nexport default {\n  data: () => ({\n    container: {\n      file: null\n    }，\n+   data: []\n  }),\n  methods: {\n    request() {},\n    handleFileChange() {},\n+    // 生成文件切片\n+    createFileChunk(file, size = SIZE) {\n+     const fileChunkList = [];\n+      let cur = 0;\n+      while (cur < file.size) {\n+        fileChunkList.push({ file: file.slice(cur, cur + size) });\n+        cur += size;\n+      }\n+      return fileChunkList;\n+    },\n+   // 上传切片\n+    async uploadChunks() {\n+      const requestList = this.data\n+        .map(({ chunk，hash }) => {\n+          const formData = new FormData();\n+          formData.append(\"chunk\", chunk);\n+          formData.append(\"hash\", hash);\n+          formData.append(\"filename\", this.container.file.name);\n+          return { formData };\n+        })\n+        .map(({ formData }) =>\n+          this.request({\n+            url: \"http://localhost:3000\",\n+            data: formData\n+          })\n+        );\n+      // 并发请求\n+      await Promise.all(requestList); \n+    },\n+    async handleUpload() {\n+      if (!this.container.file) return;\n+      const fileChunkList = this.createFileChunk(this.container.file);\n+      this.data = fileChunkList.map(({ file }，index) => ({\n+        chunk: file,\n+        // 文件名 + 数组下标\n+        hash: this.container.file.name + \"-\" + index\n+      }));\n+      await this.uploadChunks();\n+    }\n  }\n};\n</script>\n```\n\n当点击上传按钮时，调用 createFileChunk 将文件切片，切片数量通过文件大小控制，这里设置 10MB，也就是说一个 100 MB 的文件会被分成 10 个 10MB 的切片。\n\ncreateFileChunk 内使用 while 循环和 slice 方法将切片放入 fileChunkList 数组中返回。\n\n在生成文件切片时，需要给每个切片一个标识作为 hash，这里暂时使用文件名 + 下标，这样后端可以知道当前切片是第几个切片，用于之后的合并切片。\n\n随后调用 uploadChunks 上传所有的文件切片，将文件切片，切片 hash，以及文件名放入 formData 中，再调用上一步的 request 函数返回一个 proimise，最后调用 Promise.all 并发上传所有的切片。\n\n### 发送合并请求\n\n使用整体思路中提到的第二种合并切片的方式，即前端主动通知服务端进行合并\n\n前端发送额外的合并请求，服务端接受到请求时合并切片\n\n```diff\n<template>\n  <div>\n    <input type=\"file\" @change=\"handleFileChange\" />\n    <el-button @click=\"handleUpload\">upload</el-button>\n  </div>\n</template>\n\n<script>\nexport default {\n  data: () => ({\n    container: {\n      file: null\n    },\n    data: []\n  }),\n  methods: {\n    request() {},\n    handleFileChange() {},\n    createFileChunk() {},\n    async uploadChunks() {\n      const requestList = this.data\n        .map(({ chunk，hash }) => {\n          const formData = new FormData();\n          formData.append(\"chunk\", chunk);\n          formData.append(\"hash\", hash);\n          formData.append(\"filename\", this.container.file.name);\n          return { formData };\n        })\n        .map(({ formData }) =>\n          this.request({\n            url: \"http://localhost:3000\",\n            data: formData\n          })\n        );\n      await Promise.all(requestList);\n+     // 合并切片\n+     await this.mergeRequest();\n    },\n+    async mergeRequest() {\n+      await this.request({\n+        url: \"http://localhost:3000/merge\",\n+        headers: {\n+          \"content-type\": \"application/json\"\n+        },\n+        data: JSON.stringify({\n+          filename: this.container.file.name\n+        })\n+      });\n+    },    \n    async handleUpload() {}\n  }\n};\n</script>\n```\n\n## 服务端部分\n\n使用 http 模块搭建一个简单服务端\n\n```js\nconst http = require(\"http\");\nconst server = http.createServer();\n\nserver.on(\"request\", async (req, res) => {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  res.setHeader(\"Access-Control-Allow-Headers\", \"*\");\n  if (req.method === \"OPTIONS\") {\n    res.status = 200;\n    res.end();\n    return;\n  }\n});\n\nserver.listen(3000, () => console.log(\"listening port 3000\"));\n```\n\n### 接受切片\n\n使用 multiparty 处理前端传来的 formData\n\n在 multiparty.parse 的回调中，files 参数保存了 formData 中文件，fields 参数保存了 formData 中非文件的字段\n\n```diff\nconst http = require(\"http\");\nconst path = require(\"path\");\n+ const fse = require(\"fs-extra\");\n+ const multiparty = require(\"multiparty\");\n\nconst server = http.createServer();\n+ // 大文件存储目录\n+ const UPLOAD_DIR = path.resolve(__dirname, \"..\", \"target\");\n\nserver.on(\"request\", async (req, res) => {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  res.setHeader(\"Access-Control-Allow-Headers\", \"*\");\n  if (req.method === \"OPTIONS\") {\n    res.status = 200;\n    res.end();\n    return;\n  }\n\n+  const multipart = new multiparty.Form();\n\n+  multipart.parse(req, async (err, fields, files) => {\n+    if (err) {\n+      return;\n+    }\n+    const [chunk] = files.chunk;\n+    const [hash] = fields.hash;\n+    const [filename] = fields.filename;\n+    // 创建临时文件夹用于临时存储 chunk\n+    // 添加 chunkDir 前缀与文件名做区分\n+    const chunkDir = path.resolve(UPLOAD_DIR, 'chunkDir' + filename);\n\n+    if (!fse.existsSync(chunkDir)) {\n+      await fse.mkdirs(chunkDir);\n+    }\n\n+    // fs-extra 的 rename 方法 windows 平台会有权限问题\n+    // @see https://github.com/meteor/meteor/issues/7852#issuecomment-255767835\n+    await fse.move(chunk.path, `${chunkDir}/${hash}`);\n+    res.end(\"received file chunk\");\n+  });\n});\n\nserver.listen(3000, () => console.log(\"listening port 3000\"));\n```\n\n查看 multiparty 处理后的 chunk 对象，path 是存储临时文件的路径，size 是临时文件大小，在 multiparty 文档中提到可以使用 fs.rename（这里换成了 fs.remove, 因为 fs-extra 的 rename 方法在 windows 平台存在权限问题）\n\n在接受文件切片时，需要先创建临时存储切片的文件夹，以 chunkDir 作为前缀，文件名作为后缀。\n\n由于前端在发送每个切片时额外携带了唯一值 hash，所以以 hash 作为文件名，将切片从临时路径移动切片文件夹中。\n\n### 合并切片\n\n在接收到前端发送的合并请求后，服务端将文件夹下的所有切片进行合并\n\n```diff\nconst http = require(\"http\");\nconst path = require(\"path\");\nconst fse = require(\"fs-extra\");\n\nconst server = http.createServer();\nconst UPLOAD_DIR = path.resolve(__dirname, \"..\", \"target\");\n\n+ const resolvePost = req =>\n+   new Promise(resolve => {\n+     let chunk = \"\";\n+     req.on(\"data\", data => {\n+       chunk += data;\n+     });\n+     req.on(\"end\", () => {\n+       resolve(JSON.parse(chunk));\n+     });\n+   });\n\n+ // 写入文件流\n+ const pipeStream = (path, writeStream) =>\n+  new Promise(resolve => {\n+    const readStream = fse.createReadStream(path);\n+    readStream.on(\"end\", () => {\n+      fse.unlinkSync(path);\n+      resolve();\n+    });\n+    readStream.pipe(writeStream);\n+  });\n\n// 合并切片\n+ const mergeFileChunk = async (filePath, filename, size) => {\n+   const chunkDir = path.resolve(UPLOAD_DIR, 'chunkDir' + filename);\n+   const chunkPaths = await fse.readdir(chunkDir);\n+   // 根据切片下标进行排序\n+   // 否则直接读取目录的获得的顺序会错乱\n+   chunkPaths.sort((a, b) => a.split(\"-\")[1] - b.split(\"-\")[1]);\n+   // 并发写入文件\n+   await Promise.all(\n+     chunkPaths.map((chunkPath, index) =>\n+       pipeStream(\n+         path.resolve(chunkDir, chunkPath),\n+         // 根据 size 在指定位置创建可写流\n+         fse.createWriteStream(filePath, {\n+           start: index * size,\n+         })\n+       )\n+     )\n+  );\n+  // 合并后删除保存切片的目录\n+  fse.rmdirSync(chunkDir);\n+};\n\nserver.on(\"request\", async (req, res) => {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  res.setHeader(\"Access-Control-Allow-Headers\", \"*\");\n  if (req.method === \"OPTIONS\") {\n    res.status = 200;\n    res.end();\n    return;\n  }\n\n+   if (req.url === \"/merge\") {\n+     const data = await resolvePost(req);\n+     const { filename,size } = data;\n+     const filePath = path.resolve(UPLOAD_DIR, `${filename}`);\n+     await mergeFileChunk(filePath, filename);\n+     res.end(\n+       JSON.stringify({\n+         code: 0,\n+         message: \"file merged success\"\n+       })\n+     );\n+   }\n\n});\n\nserver.listen(3000, () => console.log(\"listening port 3000\"));\n```\n\n由于前端在发送合并请求时会携带文件名，服务端根据文件名可以找到上一步创建的切片文件夹\n\n接着使用 fs.createWriteStream 创建一个可写流，可写流文件名就是上传时的文件名\n\n随后遍历整个切片文件夹，将切片通过 fs.createReadStream 创建可读流，传输合并到目标文件中\n\n值得注意的是每次可读流都会传输到可写流的指定位置，这是通过 createWriteStream 的第二个参数 start 控制的，目的是能够并发合并多个可读流至可写流中，这样即使并发时流的顺序不同，也能传输到正确的位置\n\n所以还需要让前端在请求的时候提供之前设定好的 size 给服务端，服务端根据 size 指定可读流的起始位置\n\n```diff\n  async mergeRequest() {\n     await this.request({\n       url: \"http://localhost:3000/merge\",\n       headers: {\n         \"content-type\": \"application/json\"\n       },\n       data: JSON.stringify({\n+        size: SIZE,\n         filename: this.container.file.name\n       })\n     });\n   },\n```\n\n其实也可以等上一个切片合并完后再合并下个切片，这样就不需要指定位置，但传输速度会降低，所以使用了并发合并的手段。接着只要保证每次合并完成后删除这个切片，等所有切片都合并完毕后最后删除切片文件夹即可\n\n至此一个简单的大文件上传就完成了，接下来我们再此基础上扩展一些额外的功能。\n\n\n## 显示上传进度条\n上传进度分两种，一个是每个切片的上传进度，另一个是整个文件的上传进度，而整个文件的上传进度是基于每个切片上传进度计算而来，所以我们先实现单个切片的进度条。\n\n### 单个切片进度条\n\nXMLHttpRequest 原生支持上传进度的监听，只需要监听 upload.onprogress 即可，我们在原来的 request 基础上传入 onProgress 参数，给 XMLHttpRequest 注册监听事件\n\n```diff\n // xhr\n    request({\n      url,\n      method = \"post\",\n      data,\n      headers = {},\n+     onProgress = e => e,\n      requestList\n    }) {\n      return new Promise(resolve => {\n        const xhr = new XMLHttpRequest();\n+       xhr.upload.onprogress = onProgress;\n        xhr.open(method, url);\n        Object.keys(headers).forEach(key =>\n          xhr.setRequestHeader(key, headers[key])\n        );\n        xhr.send(data);\n        xhr.onload = e => {\n          resolve({\n            data: e.target.response\n          });\n        };\n      });\n    }\n```\n\n由于每个切片都需要触发独立的监听事件，所以需要一个工厂函数，根据传入的切片返回不同的监听函数\n\n在原先的前端上传逻辑中新增监听函数部分\n\n```diff\n    // 上传切片，同时过滤已上传的切片\n    async uploadChunks(uploadedList = []) {\n      const requestList = this.data\n+       .map(({ chunk,hash,index }) => {\n          const formData = new FormData();\n          formData.append(\"chunk\", chunk);\n          formData.append(\"hash\", hash);\n          formData.append(\"filename\", this.container.file.name);\n+         return { formData,index };\n        })\n+       .map(({ formData,index }) =>\n          this.request({\n            url: \"http://localhost:3000\",\n            data: formData，\n+           onProgress: this.createProgressHandler(this.data[index]),\n          })\n        );\n      await Promise.all(requestList);\n      await this.mergeRequest();\n    },\n    async handleUpload() {\n      if (!this.container.file) return;\n      const fileChunkList = this.createFileChunk(this.container.file);\n      this.data = fileChunkList.map(({ file }，index) => ({\n        chunk: file,\n+       index,\n        hash: this.container.file.name + \"-\" + index\n+       percentage:0\n      }));\n      await this.uploadChunks();\n    }    \n+   createProgressHandler(item) {\n+      return e => {\n+        item.percentage = parseInt(String((e.loaded / e.total) * 100));\n+      };\n+   }\n```\n\n每个切片在上传时都会通过监听函数更新 data 数组对应元素的 percentage 属性，之后把将 data 数组放到视图中展示即可。\n\n### 总进度条\n\n将每个切片已上传的部分累加，除以整个文件的大小，就能得出当前文件的上传进度，所以这里使用 Vue 的计算属性\n\n```js\n computed: {\n      uploadPercentage() {\n         if (!this.container.file || !this.data.length) return 0;\n         const loaded = this.data\n           .map(item => item.size * item.percentage)\n           .reduce((acc, cur) => acc + cur);\n         return parseInt((loaded / this.container.file.size).toFixed(2));\n       }\n}\n```\n\n## 总结\n\n大文件上传：\n\n- 前端上传大文件时使用 Blob.prototype.slice 将文件切片，并发上传多个切片，最后发送一个合并的请求通知服务端合并切片\n- 服务端接收切片并存储，收到合并请求后使用流将切片合并到最终文件\n- 原生 XMLHttpRequest 的 upload.onprogress 对切片上传进度的监听\n- 使用 Vue 计算属性根据每个切片的进度算出整个文件的上传进度\n\n\n参考 https://juejin.cn/post/6844904046436843527#heading-24","slug":"big-file-upload","published":1,"updated":"2023-03-20T12:27:23.424Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsh70003yt8wfh7q8c0h","content":"<p>本文从零搭建前端和服务端，实现一个大文件上传的 demo</p>\n<p>前端：Vue@2 + Element-ui</p>\n<p>服务端：Nodejs@14 + multiparty</p>\n<h2 id=\"整体思路\"><a href=\"#整体思路\" class=\"headerlink\" title=\"整体思路\"></a>整体思路</h2><h3 id=\"前端\"><a href=\"#前端\" class=\"headerlink\" title=\"前端\"></a>前端</h3><p>前端大文件上传网上的大部分文章已经给出了解决方案，核心是利用 <code>Blob.prototype.slice</code> 方法，和数组的 slice 方法相似，文件的 slice 方法可以返回原文件的某个切片。</p>\n<p>预先定义好单个切片大小，将文件切分为一个个切片，然后借助 http 的可并发性，同时上传多个切片。这样从原本传一个大文件，变成了并发传多个小的文件切片，可以大大减少上传时间。</p>\n<p>另外由于是并发，传输到服务端的顺序可能会发生变化，因此我们还需要给每个切片记录顺序。</p>\n<h3 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h3><p>服务端负责接受前端传输的切片，并在接收到所有切片后合并所有切片</p>\n<p>这里又引伸出两个问题</p>\n<ol>\n<li>何时合并切片，即切片什么时候传输完成</li>\n<li>如何合并切片</li>\n</ol>\n<p>第一个问题需要前端配合，前端在每个切片中都携带切片最大数量的信息，当服务端接受到这个数量的切片时自动合并。或者也可以额外发一个请求，主动通知服务端进行切片的合并。</p>\n<p>第二个问题，具体如何合并切片呢？这里可以使用 Nodejs 的 读写流（readStream&#x2F;writeStream），将所有切片的流传输到最终文件的流里。</p>\n<h2 id=\"前端部分\"><a href=\"#前端部分\" class=\"headerlink\" title=\"前端部分\"></a>前端部分</h2><p>前端使用 Vue 作为开发框架，对界面没有太大要求，原生也可以，考虑到美观使用 Element-ui 作为 UI 框架</p>\n<h3 id=\"上传控件\"><a href=\"#上传控件\" class=\"headerlink\" title=\"上传控件\"></a>上传控件</h3><p>首先创建选择文件的控件并监听 change 事件，另外就是上传按钮</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> @<span class=\"attr\">change</span>=<span class=\"string\">&quot;handleFileChange&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">el-button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;handleUpload&quot;</span>&gt;</span>upload<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">data</span>: <span class=\"function\">() =&gt;</span> (&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">container</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"attr\">file</span>: <span class=\"literal\">null</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;),</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">methods</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">     <span class=\"title function_\">handleFileChange</span>(<span class=\"params\">e</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> [file] = e.<span class=\"property\">target</span>.<span class=\"property\">files</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">if</span> (!file) <span class=\"keyword\">return</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">$data</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">$options</span>.<span class=\"title function_\">data</span>());</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">this</span>.<span class=\"property\">container</span>.<span class=\"property\">file</span> = file;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">async</span> <span class=\"title function_\">handleUpload</span>(<span class=\"params\"></span>) &#123;&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"请求逻辑\"><a href=\"#请求逻辑\" class=\"headerlink\" title=\"请求逻辑\"></a>请求逻辑</h3><p>考虑到通用性，这里没有用第三方的请求库，而是用原生 XMLHttpRequest 做一层简单的封装来发请求</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">request</span>(<span class=\"params\">&#123;</span></span><br><span class=\"line\"><span class=\"params\">      url,</span></span><br><span class=\"line\"><span class=\"params\">      method = <span class=\"string\">&quot;post&quot;</span>,</span></span><br><span class=\"line\"><span class=\"params\">      data,</span></span><br><span class=\"line\"><span class=\"params\">      headers = &#123;&#125;,</span></span><br><span class=\"line\"><span class=\"params\">      requestList</span></span><br><span class=\"line\"><span class=\"params\">    &#125;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">        xhr.<span class=\"title function_\">open</span>(method, url);</span><br><span class=\"line\">        <span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(headers).<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">key</span> =&gt;</span></span><br><span class=\"line\">          xhr.<span class=\"title function_\">setRequestHeader</span>(key, headers[key])</span><br><span class=\"line\">        );</span><br><span class=\"line\">        xhr.<span class=\"title function_\">send</span>(data);</span><br><span class=\"line\">        xhr.<span class=\"property\">onload</span> = <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"title function_\">resolve</span>(&#123;</span><br><span class=\"line\">            <span class=\"attr\">data</span>: e.<span class=\"property\">target</span>.<span class=\"property\">response</span></span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"上传切片\"><a href=\"#上传切片\" class=\"headerlink\" title=\"上传切片\"></a>上传切片</h3><p>接着实现比较重要的上传功能，上传需要做两件事</p>\n<ol>\n<li>对文件进行切片</li>\n<li>将切片传输给服务端</li>\n</ol>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;input type=&quot;file&quot; @change=&quot;handleFileChange&quot; /&gt;</span><br><span class=\"line\">    &lt;el-button @click=&quot;handleUpload&quot;&gt;上传&lt;/el-button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"><span class=\"addition\">+ // 切片大小</span></span><br><span class=\"line\"><span class=\"addition\">+ // the chunk size</span></span><br><span class=\"line\"><span class=\"addition\">+ const SIZE = 10 * 1024 * 1024; </span></span><br><span class=\"line\"></span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  data: () =&gt; (&#123;</span><br><span class=\"line\">    container: &#123;</span><br><span class=\"line\">      file: null</span><br><span class=\"line\">    &#125;，</span><br><span class=\"line\"><span class=\"addition\">+   data: []</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    request() &#123;&#125;,</span><br><span class=\"line\">    handleFileChange() &#123;&#125;,</span><br><span class=\"line\"><span class=\"addition\">+    // 生成文件切片</span></span><br><span class=\"line\"><span class=\"addition\">+    createFileChunk(file, size = SIZE) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     const fileChunkList = [];</span></span><br><span class=\"line\"><span class=\"addition\">+      let cur = 0;</span></span><br><span class=\"line\"><span class=\"addition\">+      while (cur &lt; file.size) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        fileChunkList.push(&#123; file: file.slice(cur, cur + size) &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+        cur += size;</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+      return fileChunkList;</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+   // 上传切片</span></span><br><span class=\"line\"><span class=\"addition\">+    async uploadChunks() &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      const requestList = this.data</span></span><br><span class=\"line\"><span class=\"addition\">+        .map((&#123; chunk，hash &#125;) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          const formData = new FormData();</span></span><br><span class=\"line\"><span class=\"addition\">+          formData.append(&quot;chunk&quot;, chunk);</span></span><br><span class=\"line\"><span class=\"addition\">+          formData.append(&quot;hash&quot;, hash);</span></span><br><span class=\"line\"><span class=\"addition\">+          formData.append(&quot;filename&quot;, this.container.file.name);</span></span><br><span class=\"line\"><span class=\"addition\">+          return &#123; formData &#125;;</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+        .map((&#123; formData &#125;) =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+          this.request(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            url: &quot;http://localhost:3000&quot;,</span></span><br><span class=\"line\"><span class=\"addition\">+            data: formData</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+        );</span></span><br><span class=\"line\"><span class=\"addition\">+      // 并发请求</span></span><br><span class=\"line\"><span class=\"addition\">+      await Promise.all(requestList); </span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+    async handleUpload() &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      if (!this.container.file) return;</span></span><br><span class=\"line\"><span class=\"addition\">+      const fileChunkList = this.createFileChunk(this.container.file);</span></span><br><span class=\"line\"><span class=\"addition\">+      this.data = fileChunkList.map((&#123; file &#125;，index) =&gt; (&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        chunk: file,</span></span><br><span class=\"line\"><span class=\"addition\">+        // 文件名 + 数组下标</span></span><br><span class=\"line\"><span class=\"addition\">+        hash: this.container.file.name + &quot;-&quot; + index</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;));</span></span><br><span class=\"line\"><span class=\"addition\">+      await this.uploadChunks();</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>当点击上传按钮时，调用 createFileChunk 将文件切片，切片数量通过文件大小控制，这里设置 10MB，也就是说一个 100 MB 的文件会被分成 10 个 10MB 的切片。</p>\n<p>createFileChunk 内使用 while 循环和 slice 方法将切片放入 fileChunkList 数组中返回。</p>\n<p>在生成文件切片时，需要给每个切片一个标识作为 hash，这里暂时使用文件名 + 下标，这样后端可以知道当前切片是第几个切片，用于之后的合并切片。</p>\n<p>随后调用 uploadChunks 上传所有的文件切片，将文件切片，切片 hash，以及文件名放入 formData 中，再调用上一步的 request 函数返回一个 proimise，最后调用 Promise.all 并发上传所有的切片。</p>\n<h3 id=\"发送合并请求\"><a href=\"#发送合并请求\" class=\"headerlink\" title=\"发送合并请求\"></a>发送合并请求</h3><p>使用整体思路中提到的第二种合并切片的方式，即前端主动通知服务端进行合并</p>\n<p>前端发送额外的合并请求，服务端接受到请求时合并切片</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;input type=&quot;file&quot; @change=&quot;handleFileChange&quot; /&gt;</span><br><span class=\"line\">    &lt;el-button @click=&quot;handleUpload&quot;&gt;upload&lt;/el-button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  data: () =&gt; (&#123;</span><br><span class=\"line\">    container: &#123;</span><br><span class=\"line\">      file: null</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    data: []</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    request() &#123;&#125;,</span><br><span class=\"line\">    handleFileChange() &#123;&#125;,</span><br><span class=\"line\">    createFileChunk() &#123;&#125;,</span><br><span class=\"line\">    async uploadChunks() &#123;</span><br><span class=\"line\">      const requestList = this.data</span><br><span class=\"line\">        .map((&#123; chunk，hash &#125;) =&gt; &#123;</span><br><span class=\"line\">          const formData = new FormData();</span><br><span class=\"line\">          formData.append(&quot;chunk&quot;, chunk);</span><br><span class=\"line\">          formData.append(&quot;hash&quot;, hash);</span><br><span class=\"line\">          formData.append(&quot;filename&quot;, this.container.file.name);</span><br><span class=\"line\">          return &#123; formData &#125;;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .map((&#123; formData &#125;) =&gt;</span><br><span class=\"line\">          this.request(&#123;</span><br><span class=\"line\">            url: &quot;http://localhost:3000&quot;,</span><br><span class=\"line\">            data: formData</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        );</span><br><span class=\"line\">      await Promise.all(requestList);</span><br><span class=\"line\"><span class=\"addition\">+     // 合并切片</span></span><br><span class=\"line\"><span class=\"addition\">+     await this.mergeRequest();</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"><span class=\"addition\">+    async mergeRequest() &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      await this.request(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        url: &quot;http://localhost:3000/merge&quot;,</span></span><br><span class=\"line\"><span class=\"addition\">+        headers: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          &quot;content-type&quot;: &quot;application/json&quot;</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+        data: JSON.stringify(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          filename: this.container.file.name</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;,    </span></span><br><span class=\"line\">    async handleUpload() &#123;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"服务端部分\"><a href=\"#服务端部分\" class=\"headerlink\" title=\"服务端部分\"></a>服务端部分</h2><p>使用 http 模块搭建一个简单服务端</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;http&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.<span class=\"title function_\">createServer</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;request&quot;</span>, <span class=\"keyword\">async</span> (req, res) =&gt; &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">setHeader</span>(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">  res.<span class=\"title function_\">setHeader</span>(<span class=\"string\">&quot;Access-Control-Allow-Headers&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.<span class=\"property\">method</span> === <span class=\"string\">&quot;OPTIONS&quot;</span>) &#123;</span><br><span class=\"line\">    res.<span class=\"property\">status</span> = <span class=\"number\">200</span>;</span><br><span class=\"line\">    res.<span class=\"title function_\">end</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;listening port 3000&quot;</span>));</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"接受切片\"><a href=\"#接受切片\" class=\"headerlink\" title=\"接受切片\"></a>接受切片</h3><p>使用 multiparty 处理前端传来的 formData</p>\n<p>在 multiparty.parse 的回调中，files 参数保存了 formData 中文件，fields 参数保存了 formData 中非文件的字段</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const http = require(&quot;http&quot;);</span><br><span class=\"line\">const path = require(&quot;path&quot;);</span><br><span class=\"line\"><span class=\"addition\">+ const fse = require(&quot;fs-extra&quot;);</span></span><br><span class=\"line\"><span class=\"addition\">+ const multiparty = require(&quot;multiparty&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\">const server = http.createServer();</span><br><span class=\"line\"><span class=\"addition\">+ // 大文件存储目录</span></span><br><span class=\"line\"><span class=\"addition\">+ const UPLOAD_DIR = path.resolve(__dirname, &quot;..&quot;, &quot;target&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\">server.on(&quot;request&quot;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">  res.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span><br><span class=\"line\">  res.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;*&quot;);</span><br><span class=\"line\">  if (req.method <span class=\"comment\">=== &quot;OPTIONS&quot;) &#123;</span></span><br><span class=\"line\">    res.status = 200;</span><br><span class=\"line\">    res.end();</span><br><span class=\"line\">    return;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+  const multipart = new multiparty.Form();</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+  multipart.parse(req, async (err, fields, files) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    if (err) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      return;</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+    const [chunk] = files.chunk;</span></span><br><span class=\"line\"><span class=\"addition\">+    const [hash] = fields.hash;</span></span><br><span class=\"line\"><span class=\"addition\">+    const [filename] = fields.filename;</span></span><br><span class=\"line\"><span class=\"addition\">+    // 创建临时文件夹用于临时存储 chunk</span></span><br><span class=\"line\"><span class=\"addition\">+    // 添加 chunkDir 前缀与文件名做区分</span></span><br><span class=\"line\"><span class=\"addition\">+    const chunkDir = path.resolve(UPLOAD_DIR, &#x27;chunkDir&#x27; + filename);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+    if (!fse.existsSync(chunkDir)) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      await fse.mkdirs(chunkDir);</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+    // fs-extra 的 rename 方法 windows 平台会有权限问题</span></span><br><span class=\"line\"><span class=\"addition\">+    // @see https://github.com/meteor/meteor/issues/7852#issuecomment-255767835</span></span><br><span class=\"line\"><span class=\"addition\">+    await fse.move(chunk.path, `$&#123;chunkDir&#125;/$&#123;hash&#125;`);</span></span><br><span class=\"line\"><span class=\"addition\">+    res.end(&quot;received file chunk&quot;);</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;);</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(3000, () =&gt; console.log(&quot;listening port 3000&quot;));</span><br></pre></td></tr></table></figure>\n\n<p>查看 multiparty 处理后的 chunk 对象，path 是存储临时文件的路径，size 是临时文件大小，在 multiparty 文档中提到可以使用 fs.rename（这里换成了 fs.remove, 因为 fs-extra 的 rename 方法在 windows 平台存在权限问题）</p>\n<p>在接受文件切片时，需要先创建临时存储切片的文件夹，以 chunkDir 作为前缀，文件名作为后缀。</p>\n<p>由于前端在发送每个切片时额外携带了唯一值 hash，所以以 hash 作为文件名，将切片从临时路径移动切片文件夹中。</p>\n<h3 id=\"合并切片\"><a href=\"#合并切片\" class=\"headerlink\" title=\"合并切片\"></a>合并切片</h3><p>在接收到前端发送的合并请求后，服务端将文件夹下的所有切片进行合并</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const http = require(&quot;http&quot;);</span><br><span class=\"line\">const path = require(&quot;path&quot;);</span><br><span class=\"line\">const fse = require(&quot;fs-extra&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">const server = http.createServer();</span><br><span class=\"line\">const UPLOAD_DIR = path.resolve(__dirname, &quot;..&quot;, &quot;target&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+ const resolvePost = req =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+   new Promise(resolve =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     let chunk = &quot;&quot;;</span></span><br><span class=\"line\"><span class=\"addition\">+     req.on(&quot;data&quot;, data =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       chunk += data;</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+     req.on(&quot;end&quot;, () =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       resolve(JSON.parse(chunk));</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+ // 写入文件流</span></span><br><span class=\"line\"><span class=\"addition\">+ const pipeStream = (path, writeStream) =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+  new Promise(resolve =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    const readStream = fse.createReadStream(path);</span></span><br><span class=\"line\"><span class=\"addition\">+    readStream.on(&quot;end&quot;, () =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      fse.unlinkSync(path);</span></span><br><span class=\"line\"><span class=\"addition\">+      resolve();</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+    readStream.pipe(writeStream);</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;);</span></span><br><span class=\"line\"></span><br><span class=\"line\">// 合并切片</span><br><span class=\"line\"><span class=\"addition\">+ const mergeFileChunk = async (filePath, filename, size) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+   const chunkDir = path.resolve(UPLOAD_DIR, &#x27;chunkDir&#x27; + filename);</span></span><br><span class=\"line\"><span class=\"addition\">+   const chunkPaths = await fse.readdir(chunkDir);</span></span><br><span class=\"line\"><span class=\"addition\">+   // 根据切片下标进行排序</span></span><br><span class=\"line\"><span class=\"addition\">+   // 否则直接读取目录的获得的顺序会错乱</span></span><br><span class=\"line\"><span class=\"addition\">+   chunkPaths.sort((a, b) =&gt; a.split(&quot;-&quot;)[1] - b.split(&quot;-&quot;)[1]);</span></span><br><span class=\"line\"><span class=\"addition\">+   // 并发写入文件</span></span><br><span class=\"line\"><span class=\"addition\">+   await Promise.all(</span></span><br><span class=\"line\"><span class=\"addition\">+     chunkPaths.map((chunkPath, index) =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+       pipeStream(</span></span><br><span class=\"line\"><span class=\"addition\">+         path.resolve(chunkDir, chunkPath),</span></span><br><span class=\"line\"><span class=\"addition\">+         // 根据 size 在指定位置创建可写流</span></span><br><span class=\"line\"><span class=\"addition\">+         fse.createWriteStream(filePath, &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+           start: index * size,</span></span><br><span class=\"line\"><span class=\"addition\">+         &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+       )</span></span><br><span class=\"line\"><span class=\"addition\">+     )</span></span><br><span class=\"line\"><span class=\"addition\">+  );</span></span><br><span class=\"line\"><span class=\"addition\">+  // 合并后删除保存切片的目录</span></span><br><span class=\"line\"><span class=\"addition\">+  fse.rmdirSync(chunkDir);</span></span><br><span class=\"line\"><span class=\"addition\">+&#125;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">server.on(&quot;request&quot;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">  res.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span><br><span class=\"line\">  res.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;*&quot;);</span><br><span class=\"line\">  if (req.method <span class=\"comment\">=== &quot;OPTIONS&quot;) &#123;</span></span><br><span class=\"line\">    res.status = 200;</span><br><span class=\"line\">    res.end();</span><br><span class=\"line\">    return;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+   if (req.url === &quot;/merge&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     const data = await resolvePost(req);</span></span><br><span class=\"line\"><span class=\"addition\">+     const &#123; filename,size &#125; = data;</span></span><br><span class=\"line\"><span class=\"addition\">+     const filePath = path.resolve(UPLOAD_DIR, `$&#123;filename&#125;`);</span></span><br><span class=\"line\"><span class=\"addition\">+     await mergeFileChunk(filePath, filename);</span></span><br><span class=\"line\"><span class=\"addition\">+     res.end(</span></span><br><span class=\"line\"><span class=\"addition\">+       JSON.stringify(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         code: 0,</span></span><br><span class=\"line\"><span class=\"addition\">+         message: &quot;file merged success&quot;</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+     );</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(3000, () =&gt; console.log(&quot;listening port 3000&quot;));</span><br></pre></td></tr></table></figure>\n\n<p>由于前端在发送合并请求时会携带文件名，服务端根据文件名可以找到上一步创建的切片文件夹</p>\n<p>接着使用 fs.createWriteStream 创建一个可写流，可写流文件名就是上传时的文件名</p>\n<p>随后遍历整个切片文件夹，将切片通过 fs.createReadStream 创建可读流，传输合并到目标文件中</p>\n<p>值得注意的是每次可读流都会传输到可写流的指定位置，这是通过 createWriteStream 的第二个参数 start 控制的，目的是能够并发合并多个可读流至可写流中，这样即使并发时流的顺序不同，也能传输到正确的位置</p>\n<p>所以还需要让前端在请求的时候提供之前设定好的 size 给服务端，服务端根据 size 指定可读流的起始位置</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  async mergeRequest() &#123;</span><br><span class=\"line\">     await this.request(&#123;</span><br><span class=\"line\">       url: &quot;http://localhost:3000/merge&quot;,</span><br><span class=\"line\">       headers: &#123;</span><br><span class=\"line\">         &quot;content-type&quot;: &quot;application/json&quot;</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\">       data: JSON.stringify(&#123;</span><br><span class=\"line\"><span class=\"addition\">+        size: SIZE,</span></span><br><span class=\"line\">         filename: this.container.file.name</span><br><span class=\"line\">       &#125;)</span><br><span class=\"line\">     &#125;);</span><br><span class=\"line\">   &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>其实也可以等上一个切片合并完后再合并下个切片，这样就不需要指定位置，但传输速度会降低，所以使用了并发合并的手段。接着只要保证每次合并完成后删除这个切片，等所有切片都合并完毕后最后删除切片文件夹即可</p>\n<p>至此一个简单的大文件上传就完成了，接下来我们再此基础上扩展一些额外的功能。</p>\n<h2 id=\"显示上传进度条\"><a href=\"#显示上传进度条\" class=\"headerlink\" title=\"显示上传进度条\"></a>显示上传进度条</h2><p>上传进度分两种，一个是每个切片的上传进度，另一个是整个文件的上传进度，而整个文件的上传进度是基于每个切片上传进度计算而来，所以我们先实现单个切片的进度条。</p>\n<h3 id=\"单个切片进度条\"><a href=\"#单个切片进度条\" class=\"headerlink\" title=\"单个切片进度条\"></a>单个切片进度条</h3><p>XMLHttpRequest 原生支持上传进度的监听，只需要监听 upload.onprogress 即可，我们在原来的 request 基础上传入 onProgress 参数，给 XMLHttpRequest 注册监听事件</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> // xhr</span><br><span class=\"line\">    request(&#123;</span><br><span class=\"line\">      url,</span><br><span class=\"line\">      method = &quot;post&quot;,</span><br><span class=\"line\">      data,</span><br><span class=\"line\">      headers = &#123;&#125;,</span><br><span class=\"line\"><span class=\"addition\">+     onProgress = e =&gt; e,</span></span><br><span class=\"line\">      requestList</span><br><span class=\"line\">    &#125;) &#123;</span><br><span class=\"line\">      return new Promise(resolve =&gt; &#123;</span><br><span class=\"line\">        const xhr = new XMLHttpRequest();</span><br><span class=\"line\"><span class=\"addition\">+       xhr.upload.onprogress = onProgress;</span></span><br><span class=\"line\">        xhr.open(method, url);</span><br><span class=\"line\">        Object.keys(headers).forEach(key =&gt;</span><br><span class=\"line\">          xhr.setRequestHeader(key, headers[key])</span><br><span class=\"line\">        );</span><br><span class=\"line\">        xhr.send(data);</span><br><span class=\"line\">        xhr.onload = e =&gt; &#123;</span><br><span class=\"line\">          resolve(&#123;</span><br><span class=\"line\">            data: e.target.response</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>由于每个切片都需要触发独立的监听事件，所以需要一个工厂函数，根据传入的切片返回不同的监听函数</p>\n<p>在原先的前端上传逻辑中新增监听函数部分</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    // 上传切片，同时过滤已上传的切片</span><br><span class=\"line\">    async uploadChunks(uploadedList = []) &#123;</span><br><span class=\"line\">      const requestList = this.data</span><br><span class=\"line\"><span class=\"addition\">+       .map((&#123; chunk,hash,index &#125;) =&gt; &#123;</span></span><br><span class=\"line\">          const formData = new FormData();</span><br><span class=\"line\">          formData.append(&quot;chunk&quot;, chunk);</span><br><span class=\"line\">          formData.append(&quot;hash&quot;, hash);</span><br><span class=\"line\">          formData.append(&quot;filename&quot;, this.container.file.name);</span><br><span class=\"line\"><span class=\"addition\">+         return &#123; formData,index &#125;;</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"><span class=\"addition\">+       .map((&#123; formData,index &#125;) =&gt;</span></span><br><span class=\"line\">          this.request(&#123;</span><br><span class=\"line\">            url: &quot;http://localhost:3000&quot;,</span><br><span class=\"line\">            data: formData，</span><br><span class=\"line\"><span class=\"addition\">+           onProgress: this.createProgressHandler(this.data[index]),</span></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        );</span><br><span class=\"line\">      await Promise.all(requestList);</span><br><span class=\"line\">      await this.mergeRequest();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    async handleUpload() &#123;</span><br><span class=\"line\">      if (!this.container.file) return;</span><br><span class=\"line\">      const fileChunkList = this.createFileChunk(this.container.file);</span><br><span class=\"line\">      this.data = fileChunkList.map((&#123; file &#125;，index) =&gt; (&#123;</span><br><span class=\"line\">        chunk: file,</span><br><span class=\"line\"><span class=\"addition\">+       index,</span></span><br><span class=\"line\">        hash: this.container.file.name + &quot;-&quot; + index</span><br><span class=\"line\"><span class=\"addition\">+       percentage:0</span></span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\">      await this.uploadChunks();</span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\"><span class=\"addition\">+   createProgressHandler(item) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      return e =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        item.percentage = parseInt(String((e.loaded / e.total) * 100));</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;;</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>每个切片在上传时都会通过监听函数更新 data 数组对应元素的 percentage 属性，之后把将 data 数组放到视图中展示即可。</p>\n<h3 id=\"总进度条\"><a href=\"#总进度条\" class=\"headerlink\" title=\"总进度条\"></a>总进度条</h3><p>将每个切片已上传的部分累加，除以整个文件的大小，就能得出当前文件的上传进度，所以这里使用 Vue 的计算属性</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"attr\">computed</span>: &#123;</span><br><span class=\"line\">      <span class=\"title function_\">uploadPercentage</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (!<span class=\"variable language_\">this</span>.<span class=\"property\">container</span>.<span class=\"property\">file</span> || !<span class=\"variable language_\">this</span>.<span class=\"property\">data</span>.<span class=\"property\">length</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">         <span class=\"keyword\">const</span> loaded = <span class=\"variable language_\">this</span>.<span class=\"property\">data</span></span><br><span class=\"line\">           .<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.<span class=\"property\">size</span> * item.<span class=\"property\">percentage</span>)</span><br><span class=\"line\">           .<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> acc + cur);</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>((loaded / <span class=\"variable language_\">this</span>.<span class=\"property\">container</span>.<span class=\"property\">file</span>.<span class=\"property\">size</span>).<span class=\"title function_\">toFixed</span>(<span class=\"number\">2</span>));</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>大文件上传：</p>\n<ul>\n<li>前端上传大文件时使用 Blob.prototype.slice 将文件切片，并发上传多个切片，最后发送一个合并的请求通知服务端合并切片</li>\n<li>服务端接收切片并存储，收到合并请求后使用流将切片合并到最终文件</li>\n<li>原生 XMLHttpRequest 的 upload.onprogress 对切片上传进度的监听</li>\n<li>使用 Vue 计算属性根据每个切片的进度算出整个文件的上传进度</li>\n</ul>\n<p>参考 <a href=\"https://juejin.cn/post/6844904046436843527#heading-24\">https://juejin.cn/post/6844904046436843527#heading-24</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>本文从零搭建前端和服务端，实现一个大文件上传的 demo</p>\n<p>前端：Vue@2 + Element-ui</p>\n<p>服务端：Nodejs@14 + multiparty</p>\n<h2 id=\"整体思路\"><a href=\"#整体思路\" class=\"headerlink\" title=\"整体思路\"></a>整体思路</h2><h3 id=\"前端\"><a href=\"#前端\" class=\"headerlink\" title=\"前端\"></a>前端</h3><p>前端大文件上传网上的大部分文章已经给出了解决方案，核心是利用 <code>Blob.prototype.slice</code> 方法，和数组的 slice 方法相似，文件的 slice 方法可以返回原文件的某个切片。</p>\n<p>预先定义好单个切片大小，将文件切分为一个个切片，然后借助 http 的可并发性，同时上传多个切片。这样从原本传一个大文件，变成了并发传多个小的文件切片，可以大大减少上传时间。</p>\n<p>另外由于是并发，传输到服务端的顺序可能会发生变化，因此我们还需要给每个切片记录顺序。</p>\n<h3 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h3><p>服务端负责接受前端传输的切片，并在接收到所有切片后合并所有切片</p>\n<p>这里又引伸出两个问题</p>\n<ol>\n<li>何时合并切片，即切片什么时候传输完成</li>\n<li>如何合并切片</li>\n</ol>\n<p>第一个问题需要前端配合，前端在每个切片中都携带切片最大数量的信息，当服务端接受到这个数量的切片时自动合并。或者也可以额外发一个请求，主动通知服务端进行切片的合并。</p>\n<p>第二个问题，具体如何合并切片呢？这里可以使用 Nodejs 的 读写流（readStream&#x2F;writeStream），将所有切片的流传输到最终文件的流里。</p>\n<h2 id=\"前端部分\"><a href=\"#前端部分\" class=\"headerlink\" title=\"前端部分\"></a>前端部分</h2><p>前端使用 Vue 作为开发框架，对界面没有太大要求，原生也可以，考虑到美观使用 Element-ui 作为 UI 框架</p>\n<h3 id=\"上传控件\"><a href=\"#上传控件\" class=\"headerlink\" title=\"上传控件\"></a>上传控件</h3><p>首先创建选择文件的控件并监听 change 事件，另外就是上传按钮</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> @<span class=\"attr\">change</span>=<span class=\"string\">&quot;handleFileChange&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">el-button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;handleUpload&quot;</span>&gt;</span>upload<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">data</span>: <span class=\"function\">() =&gt;</span> (&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">container</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"attr\">file</span>: <span class=\"literal\">null</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;),</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">methods</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">     <span class=\"title function_\">handleFileChange</span>(<span class=\"params\">e</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> [file] = e.<span class=\"property\">target</span>.<span class=\"property\">files</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">if</span> (!file) <span class=\"keyword\">return</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">$data</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">$options</span>.<span class=\"title function_\">data</span>());</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">this</span>.<span class=\"property\">container</span>.<span class=\"property\">file</span> = file;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">async</span> <span class=\"title function_\">handleUpload</span>(<span class=\"params\"></span>) &#123;&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"请求逻辑\"><a href=\"#请求逻辑\" class=\"headerlink\" title=\"请求逻辑\"></a>请求逻辑</h3><p>考虑到通用性，这里没有用第三方的请求库，而是用原生 XMLHttpRequest 做一层简单的封装来发请求</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">request</span>(<span class=\"params\">&#123;</span></span><br><span class=\"line\"><span class=\"params\">      url,</span></span><br><span class=\"line\"><span class=\"params\">      method = <span class=\"string\">&quot;post&quot;</span>,</span></span><br><span class=\"line\"><span class=\"params\">      data,</span></span><br><span class=\"line\"><span class=\"params\">      headers = &#123;&#125;,</span></span><br><span class=\"line\"><span class=\"params\">      requestList</span></span><br><span class=\"line\"><span class=\"params\">    &#125;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">        xhr.<span class=\"title function_\">open</span>(method, url);</span><br><span class=\"line\">        <span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(headers).<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">key</span> =&gt;</span></span><br><span class=\"line\">          xhr.<span class=\"title function_\">setRequestHeader</span>(key, headers[key])</span><br><span class=\"line\">        );</span><br><span class=\"line\">        xhr.<span class=\"title function_\">send</span>(data);</span><br><span class=\"line\">        xhr.<span class=\"property\">onload</span> = <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"title function_\">resolve</span>(&#123;</span><br><span class=\"line\">            <span class=\"attr\">data</span>: e.<span class=\"property\">target</span>.<span class=\"property\">response</span></span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"上传切片\"><a href=\"#上传切片\" class=\"headerlink\" title=\"上传切片\"></a>上传切片</h3><p>接着实现比较重要的上传功能，上传需要做两件事</p>\n<ol>\n<li>对文件进行切片</li>\n<li>将切片传输给服务端</li>\n</ol>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;input type=&quot;file&quot; @change=&quot;handleFileChange&quot; /&gt;</span><br><span class=\"line\">    &lt;el-button @click=&quot;handleUpload&quot;&gt;上传&lt;/el-button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"><span class=\"addition\">+ // 切片大小</span></span><br><span class=\"line\"><span class=\"addition\">+ // the chunk size</span></span><br><span class=\"line\"><span class=\"addition\">+ const SIZE = 10 * 1024 * 1024; </span></span><br><span class=\"line\"></span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  data: () =&gt; (&#123;</span><br><span class=\"line\">    container: &#123;</span><br><span class=\"line\">      file: null</span><br><span class=\"line\">    &#125;，</span><br><span class=\"line\"><span class=\"addition\">+   data: []</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    request() &#123;&#125;,</span><br><span class=\"line\">    handleFileChange() &#123;&#125;,</span><br><span class=\"line\"><span class=\"addition\">+    // 生成文件切片</span></span><br><span class=\"line\"><span class=\"addition\">+    createFileChunk(file, size = SIZE) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     const fileChunkList = [];</span></span><br><span class=\"line\"><span class=\"addition\">+      let cur = 0;</span></span><br><span class=\"line\"><span class=\"addition\">+      while (cur &lt; file.size) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        fileChunkList.push(&#123; file: file.slice(cur, cur + size) &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+        cur += size;</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+      return fileChunkList;</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+   // 上传切片</span></span><br><span class=\"line\"><span class=\"addition\">+    async uploadChunks() &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      const requestList = this.data</span></span><br><span class=\"line\"><span class=\"addition\">+        .map((&#123; chunk，hash &#125;) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          const formData = new FormData();</span></span><br><span class=\"line\"><span class=\"addition\">+          formData.append(&quot;chunk&quot;, chunk);</span></span><br><span class=\"line\"><span class=\"addition\">+          formData.append(&quot;hash&quot;, hash);</span></span><br><span class=\"line\"><span class=\"addition\">+          formData.append(&quot;filename&quot;, this.container.file.name);</span></span><br><span class=\"line\"><span class=\"addition\">+          return &#123; formData &#125;;</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+        .map((&#123; formData &#125;) =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+          this.request(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            url: &quot;http://localhost:3000&quot;,</span></span><br><span class=\"line\"><span class=\"addition\">+            data: formData</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+        );</span></span><br><span class=\"line\"><span class=\"addition\">+      // 并发请求</span></span><br><span class=\"line\"><span class=\"addition\">+      await Promise.all(requestList); </span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+    async handleUpload() &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      if (!this.container.file) return;</span></span><br><span class=\"line\"><span class=\"addition\">+      const fileChunkList = this.createFileChunk(this.container.file);</span></span><br><span class=\"line\"><span class=\"addition\">+      this.data = fileChunkList.map((&#123; file &#125;，index) =&gt; (&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        chunk: file,</span></span><br><span class=\"line\"><span class=\"addition\">+        // 文件名 + 数组下标</span></span><br><span class=\"line\"><span class=\"addition\">+        hash: this.container.file.name + &quot;-&quot; + index</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;));</span></span><br><span class=\"line\"><span class=\"addition\">+      await this.uploadChunks();</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>当点击上传按钮时，调用 createFileChunk 将文件切片，切片数量通过文件大小控制，这里设置 10MB，也就是说一个 100 MB 的文件会被分成 10 个 10MB 的切片。</p>\n<p>createFileChunk 内使用 while 循环和 slice 方法将切片放入 fileChunkList 数组中返回。</p>\n<p>在生成文件切片时，需要给每个切片一个标识作为 hash，这里暂时使用文件名 + 下标，这样后端可以知道当前切片是第几个切片，用于之后的合并切片。</p>\n<p>随后调用 uploadChunks 上传所有的文件切片，将文件切片，切片 hash，以及文件名放入 formData 中，再调用上一步的 request 函数返回一个 proimise，最后调用 Promise.all 并发上传所有的切片。</p>\n<h3 id=\"发送合并请求\"><a href=\"#发送合并请求\" class=\"headerlink\" title=\"发送合并请求\"></a>发送合并请求</h3><p>使用整体思路中提到的第二种合并切片的方式，即前端主动通知服务端进行合并</p>\n<p>前端发送额外的合并请求，服务端接受到请求时合并切片</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;input type=&quot;file&quot; @change=&quot;handleFileChange&quot; /&gt;</span><br><span class=\"line\">    &lt;el-button @click=&quot;handleUpload&quot;&gt;upload&lt;/el-button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  data: () =&gt; (&#123;</span><br><span class=\"line\">    container: &#123;</span><br><span class=\"line\">      file: null</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    data: []</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    request() &#123;&#125;,</span><br><span class=\"line\">    handleFileChange() &#123;&#125;,</span><br><span class=\"line\">    createFileChunk() &#123;&#125;,</span><br><span class=\"line\">    async uploadChunks() &#123;</span><br><span class=\"line\">      const requestList = this.data</span><br><span class=\"line\">        .map((&#123; chunk，hash &#125;) =&gt; &#123;</span><br><span class=\"line\">          const formData = new FormData();</span><br><span class=\"line\">          formData.append(&quot;chunk&quot;, chunk);</span><br><span class=\"line\">          formData.append(&quot;hash&quot;, hash);</span><br><span class=\"line\">          formData.append(&quot;filename&quot;, this.container.file.name);</span><br><span class=\"line\">          return &#123; formData &#125;;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .map((&#123; formData &#125;) =&gt;</span><br><span class=\"line\">          this.request(&#123;</span><br><span class=\"line\">            url: &quot;http://localhost:3000&quot;,</span><br><span class=\"line\">            data: formData</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        );</span><br><span class=\"line\">      await Promise.all(requestList);</span><br><span class=\"line\"><span class=\"addition\">+     // 合并切片</span></span><br><span class=\"line\"><span class=\"addition\">+     await this.mergeRequest();</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"><span class=\"addition\">+    async mergeRequest() &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      await this.request(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        url: &quot;http://localhost:3000/merge&quot;,</span></span><br><span class=\"line\"><span class=\"addition\">+        headers: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          &quot;content-type&quot;: &quot;application/json&quot;</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+        data: JSON.stringify(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          filename: this.container.file.name</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;,    </span></span><br><span class=\"line\">    async handleUpload() &#123;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"服务端部分\"><a href=\"#服务端部分\" class=\"headerlink\" title=\"服务端部分\"></a>服务端部分</h2><p>使用 http 模块搭建一个简单服务端</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;http&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.<span class=\"title function_\">createServer</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;request&quot;</span>, <span class=\"keyword\">async</span> (req, res) =&gt; &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">setHeader</span>(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">  res.<span class=\"title function_\">setHeader</span>(<span class=\"string\">&quot;Access-Control-Allow-Headers&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.<span class=\"property\">method</span> === <span class=\"string\">&quot;OPTIONS&quot;</span>) &#123;</span><br><span class=\"line\">    res.<span class=\"property\">status</span> = <span class=\"number\">200</span>;</span><br><span class=\"line\">    res.<span class=\"title function_\">end</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;listening port 3000&quot;</span>));</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"接受切片\"><a href=\"#接受切片\" class=\"headerlink\" title=\"接受切片\"></a>接受切片</h3><p>使用 multiparty 处理前端传来的 formData</p>\n<p>在 multiparty.parse 的回调中，files 参数保存了 formData 中文件，fields 参数保存了 formData 中非文件的字段</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const http = require(&quot;http&quot;);</span><br><span class=\"line\">const path = require(&quot;path&quot;);</span><br><span class=\"line\"><span class=\"addition\">+ const fse = require(&quot;fs-extra&quot;);</span></span><br><span class=\"line\"><span class=\"addition\">+ const multiparty = require(&quot;multiparty&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\">const server = http.createServer();</span><br><span class=\"line\"><span class=\"addition\">+ // 大文件存储目录</span></span><br><span class=\"line\"><span class=\"addition\">+ const UPLOAD_DIR = path.resolve(__dirname, &quot;..&quot;, &quot;target&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\">server.on(&quot;request&quot;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">  res.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span><br><span class=\"line\">  res.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;*&quot;);</span><br><span class=\"line\">  if (req.method <span class=\"comment\">=== &quot;OPTIONS&quot;) &#123;</span></span><br><span class=\"line\">    res.status = 200;</span><br><span class=\"line\">    res.end();</span><br><span class=\"line\">    return;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+  const multipart = new multiparty.Form();</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+  multipart.parse(req, async (err, fields, files) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    if (err) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      return;</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+    const [chunk] = files.chunk;</span></span><br><span class=\"line\"><span class=\"addition\">+    const [hash] = fields.hash;</span></span><br><span class=\"line\"><span class=\"addition\">+    const [filename] = fields.filename;</span></span><br><span class=\"line\"><span class=\"addition\">+    // 创建临时文件夹用于临时存储 chunk</span></span><br><span class=\"line\"><span class=\"addition\">+    // 添加 chunkDir 前缀与文件名做区分</span></span><br><span class=\"line\"><span class=\"addition\">+    const chunkDir = path.resolve(UPLOAD_DIR, &#x27;chunkDir&#x27; + filename);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+    if (!fse.existsSync(chunkDir)) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      await fse.mkdirs(chunkDir);</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+    // fs-extra 的 rename 方法 windows 平台会有权限问题</span></span><br><span class=\"line\"><span class=\"addition\">+    // @see https://github.com/meteor/meteor/issues/7852#issuecomment-255767835</span></span><br><span class=\"line\"><span class=\"addition\">+    await fse.move(chunk.path, `$&#123;chunkDir&#125;/$&#123;hash&#125;`);</span></span><br><span class=\"line\"><span class=\"addition\">+    res.end(&quot;received file chunk&quot;);</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;);</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(3000, () =&gt; console.log(&quot;listening port 3000&quot;));</span><br></pre></td></tr></table></figure>\n\n<p>查看 multiparty 处理后的 chunk 对象，path 是存储临时文件的路径，size 是临时文件大小，在 multiparty 文档中提到可以使用 fs.rename（这里换成了 fs.remove, 因为 fs-extra 的 rename 方法在 windows 平台存在权限问题）</p>\n<p>在接受文件切片时，需要先创建临时存储切片的文件夹，以 chunkDir 作为前缀，文件名作为后缀。</p>\n<p>由于前端在发送每个切片时额外携带了唯一值 hash，所以以 hash 作为文件名，将切片从临时路径移动切片文件夹中。</p>\n<h3 id=\"合并切片\"><a href=\"#合并切片\" class=\"headerlink\" title=\"合并切片\"></a>合并切片</h3><p>在接收到前端发送的合并请求后，服务端将文件夹下的所有切片进行合并</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const http = require(&quot;http&quot;);</span><br><span class=\"line\">const path = require(&quot;path&quot;);</span><br><span class=\"line\">const fse = require(&quot;fs-extra&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">const server = http.createServer();</span><br><span class=\"line\">const UPLOAD_DIR = path.resolve(__dirname, &quot;..&quot;, &quot;target&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+ const resolvePost = req =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+   new Promise(resolve =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     let chunk = &quot;&quot;;</span></span><br><span class=\"line\"><span class=\"addition\">+     req.on(&quot;data&quot;, data =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       chunk += data;</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+     req.on(&quot;end&quot;, () =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       resolve(JSON.parse(chunk));</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+ // 写入文件流</span></span><br><span class=\"line\"><span class=\"addition\">+ const pipeStream = (path, writeStream) =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+  new Promise(resolve =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    const readStream = fse.createReadStream(path);</span></span><br><span class=\"line\"><span class=\"addition\">+    readStream.on(&quot;end&quot;, () =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      fse.unlinkSync(path);</span></span><br><span class=\"line\"><span class=\"addition\">+      resolve();</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+    readStream.pipe(writeStream);</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;);</span></span><br><span class=\"line\"></span><br><span class=\"line\">// 合并切片</span><br><span class=\"line\"><span class=\"addition\">+ const mergeFileChunk = async (filePath, filename, size) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+   const chunkDir = path.resolve(UPLOAD_DIR, &#x27;chunkDir&#x27; + filename);</span></span><br><span class=\"line\"><span class=\"addition\">+   const chunkPaths = await fse.readdir(chunkDir);</span></span><br><span class=\"line\"><span class=\"addition\">+   // 根据切片下标进行排序</span></span><br><span class=\"line\"><span class=\"addition\">+   // 否则直接读取目录的获得的顺序会错乱</span></span><br><span class=\"line\"><span class=\"addition\">+   chunkPaths.sort((a, b) =&gt; a.split(&quot;-&quot;)[1] - b.split(&quot;-&quot;)[1]);</span></span><br><span class=\"line\"><span class=\"addition\">+   // 并发写入文件</span></span><br><span class=\"line\"><span class=\"addition\">+   await Promise.all(</span></span><br><span class=\"line\"><span class=\"addition\">+     chunkPaths.map((chunkPath, index) =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+       pipeStream(</span></span><br><span class=\"line\"><span class=\"addition\">+         path.resolve(chunkDir, chunkPath),</span></span><br><span class=\"line\"><span class=\"addition\">+         // 根据 size 在指定位置创建可写流</span></span><br><span class=\"line\"><span class=\"addition\">+         fse.createWriteStream(filePath, &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+           start: index * size,</span></span><br><span class=\"line\"><span class=\"addition\">+         &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+       )</span></span><br><span class=\"line\"><span class=\"addition\">+     )</span></span><br><span class=\"line\"><span class=\"addition\">+  );</span></span><br><span class=\"line\"><span class=\"addition\">+  // 合并后删除保存切片的目录</span></span><br><span class=\"line\"><span class=\"addition\">+  fse.rmdirSync(chunkDir);</span></span><br><span class=\"line\"><span class=\"addition\">+&#125;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">server.on(&quot;request&quot;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">  res.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span><br><span class=\"line\">  res.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;*&quot;);</span><br><span class=\"line\">  if (req.method <span class=\"comment\">=== &quot;OPTIONS&quot;) &#123;</span></span><br><span class=\"line\">    res.status = 200;</span><br><span class=\"line\">    res.end();</span><br><span class=\"line\">    return;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+   if (req.url === &quot;/merge&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     const data = await resolvePost(req);</span></span><br><span class=\"line\"><span class=\"addition\">+     const &#123; filename,size &#125; = data;</span></span><br><span class=\"line\"><span class=\"addition\">+     const filePath = path.resolve(UPLOAD_DIR, `$&#123;filename&#125;`);</span></span><br><span class=\"line\"><span class=\"addition\">+     await mergeFileChunk(filePath, filename);</span></span><br><span class=\"line\"><span class=\"addition\">+     res.end(</span></span><br><span class=\"line\"><span class=\"addition\">+       JSON.stringify(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         code: 0,</span></span><br><span class=\"line\"><span class=\"addition\">+         message: &quot;file merged success&quot;</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+     );</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(3000, () =&gt; console.log(&quot;listening port 3000&quot;));</span><br></pre></td></tr></table></figure>\n\n<p>由于前端在发送合并请求时会携带文件名，服务端根据文件名可以找到上一步创建的切片文件夹</p>\n<p>接着使用 fs.createWriteStream 创建一个可写流，可写流文件名就是上传时的文件名</p>\n<p>随后遍历整个切片文件夹，将切片通过 fs.createReadStream 创建可读流，传输合并到目标文件中</p>\n<p>值得注意的是每次可读流都会传输到可写流的指定位置，这是通过 createWriteStream 的第二个参数 start 控制的，目的是能够并发合并多个可读流至可写流中，这样即使并发时流的顺序不同，也能传输到正确的位置</p>\n<p>所以还需要让前端在请求的时候提供之前设定好的 size 给服务端，服务端根据 size 指定可读流的起始位置</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  async mergeRequest() &#123;</span><br><span class=\"line\">     await this.request(&#123;</span><br><span class=\"line\">       url: &quot;http://localhost:3000/merge&quot;,</span><br><span class=\"line\">       headers: &#123;</span><br><span class=\"line\">         &quot;content-type&quot;: &quot;application/json&quot;</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\">       data: JSON.stringify(&#123;</span><br><span class=\"line\"><span class=\"addition\">+        size: SIZE,</span></span><br><span class=\"line\">         filename: this.container.file.name</span><br><span class=\"line\">       &#125;)</span><br><span class=\"line\">     &#125;);</span><br><span class=\"line\">   &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>其实也可以等上一个切片合并完后再合并下个切片，这样就不需要指定位置，但传输速度会降低，所以使用了并发合并的手段。接着只要保证每次合并完成后删除这个切片，等所有切片都合并完毕后最后删除切片文件夹即可</p>\n<p>至此一个简单的大文件上传就完成了，接下来我们再此基础上扩展一些额外的功能。</p>\n<h2 id=\"显示上传进度条\"><a href=\"#显示上传进度条\" class=\"headerlink\" title=\"显示上传进度条\"></a>显示上传进度条</h2><p>上传进度分两种，一个是每个切片的上传进度，另一个是整个文件的上传进度，而整个文件的上传进度是基于每个切片上传进度计算而来，所以我们先实现单个切片的进度条。</p>\n<h3 id=\"单个切片进度条\"><a href=\"#单个切片进度条\" class=\"headerlink\" title=\"单个切片进度条\"></a>单个切片进度条</h3><p>XMLHttpRequest 原生支持上传进度的监听，只需要监听 upload.onprogress 即可，我们在原来的 request 基础上传入 onProgress 参数，给 XMLHttpRequest 注册监听事件</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> // xhr</span><br><span class=\"line\">    request(&#123;</span><br><span class=\"line\">      url,</span><br><span class=\"line\">      method = &quot;post&quot;,</span><br><span class=\"line\">      data,</span><br><span class=\"line\">      headers = &#123;&#125;,</span><br><span class=\"line\"><span class=\"addition\">+     onProgress = e =&gt; e,</span></span><br><span class=\"line\">      requestList</span><br><span class=\"line\">    &#125;) &#123;</span><br><span class=\"line\">      return new Promise(resolve =&gt; &#123;</span><br><span class=\"line\">        const xhr = new XMLHttpRequest();</span><br><span class=\"line\"><span class=\"addition\">+       xhr.upload.onprogress = onProgress;</span></span><br><span class=\"line\">        xhr.open(method, url);</span><br><span class=\"line\">        Object.keys(headers).forEach(key =&gt;</span><br><span class=\"line\">          xhr.setRequestHeader(key, headers[key])</span><br><span class=\"line\">        );</span><br><span class=\"line\">        xhr.send(data);</span><br><span class=\"line\">        xhr.onload = e =&gt; &#123;</span><br><span class=\"line\">          resolve(&#123;</span><br><span class=\"line\">            data: e.target.response</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>由于每个切片都需要触发独立的监听事件，所以需要一个工厂函数，根据传入的切片返回不同的监听函数</p>\n<p>在原先的前端上传逻辑中新增监听函数部分</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    // 上传切片，同时过滤已上传的切片</span><br><span class=\"line\">    async uploadChunks(uploadedList = []) &#123;</span><br><span class=\"line\">      const requestList = this.data</span><br><span class=\"line\"><span class=\"addition\">+       .map((&#123; chunk,hash,index &#125;) =&gt; &#123;</span></span><br><span class=\"line\">          const formData = new FormData();</span><br><span class=\"line\">          formData.append(&quot;chunk&quot;, chunk);</span><br><span class=\"line\">          formData.append(&quot;hash&quot;, hash);</span><br><span class=\"line\">          formData.append(&quot;filename&quot;, this.container.file.name);</span><br><span class=\"line\"><span class=\"addition\">+         return &#123; formData,index &#125;;</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"><span class=\"addition\">+       .map((&#123; formData,index &#125;) =&gt;</span></span><br><span class=\"line\">          this.request(&#123;</span><br><span class=\"line\">            url: &quot;http://localhost:3000&quot;,</span><br><span class=\"line\">            data: formData，</span><br><span class=\"line\"><span class=\"addition\">+           onProgress: this.createProgressHandler(this.data[index]),</span></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        );</span><br><span class=\"line\">      await Promise.all(requestList);</span><br><span class=\"line\">      await this.mergeRequest();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    async handleUpload() &#123;</span><br><span class=\"line\">      if (!this.container.file) return;</span><br><span class=\"line\">      const fileChunkList = this.createFileChunk(this.container.file);</span><br><span class=\"line\">      this.data = fileChunkList.map((&#123; file &#125;，index) =&gt; (&#123;</span><br><span class=\"line\">        chunk: file,</span><br><span class=\"line\"><span class=\"addition\">+       index,</span></span><br><span class=\"line\">        hash: this.container.file.name + &quot;-&quot; + index</span><br><span class=\"line\"><span class=\"addition\">+       percentage:0</span></span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\">      await this.uploadChunks();</span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\"><span class=\"addition\">+   createProgressHandler(item) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      return e =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        item.percentage = parseInt(String((e.loaded / e.total) * 100));</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;;</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>每个切片在上传时都会通过监听函数更新 data 数组对应元素的 percentage 属性，之后把将 data 数组放到视图中展示即可。</p>\n<h3 id=\"总进度条\"><a href=\"#总进度条\" class=\"headerlink\" title=\"总进度条\"></a>总进度条</h3><p>将每个切片已上传的部分累加，除以整个文件的大小，就能得出当前文件的上传进度，所以这里使用 Vue 的计算属性</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"attr\">computed</span>: &#123;</span><br><span class=\"line\">      <span class=\"title function_\">uploadPercentage</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (!<span class=\"variable language_\">this</span>.<span class=\"property\">container</span>.<span class=\"property\">file</span> || !<span class=\"variable language_\">this</span>.<span class=\"property\">data</span>.<span class=\"property\">length</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">         <span class=\"keyword\">const</span> loaded = <span class=\"variable language_\">this</span>.<span class=\"property\">data</span></span><br><span class=\"line\">           .<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.<span class=\"property\">size</span> * item.<span class=\"property\">percentage</span>)</span><br><span class=\"line\">           .<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> acc + cur);</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>((loaded / <span class=\"variable language_\">this</span>.<span class=\"property\">container</span>.<span class=\"property\">file</span>.<span class=\"property\">size</span>).<span class=\"title function_\">toFixed</span>(<span class=\"number\">2</span>));</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>大文件上传：</p>\n<ul>\n<li>前端上传大文件时使用 Blob.prototype.slice 将文件切片，并发上传多个切片，最后发送一个合并的请求通知服务端合并切片</li>\n<li>服务端接收切片并存储，收到合并请求后使用流将切片合并到最终文件</li>\n<li>原生 XMLHttpRequest 的 upload.onprogress 对切片上传进度的监听</li>\n<li>使用 Vue 计算属性根据每个切片的进度算出整个文件的上传进度</li>\n</ul>\n<p>参考 <a href=\"https://juejin.cn/post/6844904046436843527#heading-24\">https://juejin.cn/post/6844904046436843527#heading-24</a></p>\n"},{"title":"数组去重方法总结","date":"2022-05-14T12:54:34.000Z","description":"数组去重方法总结","_content":"\n**方法一、利用ES6 Set去重（ES6中最常用）**\n\n```js\nfunction unique (arr) {\n  return Array.from(new Set(arr))\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", true, 15, false, undefined, null, NaN, \"NaN\", 0, \"a\", {}, {}]\n```\n\n\n\n**方法二、利用for嵌套for，然后splice去重（ES5中最常用）**\n\n```js\nfunction unique(arr){            \n        for(var i=0; i<arr.length; i++){\n            for(var j=i+1; j<arr.length; j++){\n                if(arr[i]==arr[j]){         //第一个等同于第二个，splice方法删除第二个\n                    arr.splice(j,1);\n                    j--;\n                }\n            }\n        }\n\treturn arr;\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", 15, false, undefined, NaN, NaN, \"NaN\", \"a\", {…}, {…}]     //NaN和{}没有去重，两个null直接消失了\n```\n\n- 双层循环，外层循环元素，内层循环时比较值。值相同时，则删去这个值。\n- 想快速学习更多常用的`ES6`语法\n\n\n\n**方法三、利用indexOf去重**\n\n```js\nfunction unique(arr) {\n    if (!Array.isArray(arr)) {\n        console.log('type error!')\n        return\n    }\n    var array = [];\n    for (var i = 0; i < arr.length; i++) {\n        if (array .indexOf(arr[i]) === -1) {\n            array .push(arr[i])\n        }\n    }\n    return array;\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", true, 15, false, undefined, null, NaN, NaN, \"NaN\", 0, \"a\", {…}, {…}]  //NaN、{}没有去重\n```\n\n新建一个空的结果数组，`for` 循环原数组，判断结果数组是否存在当前元素，如果有相同的值则跳过，不相同则`push`进数组。\n\n\n\n**方法四、利用sort()**\n\n```js\nfunction unique(arr) {\n    if (!Array.isArray(arr)) {\n        console.log('type error!')\n        return;\n    }\n    arr = arr.sort()\n    var arrry= [arr[0]];\n    for (var i = 1; i < arr.length; i++) {\n        if (arr[i] !== arr[i-1]) {\n            arrry.push(arr[i]);\n        }\n    }\n    return arrry;\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [0, 1, 15, \"NaN\", NaN, NaN, {…}, {…}, \"a\", false, null, true, \"true\", undefined]      //NaN、{}没有去重\n```\n\n利用`sort()`排序方法，然后根据排序后的结果进行遍历及相邻元素比对\n\n\n\n**方法五、利用对象的属性不能相同的特点进行去重**\n\n```js\nfunction unique(arr) {\n    if (!Array.isArray(arr)) {\n        console.log('type error!')\n        return\n    }\n    var arrry= [];\n     var  obj = {};\n    for (var i = 0; i < arr.length; i++) {\n        if (!obj[arr[i]]) {\n            arrry.push(arr[i])\n            obj[arr[i]] = 1\n        } else {\n            obj[arr[i]]++\n        }\n    }\n    return arrry;\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", 15, false, undefined, null, NaN, 0, \"a\", {…}]    //两个true直接去掉了，NaN和{}去重\n```\n\n\n\n**方法六、利用includes**\n\n```js\nfunction unique(arr) {\n    if (!Array.isArray(arr)) {\n        console.log('type error!')\n        return\n    }\n    var array =[];\n    for(var i = 0; i < arr.length; i++) {\n            if( !array.includes( arr[i]) ) {//includes 检测数组是否有某个值\n                    array.push(arr[i]);\n              }\n    }\n    return array\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", true, 15, false, undefined, null, NaN, \"NaN\", 0, \"a\", {…}, {…}]     //{}没有去重\n```\n\n\n\n**方法七、利用hasOwnProperty**\n\n```js\nfunction unique(arr) {\n    var obj = {};\n    return arr.filter(function(item, index, arr){\n        return obj.hasOwnProperty(typeof item + item) ? false : (obj[typeof item + item] = true)\n    })\n}\n    var arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\n        console.log(unique(arr))\n// [1, \"true\", true, 15, false, undefined, null, NaN, \"NaN\", 0, \"a\", {…}]   //所有的都去重了\n```\n\n利用`hasOwnProperty` 判断是否存在对象属性\n\n\n\n**方法八、利用filter**\n\n```js\nfunction unique(arr) {\n  return arr.filter(function(item, index, arr) {\n    //当前元素，在原始数组中的第一个索引==当前索引值，否则返回当前元素\n    return arr.indexOf(item, 0) === index;\n  });\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", true, 15, false, undefined, null, \"NaN\", 0, \"a\", {…}, {…}]\n```\n\n\n\n**方法九、利用递归去重**\n\n```js\nfunction unique(arr) {\n    var array= arr;\n    var len = array.length;\n\tarray.sort(function(a,b){   //排序后更加方便去重\n\t\treturn a - b;\n\t})\n\tfunction loop(index){\n        if(index >= 1){\n            if(array[index] === array[index-1]){\n            array.splice(index,1);\n            }\n            loop(index - 1);    //递归loop，然后数组去重\n        }\n\t}\n\tloop(len-1);\n\treturn array;\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"a\", \"true\", true, 15, false, 1, {…}, null, NaN, NaN, \"NaN\", 0, \"a\", {…}, undefined]\n```\n\n\n\n**方法十、利用Map数据结构去重**\n\n```js\nfunction arrayNonRepeatfy(arr) {\n\tlet map = new Map();\n\t\tlet array = new Array();  // 数组用于返回结果\n\t\tfor (let i = 0; i < arr.length; i++) {\n\t\t\tif(map .has(arr[i])) {  // 如果有该key值\n\t\t\tmap .set(arr[i], true);\n\t\t} else {\n\t\t\tmap .set(arr[i], false);   // 如果没有该key值\n\t\t\tarray .push(arr[i]);\n\t\t}\n\t}\n\treturn array ;\n}\n var arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\n    console.log(unique(arr))\n// [1, \"a\", \"true\", true, 15, false, 1, {…}, null, NaN, NaN, \"NaN\", 0, \"a\", {…}, undefined]\n```\n\n创建一个空`Map`数据结构，遍历需要去重的数组，把数组的每一个元素作为`key`存到`Map`中。由于`Map`中不会出现相同的`key`值，所以最终得到的就是去重后的结果\n\n\n\n**方法十一、利用reduce+includes**\n\n```js\nfunction unique(arr){\n    return arr.reduce((prev,cur) => prev.includes(cur) ? prev : [...prev,cur],[]);\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr));\n// [1, \"true\", true, 15, false, undefined, null, NaN, \"NaN\", 0, \"a\", {…}, {…}]\n```\n\n\n\n**方法十二、[...new Set(arr)]**\n\n```js\n[...new Set(arr)]\n```\n\n代码就是这么少----（其实，严格来说并不算是一种，相对于第一种方法来说只是简化了代码）\n","source":"_posts/array-not-duplicate.md","raw":"---\ntitle: 数组去重方法总结\ndate: 2022-05-14 20:54:34\ntags: \ncategories: JavaScript\ndescription: 数组去重方法总结\n---\n\n**方法一、利用ES6 Set去重（ES6中最常用）**\n\n```js\nfunction unique (arr) {\n  return Array.from(new Set(arr))\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", true, 15, false, undefined, null, NaN, \"NaN\", 0, \"a\", {}, {}]\n```\n\n\n\n**方法二、利用for嵌套for，然后splice去重（ES5中最常用）**\n\n```js\nfunction unique(arr){            \n        for(var i=0; i<arr.length; i++){\n            for(var j=i+1; j<arr.length; j++){\n                if(arr[i]==arr[j]){         //第一个等同于第二个，splice方法删除第二个\n                    arr.splice(j,1);\n                    j--;\n                }\n            }\n        }\n\treturn arr;\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", 15, false, undefined, NaN, NaN, \"NaN\", \"a\", {…}, {…}]     //NaN和{}没有去重，两个null直接消失了\n```\n\n- 双层循环，外层循环元素，内层循环时比较值。值相同时，则删去这个值。\n- 想快速学习更多常用的`ES6`语法\n\n\n\n**方法三、利用indexOf去重**\n\n```js\nfunction unique(arr) {\n    if (!Array.isArray(arr)) {\n        console.log('type error!')\n        return\n    }\n    var array = [];\n    for (var i = 0; i < arr.length; i++) {\n        if (array .indexOf(arr[i]) === -1) {\n            array .push(arr[i])\n        }\n    }\n    return array;\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", true, 15, false, undefined, null, NaN, NaN, \"NaN\", 0, \"a\", {…}, {…}]  //NaN、{}没有去重\n```\n\n新建一个空的结果数组，`for` 循环原数组，判断结果数组是否存在当前元素，如果有相同的值则跳过，不相同则`push`进数组。\n\n\n\n**方法四、利用sort()**\n\n```js\nfunction unique(arr) {\n    if (!Array.isArray(arr)) {\n        console.log('type error!')\n        return;\n    }\n    arr = arr.sort()\n    var arrry= [arr[0]];\n    for (var i = 1; i < arr.length; i++) {\n        if (arr[i] !== arr[i-1]) {\n            arrry.push(arr[i]);\n        }\n    }\n    return arrry;\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [0, 1, 15, \"NaN\", NaN, NaN, {…}, {…}, \"a\", false, null, true, \"true\", undefined]      //NaN、{}没有去重\n```\n\n利用`sort()`排序方法，然后根据排序后的结果进行遍历及相邻元素比对\n\n\n\n**方法五、利用对象的属性不能相同的特点进行去重**\n\n```js\nfunction unique(arr) {\n    if (!Array.isArray(arr)) {\n        console.log('type error!')\n        return\n    }\n    var arrry= [];\n     var  obj = {};\n    for (var i = 0; i < arr.length; i++) {\n        if (!obj[arr[i]]) {\n            arrry.push(arr[i])\n            obj[arr[i]] = 1\n        } else {\n            obj[arr[i]]++\n        }\n    }\n    return arrry;\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", 15, false, undefined, null, NaN, 0, \"a\", {…}]    //两个true直接去掉了，NaN和{}去重\n```\n\n\n\n**方法六、利用includes**\n\n```js\nfunction unique(arr) {\n    if (!Array.isArray(arr)) {\n        console.log('type error!')\n        return\n    }\n    var array =[];\n    for(var i = 0; i < arr.length; i++) {\n            if( !array.includes( arr[i]) ) {//includes 检测数组是否有某个值\n                    array.push(arr[i]);\n              }\n    }\n    return array\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", true, 15, false, undefined, null, NaN, \"NaN\", 0, \"a\", {…}, {…}]     //{}没有去重\n```\n\n\n\n**方法七、利用hasOwnProperty**\n\n```js\nfunction unique(arr) {\n    var obj = {};\n    return arr.filter(function(item, index, arr){\n        return obj.hasOwnProperty(typeof item + item) ? false : (obj[typeof item + item] = true)\n    })\n}\n    var arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\n        console.log(unique(arr))\n// [1, \"true\", true, 15, false, undefined, null, NaN, \"NaN\", 0, \"a\", {…}]   //所有的都去重了\n```\n\n利用`hasOwnProperty` 判断是否存在对象属性\n\n\n\n**方法八、利用filter**\n\n```js\nfunction unique(arr) {\n  return arr.filter(function(item, index, arr) {\n    //当前元素，在原始数组中的第一个索引==当前索引值，否则返回当前元素\n    return arr.indexOf(item, 0) === index;\n  });\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"true\", true, 15, false, undefined, null, \"NaN\", 0, \"a\", {…}, {…}]\n```\n\n\n\n**方法九、利用递归去重**\n\n```js\nfunction unique(arr) {\n    var array= arr;\n    var len = array.length;\n\tarray.sort(function(a,b){   //排序后更加方便去重\n\t\treturn a - b;\n\t})\n\tfunction loop(index){\n        if(index >= 1){\n            if(array[index] === array[index-1]){\n            array.splice(index,1);\n            }\n            loop(index - 1);    //递归loop，然后数组去重\n        }\n\t}\n\tloop(len-1);\n\treturn array;\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr))\n// [1, \"a\", \"true\", true, 15, false, 1, {…}, null, NaN, NaN, \"NaN\", 0, \"a\", {…}, undefined]\n```\n\n\n\n**方法十、利用Map数据结构去重**\n\n```js\nfunction arrayNonRepeatfy(arr) {\n\tlet map = new Map();\n\t\tlet array = new Array();  // 数组用于返回结果\n\t\tfor (let i = 0; i < arr.length; i++) {\n\t\t\tif(map .has(arr[i])) {  // 如果有该key值\n\t\t\tmap .set(arr[i], true);\n\t\t} else {\n\t\t\tmap .set(arr[i], false);   // 如果没有该key值\n\t\t\tarray .push(arr[i]);\n\t\t}\n\t}\n\treturn array ;\n}\n var arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\n    console.log(unique(arr))\n// [1, \"a\", \"true\", true, 15, false, 1, {…}, null, NaN, NaN, \"NaN\", 0, \"a\", {…}, undefined]\n```\n\n创建一个空`Map`数据结构，遍历需要去重的数组，把数组的每一个元素作为`key`存到`Map`中。由于`Map`中不会出现相同的`key`值，所以最终得到的就是去重后的结果\n\n\n\n**方法十一、利用reduce+includes**\n\n```js\nfunction unique(arr){\n    return arr.reduce((prev,cur) => prev.includes(cur) ? prev : [...prev,cur],[]);\n}\nvar arr = [1,1,'true','true',true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,'NaN', 0, 0, 'a', 'a',{},{}];\nconsole.log(unique(arr));\n// [1, \"true\", true, 15, false, undefined, null, NaN, \"NaN\", 0, \"a\", {…}, {…}]\n```\n\n\n\n**方法十二、[...new Set(arr)]**\n\n```js\n[...new Set(arr)]\n```\n\n代码就是这么少----（其实，严格来说并不算是一种，相对于第一种方法来说只是简化了代码）\n","slug":"array-not-duplicate","published":1,"updated":"2022-05-14T12:55:57.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshd0007yt8w8d9b5v04","content":"<p><strong>方法一、利用ES6 Set去重（ES6中最常用）</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span> (arr) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Set</span>(arr))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;&#125;, &#123;&#125;]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法二、利用for嵌套for，然后splice去重（ES5中最常用）</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>)&#123;            </span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;arr.<span class=\"property\">length</span>; i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j=i+<span class=\"number\">1</span>; j&lt;arr.<span class=\"property\">length</span>; j++)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(arr[i]==arr[j])&#123;         <span class=\"comment\">//第一个等同于第二个，splice方法删除第二个</span></span><br><span class=\"line\">                    arr.<span class=\"title function_\">splice</span>(j,<span class=\"number\">1</span>);</span><br><span class=\"line\">                    j--;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> arr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, 15, false, undefined, NaN, NaN, &quot;NaN&quot;, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]     //NaN和&#123;&#125;没有去重，两个null直接消失了</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>双层循环，外层循环元素，内层循环时比较值。值相同时，则删去这个值。</li>\n<li>想快速学习更多常用的<code>ES6</code>语法</li>\n</ul>\n<p><strong>方法三、利用indexOf去重</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(arr)) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;type error!&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> array = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; arr.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (array .<span class=\"title function_\">indexOf</span>(arr[i]) === -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            array .<span class=\"title function_\">push</span>(arr[i])</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> array;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]  //NaN、&#123;&#125;没有去重</span></span><br></pre></td></tr></table></figure>\n\n<p>新建一个空的结果数组，<code>for</code> 循环原数组，判断结果数组是否存在当前元素，如果有相同的值则跳过，不相同则<code>push</code>进数组。</p>\n<p><strong>方法四、利用sort()</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(arr)) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;type error!&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    arr = arr.<span class=\"title function_\">sort</span>()</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arrry= [arr[<span class=\"number\">0</span>]];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; arr.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (arr[i] !== arr[i-<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">            arrry.<span class=\"title function_\">push</span>(arr[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arrry;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [0, 1, 15, &quot;NaN&quot;, NaN, NaN, &#123;…&#125;, &#123;…&#125;, &quot;a&quot;, false, null, true, &quot;true&quot;, undefined]      //NaN、&#123;&#125;没有去重</span></span><br></pre></td></tr></table></figure>\n\n<p>利用<code>sort()</code>排序方法，然后根据排序后的结果进行遍历及相邻元素比对</p>\n<p><strong>方法五、利用对象的属性不能相同的特点进行去重</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(arr)) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;type error!&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arrry= [];</span><br><span class=\"line\">     <span class=\"keyword\">var</span>  obj = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; arr.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!obj[arr[i]]) &#123;</span><br><span class=\"line\">            arrry.<span class=\"title function_\">push</span>(arr[i])</span><br><span class=\"line\">            obj[arr[i]] = <span class=\"number\">1</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            obj[arr[i]]++</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arrry;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, 15, false, undefined, null, NaN, 0, &quot;a&quot;, &#123;…&#125;]    //两个true直接去掉了，NaN和&#123;&#125;去重</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法六、利用includes</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(arr)) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;type error!&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> array =[];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; arr.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>( !array.<span class=\"title function_\">includes</span>( arr[i]) ) &#123;<span class=\"comment\">//includes 检测数组是否有某个值</span></span><br><span class=\"line\">                    array.<span class=\"title function_\">push</span>(arr[i]);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> array</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]     //&#123;&#125;没有去重</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法七、利用hasOwnProperty</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> obj = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span>(<span class=\"params\">item, index, arr</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj.<span class=\"title function_\">hasOwnProperty</span>(<span class=\"keyword\">typeof</span> item + item) ? <span class=\"literal\">false</span> : (obj[<span class=\"keyword\">typeof</span> item + item] = <span class=\"literal\">true</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;]   //所有的都去重了</span></span><br></pre></td></tr></table></figure>\n\n<p>利用<code>hasOwnProperty</code> 判断是否存在对象属性</p>\n<p><strong>方法八、利用filter</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span>(<span class=\"params\">item, index, arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//当前元素，在原始数组中的第一个索引==当前索引值，否则返回当前元素</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.<span class=\"title function_\">indexOf</span>(item, <span class=\"number\">0</span>) === index;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法九、利用递归去重</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> array= arr;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> len = array.<span class=\"property\">length</span>;</span><br><span class=\"line\">\tarray.<span class=\"title function_\">sort</span>(<span class=\"keyword\">function</span>(<span class=\"params\">a,b</span>)&#123;   <span class=\"comment\">//排序后更加方便去重</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> a - b;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">function</span> <span class=\"title function_\">loop</span>(<span class=\"params\">index</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(index &gt;= <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(array[index] === array[index-<span class=\"number\">1</span>])&#123;</span><br><span class=\"line\">            array.<span class=\"title function_\">splice</span>(index,<span class=\"number\">1</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"title function_\">loop</span>(index - <span class=\"number\">1</span>);    <span class=\"comment\">//递归loop，然后数组去重</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"title function_\">loop</span>(len-<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> array;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;a&quot;, &quot;true&quot;, true, 15, false, 1, &#123;…&#125;, null, NaN, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, undefined]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法十、利用Map数据结构去重</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">arrayNonRepeatfy</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">let</span> map = <span class=\"keyword\">new</span> <span class=\"title class_\">Map</span>();</span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> array = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();  <span class=\"comment\">// 数组用于返回结果</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; arr.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(map .<span class=\"title function_\">has</span>(arr[i])) &#123;  <span class=\"comment\">// 如果有该key值</span></span><br><span class=\"line\">\t\t\tmap .<span class=\"title function_\">set</span>(arr[i], <span class=\"literal\">true</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tmap .<span class=\"title function_\">set</span>(arr[i], <span class=\"literal\">false</span>);   <span class=\"comment\">// 如果没有该key值</span></span><br><span class=\"line\">\t\t\tarray .<span class=\"title function_\">push</span>(arr[i]);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> array ;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> <span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;a&quot;, &quot;true&quot;, true, 15, false, 1, &#123;…&#125;, null, NaN, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, undefined]</span></span><br></pre></td></tr></table></figure>\n\n<p>创建一个空<code>Map</code>数据结构，遍历需要去重的数组，把数组的每一个元素作为<code>key</code>存到<code>Map</code>中。由于<code>Map</code>中不会出现相同的<code>key</code>值，所以最终得到的就是去重后的结果</p>\n<p><strong>方法十一、利用reduce+includes</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">prev,cur</span>) =&gt;</span> prev.<span class=\"title function_\">includes</span>(cur) ? prev : [...prev,cur],[]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr));</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法十二、[…new Set(arr)]</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[...<span class=\"keyword\">new</span> <span class=\"title class_\">Set</span>(arr)]</span><br></pre></td></tr></table></figure>\n\n<p>代码就是这么少—-（其实，严格来说并不算是一种，相对于第一种方法来说只是简化了代码）</p>\n","site":{"data":{}},"excerpt":"","more":"<p><strong>方法一、利用ES6 Set去重（ES6中最常用）</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span> (arr) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Set</span>(arr))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;&#125;, &#123;&#125;]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法二、利用for嵌套for，然后splice去重（ES5中最常用）</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>)&#123;            </span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;arr.<span class=\"property\">length</span>; i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j=i+<span class=\"number\">1</span>; j&lt;arr.<span class=\"property\">length</span>; j++)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(arr[i]==arr[j])&#123;         <span class=\"comment\">//第一个等同于第二个，splice方法删除第二个</span></span><br><span class=\"line\">                    arr.<span class=\"title function_\">splice</span>(j,<span class=\"number\">1</span>);</span><br><span class=\"line\">                    j--;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> arr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, 15, false, undefined, NaN, NaN, &quot;NaN&quot;, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]     //NaN和&#123;&#125;没有去重，两个null直接消失了</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>双层循环，外层循环元素，内层循环时比较值。值相同时，则删去这个值。</li>\n<li>想快速学习更多常用的<code>ES6</code>语法</li>\n</ul>\n<p><strong>方法三、利用indexOf去重</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(arr)) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;type error!&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> array = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; arr.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (array .<span class=\"title function_\">indexOf</span>(arr[i]) === -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            array .<span class=\"title function_\">push</span>(arr[i])</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> array;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]  //NaN、&#123;&#125;没有去重</span></span><br></pre></td></tr></table></figure>\n\n<p>新建一个空的结果数组，<code>for</code> 循环原数组，判断结果数组是否存在当前元素，如果有相同的值则跳过，不相同则<code>push</code>进数组。</p>\n<p><strong>方法四、利用sort()</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(arr)) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;type error!&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    arr = arr.<span class=\"title function_\">sort</span>()</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arrry= [arr[<span class=\"number\">0</span>]];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; arr.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (arr[i] !== arr[i-<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">            arrry.<span class=\"title function_\">push</span>(arr[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arrry;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [0, 1, 15, &quot;NaN&quot;, NaN, NaN, &#123;…&#125;, &#123;…&#125;, &quot;a&quot;, false, null, true, &quot;true&quot;, undefined]      //NaN、&#123;&#125;没有去重</span></span><br></pre></td></tr></table></figure>\n\n<p>利用<code>sort()</code>排序方法，然后根据排序后的结果进行遍历及相邻元素比对</p>\n<p><strong>方法五、利用对象的属性不能相同的特点进行去重</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(arr)) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;type error!&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arrry= [];</span><br><span class=\"line\">     <span class=\"keyword\">var</span>  obj = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; arr.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!obj[arr[i]]) &#123;</span><br><span class=\"line\">            arrry.<span class=\"title function_\">push</span>(arr[i])</span><br><span class=\"line\">            obj[arr[i]] = <span class=\"number\">1</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            obj[arr[i]]++</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arrry;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, 15, false, undefined, null, NaN, 0, &quot;a&quot;, &#123;…&#125;]    //两个true直接去掉了，NaN和&#123;&#125;去重</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法六、利用includes</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(arr)) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;type error!&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> array =[];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; arr.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>( !array.<span class=\"title function_\">includes</span>( arr[i]) ) &#123;<span class=\"comment\">//includes 检测数组是否有某个值</span></span><br><span class=\"line\">                    array.<span class=\"title function_\">push</span>(arr[i]);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> array</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]     //&#123;&#125;没有去重</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法七、利用hasOwnProperty</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> obj = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span>(<span class=\"params\">item, index, arr</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj.<span class=\"title function_\">hasOwnProperty</span>(<span class=\"keyword\">typeof</span> item + item) ? <span class=\"literal\">false</span> : (obj[<span class=\"keyword\">typeof</span> item + item] = <span class=\"literal\">true</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;]   //所有的都去重了</span></span><br></pre></td></tr></table></figure>\n\n<p>利用<code>hasOwnProperty</code> 判断是否存在对象属性</p>\n<p><strong>方法八、利用filter</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span>(<span class=\"params\">item, index, arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//当前元素，在原始数组中的第一个索引==当前索引值，否则返回当前元素</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.<span class=\"title function_\">indexOf</span>(item, <span class=\"number\">0</span>) === index;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法九、利用递归去重</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> array= arr;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> len = array.<span class=\"property\">length</span>;</span><br><span class=\"line\">\tarray.<span class=\"title function_\">sort</span>(<span class=\"keyword\">function</span>(<span class=\"params\">a,b</span>)&#123;   <span class=\"comment\">//排序后更加方便去重</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> a - b;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">function</span> <span class=\"title function_\">loop</span>(<span class=\"params\">index</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(index &gt;= <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(array[index] === array[index-<span class=\"number\">1</span>])&#123;</span><br><span class=\"line\">            array.<span class=\"title function_\">splice</span>(index,<span class=\"number\">1</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"title function_\">loop</span>(index - <span class=\"number\">1</span>);    <span class=\"comment\">//递归loop，然后数组去重</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"title function_\">loop</span>(len-<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> array;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;a&quot;, &quot;true&quot;, true, 15, false, 1, &#123;…&#125;, null, NaN, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, undefined]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法十、利用Map数据结构去重</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">arrayNonRepeatfy</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">let</span> map = <span class=\"keyword\">new</span> <span class=\"title class_\">Map</span>();</span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> array = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();  <span class=\"comment\">// 数组用于返回结果</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; arr.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(map .<span class=\"title function_\">has</span>(arr[i])) &#123;  <span class=\"comment\">// 如果有该key值</span></span><br><span class=\"line\">\t\t\tmap .<span class=\"title function_\">set</span>(arr[i], <span class=\"literal\">true</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tmap .<span class=\"title function_\">set</span>(arr[i], <span class=\"literal\">false</span>);   <span class=\"comment\">// 如果没有该key值</span></span><br><span class=\"line\">\t\t\tarray .<span class=\"title function_\">push</span>(arr[i]);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> array ;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> <span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr))</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;a&quot;, &quot;true&quot;, true, 15, false, 1, &#123;…&#125;, null, NaN, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, undefined]</span></span><br></pre></td></tr></table></figure>\n\n<p>创建一个空<code>Map</code>数据结构，遍历需要去重的数组，把数组的每一个元素作为<code>key</code>存到<code>Map</code>中。由于<code>Map</code>中不会出现相同的<code>key</code>值，所以最终得到的就是去重后的结果</p>\n<p><strong>方法十一、利用reduce+includes</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">unique</span>(<span class=\"params\">arr</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">prev,cur</span>) =&gt;</span> prev.<span class=\"title function_\">includes</span>(cur) ? prev : [...prev,cur],[]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"string\">&#x27;true&#x27;</span>,<span class=\"literal\">true</span>,<span class=\"literal\">true</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>, <span class=\"literal\">undefined</span>,<span class=\"literal\">undefined</span>, <span class=\"literal\">null</span>,<span class=\"literal\">null</span>, <span class=\"title class_\">NaN</span>, <span class=\"title class_\">NaN</span>,<span class=\"string\">&#x27;NaN&#x27;</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">unique</span>(arr));</span><br><span class=\"line\"><span class=\"comment\">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>方法十二、[…new Set(arr)]</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[...<span class=\"keyword\">new</span> <span class=\"title class_\">Set</span>(arr)]</span><br></pre></td></tr></table></figure>\n\n<p>代码就是这么少—-（其实，严格来说并不算是一种，相对于第一种方法来说只是简化了代码）</p>\n"},{"title":"NexT添加友情链接","date":"2022-05-24T16:10:37.000Z","description":"最简单的友情链接页面定制","_content":"\n## 新建一个post\n\n在 source 文件夹下建一个文件夹 links，里面放一个文件 index.md，即友链页面：\n\n```html\n---\ntitle: 友情链接\ndate: 2021-06-16 00:34:27\n---\n\n<div class=\"post-body\">\n   <div id=\"links\">\n      <style>\n         .links-content{\n         margin-top:1rem;\n         }\n         .link-navigation::after {\n         content: \" \";\n         display: block;\n         clear: both;\n         }\n         .card {\n         width: 45%;\n         font-size: 1rem;\n         padding: 10px 20px;\n         border-radius: 4px;\n         transition-duration: 0.15s;\n         margin-bottom: 1rem;\n         display:flex;\n         }\n         .card:nth-child(odd) {\n         float: left;\n         }\n         .card:nth-child(even) {\n         float: right;\n         }\n         .card:hover {\n         transform: scale(1.1);\n         box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.12), 0 0 6px 0 rgba(0, 0, 0, 0.04);\n         }\n         .card a {\n         border:none;\n         }\n         .card .ava {\n         width: 3rem!important;\n         height: 3rem!important;\n         margin:0!important;\n         margin-right: 1em!important;\n         border-radius:4px;\n         }\n         .card .card-header {\n         font-style: italic;\n         overflow: hidden;\n         width: 100%;\n         }\n         .card .card-header a {\n         font-style: normal;\n         color: #2bbc8a;\n         font-weight: bold;\n         text-decoration: none;\n         }\n         .card .card-header a:hover {\n         color: #d480aa;\n         text-decoration: none;\n         }\n         .card .card-header .info {\n         font-style:normal;\n         color:#a3a3a3;\n         font-size:14px;\n         min-width: 0;\n         overflow: hidden;\n         white-space: nowrap;\n         }\n      </style>\n      <div class=\"links-content\">\n         <div class=\"link-navigation\">\n            <div class=\"card\">\n               <img class=\"ava\" src=\"https://cdn.jsdelivr.net/gh/hvnobug/assets/common/avatar.png\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://blog.hvnobug.com/\">Emil’s blog</a>\n                  </div>\n                  <div class=\"info\">这是一个分享IT技术的小站。</div>\n               </div>\n            </div>\n            <div class=\"card\">\n               <img class=\"ava\" src=\"https://yingwiki.top/avatar\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://yingwiki.top\">越行勤's Blog</a>\n                  </div>\n                  <div class=\"info\">努力学习的小菜鸟</div>\n               </div>\n            </div>\n         </div>\n      </div>\n   </div>\n</div>\n```\n\n其实就是一段css再接上几个div，以后每加一个友链，只需要复制如下一段即可：\n\n```html\n<div class=\"card\">\n   <img class=\"ava\" src=\"{avatarurl}\" />\n   <div class=\"card-header\">\n      <div>\n         <a href=\"{link}\">{name}</a>\n      </div>\n      <div class=\"info\">{description}</div>\n   </div>\n</div>\n```\n\n之后在每次 `hexo g` 时，就会生成一个 `links/index.html` 文件。同时由于它不在  `source/_posts` 文件中，hexo不会把它当成一篇新博客加入首页。\n\n## 增加菜单项\n\n在NexT主题的配置文件 `_config.yml` 中找到 `menu` 部分，加一行即可：\n\n```none\n...\nmenu:\n  tags: /tags/ || tags\n  categories: /categories/ || th\n...\n  Links: /links/ || link\n...\n```\n\n","source":"_posts/blog-next-links.md","raw":"---\ntitle: NexT添加友情链接\ndate: 2022-05-25 00:10:37\ntags:\ncategories: 博客\ndescription: 最简单的友情链接页面定制\n---\n\n## 新建一个post\n\n在 source 文件夹下建一个文件夹 links，里面放一个文件 index.md，即友链页面：\n\n```html\n---\ntitle: 友情链接\ndate: 2021-06-16 00:34:27\n---\n\n<div class=\"post-body\">\n   <div id=\"links\">\n      <style>\n         .links-content{\n         margin-top:1rem;\n         }\n         .link-navigation::after {\n         content: \" \";\n         display: block;\n         clear: both;\n         }\n         .card {\n         width: 45%;\n         font-size: 1rem;\n         padding: 10px 20px;\n         border-radius: 4px;\n         transition-duration: 0.15s;\n         margin-bottom: 1rem;\n         display:flex;\n         }\n         .card:nth-child(odd) {\n         float: left;\n         }\n         .card:nth-child(even) {\n         float: right;\n         }\n         .card:hover {\n         transform: scale(1.1);\n         box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.12), 0 0 6px 0 rgba(0, 0, 0, 0.04);\n         }\n         .card a {\n         border:none;\n         }\n         .card .ava {\n         width: 3rem!important;\n         height: 3rem!important;\n         margin:0!important;\n         margin-right: 1em!important;\n         border-radius:4px;\n         }\n         .card .card-header {\n         font-style: italic;\n         overflow: hidden;\n         width: 100%;\n         }\n         .card .card-header a {\n         font-style: normal;\n         color: #2bbc8a;\n         font-weight: bold;\n         text-decoration: none;\n         }\n         .card .card-header a:hover {\n         color: #d480aa;\n         text-decoration: none;\n         }\n         .card .card-header .info {\n         font-style:normal;\n         color:#a3a3a3;\n         font-size:14px;\n         min-width: 0;\n         overflow: hidden;\n         white-space: nowrap;\n         }\n      </style>\n      <div class=\"links-content\">\n         <div class=\"link-navigation\">\n            <div class=\"card\">\n               <img class=\"ava\" src=\"https://cdn.jsdelivr.net/gh/hvnobug/assets/common/avatar.png\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://blog.hvnobug.com/\">Emil’s blog</a>\n                  </div>\n                  <div class=\"info\">这是一个分享IT技术的小站。</div>\n               </div>\n            </div>\n            <div class=\"card\">\n               <img class=\"ava\" src=\"https://yingwiki.top/avatar\" />\n               <div class=\"card-header\">\n                  <div>\n                     <a href=\"https://yingwiki.top\">越行勤's Blog</a>\n                  </div>\n                  <div class=\"info\">努力学习的小菜鸟</div>\n               </div>\n            </div>\n         </div>\n      </div>\n   </div>\n</div>\n```\n\n其实就是一段css再接上几个div，以后每加一个友链，只需要复制如下一段即可：\n\n```html\n<div class=\"card\">\n   <img class=\"ava\" src=\"{avatarurl}\" />\n   <div class=\"card-header\">\n      <div>\n         <a href=\"{link}\">{name}</a>\n      </div>\n      <div class=\"info\">{description}</div>\n   </div>\n</div>\n```\n\n之后在每次 `hexo g` 时，就会生成一个 `links/index.html` 文件。同时由于它不在  `source/_posts` 文件中，hexo不会把它当成一篇新博客加入首页。\n\n## 增加菜单项\n\n在NexT主题的配置文件 `_config.yml` 中找到 `menu` 部分，加一行即可：\n\n```none\n...\nmenu:\n  tags: /tags/ || tags\n  categories: /categories/ || th\n...\n  Links: /links/ || link\n...\n```\n\n","slug":"blog-next-links","published":1,"updated":"2022-05-24T16:14:29.668Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshe0009yt8w3skm3th2","content":"<h2 id=\"新建一个post\"><a href=\"#新建一个post\" class=\"headerlink\" title=\"新建一个post\"></a>新建一个post</h2><p>在 source 文件夹下建一个文件夹 links，里面放一个文件 index.md，即友链页面：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: 友情链接</span><br><span class=\"line\">date: 2021-06-16 00:34:27</span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;post-body&quot;</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;links&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.links-content</span>&#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">margin-top</span>:<span class=\"number\">1rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.link-navigation</span><span class=\"selector-pseudo\">::after</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">content</span>: <span class=\"string\">&quot; &quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">display</span>: block;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">clear</span>: both;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">width</span>: <span class=\"number\">45%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">border-radius</span>: <span class=\"number\">4px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">transition-duration</span>: <span class=\"number\">0.15s</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">1rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">display</span>:flex;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span><span class=\"selector-pseudo\">:nth-child</span>(odd) &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">float</span>: left;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span><span class=\"selector-pseudo\">:nth-child</span>(even) &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">float</span>: right;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span><span class=\"selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">transform</span>: <span class=\"built_in\">scale</span>(<span class=\"number\">1.1</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">2px</span> <span class=\"number\">6px</span> <span class=\"number\">0</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.12</span>), <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">6px</span> <span class=\"number\">0</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.04</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-tag\">a</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">border</span>:none;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-class\">.ava</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">width</span>: <span class=\"number\">3rem</span><span class=\"meta\">!important</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">height</span>: <span class=\"number\">3rem</span><span class=\"meta\">!important</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">margin</span>:<span class=\"number\">0</span><span class=\"meta\">!important</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">margin-right</span>: <span class=\"number\">1em</span><span class=\"meta\">!important</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">border-radius</span>:<span class=\"number\">4px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-class\">.card-header</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-style</span>: italic;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">overflow</span>: hidden;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-class\">.card-header</span> <span class=\"selector-tag\">a</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-style</span>: normal;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">color</span>: <span class=\"number\">#2bbc8a</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-weight</span>: bold;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">text-decoration</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-class\">.card-header</span> <span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">color</span>: <span class=\"number\">#d480aa</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">text-decoration</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-class\">.card-header</span> <span class=\"selector-class\">.info</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-style</span>:normal;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">color</span>:<span class=\"number\">#a3a3a3</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-size</span>:<span class=\"number\">14px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">min-width</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">overflow</span>: hidden;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">white-space</span>: nowrap;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">      </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;links-content&quot;</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;link-navigation&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card&quot;</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ava&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/gh/hvnobug/assets/common/avatar.png&quot;</span> /&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card-header&quot;</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                     <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://blog.hvnobug.com/&quot;</span>&gt;</span>Emil’s blog<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span>这是一个分享IT技术的小站。<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card&quot;</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ava&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://yingwiki.top/avatar&quot;</span> /&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card-header&quot;</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                     <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://yingwiki.top&quot;</span>&gt;</span>越行勤&#x27;s Blog<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span>努力学习的小菜鸟<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>其实就是一段css再接上几个div，以后每加一个友链，只需要复制如下一段即可：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card&quot;</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ava&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;avatarurl&#125;&quot;</span> /&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card-header&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;link&#125;&quot;</span>&gt;</span>&#123;name&#125;<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span>&#123;description&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>之后在每次 <code>hexo g</code> 时，就会生成一个 <code>links/index.html</code> 文件。同时由于它不在  <code>source/_posts</code> 文件中，hexo不会把它当成一篇新博客加入首页。</p>\n<h2 id=\"增加菜单项\"><a href=\"#增加菜单项\" class=\"headerlink\" title=\"增加菜单项\"></a>增加菜单项</h2><p>在NexT主题的配置文件 <code>_config.yml</code> 中找到 <code>menu</code> 部分，加一行即可：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">menu:</span><br><span class=\"line\">  tags: /tags/ || tags</span><br><span class=\"line\">  categories: /categories/ || th</span><br><span class=\"line\">...</span><br><span class=\"line\">  Links: /links/ || link</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"新建一个post\"><a href=\"#新建一个post\" class=\"headerlink\" title=\"新建一个post\"></a>新建一个post</h2><p>在 source 文件夹下建一个文件夹 links，里面放一个文件 index.md，即友链页面：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: 友情链接</span><br><span class=\"line\">date: 2021-06-16 00:34:27</span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;post-body&quot;</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;links&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.links-content</span>&#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">margin-top</span>:<span class=\"number\">1rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.link-navigation</span><span class=\"selector-pseudo\">::after</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">content</span>: <span class=\"string\">&quot; &quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">display</span>: block;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">clear</span>: both;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">width</span>: <span class=\"number\">45%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">border-radius</span>: <span class=\"number\">4px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">transition-duration</span>: <span class=\"number\">0.15s</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">1rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">display</span>:flex;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span><span class=\"selector-pseudo\">:nth-child</span>(odd) &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">float</span>: left;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span><span class=\"selector-pseudo\">:nth-child</span>(even) &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">float</span>: right;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span><span class=\"selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">transform</span>: <span class=\"built_in\">scale</span>(<span class=\"number\">1.1</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">2px</span> <span class=\"number\">6px</span> <span class=\"number\">0</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.12</span>), <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">6px</span> <span class=\"number\">0</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.04</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-tag\">a</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">border</span>:none;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-class\">.ava</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">width</span>: <span class=\"number\">3rem</span><span class=\"meta\">!important</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">height</span>: <span class=\"number\">3rem</span><span class=\"meta\">!important</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">margin</span>:<span class=\"number\">0</span><span class=\"meta\">!important</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">margin-right</span>: <span class=\"number\">1em</span><span class=\"meta\">!important</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">border-radius</span>:<span class=\"number\">4px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-class\">.card-header</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-style</span>: italic;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">overflow</span>: hidden;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-class\">.card-header</span> <span class=\"selector-tag\">a</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-style</span>: normal;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">color</span>: <span class=\"number\">#2bbc8a</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-weight</span>: bold;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">text-decoration</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-class\">.card-header</span> <span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">color</span>: <span class=\"number\">#d480aa</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">text-decoration</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"selector-class\">.card</span> <span class=\"selector-class\">.card-header</span> <span class=\"selector-class\">.info</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-style</span>:normal;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">color</span>:<span class=\"number\">#a3a3a3</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">font-size</span>:<span class=\"number\">14px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">min-width</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">overflow</span>: hidden;</span></span><br><span class=\"line\"><span class=\"language-css\">         <span class=\"attribute\">white-space</span>: nowrap;</span></span><br><span class=\"line\"><span class=\"language-css\">         &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">      </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;links-content&quot;</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;link-navigation&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card&quot;</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ava&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/gh/hvnobug/assets/common/avatar.png&quot;</span> /&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card-header&quot;</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                     <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://blog.hvnobug.com/&quot;</span>&gt;</span>Emil’s blog<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span>这是一个分享IT技术的小站。<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card&quot;</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ava&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://yingwiki.top/avatar&quot;</span> /&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card-header&quot;</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                     <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://yingwiki.top&quot;</span>&gt;</span>越行勤&#x27;s Blog<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span>努力学习的小菜鸟<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>其实就是一段css再接上几个div，以后每加一个友链，只需要复制如下一段即可：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card&quot;</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ava&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;avatarurl&#125;&quot;</span> /&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card-header&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;link&#125;&quot;</span>&gt;</span>&#123;name&#125;<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span>&#123;description&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>之后在每次 <code>hexo g</code> 时，就会生成一个 <code>links/index.html</code> 文件。同时由于它不在  <code>source/_posts</code> 文件中，hexo不会把它当成一篇新博客加入首页。</p>\n<h2 id=\"增加菜单项\"><a href=\"#增加菜单项\" class=\"headerlink\" title=\"增加菜单项\"></a>增加菜单项</h2><p>在NexT主题的配置文件 <code>_config.yml</code> 中找到 <code>menu</code> 部分，加一行即可：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">menu:</span><br><span class=\"line\">  tags: /tags/ || tags</span><br><span class=\"line\">  categories: /categories/ || th</span><br><span class=\"line\">...</span><br><span class=\"line\">  Links: /links/ || link</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n"},{"title":"断点续传实现","date":"2023-03-20T12:25:12.000Z","description":"断点续传的原理在于前端/服务端需要记住已上传的切片，这样下次上传就可以跳过之前已上传的部分","_content":"\n断点续传的原理在于前端/服务端需要记住已上传的切片，这样下次上传就可以跳过之前已上传的部分，有两种方案实现记忆的功能\n\n- 前端使用 localStorage 记录已上传的切片 hash\n- 服务端保存已上传的切片 hash，前端每次上传前向服务端获取已上传的切片\n\n第一种是前端的解决方案，第二种是服务端，而前端方案有一个缺陷，如果换了个浏览器就失去了记忆的效果，所以这里选后者\n\n## 生成 hash\n\n无论是前端还是服务端，都必须要生成文件和切片的 hash，之前我们使用文件名 + 切片下标作为切片 hash，这样做文件名一旦修改就失去了效果，而事实上只要文件内容不变，hash 就不应该变化，所以正确的做法是根据文件内容生成 hash，所以我们修改一下 hash 的生成规则\n\nwebpack 的产物 contenthash 也是基于这个思路实现的\n\n这里用到另一个库 spark-md5，它可以根据文件内容计算出文件的 hash 值\n\n另外考虑到如果上传一个超大文件，读取文件内容计算 hash 是非常耗费时间的，并且会引起 UI 的阻塞，导致页面假死状态，所以我们使用 web-worker 在 worker 线程计算 hash，这样用户仍可以在主界面正常的交互。\n\n由于实例化 web-worker 时，参数是一个 js 文件路径且不能跨域，所以我们单独创建一个 hash.js 文件放在 public 目录下，另外在 worker 中也是不允许访问 dom 的，但它提供了importScripts 函数用于导入外部脚本，通过它导入 spark-md5\n\n```js\n// /public/hash.js\n\n// 导入脚本\nself.importScripts(\"/spark-md5.min.js\");\n\n// 生成文件 hash\nself.onmessage = e => {\n  const { fileChunkList } = e.data;\n  const spark = new self.SparkMD5.ArrayBuffer();\n  let percentage = 0;\n  let count = 0;\n  const loadNext = index => {\n    const reader = new FileReader();\n    reader.readAsArrayBuffer(fileChunkList[index].file);\n    reader.onload = e => {\n      count++;\n      spark.append(e.target.result);\n      if (count === fileChunkList.length) {\n        self.postMessage({\n          percentage: 100,\n          hash: spark.end()\n        });\n        self.close();\n      } else {\n        percentage += 100 / fileChunkList.length;\n        self.postMessage({\n          percentage\n        });\n        // calculate recursively\n        loadNext(count);\n      }\n    };\n  };\n  loadNext(0);\n};\n```\n\n在 worker 线程中，接受文件切片 fileChunkList，利用 fileReader 读取每个切片的 ArrayBuffer 并不断传入 spark-md5 中，每计算完一个切片通过 postMessage 向主线程发送一个进度事件，全部完成后将最终的 hash 发送给主线程。\n\nspark-md5 文档中要求传入所有切片并算出 hash 值，不能直接将整个文件放入计算，否则即使不同文件也会有相同的 hash。\n\n接着编写主线程与 worker 线程通讯的逻辑\n\n```diff\n+    // 生成文件 hash（web-worker）\n+    calculateHash(fileChunkList) {\n+      return new Promise(resolve => {\n+        // 添加 worker 属性\n+        this.container.worker = new Worker(\"/hash.js\");\n+        this.container.worker.postMessage({ fileChunkList });\n+        this.container.worker.onmessage = e => {\n+          const { percentage, hash } = e.data;\n+          this.hashPercentage = percentage;\n+          if (hash) {\n+            resolve(hash);\n+          }\n+        };\n+      });\n    },\n    async handleUpload() {\n      if (!this.container.file) return;\n      const fileChunkList = this.createFileChunk(this.container.file);\n+     this.container.hash = await this.calculateHash(fileChunkList);\n      this.data = fileChunkList.map(({ file }，index) => ({\n+       fileHash: this.container.hash,\n        chunk: file,\n        hash: this.container.file.name + \"-\" + index,\n        percentage:0\n      }));\n      await this.uploadChunks();\n    }   \n```\n\n主线程使用 postMessage 给 worker 线程传入所有切片 fileChunkList，并监听 worker 线程发出的 postMessage 事件拿到文件 hash，加上显示计算 hash 的进度条。\n\n至此前端需要将之前用文件名作为 hash 的地方改写为 worker 返回的 hash。\n\n服务端则使用固定前缀 + hash 作为切片文件夹名，hash + 下标作为切片名，hash + 扩展名作为文件名。\n\n## 文件秒传\n\n在实现断点续传前先简单介绍一下文件秒传\n\n所谓的文件秒传，即在服务端已经存在了上传的资源，所以当用户再次上传时会直接提示上传成功\n\n文件秒传需要依赖上一步生成的 hash，即在上传前，先计算出文件 hash，并把 hash 发送给服务端进行验证，由于 hash 的唯一性，所以一旦服务端能找到 hash 相同的文件，则直接返回上传成功的信息即可\n\n```diff\n+    async verifyUpload(filename, fileHash) {\n+       const { data } = await this.request({\n+         url: \"http://localhost:3000/verify\",\n+         headers: {\n+           \"content-type\": \"application/json\"\n+         },\n+         data: JSON.stringify({\n+           filename,\n+           fileHash\n+         })\n+       });\n+       return JSON.parse(data);\n+     },\n   async handleUpload() {\n      if (!this.container.file) return;\n      const fileChunkList = this.createFileChunk(this.container.file);\n      this.container.hash = await this.calculateHash(fileChunkList);\n+     const { shouldUpload } = await this.verifyUpload(\n+       this.container.file.name,\n+       this.container.hash\n+     );\n+     if (!shouldUpload) {\n+       this.$message.success(\"skip upload：file upload success\");\n+       return;\n+    }\n     this.data = fileChunkList.map(({ file }, index) => ({\n        fileHash: this.container.hash,\n        index,\n        hash: this.container.hash + \"-\" + index,\n        chunk: file,\n        percentage: 0\n      }));\n      await this.uploadChunks();\n    }   \n```\n\n秒传其实就是给用户看的障眼法，实质上根本没有上传\n\n服务端的逻辑非常简单，新增一个验证接口，验证文件是否存在即可\n\n```diff\n+ // 提取后缀名\n+ const extractExt = filename =>\n+  filename.slice(filename.lastIndexOf(\".\"), filename.length);\nconst UPLOAD_DIR = path.resolve(__dirname, \"..\", \"target\");\n\nconst resolvePost = req =>\n  new Promise(resolve => {\n    let chunk = \"\";\n    req.on(\"data\", data => {\n      chunk += data;\n    });\n    req.on(\"end\", () => {\n      resolve(JSON.parse(chunk));\n    });\n  });\n\nserver.on(\"request\", async (req, res) => {\n  if (req.url === \"/verify\") {\n+    const data = await resolvePost(req);\n+    const { fileHash, filename } = data;\n+    const ext = extractExt(filename);\n+    const filePath = path.resolve(UPLOAD_DIR, `${fileHash}${ext}`);\n+    if (fse.existsSync(filePath)) {\n+      res.end(\n+        JSON.stringify({\n+          shouldUpload: false\n+        })\n+      );\n+    } else {\n+      res.end(\n+        JSON.stringify({\n+          shouldUpload: true\n+        })\n+      );\n+    }\n  }\n});\n\nserver.listen(3000, () => console.log(\"listening port 3000\"));\n```\n\n## 暂停上传\n\n讲完了生成 hash 和文件秒传，回到断点续传\n\n断点续传顾名思义即断点 + 续传，所以我们第一步先实现“断点”，也就是暂停上传\n\n原理是使用 XMLHttpRequest 的 abort 方法，可以取消一个 xhr 请求的发送，为此我们需要将上传每个切片的 xhr 对象保存起来，我们再改造一下 request 方法\n\n```diff\n   request({\n      url,\n      method = \"post\",\n      data,\n      headers = {},\n      onProgress = e => e,\n+     requestList\n    }) {\n      return new Promise(resolve => {\n        const xhr = new XMLHttpRequest();\n        xhr.upload.onprogress = onProgress;\n        xhr.open(method, url);\n        Object.keys(headers).forEach(key =>\n          xhr.setRequestHeader(key, headers[key])\n        );\n        xhr.send(data);\n        xhr.onload = e => {\n+          // 将请求成功的 xhr 从列表中删除\n+          if (requestList) {\n+            const xhrIndex = requestList.findIndex(item => item === xhr);\n+            requestList.splice(xhrIndex, 1);\n+          }\n          resolve({\n            data: e.target.response\n          });\n        };\n+        // 暴露当前 xhr 给外部\n+        requestList?.push(xhr);\n      });\n    },\n```\n\n这样在上传切片时传入 requestList 数组作为参数，request 方法就会将所有的 xhr 保存在数组中了。\n\n每当一个切片上传成功时，将对应的 xhr 从 requestList 中删除，所以 requestList 中只保存正在上传切片的 xhr\n\n之后新建一个暂停按钮，当点击按钮时，调用保存在 requestList 中 xhr 的 abort 方法，即取消并清空所有正在上传的切片\n\n```js\n handlePause() {\n    this.requestList.forEach(xhr => xhr?.abort());\n    this.requestList = [];\n}\n```\n\n点击暂停按钮可以看到 xhr 都被取消了。\n\n## 恢复上传\n\n之前在介绍断点续传的时提到使用第二种服务端存储的方式实现续传\n\n由于当文件切片上传后，服务端会建立一个文件夹存储所有上传的切片，所以每次前端上传前可以调用一个接口，服务端将已上传的切片的切片名返回，前端再跳过这些已经上传切片，这样就实现了“续传”的效果。\n\n而这个接口可以和之前秒传的验证接口合并，前端每次上传前发送一个验证的请求，返回两种结果\n\n- 服务端已存在该文件，不需要再次上传\n- 服务端不存在该文件或者已上传部分文件切片，通知前端进行上传，并把已上传的文件切片返回给前端\n\n所以我们改造一下之前文件秒传的服务端验证接口\n\n```diff\nconst extractExt = filename =>\n  filename.slice(filename.lastIndexOf(\".\"), filename.length);\nconst UPLOAD_DIR = path.resolve(__dirname, \"..\", \"target\");\n\nconst resolvePost = req =>\n  new Promise(resolve => {\n    let chunk = \"\";\n    req.on(\"data\", data => {\n      chunk += data;\n    });\n    req.on(\"end\", () => {\n      resolve(JSON.parse(chunk));\n    });\n  });\n  \n+ // 返回已上传的所有切片名\n+ const createUploadedList = async fileHash =>\n+   fse.existsSync(path.resolve(UPLOAD_DIR, fileHash))\n+    ? await fse.readdir(path.resolve(UPLOAD_DIR, fileHash))\n+    : [];\n\nserver.on(\"request\", async (req, res) => {\n  if (req.url === \"/verify\") {\n    const data = await resolvePost(req);\n    const { fileHash, filename } = data;\n    const ext = extractExt(filename);\n    const filePath = path.resolve(UPLOAD_DIR, `${fileHash}${ext}`);\n    if (fse.existsSync(filePath)) {\n      res.end(\n        JSON.stringify({\n          shouldUpload: false\n        })\n      );\n    } else {\n      res.end(\n        JSON.stringify({\n          shouldUpload: true，\n+         uploadedList: await createUploadedList(fileHash)\n        })\n      );\n    }\n  }\n});\n\nserver.listen(3000, () => console.log(\"listening port 3000\"));\n```\n\n接着回到前端，前端有两个地方需要调用验证的接口\n\n- 点击上传时，检查是否需要上传和已上传的切片\n- 点击暂停后的恢复上传，返回已上传的切片\n\n新增恢复按钮并改造原来上传切片的逻辑\n\n```diff\n<template>\n  <div id=\"app\">\n      <input\n        type=\"file\"\n        @change=\"handleFileChange\"\n      />\n       <el-button @click=\"handleUpload\">upload</el-button>\n       <el-button @click=\"handlePause\" v-if=\"isPaused\">pause</el-button>\n+      <el-button @click=\"handleResume\" v-else>resume</el-button>\n      //...\n    </div>\n</template>\n\n+   async handleResume() {\n+      const { uploadedList } = await this.verifyUpload(\n+        this.container.file.name,\n+        this.container.hash\n+      );\n+      await this.uploadChunks(uploadedList);\n    },\n    async handleUpload() {\n      if (!this.container.file) return;\n      const fileChunkList = this.createFileChunk(this.container.file);\n      this.container.hash = await this.calculateHash(fileChunkList);\n+     const { shouldUpload, uploadedList } = await this.verifyUpload(\n+       this.container.file.name,\n+       this.container.hash\n+     );\n+     if (!shouldUpload) {\n+       this.$message.success(\"skip upload：file upload success\");\n+       return;\n+     }\n      this.data = fileChunkList.map(({ file }, index) => ({\n        fileHash: this.container.hash,\n        index,\n        hash: this.container.hash + \"-\" + index,\n        chunk: file，\n        percentage: 0\n      }));\n+      await this.uploadChunks(uploadedList);\n    },\n    // 上传切片，同时过滤已上传的切片\n+   async uploadChunks(uploadedList = []) {\n      const requestList = this.data\n+       .filter(({ hash }) => !uploadedList.includes(hash))\n        .map(({ chunk, hash, index }) => {\n          const formData = new FormData();\n          formData.append(\"chunk\", chunk);\n          formData.append(\"hash\", hash);\n          formData.append(\"filename\", this.container.file.name);\n          formData.append(\"fileHash\", this.container.hash);\n          return { formData, index };\n        })\n        .map(({ formData, index }) =>\n          this.request({\n            url: \"http://localhost:3000\",\n            data: formData,\n            onProgress: this.createProgressHandler(this.data[index]),\n            requestList: this.requestList\n          })\n        );\n      await Promise.all(requestList);\n+     // 之前上传的切片数量 + 本次上传的切片数量 = 所有切片数量时合并切片\n+     if (uploadedList.length + requestList.length === this.data.length) {\n         await this.mergeRequest();\n+     }\n    }\n```\n\n这里给原来上传切片的函数新增 uploadedList 参数，即上图中服务端返回的切片名列表，通过 filter 过滤掉已上传的切片，并且由于新增了已上传的部分，所以之前合并接口的触发条件做了一些改动。\n\n到这里断点续传的功能基本完成了。\n\n## 进度条改进\n\n虽然实现了断点续传，但还需要修改一下进度条的显示规则，否则在暂停上传/接收到已上传切片时的进度条会出现偏差\n\n### 单个切片进度条\n\n由于在点击上传/恢复上传时，会调用验证接口返回已上传的切片，所以需要将已上传切片的进度变成 100%\n\n```diff\n   async handleUpload() {\n      if (!this.container.file) return;\n      const fileChunkList = this.createFileChunk(this.container.file);\n      this.container.hash = await this.calculateHash(fileChunkList);\n      const { shouldUpload, uploadedList } = await this.verifyUpload(\n        this.container.file.name,\n        this.container.hash\n      );\n      if (!shouldUpload) {\n        this.$message.success(\"skip upload：file upload success\");\n        return;\n      }\n      this.data = fileChunkList.map(({ file }, index) => ({\n        fileHash: this.container.hash,\n        index,\n        hash: this.container.hash + \"-\" + index,\n        chunk: file,\n+       percentage: uploadedList.includes(index) ? 100 : 0\n      }));\n      await this.uploadChunks(uploadedList);\n    },\n```\n\nuploadedList 会返回已上传的切片，在遍历所有切片时判断当前切片是否在已上传列表里即可\n\n### 总进度条\n\n之前说到总进度条是一个计算属性，根据所有切片的上传进度计算而来，这就遇到了一个问题，点击暂停会取消并清空切片的 xhr 请求，此时如果已经上传了一部分，就会发现文件进度条有倒退的现象。\n\n当点击恢复时，由于重新创建了 xhr 导致切片进度清零，所以总进度条就会倒退\n\n解决方案是创建一个“假”的进度条，这个假进度条基于文件进度条，但只会停止和增加，然后给用户展示这个假的进度条\n\n这里我们使用 Vue 的监听属性\n\n```diff\n  data: () => ({\n+    fakeUploadPercentage: 0\n  }),\n  computed: {\n    uploadPercentage() {\n      if (!this.container.file || !this.data.length) return 0;\n      const loaded = this.data\n        .map(item => item.size * item.percentage)\n        .reduce((acc, cur) => acc + cur);\n      return parseInt((loaded / this.container.file.size).toFixed(2));\n    }\n  },  \n  watch: {\n+    uploadPercentage(now) {\n+      if (now > this.fakeUploadPercentage) {\n+        this.fakeUploadPercentage = now;\n+      }\n    }\n  },\n```\n\n当 uploadPercentage 即真的文件进度条增加时，fakeUploadPercentage 也增加，一旦文件进度条后退，假的进度条只需停止即可。\n\n至此一个大文件上传 + 断点续传的解决方案就完成了。\n\n\n## 总结\n\n断点续传\n\n- 使用 spark-md5 根据文件内容算出文件 hash\n- 通过 hash 可以判断服务端是否已经上传该文件，从而直接提示用户上传成功（秒传）\n- 通过 XMLHttpRequest 的 abort 方法暂停切片的上传\n- 上传前服务端返回已经上传的切片名，前端跳过这些切片的上传\n\n\n参考 https://juejin.cn/post/6844904046436843527#heading-16","source":"_posts/breakpoint-upload.md","raw":"---\ntitle: 断点续传实现\ndate: 2023-03-20 20:25:12\ntags: JavaScript\ncategories: JavaScript\ndescription: 断点续传的原理在于前端/服务端需要记住已上传的切片，这样下次上传就可以跳过之前已上传的部分\n---\n\n断点续传的原理在于前端/服务端需要记住已上传的切片，这样下次上传就可以跳过之前已上传的部分，有两种方案实现记忆的功能\n\n- 前端使用 localStorage 记录已上传的切片 hash\n- 服务端保存已上传的切片 hash，前端每次上传前向服务端获取已上传的切片\n\n第一种是前端的解决方案，第二种是服务端，而前端方案有一个缺陷，如果换了个浏览器就失去了记忆的效果，所以这里选后者\n\n## 生成 hash\n\n无论是前端还是服务端，都必须要生成文件和切片的 hash，之前我们使用文件名 + 切片下标作为切片 hash，这样做文件名一旦修改就失去了效果，而事实上只要文件内容不变，hash 就不应该变化，所以正确的做法是根据文件内容生成 hash，所以我们修改一下 hash 的生成规则\n\nwebpack 的产物 contenthash 也是基于这个思路实现的\n\n这里用到另一个库 spark-md5，它可以根据文件内容计算出文件的 hash 值\n\n另外考虑到如果上传一个超大文件，读取文件内容计算 hash 是非常耗费时间的，并且会引起 UI 的阻塞，导致页面假死状态，所以我们使用 web-worker 在 worker 线程计算 hash，这样用户仍可以在主界面正常的交互。\n\n由于实例化 web-worker 时，参数是一个 js 文件路径且不能跨域，所以我们单独创建一个 hash.js 文件放在 public 目录下，另外在 worker 中也是不允许访问 dom 的，但它提供了importScripts 函数用于导入外部脚本，通过它导入 spark-md5\n\n```js\n// /public/hash.js\n\n// 导入脚本\nself.importScripts(\"/spark-md5.min.js\");\n\n// 生成文件 hash\nself.onmessage = e => {\n  const { fileChunkList } = e.data;\n  const spark = new self.SparkMD5.ArrayBuffer();\n  let percentage = 0;\n  let count = 0;\n  const loadNext = index => {\n    const reader = new FileReader();\n    reader.readAsArrayBuffer(fileChunkList[index].file);\n    reader.onload = e => {\n      count++;\n      spark.append(e.target.result);\n      if (count === fileChunkList.length) {\n        self.postMessage({\n          percentage: 100,\n          hash: spark.end()\n        });\n        self.close();\n      } else {\n        percentage += 100 / fileChunkList.length;\n        self.postMessage({\n          percentage\n        });\n        // calculate recursively\n        loadNext(count);\n      }\n    };\n  };\n  loadNext(0);\n};\n```\n\n在 worker 线程中，接受文件切片 fileChunkList，利用 fileReader 读取每个切片的 ArrayBuffer 并不断传入 spark-md5 中，每计算完一个切片通过 postMessage 向主线程发送一个进度事件，全部完成后将最终的 hash 发送给主线程。\n\nspark-md5 文档中要求传入所有切片并算出 hash 值，不能直接将整个文件放入计算，否则即使不同文件也会有相同的 hash。\n\n接着编写主线程与 worker 线程通讯的逻辑\n\n```diff\n+    // 生成文件 hash（web-worker）\n+    calculateHash(fileChunkList) {\n+      return new Promise(resolve => {\n+        // 添加 worker 属性\n+        this.container.worker = new Worker(\"/hash.js\");\n+        this.container.worker.postMessage({ fileChunkList });\n+        this.container.worker.onmessage = e => {\n+          const { percentage, hash } = e.data;\n+          this.hashPercentage = percentage;\n+          if (hash) {\n+            resolve(hash);\n+          }\n+        };\n+      });\n    },\n    async handleUpload() {\n      if (!this.container.file) return;\n      const fileChunkList = this.createFileChunk(this.container.file);\n+     this.container.hash = await this.calculateHash(fileChunkList);\n      this.data = fileChunkList.map(({ file }，index) => ({\n+       fileHash: this.container.hash,\n        chunk: file,\n        hash: this.container.file.name + \"-\" + index,\n        percentage:0\n      }));\n      await this.uploadChunks();\n    }   \n```\n\n主线程使用 postMessage 给 worker 线程传入所有切片 fileChunkList，并监听 worker 线程发出的 postMessage 事件拿到文件 hash，加上显示计算 hash 的进度条。\n\n至此前端需要将之前用文件名作为 hash 的地方改写为 worker 返回的 hash。\n\n服务端则使用固定前缀 + hash 作为切片文件夹名，hash + 下标作为切片名，hash + 扩展名作为文件名。\n\n## 文件秒传\n\n在实现断点续传前先简单介绍一下文件秒传\n\n所谓的文件秒传，即在服务端已经存在了上传的资源，所以当用户再次上传时会直接提示上传成功\n\n文件秒传需要依赖上一步生成的 hash，即在上传前，先计算出文件 hash，并把 hash 发送给服务端进行验证，由于 hash 的唯一性，所以一旦服务端能找到 hash 相同的文件，则直接返回上传成功的信息即可\n\n```diff\n+    async verifyUpload(filename, fileHash) {\n+       const { data } = await this.request({\n+         url: \"http://localhost:3000/verify\",\n+         headers: {\n+           \"content-type\": \"application/json\"\n+         },\n+         data: JSON.stringify({\n+           filename,\n+           fileHash\n+         })\n+       });\n+       return JSON.parse(data);\n+     },\n   async handleUpload() {\n      if (!this.container.file) return;\n      const fileChunkList = this.createFileChunk(this.container.file);\n      this.container.hash = await this.calculateHash(fileChunkList);\n+     const { shouldUpload } = await this.verifyUpload(\n+       this.container.file.name,\n+       this.container.hash\n+     );\n+     if (!shouldUpload) {\n+       this.$message.success(\"skip upload：file upload success\");\n+       return;\n+    }\n     this.data = fileChunkList.map(({ file }, index) => ({\n        fileHash: this.container.hash,\n        index,\n        hash: this.container.hash + \"-\" + index,\n        chunk: file,\n        percentage: 0\n      }));\n      await this.uploadChunks();\n    }   \n```\n\n秒传其实就是给用户看的障眼法，实质上根本没有上传\n\n服务端的逻辑非常简单，新增一个验证接口，验证文件是否存在即可\n\n```diff\n+ // 提取后缀名\n+ const extractExt = filename =>\n+  filename.slice(filename.lastIndexOf(\".\"), filename.length);\nconst UPLOAD_DIR = path.resolve(__dirname, \"..\", \"target\");\n\nconst resolvePost = req =>\n  new Promise(resolve => {\n    let chunk = \"\";\n    req.on(\"data\", data => {\n      chunk += data;\n    });\n    req.on(\"end\", () => {\n      resolve(JSON.parse(chunk));\n    });\n  });\n\nserver.on(\"request\", async (req, res) => {\n  if (req.url === \"/verify\") {\n+    const data = await resolvePost(req);\n+    const { fileHash, filename } = data;\n+    const ext = extractExt(filename);\n+    const filePath = path.resolve(UPLOAD_DIR, `${fileHash}${ext}`);\n+    if (fse.existsSync(filePath)) {\n+      res.end(\n+        JSON.stringify({\n+          shouldUpload: false\n+        })\n+      );\n+    } else {\n+      res.end(\n+        JSON.stringify({\n+          shouldUpload: true\n+        })\n+      );\n+    }\n  }\n});\n\nserver.listen(3000, () => console.log(\"listening port 3000\"));\n```\n\n## 暂停上传\n\n讲完了生成 hash 和文件秒传，回到断点续传\n\n断点续传顾名思义即断点 + 续传，所以我们第一步先实现“断点”，也就是暂停上传\n\n原理是使用 XMLHttpRequest 的 abort 方法，可以取消一个 xhr 请求的发送，为此我们需要将上传每个切片的 xhr 对象保存起来，我们再改造一下 request 方法\n\n```diff\n   request({\n      url,\n      method = \"post\",\n      data,\n      headers = {},\n      onProgress = e => e,\n+     requestList\n    }) {\n      return new Promise(resolve => {\n        const xhr = new XMLHttpRequest();\n        xhr.upload.onprogress = onProgress;\n        xhr.open(method, url);\n        Object.keys(headers).forEach(key =>\n          xhr.setRequestHeader(key, headers[key])\n        );\n        xhr.send(data);\n        xhr.onload = e => {\n+          // 将请求成功的 xhr 从列表中删除\n+          if (requestList) {\n+            const xhrIndex = requestList.findIndex(item => item === xhr);\n+            requestList.splice(xhrIndex, 1);\n+          }\n          resolve({\n            data: e.target.response\n          });\n        };\n+        // 暴露当前 xhr 给外部\n+        requestList?.push(xhr);\n      });\n    },\n```\n\n这样在上传切片时传入 requestList 数组作为参数，request 方法就会将所有的 xhr 保存在数组中了。\n\n每当一个切片上传成功时，将对应的 xhr 从 requestList 中删除，所以 requestList 中只保存正在上传切片的 xhr\n\n之后新建一个暂停按钮，当点击按钮时，调用保存在 requestList 中 xhr 的 abort 方法，即取消并清空所有正在上传的切片\n\n```js\n handlePause() {\n    this.requestList.forEach(xhr => xhr?.abort());\n    this.requestList = [];\n}\n```\n\n点击暂停按钮可以看到 xhr 都被取消了。\n\n## 恢复上传\n\n之前在介绍断点续传的时提到使用第二种服务端存储的方式实现续传\n\n由于当文件切片上传后，服务端会建立一个文件夹存储所有上传的切片，所以每次前端上传前可以调用一个接口，服务端将已上传的切片的切片名返回，前端再跳过这些已经上传切片，这样就实现了“续传”的效果。\n\n而这个接口可以和之前秒传的验证接口合并，前端每次上传前发送一个验证的请求，返回两种结果\n\n- 服务端已存在该文件，不需要再次上传\n- 服务端不存在该文件或者已上传部分文件切片，通知前端进行上传，并把已上传的文件切片返回给前端\n\n所以我们改造一下之前文件秒传的服务端验证接口\n\n```diff\nconst extractExt = filename =>\n  filename.slice(filename.lastIndexOf(\".\"), filename.length);\nconst UPLOAD_DIR = path.resolve(__dirname, \"..\", \"target\");\n\nconst resolvePost = req =>\n  new Promise(resolve => {\n    let chunk = \"\";\n    req.on(\"data\", data => {\n      chunk += data;\n    });\n    req.on(\"end\", () => {\n      resolve(JSON.parse(chunk));\n    });\n  });\n  \n+ // 返回已上传的所有切片名\n+ const createUploadedList = async fileHash =>\n+   fse.existsSync(path.resolve(UPLOAD_DIR, fileHash))\n+    ? await fse.readdir(path.resolve(UPLOAD_DIR, fileHash))\n+    : [];\n\nserver.on(\"request\", async (req, res) => {\n  if (req.url === \"/verify\") {\n    const data = await resolvePost(req);\n    const { fileHash, filename } = data;\n    const ext = extractExt(filename);\n    const filePath = path.resolve(UPLOAD_DIR, `${fileHash}${ext}`);\n    if (fse.existsSync(filePath)) {\n      res.end(\n        JSON.stringify({\n          shouldUpload: false\n        })\n      );\n    } else {\n      res.end(\n        JSON.stringify({\n          shouldUpload: true，\n+         uploadedList: await createUploadedList(fileHash)\n        })\n      );\n    }\n  }\n});\n\nserver.listen(3000, () => console.log(\"listening port 3000\"));\n```\n\n接着回到前端，前端有两个地方需要调用验证的接口\n\n- 点击上传时，检查是否需要上传和已上传的切片\n- 点击暂停后的恢复上传，返回已上传的切片\n\n新增恢复按钮并改造原来上传切片的逻辑\n\n```diff\n<template>\n  <div id=\"app\">\n      <input\n        type=\"file\"\n        @change=\"handleFileChange\"\n      />\n       <el-button @click=\"handleUpload\">upload</el-button>\n       <el-button @click=\"handlePause\" v-if=\"isPaused\">pause</el-button>\n+      <el-button @click=\"handleResume\" v-else>resume</el-button>\n      //...\n    </div>\n</template>\n\n+   async handleResume() {\n+      const { uploadedList } = await this.verifyUpload(\n+        this.container.file.name,\n+        this.container.hash\n+      );\n+      await this.uploadChunks(uploadedList);\n    },\n    async handleUpload() {\n      if (!this.container.file) return;\n      const fileChunkList = this.createFileChunk(this.container.file);\n      this.container.hash = await this.calculateHash(fileChunkList);\n+     const { shouldUpload, uploadedList } = await this.verifyUpload(\n+       this.container.file.name,\n+       this.container.hash\n+     );\n+     if (!shouldUpload) {\n+       this.$message.success(\"skip upload：file upload success\");\n+       return;\n+     }\n      this.data = fileChunkList.map(({ file }, index) => ({\n        fileHash: this.container.hash,\n        index,\n        hash: this.container.hash + \"-\" + index,\n        chunk: file，\n        percentage: 0\n      }));\n+      await this.uploadChunks(uploadedList);\n    },\n    // 上传切片，同时过滤已上传的切片\n+   async uploadChunks(uploadedList = []) {\n      const requestList = this.data\n+       .filter(({ hash }) => !uploadedList.includes(hash))\n        .map(({ chunk, hash, index }) => {\n          const formData = new FormData();\n          formData.append(\"chunk\", chunk);\n          formData.append(\"hash\", hash);\n          formData.append(\"filename\", this.container.file.name);\n          formData.append(\"fileHash\", this.container.hash);\n          return { formData, index };\n        })\n        .map(({ formData, index }) =>\n          this.request({\n            url: \"http://localhost:3000\",\n            data: formData,\n            onProgress: this.createProgressHandler(this.data[index]),\n            requestList: this.requestList\n          })\n        );\n      await Promise.all(requestList);\n+     // 之前上传的切片数量 + 本次上传的切片数量 = 所有切片数量时合并切片\n+     if (uploadedList.length + requestList.length === this.data.length) {\n         await this.mergeRequest();\n+     }\n    }\n```\n\n这里给原来上传切片的函数新增 uploadedList 参数，即上图中服务端返回的切片名列表，通过 filter 过滤掉已上传的切片，并且由于新增了已上传的部分，所以之前合并接口的触发条件做了一些改动。\n\n到这里断点续传的功能基本完成了。\n\n## 进度条改进\n\n虽然实现了断点续传，但还需要修改一下进度条的显示规则，否则在暂停上传/接收到已上传切片时的进度条会出现偏差\n\n### 单个切片进度条\n\n由于在点击上传/恢复上传时，会调用验证接口返回已上传的切片，所以需要将已上传切片的进度变成 100%\n\n```diff\n   async handleUpload() {\n      if (!this.container.file) return;\n      const fileChunkList = this.createFileChunk(this.container.file);\n      this.container.hash = await this.calculateHash(fileChunkList);\n      const { shouldUpload, uploadedList } = await this.verifyUpload(\n        this.container.file.name,\n        this.container.hash\n      );\n      if (!shouldUpload) {\n        this.$message.success(\"skip upload：file upload success\");\n        return;\n      }\n      this.data = fileChunkList.map(({ file }, index) => ({\n        fileHash: this.container.hash,\n        index,\n        hash: this.container.hash + \"-\" + index,\n        chunk: file,\n+       percentage: uploadedList.includes(index) ? 100 : 0\n      }));\n      await this.uploadChunks(uploadedList);\n    },\n```\n\nuploadedList 会返回已上传的切片，在遍历所有切片时判断当前切片是否在已上传列表里即可\n\n### 总进度条\n\n之前说到总进度条是一个计算属性，根据所有切片的上传进度计算而来，这就遇到了一个问题，点击暂停会取消并清空切片的 xhr 请求，此时如果已经上传了一部分，就会发现文件进度条有倒退的现象。\n\n当点击恢复时，由于重新创建了 xhr 导致切片进度清零，所以总进度条就会倒退\n\n解决方案是创建一个“假”的进度条，这个假进度条基于文件进度条，但只会停止和增加，然后给用户展示这个假的进度条\n\n这里我们使用 Vue 的监听属性\n\n```diff\n  data: () => ({\n+    fakeUploadPercentage: 0\n  }),\n  computed: {\n    uploadPercentage() {\n      if (!this.container.file || !this.data.length) return 0;\n      const loaded = this.data\n        .map(item => item.size * item.percentage)\n        .reduce((acc, cur) => acc + cur);\n      return parseInt((loaded / this.container.file.size).toFixed(2));\n    }\n  },  \n  watch: {\n+    uploadPercentage(now) {\n+      if (now > this.fakeUploadPercentage) {\n+        this.fakeUploadPercentage = now;\n+      }\n    }\n  },\n```\n\n当 uploadPercentage 即真的文件进度条增加时，fakeUploadPercentage 也增加，一旦文件进度条后退，假的进度条只需停止即可。\n\n至此一个大文件上传 + 断点续传的解决方案就完成了。\n\n\n## 总结\n\n断点续传\n\n- 使用 spark-md5 根据文件内容算出文件 hash\n- 通过 hash 可以判断服务端是否已经上传该文件，从而直接提示用户上传成功（秒传）\n- 通过 XMLHttpRequest 的 abort 方法暂停切片的上传\n- 上传前服务端返回已经上传的切片名，前端跳过这些切片的上传\n\n\n参考 https://juejin.cn/post/6844904046436843527#heading-16","slug":"breakpoint-upload","published":1,"updated":"2023-03-20T12:27:07.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshf000byt8w097m1y3l","content":"<p>断点续传的原理在于前端&#x2F;服务端需要记住已上传的切片，这样下次上传就可以跳过之前已上传的部分，有两种方案实现记忆的功能</p>\n<ul>\n<li>前端使用 localStorage 记录已上传的切片 hash</li>\n<li>服务端保存已上传的切片 hash，前端每次上传前向服务端获取已上传的切片</li>\n</ul>\n<p>第一种是前端的解决方案，第二种是服务端，而前端方案有一个缺陷，如果换了个浏览器就失去了记忆的效果，所以这里选后者</p>\n<h2 id=\"生成-hash\"><a href=\"#生成-hash\" class=\"headerlink\" title=\"生成 hash\"></a>生成 hash</h2><p>无论是前端还是服务端，都必须要生成文件和切片的 hash，之前我们使用文件名 + 切片下标作为切片 hash，这样做文件名一旦修改就失去了效果，而事实上只要文件内容不变，hash 就不应该变化，所以正确的做法是根据文件内容生成 hash，所以我们修改一下 hash 的生成规则</p>\n<p>webpack 的产物 contenthash 也是基于这个思路实现的</p>\n<p>这里用到另一个库 spark-md5，它可以根据文件内容计算出文件的 hash 值</p>\n<p>另外考虑到如果上传一个超大文件，读取文件内容计算 hash 是非常耗费时间的，并且会引起 UI 的阻塞，导致页面假死状态，所以我们使用 web-worker 在 worker 线程计算 hash，这样用户仍可以在主界面正常的交互。</p>\n<p>由于实例化 web-worker 时，参数是一个 js 文件路径且不能跨域，所以我们单独创建一个 hash.js 文件放在 public 目录下，另外在 worker 中也是不允许访问 dom 的，但它提供了importScripts 函数用于导入外部脚本，通过它导入 spark-md5</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// /public/hash.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 导入脚本</span></span><br><span class=\"line\">self.importScripts(<span class=\"string\">&quot;/spark-md5.min.js&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 生成文件 hash</span></span><br><span class=\"line\">self.<span class=\"property\">onmessage</span> = <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; fileChunkList &#125; = e.<span class=\"property\">data</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> spark = <span class=\"keyword\">new</span> self.<span class=\"property\">SparkMD5</span>.<span class=\"title class_\">ArrayBuffer</span>();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> percentage = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"title function_\">loadNext</span> = index =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> reader = <span class=\"keyword\">new</span> <span class=\"title class_\">FileReader</span>();</span><br><span class=\"line\">    reader.<span class=\"title function_\">readAsArrayBuffer</span>(fileChunkList[index].<span class=\"property\">file</span>);</span><br><span class=\"line\">    reader.<span class=\"property\">onload</span> = <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">      count++;</span><br><span class=\"line\">      spark.<span class=\"title function_\">append</span>(e.<span class=\"property\">target</span>.<span class=\"property\">result</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (count === fileChunkList.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">        self.<span class=\"title function_\">postMessage</span>(&#123;</span><br><span class=\"line\">          <span class=\"attr\">percentage</span>: <span class=\"number\">100</span>,</span><br><span class=\"line\">          <span class=\"attr\">hash</span>: spark.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        self.<span class=\"title function_\">close</span>();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        percentage += <span class=\"number\">100</span> / fileChunkList.<span class=\"property\">length</span>;</span><br><span class=\"line\">        self.<span class=\"title function_\">postMessage</span>(&#123;</span><br><span class=\"line\">          percentage</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">// calculate recursively</span></span><br><span class=\"line\">        <span class=\"title function_\">loadNext</span>(count);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"title function_\">loadNext</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>在 worker 线程中，接受文件切片 fileChunkList，利用 fileReader 读取每个切片的 ArrayBuffer 并不断传入 spark-md5 中，每计算完一个切片通过 postMessage 向主线程发送一个进度事件，全部完成后将最终的 hash 发送给主线程。</p>\n<p>spark-md5 文档中要求传入所有切片并算出 hash 值，不能直接将整个文件放入计算，否则即使不同文件也会有相同的 hash。</p>\n<p>接着编写主线程与 worker 线程通讯的逻辑</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+    // 生成文件 hash（web-worker）</span></span><br><span class=\"line\"><span class=\"addition\">+    calculateHash(fileChunkList) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      return new Promise(resolve =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        // 添加 worker 属性</span></span><br><span class=\"line\"><span class=\"addition\">+        this.container.worker = new Worker(&quot;/hash.js&quot;);</span></span><br><span class=\"line\"><span class=\"addition\">+        this.container.worker.postMessage(&#123; fileChunkList &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+        this.container.worker.onmessage = e =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          const &#123; percentage, hash &#125; = e.data;</span></span><br><span class=\"line\"><span class=\"addition\">+          this.hashPercentage = percentage;</span></span><br><span class=\"line\"><span class=\"addition\">+          if (hash) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            resolve(hash);</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;;</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;);</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    async handleUpload() &#123;</span><br><span class=\"line\">      if (!this.container.file) return;</span><br><span class=\"line\">      const fileChunkList = this.createFileChunk(this.container.file);</span><br><span class=\"line\"><span class=\"addition\">+     this.container.hash = await this.calculateHash(fileChunkList);</span></span><br><span class=\"line\">      this.data = fileChunkList.map((&#123; file &#125;，index) =&gt; (&#123;</span><br><span class=\"line\"><span class=\"addition\">+       fileHash: this.container.hash,</span></span><br><span class=\"line\">        chunk: file,</span><br><span class=\"line\">        hash: this.container.file.name + &quot;-&quot; + index,</span><br><span class=\"line\">        percentage:0</span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\">      await this.uploadChunks();</span><br><span class=\"line\">    &#125;   </span><br></pre></td></tr></table></figure>\n\n<p>主线程使用 postMessage 给 worker 线程传入所有切片 fileChunkList，并监听 worker 线程发出的 postMessage 事件拿到文件 hash，加上显示计算 hash 的进度条。</p>\n<p>至此前端需要将之前用文件名作为 hash 的地方改写为 worker 返回的 hash。</p>\n<p>服务端则使用固定前缀 + hash 作为切片文件夹名，hash + 下标作为切片名，hash + 扩展名作为文件名。</p>\n<h2 id=\"文件秒传\"><a href=\"#文件秒传\" class=\"headerlink\" title=\"文件秒传\"></a>文件秒传</h2><p>在实现断点续传前先简单介绍一下文件秒传</p>\n<p>所谓的文件秒传，即在服务端已经存在了上传的资源，所以当用户再次上传时会直接提示上传成功</p>\n<p>文件秒传需要依赖上一步生成的 hash，即在上传前，先计算出文件 hash，并把 hash 发送给服务端进行验证，由于 hash 的唯一性，所以一旦服务端能找到 hash 相同的文件，则直接返回上传成功的信息即可</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+    async verifyUpload(filename, fileHash) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       const &#123; data &#125; = await this.request(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         url: &quot;http://localhost:3000/verify&quot;,</span></span><br><span class=\"line\"><span class=\"addition\">+         headers: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+           &quot;content-type&quot;: &quot;application/json&quot;</span></span><br><span class=\"line\"><span class=\"addition\">+         &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+         data: JSON.stringify(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+           filename,</span></span><br><span class=\"line\"><span class=\"addition\">+           fileHash</span></span><br><span class=\"line\"><span class=\"addition\">+         &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+       return JSON.parse(data);</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;,</span></span><br><span class=\"line\">   async handleUpload() &#123;</span><br><span class=\"line\">      if (!this.container.file) return;</span><br><span class=\"line\">      const fileChunkList = this.createFileChunk(this.container.file);</span><br><span class=\"line\">      this.container.hash = await this.calculateHash(fileChunkList);</span><br><span class=\"line\"><span class=\"addition\">+     const &#123; shouldUpload &#125; = await this.verifyUpload(</span></span><br><span class=\"line\"><span class=\"addition\">+       this.container.file.name,</span></span><br><span class=\"line\"><span class=\"addition\">+       this.container.hash</span></span><br><span class=\"line\"><span class=\"addition\">+     );</span></span><br><span class=\"line\"><span class=\"addition\">+     if (!shouldUpload) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       this.$message.success(&quot;skip upload：file upload success&quot;);</span></span><br><span class=\"line\"><span class=\"addition\">+       return;</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\">     this.data = fileChunkList.map((&#123; file &#125;, index) =&gt; (&#123;</span><br><span class=\"line\">        fileHash: this.container.hash,</span><br><span class=\"line\">        index,</span><br><span class=\"line\">        hash: this.container.hash + &quot;-&quot; + index,</span><br><span class=\"line\">        chunk: file,</span><br><span class=\"line\">        percentage: 0</span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\">      await this.uploadChunks();</span><br><span class=\"line\">    &#125;   </span><br></pre></td></tr></table></figure>\n\n<p>秒传其实就是给用户看的障眼法，实质上根本没有上传</p>\n<p>服务端的逻辑非常简单，新增一个验证接口，验证文件是否存在即可</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+ // 提取后缀名</span></span><br><span class=\"line\"><span class=\"addition\">+ const extractExt = filename =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+  filename.slice(filename.lastIndexOf(&quot;.&quot;), filename.length);</span></span><br><span class=\"line\">const UPLOAD_DIR = path.resolve(__dirname, &quot;..&quot;, &quot;target&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">const resolvePost = req =&gt;</span><br><span class=\"line\">  new Promise(resolve =&gt; &#123;</span><br><span class=\"line\">    let chunk = &quot;&quot;;</span><br><span class=\"line\">    req.on(&quot;data&quot;, data =&gt; &#123;</span><br><span class=\"line\">      chunk += data;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    req.on(&quot;end&quot;, () =&gt; &#123;</span><br><span class=\"line\">      resolve(JSON.parse(chunk));</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.on(&quot;request&quot;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">  if (req.url <span class=\"comment\">=== &quot;/verify&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    const data = await resolvePost(req);</span></span><br><span class=\"line\"><span class=\"addition\">+    const &#123; fileHash, filename &#125; = data;</span></span><br><span class=\"line\"><span class=\"addition\">+    const ext = extractExt(filename);</span></span><br><span class=\"line\"><span class=\"addition\">+    const filePath = path.resolve(UPLOAD_DIR, `$&#123;fileHash&#125;$&#123;ext&#125;`);</span></span><br><span class=\"line\"><span class=\"addition\">+    if (fse.existsSync(filePath)) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      res.end(</span></span><br><span class=\"line\"><span class=\"addition\">+        JSON.stringify(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          shouldUpload: false</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+      );</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      res.end(</span></span><br><span class=\"line\"><span class=\"addition\">+        JSON.stringify(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          shouldUpload: true</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+      );</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(3000, () =&gt; console.log(&quot;listening port 3000&quot;));</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"暂停上传\"><a href=\"#暂停上传\" class=\"headerlink\" title=\"暂停上传\"></a>暂停上传</h2><p>讲完了生成 hash 和文件秒传，回到断点续传</p>\n<p>断点续传顾名思义即断点 + 续传，所以我们第一步先实现“断点”，也就是暂停上传</p>\n<p>原理是使用 XMLHttpRequest 的 abort 方法，可以取消一个 xhr 请求的发送，为此我们需要将上传每个切片的 xhr 对象保存起来，我们再改造一下 request 方法</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   request(&#123;</span><br><span class=\"line\">      url,</span><br><span class=\"line\">      method = &quot;post&quot;,</span><br><span class=\"line\">      data,</span><br><span class=\"line\">      headers = &#123;&#125;,</span><br><span class=\"line\">      onProgress = e =&gt; e,</span><br><span class=\"line\"><span class=\"addition\">+     requestList</span></span><br><span class=\"line\">    &#125;) &#123;</span><br><span class=\"line\">      return new Promise(resolve =&gt; &#123;</span><br><span class=\"line\">        const xhr = new XMLHttpRequest();</span><br><span class=\"line\">        xhr.upload.onprogress = onProgress;</span><br><span class=\"line\">        xhr.open(method, url);</span><br><span class=\"line\">        Object.keys(headers).forEach(key =&gt;</span><br><span class=\"line\">          xhr.setRequestHeader(key, headers[key])</span><br><span class=\"line\">        );</span><br><span class=\"line\">        xhr.send(data);</span><br><span class=\"line\">        xhr.onload = e =&gt; &#123;</span><br><span class=\"line\"><span class=\"addition\">+          // 将请求成功的 xhr 从列表中删除</span></span><br><span class=\"line\"><span class=\"addition\">+          if (requestList) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            const xhrIndex = requestList.findIndex(item =&gt; item === xhr);</span></span><br><span class=\"line\"><span class=\"addition\">+            requestList.splice(xhrIndex, 1);</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\">          resolve(&#123;</span><br><span class=\"line\">            data: e.target.response</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"><span class=\"addition\">+        // 暴露当前 xhr 给外部</span></span><br><span class=\"line\"><span class=\"addition\">+        requestList?.push(xhr);</span></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>这样在上传切片时传入 requestList 数组作为参数，request 方法就会将所有的 xhr 保存在数组中了。</p>\n<p>每当一个切片上传成功时，将对应的 xhr 从 requestList 中删除，所以 requestList 中只保存正在上传切片的 xhr</p>\n<p>之后新建一个暂停按钮，当点击按钮时，调用保存在 requestList 中 xhr 的 abort 方法，即取消并清空所有正在上传的切片</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"title function_\">handlePause</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">requestList</span>.<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">xhr</span> =&gt;</span> xhr?.<span class=\"title function_\">abort</span>());</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">requestList</span> = [];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>点击暂停按钮可以看到 xhr 都被取消了。</p>\n<h2 id=\"恢复上传\"><a href=\"#恢复上传\" class=\"headerlink\" title=\"恢复上传\"></a>恢复上传</h2><p>之前在介绍断点续传的时提到使用第二种服务端存储的方式实现续传</p>\n<p>由于当文件切片上传后，服务端会建立一个文件夹存储所有上传的切片，所以每次前端上传前可以调用一个接口，服务端将已上传的切片的切片名返回，前端再跳过这些已经上传切片，这样就实现了“续传”的效果。</p>\n<p>而这个接口可以和之前秒传的验证接口合并，前端每次上传前发送一个验证的请求，返回两种结果</p>\n<ul>\n<li>服务端已存在该文件，不需要再次上传</li>\n<li>服务端不存在该文件或者已上传部分文件切片，通知前端进行上传，并把已上传的文件切片返回给前端</li>\n</ul>\n<p>所以我们改造一下之前文件秒传的服务端验证接口</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const extractExt = filename =&gt;</span><br><span class=\"line\">  filename.slice(filename.lastIndexOf(&quot;.&quot;), filename.length);</span><br><span class=\"line\">const UPLOAD_DIR = path.resolve(__dirname, &quot;..&quot;, &quot;target&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">const resolvePost = req =&gt;</span><br><span class=\"line\">  new Promise(resolve =&gt; &#123;</span><br><span class=\"line\">    let chunk = &quot;&quot;;</span><br><span class=\"line\">    req.on(&quot;data&quot;, data =&gt; &#123;</span><br><span class=\"line\">      chunk += data;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    req.on(&quot;end&quot;, () =&gt; &#123;</span><br><span class=\"line\">      resolve(JSON.parse(chunk));</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"addition\">+ // 返回已上传的所有切片名</span></span><br><span class=\"line\"><span class=\"addition\">+ const createUploadedList = async fileHash =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+   fse.existsSync(path.resolve(UPLOAD_DIR, fileHash))</span></span><br><span class=\"line\"><span class=\"addition\">+    ? await fse.readdir(path.resolve(UPLOAD_DIR, fileHash))</span></span><br><span class=\"line\"><span class=\"addition\">+    : [];</span></span><br><span class=\"line\"></span><br><span class=\"line\">server.on(&quot;request&quot;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">  if (req.url <span class=\"comment\">=== &quot;/verify&quot;) &#123;</span></span><br><span class=\"line\">    const data = await resolvePost(req);</span><br><span class=\"line\">    const &#123; fileHash, filename &#125; = data;</span><br><span class=\"line\">    const ext = extractExt(filename);</span><br><span class=\"line\">    const filePath = path.resolve(UPLOAD_DIR, `$&#123;fileHash&#125;$&#123;ext&#125;`);</span><br><span class=\"line\">    if (fse.existsSync(filePath)) &#123;</span><br><span class=\"line\">      res.end(</span><br><span class=\"line\">        JSON.stringify(&#123;</span><br><span class=\"line\">          shouldUpload: false</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      res.end(</span><br><span class=\"line\">        JSON.stringify(&#123;</span><br><span class=\"line\">          shouldUpload: true，</span><br><span class=\"line\"><span class=\"addition\">+         uploadedList: await createUploadedList(fileHash)</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(3000, () =&gt; console.log(&quot;listening port 3000&quot;));</span><br></pre></td></tr></table></figure>\n\n<p>接着回到前端，前端有两个地方需要调用验证的接口</p>\n<ul>\n<li>点击上传时，检查是否需要上传和已上传的切片</li>\n<li>点击暂停后的恢复上传，返回已上传的切片</li>\n</ul>\n<p>新增恢复按钮并改造原来上传切片的逻辑</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div id=&quot;app&quot;&gt;</span><br><span class=\"line\">      &lt;input</span><br><span class=\"line\">        type=&quot;file&quot;</span><br><span class=\"line\">        @change=&quot;handleFileChange&quot;</span><br><span class=\"line\">      /&gt;</span><br><span class=\"line\">       &lt;el-button @click=&quot;handleUpload&quot;&gt;upload&lt;/el-button&gt;</span><br><span class=\"line\">       &lt;el-button @click=&quot;handlePause&quot; v-if=&quot;isPaused&quot;&gt;pause&lt;/el-button&gt;</span><br><span class=\"line\"><span class=\"addition\">+      &lt;el-button @click=&quot;handleResume&quot; v-else&gt;resume&lt;/el-button&gt;</span></span><br><span class=\"line\">      //...</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+   async handleResume() &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      const &#123; uploadedList &#125; = await this.verifyUpload(</span></span><br><span class=\"line\"><span class=\"addition\">+        this.container.file.name,</span></span><br><span class=\"line\"><span class=\"addition\">+        this.container.hash</span></span><br><span class=\"line\"><span class=\"addition\">+      );</span></span><br><span class=\"line\"><span class=\"addition\">+      await this.uploadChunks(uploadedList);</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    async handleUpload() &#123;</span><br><span class=\"line\">      if (!this.container.file) return;</span><br><span class=\"line\">      const fileChunkList = this.createFileChunk(this.container.file);</span><br><span class=\"line\">      this.container.hash = await this.calculateHash(fileChunkList);</span><br><span class=\"line\"><span class=\"addition\">+     const &#123; shouldUpload, uploadedList &#125; = await this.verifyUpload(</span></span><br><span class=\"line\"><span class=\"addition\">+       this.container.file.name,</span></span><br><span class=\"line\"><span class=\"addition\">+       this.container.hash</span></span><br><span class=\"line\"><span class=\"addition\">+     );</span></span><br><span class=\"line\"><span class=\"addition\">+     if (!shouldUpload) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       this.$message.success(&quot;skip upload：file upload success&quot;);</span></span><br><span class=\"line\"><span class=\"addition\">+       return;</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;</span></span><br><span class=\"line\">      this.data = fileChunkList.map((&#123; file &#125;, index) =&gt; (&#123;</span><br><span class=\"line\">        fileHash: this.container.hash,</span><br><span class=\"line\">        index,</span><br><span class=\"line\">        hash: this.container.hash + &quot;-&quot; + index,</span><br><span class=\"line\">        chunk: file，</span><br><span class=\"line\">        percentage: 0</span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\"><span class=\"addition\">+      await this.uploadChunks(uploadedList);</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    // 上传切片，同时过滤已上传的切片</span><br><span class=\"line\"><span class=\"addition\">+   async uploadChunks(uploadedList = []) &#123;</span></span><br><span class=\"line\">      const requestList = this.data</span><br><span class=\"line\"><span class=\"addition\">+       .filter((&#123; hash &#125;) =&gt; !uploadedList.includes(hash))</span></span><br><span class=\"line\">        .map((&#123; chunk, hash, index &#125;) =&gt; &#123;</span><br><span class=\"line\">          const formData = new FormData();</span><br><span class=\"line\">          formData.append(&quot;chunk&quot;, chunk);</span><br><span class=\"line\">          formData.append(&quot;hash&quot;, hash);</span><br><span class=\"line\">          formData.append(&quot;filename&quot;, this.container.file.name);</span><br><span class=\"line\">          formData.append(&quot;fileHash&quot;, this.container.hash);</span><br><span class=\"line\">          return &#123; formData, index &#125;;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .map((&#123; formData, index &#125;) =&gt;</span><br><span class=\"line\">          this.request(&#123;</span><br><span class=\"line\">            url: &quot;http://localhost:3000&quot;,</span><br><span class=\"line\">            data: formData,</span><br><span class=\"line\">            onProgress: this.createProgressHandler(this.data[index]),</span><br><span class=\"line\">            requestList: this.requestList</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        );</span><br><span class=\"line\">      await Promise.all(requestList);</span><br><span class=\"line\"><span class=\"addition\">+     // 之前上传的切片数量 + 本次上传的切片数量 = 所有切片数量时合并切片</span></span><br><span class=\"line\"><span class=\"addition\">+     if (uploadedList.length + requestList.length === this.data.length) &#123;</span></span><br><span class=\"line\">         await this.mergeRequest();</span><br><span class=\"line\"><span class=\"addition\">+     &#125;</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里给原来上传切片的函数新增 uploadedList 参数，即上图中服务端返回的切片名列表，通过 filter 过滤掉已上传的切片，并且由于新增了已上传的部分，所以之前合并接口的触发条件做了一些改动。</p>\n<p>到这里断点续传的功能基本完成了。</p>\n<h2 id=\"进度条改进\"><a href=\"#进度条改进\" class=\"headerlink\" title=\"进度条改进\"></a>进度条改进</h2><p>虽然实现了断点续传，但还需要修改一下进度条的显示规则，否则在暂停上传&#x2F;接收到已上传切片时的进度条会出现偏差</p>\n<h3 id=\"单个切片进度条\"><a href=\"#单个切片进度条\" class=\"headerlink\" title=\"单个切片进度条\"></a>单个切片进度条</h3><p>由于在点击上传&#x2F;恢复上传时，会调用验证接口返回已上传的切片，所以需要将已上传切片的进度变成 100%</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   async handleUpload() &#123;</span><br><span class=\"line\">      if (!this.container.file) return;</span><br><span class=\"line\">      const fileChunkList = this.createFileChunk(this.container.file);</span><br><span class=\"line\">      this.container.hash = await this.calculateHash(fileChunkList);</span><br><span class=\"line\">      const &#123; shouldUpload, uploadedList &#125; = await this.verifyUpload(</span><br><span class=\"line\">        this.container.file.name,</span><br><span class=\"line\">        this.container.hash</span><br><span class=\"line\">      );</span><br><span class=\"line\">      if (!shouldUpload) &#123;</span><br><span class=\"line\">        this.$message.success(&quot;skip upload：file upload success&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      this.data = fileChunkList.map((&#123; file &#125;, index) =&gt; (&#123;</span><br><span class=\"line\">        fileHash: this.container.hash,</span><br><span class=\"line\">        index,</span><br><span class=\"line\">        hash: this.container.hash + &quot;-&quot; + index,</span><br><span class=\"line\">        chunk: file,</span><br><span class=\"line\"><span class=\"addition\">+       percentage: uploadedList.includes(index) ? 100 : 0</span></span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\">      await this.uploadChunks(uploadedList);</span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>uploadedList 会返回已上传的切片，在遍历所有切片时判断当前切片是否在已上传列表里即可</p>\n<h3 id=\"总进度条\"><a href=\"#总进度条\" class=\"headerlink\" title=\"总进度条\"></a>总进度条</h3><p>之前说到总进度条是一个计算属性，根据所有切片的上传进度计算而来，这就遇到了一个问题，点击暂停会取消并清空切片的 xhr 请求，此时如果已经上传了一部分，就会发现文件进度条有倒退的现象。</p>\n<p>当点击恢复时，由于重新创建了 xhr 导致切片进度清零，所以总进度条就会倒退</p>\n<p>解决方案是创建一个“假”的进度条，这个假进度条基于文件进度条，但只会停止和增加，然后给用户展示这个假的进度条</p>\n<p>这里我们使用 Vue 的监听属性</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  data: () =&gt; (&#123;</span><br><span class=\"line\"><span class=\"addition\">+    fakeUploadPercentage: 0</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  computed: &#123;</span><br><span class=\"line\">    uploadPercentage() &#123;</span><br><span class=\"line\">      if (!this.container.file || !this.data.length) return 0;</span><br><span class=\"line\">      const loaded = this.data</span><br><span class=\"line\">        .map(item =&gt; item.size * item.percentage)</span><br><span class=\"line\">        .reduce((acc, cur) =&gt; acc + cur);</span><br><span class=\"line\">      return parseInt((loaded / this.container.file.size).toFixed(2));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,  </span><br><span class=\"line\">  watch: &#123;</span><br><span class=\"line\"><span class=\"addition\">+    uploadPercentage(now) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      if (now &gt; this.fakeUploadPercentage) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        this.fakeUploadPercentage = now;</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>当 uploadPercentage 即真的文件进度条增加时，fakeUploadPercentage 也增加，一旦文件进度条后退，假的进度条只需停止即可。</p>\n<p>至此一个大文件上传 + 断点续传的解决方案就完成了。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>断点续传</p>\n<ul>\n<li>使用 spark-md5 根据文件内容算出文件 hash</li>\n<li>通过 hash 可以判断服务端是否已经上传该文件，从而直接提示用户上传成功（秒传）</li>\n<li>通过 XMLHttpRequest 的 abort 方法暂停切片的上传</li>\n<li>上传前服务端返回已经上传的切片名，前端跳过这些切片的上传</li>\n</ul>\n<p>参考 <a href=\"https://juejin.cn/post/6844904046436843527#heading-16\">https://juejin.cn/post/6844904046436843527#heading-16</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>断点续传的原理在于前端&#x2F;服务端需要记住已上传的切片，这样下次上传就可以跳过之前已上传的部分，有两种方案实现记忆的功能</p>\n<ul>\n<li>前端使用 localStorage 记录已上传的切片 hash</li>\n<li>服务端保存已上传的切片 hash，前端每次上传前向服务端获取已上传的切片</li>\n</ul>\n<p>第一种是前端的解决方案，第二种是服务端，而前端方案有一个缺陷，如果换了个浏览器就失去了记忆的效果，所以这里选后者</p>\n<h2 id=\"生成-hash\"><a href=\"#生成-hash\" class=\"headerlink\" title=\"生成 hash\"></a>生成 hash</h2><p>无论是前端还是服务端，都必须要生成文件和切片的 hash，之前我们使用文件名 + 切片下标作为切片 hash，这样做文件名一旦修改就失去了效果，而事实上只要文件内容不变，hash 就不应该变化，所以正确的做法是根据文件内容生成 hash，所以我们修改一下 hash 的生成规则</p>\n<p>webpack 的产物 contenthash 也是基于这个思路实现的</p>\n<p>这里用到另一个库 spark-md5，它可以根据文件内容计算出文件的 hash 值</p>\n<p>另外考虑到如果上传一个超大文件，读取文件内容计算 hash 是非常耗费时间的，并且会引起 UI 的阻塞，导致页面假死状态，所以我们使用 web-worker 在 worker 线程计算 hash，这样用户仍可以在主界面正常的交互。</p>\n<p>由于实例化 web-worker 时，参数是一个 js 文件路径且不能跨域，所以我们单独创建一个 hash.js 文件放在 public 目录下，另外在 worker 中也是不允许访问 dom 的，但它提供了importScripts 函数用于导入外部脚本，通过它导入 spark-md5</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// /public/hash.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 导入脚本</span></span><br><span class=\"line\">self.importScripts(<span class=\"string\">&quot;/spark-md5.min.js&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 生成文件 hash</span></span><br><span class=\"line\">self.<span class=\"property\">onmessage</span> = <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; fileChunkList &#125; = e.<span class=\"property\">data</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> spark = <span class=\"keyword\">new</span> self.<span class=\"property\">SparkMD5</span>.<span class=\"title class_\">ArrayBuffer</span>();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> percentage = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"title function_\">loadNext</span> = index =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> reader = <span class=\"keyword\">new</span> <span class=\"title class_\">FileReader</span>();</span><br><span class=\"line\">    reader.<span class=\"title function_\">readAsArrayBuffer</span>(fileChunkList[index].<span class=\"property\">file</span>);</span><br><span class=\"line\">    reader.<span class=\"property\">onload</span> = <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">      count++;</span><br><span class=\"line\">      spark.<span class=\"title function_\">append</span>(e.<span class=\"property\">target</span>.<span class=\"property\">result</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (count === fileChunkList.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">        self.<span class=\"title function_\">postMessage</span>(&#123;</span><br><span class=\"line\">          <span class=\"attr\">percentage</span>: <span class=\"number\">100</span>,</span><br><span class=\"line\">          <span class=\"attr\">hash</span>: spark.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        self.<span class=\"title function_\">close</span>();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        percentage += <span class=\"number\">100</span> / fileChunkList.<span class=\"property\">length</span>;</span><br><span class=\"line\">        self.<span class=\"title function_\">postMessage</span>(&#123;</span><br><span class=\"line\">          percentage</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">// calculate recursively</span></span><br><span class=\"line\">        <span class=\"title function_\">loadNext</span>(count);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"title function_\">loadNext</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>在 worker 线程中，接受文件切片 fileChunkList，利用 fileReader 读取每个切片的 ArrayBuffer 并不断传入 spark-md5 中，每计算完一个切片通过 postMessage 向主线程发送一个进度事件，全部完成后将最终的 hash 发送给主线程。</p>\n<p>spark-md5 文档中要求传入所有切片并算出 hash 值，不能直接将整个文件放入计算，否则即使不同文件也会有相同的 hash。</p>\n<p>接着编写主线程与 worker 线程通讯的逻辑</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+    // 生成文件 hash（web-worker）</span></span><br><span class=\"line\"><span class=\"addition\">+    calculateHash(fileChunkList) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      return new Promise(resolve =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        // 添加 worker 属性</span></span><br><span class=\"line\"><span class=\"addition\">+        this.container.worker = new Worker(&quot;/hash.js&quot;);</span></span><br><span class=\"line\"><span class=\"addition\">+        this.container.worker.postMessage(&#123; fileChunkList &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+        this.container.worker.onmessage = e =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          const &#123; percentage, hash &#125; = e.data;</span></span><br><span class=\"line\"><span class=\"addition\">+          this.hashPercentage = percentage;</span></span><br><span class=\"line\"><span class=\"addition\">+          if (hash) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            resolve(hash);</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;;</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;);</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    async handleUpload() &#123;</span><br><span class=\"line\">      if (!this.container.file) return;</span><br><span class=\"line\">      const fileChunkList = this.createFileChunk(this.container.file);</span><br><span class=\"line\"><span class=\"addition\">+     this.container.hash = await this.calculateHash(fileChunkList);</span></span><br><span class=\"line\">      this.data = fileChunkList.map((&#123; file &#125;，index) =&gt; (&#123;</span><br><span class=\"line\"><span class=\"addition\">+       fileHash: this.container.hash,</span></span><br><span class=\"line\">        chunk: file,</span><br><span class=\"line\">        hash: this.container.file.name + &quot;-&quot; + index,</span><br><span class=\"line\">        percentage:0</span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\">      await this.uploadChunks();</span><br><span class=\"line\">    &#125;   </span><br></pre></td></tr></table></figure>\n\n<p>主线程使用 postMessage 给 worker 线程传入所有切片 fileChunkList，并监听 worker 线程发出的 postMessage 事件拿到文件 hash，加上显示计算 hash 的进度条。</p>\n<p>至此前端需要将之前用文件名作为 hash 的地方改写为 worker 返回的 hash。</p>\n<p>服务端则使用固定前缀 + hash 作为切片文件夹名，hash + 下标作为切片名，hash + 扩展名作为文件名。</p>\n<h2 id=\"文件秒传\"><a href=\"#文件秒传\" class=\"headerlink\" title=\"文件秒传\"></a>文件秒传</h2><p>在实现断点续传前先简单介绍一下文件秒传</p>\n<p>所谓的文件秒传，即在服务端已经存在了上传的资源，所以当用户再次上传时会直接提示上传成功</p>\n<p>文件秒传需要依赖上一步生成的 hash，即在上传前，先计算出文件 hash，并把 hash 发送给服务端进行验证，由于 hash 的唯一性，所以一旦服务端能找到 hash 相同的文件，则直接返回上传成功的信息即可</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+    async verifyUpload(filename, fileHash) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       const &#123; data &#125; = await this.request(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         url: &quot;http://localhost:3000/verify&quot;,</span></span><br><span class=\"line\"><span class=\"addition\">+         headers: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+           &quot;content-type&quot;: &quot;application/json&quot;</span></span><br><span class=\"line\"><span class=\"addition\">+         &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+         data: JSON.stringify(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+           filename,</span></span><br><span class=\"line\"><span class=\"addition\">+           fileHash</span></span><br><span class=\"line\"><span class=\"addition\">+         &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+       return JSON.parse(data);</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;,</span></span><br><span class=\"line\">   async handleUpload() &#123;</span><br><span class=\"line\">      if (!this.container.file) return;</span><br><span class=\"line\">      const fileChunkList = this.createFileChunk(this.container.file);</span><br><span class=\"line\">      this.container.hash = await this.calculateHash(fileChunkList);</span><br><span class=\"line\"><span class=\"addition\">+     const &#123; shouldUpload &#125; = await this.verifyUpload(</span></span><br><span class=\"line\"><span class=\"addition\">+       this.container.file.name,</span></span><br><span class=\"line\"><span class=\"addition\">+       this.container.hash</span></span><br><span class=\"line\"><span class=\"addition\">+     );</span></span><br><span class=\"line\"><span class=\"addition\">+     if (!shouldUpload) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       this.$message.success(&quot;skip upload：file upload success&quot;);</span></span><br><span class=\"line\"><span class=\"addition\">+       return;</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\">     this.data = fileChunkList.map((&#123; file &#125;, index) =&gt; (&#123;</span><br><span class=\"line\">        fileHash: this.container.hash,</span><br><span class=\"line\">        index,</span><br><span class=\"line\">        hash: this.container.hash + &quot;-&quot; + index,</span><br><span class=\"line\">        chunk: file,</span><br><span class=\"line\">        percentage: 0</span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\">      await this.uploadChunks();</span><br><span class=\"line\">    &#125;   </span><br></pre></td></tr></table></figure>\n\n<p>秒传其实就是给用户看的障眼法，实质上根本没有上传</p>\n<p>服务端的逻辑非常简单，新增一个验证接口，验证文件是否存在即可</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+ // 提取后缀名</span></span><br><span class=\"line\"><span class=\"addition\">+ const extractExt = filename =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+  filename.slice(filename.lastIndexOf(&quot;.&quot;), filename.length);</span></span><br><span class=\"line\">const UPLOAD_DIR = path.resolve(__dirname, &quot;..&quot;, &quot;target&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">const resolvePost = req =&gt;</span><br><span class=\"line\">  new Promise(resolve =&gt; &#123;</span><br><span class=\"line\">    let chunk = &quot;&quot;;</span><br><span class=\"line\">    req.on(&quot;data&quot;, data =&gt; &#123;</span><br><span class=\"line\">      chunk += data;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    req.on(&quot;end&quot;, () =&gt; &#123;</span><br><span class=\"line\">      resolve(JSON.parse(chunk));</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.on(&quot;request&quot;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">  if (req.url <span class=\"comment\">=== &quot;/verify&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    const data = await resolvePost(req);</span></span><br><span class=\"line\"><span class=\"addition\">+    const &#123; fileHash, filename &#125; = data;</span></span><br><span class=\"line\"><span class=\"addition\">+    const ext = extractExt(filename);</span></span><br><span class=\"line\"><span class=\"addition\">+    const filePath = path.resolve(UPLOAD_DIR, `$&#123;fileHash&#125;$&#123;ext&#125;`);</span></span><br><span class=\"line\"><span class=\"addition\">+    if (fse.existsSync(filePath)) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      res.end(</span></span><br><span class=\"line\"><span class=\"addition\">+        JSON.stringify(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          shouldUpload: false</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+      );</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      res.end(</span></span><br><span class=\"line\"><span class=\"addition\">+        JSON.stringify(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          shouldUpload: true</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+      );</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(3000, () =&gt; console.log(&quot;listening port 3000&quot;));</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"暂停上传\"><a href=\"#暂停上传\" class=\"headerlink\" title=\"暂停上传\"></a>暂停上传</h2><p>讲完了生成 hash 和文件秒传，回到断点续传</p>\n<p>断点续传顾名思义即断点 + 续传，所以我们第一步先实现“断点”，也就是暂停上传</p>\n<p>原理是使用 XMLHttpRequest 的 abort 方法，可以取消一个 xhr 请求的发送，为此我们需要将上传每个切片的 xhr 对象保存起来，我们再改造一下 request 方法</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   request(&#123;</span><br><span class=\"line\">      url,</span><br><span class=\"line\">      method = &quot;post&quot;,</span><br><span class=\"line\">      data,</span><br><span class=\"line\">      headers = &#123;&#125;,</span><br><span class=\"line\">      onProgress = e =&gt; e,</span><br><span class=\"line\"><span class=\"addition\">+     requestList</span></span><br><span class=\"line\">    &#125;) &#123;</span><br><span class=\"line\">      return new Promise(resolve =&gt; &#123;</span><br><span class=\"line\">        const xhr = new XMLHttpRequest();</span><br><span class=\"line\">        xhr.upload.onprogress = onProgress;</span><br><span class=\"line\">        xhr.open(method, url);</span><br><span class=\"line\">        Object.keys(headers).forEach(key =&gt;</span><br><span class=\"line\">          xhr.setRequestHeader(key, headers[key])</span><br><span class=\"line\">        );</span><br><span class=\"line\">        xhr.send(data);</span><br><span class=\"line\">        xhr.onload = e =&gt; &#123;</span><br><span class=\"line\"><span class=\"addition\">+          // 将请求成功的 xhr 从列表中删除</span></span><br><span class=\"line\"><span class=\"addition\">+          if (requestList) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            const xhrIndex = requestList.findIndex(item =&gt; item === xhr);</span></span><br><span class=\"line\"><span class=\"addition\">+            requestList.splice(xhrIndex, 1);</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\">          resolve(&#123;</span><br><span class=\"line\">            data: e.target.response</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"><span class=\"addition\">+        // 暴露当前 xhr 给外部</span></span><br><span class=\"line\"><span class=\"addition\">+        requestList?.push(xhr);</span></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>这样在上传切片时传入 requestList 数组作为参数，request 方法就会将所有的 xhr 保存在数组中了。</p>\n<p>每当一个切片上传成功时，将对应的 xhr 从 requestList 中删除，所以 requestList 中只保存正在上传切片的 xhr</p>\n<p>之后新建一个暂停按钮，当点击按钮时，调用保存在 requestList 中 xhr 的 abort 方法，即取消并清空所有正在上传的切片</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"title function_\">handlePause</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">requestList</span>.<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">xhr</span> =&gt;</span> xhr?.<span class=\"title function_\">abort</span>());</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">requestList</span> = [];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>点击暂停按钮可以看到 xhr 都被取消了。</p>\n<h2 id=\"恢复上传\"><a href=\"#恢复上传\" class=\"headerlink\" title=\"恢复上传\"></a>恢复上传</h2><p>之前在介绍断点续传的时提到使用第二种服务端存储的方式实现续传</p>\n<p>由于当文件切片上传后，服务端会建立一个文件夹存储所有上传的切片，所以每次前端上传前可以调用一个接口，服务端将已上传的切片的切片名返回，前端再跳过这些已经上传切片，这样就实现了“续传”的效果。</p>\n<p>而这个接口可以和之前秒传的验证接口合并，前端每次上传前发送一个验证的请求，返回两种结果</p>\n<ul>\n<li>服务端已存在该文件，不需要再次上传</li>\n<li>服务端不存在该文件或者已上传部分文件切片，通知前端进行上传，并把已上传的文件切片返回给前端</li>\n</ul>\n<p>所以我们改造一下之前文件秒传的服务端验证接口</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const extractExt = filename =&gt;</span><br><span class=\"line\">  filename.slice(filename.lastIndexOf(&quot;.&quot;), filename.length);</span><br><span class=\"line\">const UPLOAD_DIR = path.resolve(__dirname, &quot;..&quot;, &quot;target&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">const resolvePost = req =&gt;</span><br><span class=\"line\">  new Promise(resolve =&gt; &#123;</span><br><span class=\"line\">    let chunk = &quot;&quot;;</span><br><span class=\"line\">    req.on(&quot;data&quot;, data =&gt; &#123;</span><br><span class=\"line\">      chunk += data;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    req.on(&quot;end&quot;, () =&gt; &#123;</span><br><span class=\"line\">      resolve(JSON.parse(chunk));</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"addition\">+ // 返回已上传的所有切片名</span></span><br><span class=\"line\"><span class=\"addition\">+ const createUploadedList = async fileHash =&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+   fse.existsSync(path.resolve(UPLOAD_DIR, fileHash))</span></span><br><span class=\"line\"><span class=\"addition\">+    ? await fse.readdir(path.resolve(UPLOAD_DIR, fileHash))</span></span><br><span class=\"line\"><span class=\"addition\">+    : [];</span></span><br><span class=\"line\"></span><br><span class=\"line\">server.on(&quot;request&quot;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">  if (req.url <span class=\"comment\">=== &quot;/verify&quot;) &#123;</span></span><br><span class=\"line\">    const data = await resolvePost(req);</span><br><span class=\"line\">    const &#123; fileHash, filename &#125; = data;</span><br><span class=\"line\">    const ext = extractExt(filename);</span><br><span class=\"line\">    const filePath = path.resolve(UPLOAD_DIR, `$&#123;fileHash&#125;$&#123;ext&#125;`);</span><br><span class=\"line\">    if (fse.existsSync(filePath)) &#123;</span><br><span class=\"line\">      res.end(</span><br><span class=\"line\">        JSON.stringify(&#123;</span><br><span class=\"line\">          shouldUpload: false</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      res.end(</span><br><span class=\"line\">        JSON.stringify(&#123;</span><br><span class=\"line\">          shouldUpload: true，</span><br><span class=\"line\"><span class=\"addition\">+         uploadedList: await createUploadedList(fileHash)</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(3000, () =&gt; console.log(&quot;listening port 3000&quot;));</span><br></pre></td></tr></table></figure>\n\n<p>接着回到前端，前端有两个地方需要调用验证的接口</p>\n<ul>\n<li>点击上传时，检查是否需要上传和已上传的切片</li>\n<li>点击暂停后的恢复上传，返回已上传的切片</li>\n</ul>\n<p>新增恢复按钮并改造原来上传切片的逻辑</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div id=&quot;app&quot;&gt;</span><br><span class=\"line\">      &lt;input</span><br><span class=\"line\">        type=&quot;file&quot;</span><br><span class=\"line\">        @change=&quot;handleFileChange&quot;</span><br><span class=\"line\">      /&gt;</span><br><span class=\"line\">       &lt;el-button @click=&quot;handleUpload&quot;&gt;upload&lt;/el-button&gt;</span><br><span class=\"line\">       &lt;el-button @click=&quot;handlePause&quot; v-if=&quot;isPaused&quot;&gt;pause&lt;/el-button&gt;</span><br><span class=\"line\"><span class=\"addition\">+      &lt;el-button @click=&quot;handleResume&quot; v-else&gt;resume&lt;/el-button&gt;</span></span><br><span class=\"line\">      //...</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+   async handleResume() &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      const &#123; uploadedList &#125; = await this.verifyUpload(</span></span><br><span class=\"line\"><span class=\"addition\">+        this.container.file.name,</span></span><br><span class=\"line\"><span class=\"addition\">+        this.container.hash</span></span><br><span class=\"line\"><span class=\"addition\">+      );</span></span><br><span class=\"line\"><span class=\"addition\">+      await this.uploadChunks(uploadedList);</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    async handleUpload() &#123;</span><br><span class=\"line\">      if (!this.container.file) return;</span><br><span class=\"line\">      const fileChunkList = this.createFileChunk(this.container.file);</span><br><span class=\"line\">      this.container.hash = await this.calculateHash(fileChunkList);</span><br><span class=\"line\"><span class=\"addition\">+     const &#123; shouldUpload, uploadedList &#125; = await this.verifyUpload(</span></span><br><span class=\"line\"><span class=\"addition\">+       this.container.file.name,</span></span><br><span class=\"line\"><span class=\"addition\">+       this.container.hash</span></span><br><span class=\"line\"><span class=\"addition\">+     );</span></span><br><span class=\"line\"><span class=\"addition\">+     if (!shouldUpload) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       this.$message.success(&quot;skip upload：file upload success&quot;);</span></span><br><span class=\"line\"><span class=\"addition\">+       return;</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;</span></span><br><span class=\"line\">      this.data = fileChunkList.map((&#123; file &#125;, index) =&gt; (&#123;</span><br><span class=\"line\">        fileHash: this.container.hash,</span><br><span class=\"line\">        index,</span><br><span class=\"line\">        hash: this.container.hash + &quot;-&quot; + index,</span><br><span class=\"line\">        chunk: file，</span><br><span class=\"line\">        percentage: 0</span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\"><span class=\"addition\">+      await this.uploadChunks(uploadedList);</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    // 上传切片，同时过滤已上传的切片</span><br><span class=\"line\"><span class=\"addition\">+   async uploadChunks(uploadedList = []) &#123;</span></span><br><span class=\"line\">      const requestList = this.data</span><br><span class=\"line\"><span class=\"addition\">+       .filter((&#123; hash &#125;) =&gt; !uploadedList.includes(hash))</span></span><br><span class=\"line\">        .map((&#123; chunk, hash, index &#125;) =&gt; &#123;</span><br><span class=\"line\">          const formData = new FormData();</span><br><span class=\"line\">          formData.append(&quot;chunk&quot;, chunk);</span><br><span class=\"line\">          formData.append(&quot;hash&quot;, hash);</span><br><span class=\"line\">          formData.append(&quot;filename&quot;, this.container.file.name);</span><br><span class=\"line\">          formData.append(&quot;fileHash&quot;, this.container.hash);</span><br><span class=\"line\">          return &#123; formData, index &#125;;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .map((&#123; formData, index &#125;) =&gt;</span><br><span class=\"line\">          this.request(&#123;</span><br><span class=\"line\">            url: &quot;http://localhost:3000&quot;,</span><br><span class=\"line\">            data: formData,</span><br><span class=\"line\">            onProgress: this.createProgressHandler(this.data[index]),</span><br><span class=\"line\">            requestList: this.requestList</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        );</span><br><span class=\"line\">      await Promise.all(requestList);</span><br><span class=\"line\"><span class=\"addition\">+     // 之前上传的切片数量 + 本次上传的切片数量 = 所有切片数量时合并切片</span></span><br><span class=\"line\"><span class=\"addition\">+     if (uploadedList.length + requestList.length === this.data.length) &#123;</span></span><br><span class=\"line\">         await this.mergeRequest();</span><br><span class=\"line\"><span class=\"addition\">+     &#125;</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里给原来上传切片的函数新增 uploadedList 参数，即上图中服务端返回的切片名列表，通过 filter 过滤掉已上传的切片，并且由于新增了已上传的部分，所以之前合并接口的触发条件做了一些改动。</p>\n<p>到这里断点续传的功能基本完成了。</p>\n<h2 id=\"进度条改进\"><a href=\"#进度条改进\" class=\"headerlink\" title=\"进度条改进\"></a>进度条改进</h2><p>虽然实现了断点续传，但还需要修改一下进度条的显示规则，否则在暂停上传&#x2F;接收到已上传切片时的进度条会出现偏差</p>\n<h3 id=\"单个切片进度条\"><a href=\"#单个切片进度条\" class=\"headerlink\" title=\"单个切片进度条\"></a>单个切片进度条</h3><p>由于在点击上传&#x2F;恢复上传时，会调用验证接口返回已上传的切片，所以需要将已上传切片的进度变成 100%</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   async handleUpload() &#123;</span><br><span class=\"line\">      if (!this.container.file) return;</span><br><span class=\"line\">      const fileChunkList = this.createFileChunk(this.container.file);</span><br><span class=\"line\">      this.container.hash = await this.calculateHash(fileChunkList);</span><br><span class=\"line\">      const &#123; shouldUpload, uploadedList &#125; = await this.verifyUpload(</span><br><span class=\"line\">        this.container.file.name,</span><br><span class=\"line\">        this.container.hash</span><br><span class=\"line\">      );</span><br><span class=\"line\">      if (!shouldUpload) &#123;</span><br><span class=\"line\">        this.$message.success(&quot;skip upload：file upload success&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      this.data = fileChunkList.map((&#123; file &#125;, index) =&gt; (&#123;</span><br><span class=\"line\">        fileHash: this.container.hash,</span><br><span class=\"line\">        index,</span><br><span class=\"line\">        hash: this.container.hash + &quot;-&quot; + index,</span><br><span class=\"line\">        chunk: file,</span><br><span class=\"line\"><span class=\"addition\">+       percentage: uploadedList.includes(index) ? 100 : 0</span></span><br><span class=\"line\">      &#125;));</span><br><span class=\"line\">      await this.uploadChunks(uploadedList);</span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>uploadedList 会返回已上传的切片，在遍历所有切片时判断当前切片是否在已上传列表里即可</p>\n<h3 id=\"总进度条\"><a href=\"#总进度条\" class=\"headerlink\" title=\"总进度条\"></a>总进度条</h3><p>之前说到总进度条是一个计算属性，根据所有切片的上传进度计算而来，这就遇到了一个问题，点击暂停会取消并清空切片的 xhr 请求，此时如果已经上传了一部分，就会发现文件进度条有倒退的现象。</p>\n<p>当点击恢复时，由于重新创建了 xhr 导致切片进度清零，所以总进度条就会倒退</p>\n<p>解决方案是创建一个“假”的进度条，这个假进度条基于文件进度条，但只会停止和增加，然后给用户展示这个假的进度条</p>\n<p>这里我们使用 Vue 的监听属性</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  data: () =&gt; (&#123;</span><br><span class=\"line\"><span class=\"addition\">+    fakeUploadPercentage: 0</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  computed: &#123;</span><br><span class=\"line\">    uploadPercentage() &#123;</span><br><span class=\"line\">      if (!this.container.file || !this.data.length) return 0;</span><br><span class=\"line\">      const loaded = this.data</span><br><span class=\"line\">        .map(item =&gt; item.size * item.percentage)</span><br><span class=\"line\">        .reduce((acc, cur) =&gt; acc + cur);</span><br><span class=\"line\">      return parseInt((loaded / this.container.file.size).toFixed(2));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,  </span><br><span class=\"line\">  watch: &#123;</span><br><span class=\"line\"><span class=\"addition\">+    uploadPercentage(now) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      if (now &gt; this.fakeUploadPercentage) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        this.fakeUploadPercentage = now;</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>当 uploadPercentage 即真的文件进度条增加时，fakeUploadPercentage 也增加，一旦文件进度条后退，假的进度条只需停止即可。</p>\n<p>至此一个大文件上传 + 断点续传的解决方案就完成了。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>断点续传</p>\n<ul>\n<li>使用 spark-md5 根据文件内容算出文件 hash</li>\n<li>通过 hash 可以判断服务端是否已经上传该文件，从而直接提示用户上传成功（秒传）</li>\n<li>通过 XMLHttpRequest 的 abort 方法暂停切片的上传</li>\n<li>上传前服务端返回已经上传的切片名，前端跳过这些切片的上传</li>\n</ul>\n<p>参考 <a href=\"https://juejin.cn/post/6844904046436843527#heading-16\">https://juejin.cn/post/6844904046436843527#heading-16</a></p>\n"},{"title":"强缓存和协商缓存","date":"2023-02-15T14:28:18.000Z","description":"浏览器缓存(Brower Caching)是浏览器对之前请求过的文件进行缓存，以便下一次访问时重复使用，节省带宽，提高访问速度，降低服务器压力。","_content":"\n浏览器缓存（Brower Caching）是浏览器在本地磁盘对用户最近请求过的文档进行存储，当访问者再次访问同一页面时，浏览器就可以直接从本地磁盘加载文档。\n\n浏览器缓存的优点有：\n\n- 减少了冗余的数据传输，节省了网费\n- 减少了服务器的负担，大大提升了网站的性能\n- 加快了客户端加载网页的速度\n\n\n\n## 浏览器缓存分类\n\n浏览器缓存主要有两类：缓存协商和强缓存。\n\n浏览器在第一次请求发生后，再次请求时：\n\n1. 浏览器会先获取该资源缓存的header信息，根据其中的**expires**和**cahe-control**判断是否命中强缓存，若命中则直接从缓存中获取资源，包括缓存的header信息，本次请求不会与服务器进行通信；\n\n2. 如果没有命中强缓存，浏览器会发送请求到服务器，该请求会携带第一次请求返回的有关缓存的header字段信息（**Last-Modified/IF-Modified-Since、Etag/IF-None-Match**）,由**服务器**根据请求中的相关header信息来对比结果是否命中协商缓存，若命中，则服务器返回新的响应header信息更新缓存中的对应header信息，但是并不返回资源内容，它会告知浏览器可以直接从缓存获取；否则返回最新的资源内容\n\n### 强缓存\n\n强缓存是利用http的返回头中的Expires或者Cache-Control两个字段来控制的，用来表示资源的缓存时间。\n\n- Expires\n  该字段是http1.0时的规范，它的值为一个绝对时间的GMT格式的时间字符串，比如 `Expires:Mon,18 Oct 2066 23:59:59 GMT`。这个时间代表着这个资源的失效时间，在此时间之前，即命中缓存。这种方式有一个明显的缺点，由于失效时间是一个绝对时间，所以当服务器与客户端时间偏差较大时，就会导致缓存混乱。\n\n- Cache-Control\n  Cache-Control是http1.1时出现的header信息，主要是利用该字段的max-age值来进行判断，它是一个相对时间，例如 `Cache-Control:max-age=3600`，代表着资源的有效期是3600秒。\n\nCache-Control与Expires可以在服务端配置同时启用，同时启用的时候Cache-Control优先级高。\n\n### 协商缓存\n\n协商缓存就是由服务器来确定缓存资源是否可用，所以客户端与服务器端要通过某种标识来进行通信，从而让服务器判断请求资源是否可以缓存访问，这主要涉及到下面两组header字段，这两组搭档都是成对出现的，即第一次请求的响应头带上某个字段（Last-Modified或者Etag），则后续请求则会带上对应的请求字段（If-Modified-Since或者If-None-Match），若响应头没有Last-Modified或者Etag字段，则请求头也不会有对应的字段。\n\n**Last-Modify/If-Modify-Since**\n\n浏览器第一次请求一个资源的时候，服务器返回的header中会加上Last-Modify，Last-modify是一个**时间标识**该资源的最后修改时间，例如 `Last-Modify: Thu,31 Dec 2037 23:59:59 GMT`。\n\n当浏览器再次请求该资源时，request的请求头中会包含If-Modify-Since，该值为缓存之前返回的Last-Modify。服务器收到If-Modify-Since后，根据资源的最后修改时间判断是否命中缓存。\n\n如果命中缓存，则返回304，并且不会返回资源内容，并且不会返回Last-Modify。\n\n**ETag/If-None-Match**\n\n与Last-Modify/If-Modify-Since不同的是，Etag/If-None-Match返回的是一个**校验码**。ETag可以保证每一个资源是唯一的，资源变化都会导致ETag变化。服务器根据浏览器上送的If-None-Match值来判断是否命中缓存。\n\n与Last-Modified不一样的是，当服务器返回304 Not Modified的响应时，由于ETag重新生成过，response header中还会把这个ETag返回，即使这个ETag跟之前的没有变化。\n\n**为什么要有Etag？**\n\n你可能会觉得使用Last-Modified已经足以让浏览器知道本地的缓存副本是否足够新，为什么还需要Etag呢？ HTTP1.1中Etag的出现主要是为了解决几个Last-Modified比较难解决的问题：\n\n- 一些文件也许会周期性的更改，但是他的内容并不改变(仅仅改变的修改时间)，这个时候我们并不希望客户端认为这个文件被修改了，而重新GET；\n- 某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说1s内修改了N次)，If-Modified-Since能检查到的粒度是s级的，这种修改无法判断(或者说UNIX记录MTIME只能精确到秒)；\n- 某些服务器不能精确的得到文件的最后修改时间。\n\n**Last-Modified与ETag是可以一起使用的，服务器会优先验证ETag，一致的情况下，才会继续比对Last-Modified，最后才决定是否返回304。**\n\n强缓存与协商缓存的区别可以用下表来表示：\n\n| 缓存类型 | 获取资源形式 | 状态码              | 发送请求到服务器                 |\n| -------- | ------------ | ------------------- | -------------------------------- |\n| 强缓存   | 从缓存取     | 200（from cache）   | 否，直接从缓存取                 |\n| 协商缓存 | 从缓存取     | 304（Not Modified） | 是，通过服务器来告知缓存是否可用 |\n\n\n\n\n## 用户行为对缓存的影响\n\n| 用户操作        | Expires/Cache-Control | Last-Modied/Etag |\n| --------------- | --------------------- | ---------------- |\n| 地址栏回车      | 有效                  | 有效             |\n| 页面链接跳转    | 有效                  | 有效             |\n| 新开窗口        | 有效                  | 有效             |\n| 前进回退        | 有效                  | 有效             |\n| F5刷新          | 无效                  | 有效             |\n| Ctrl+F5强制刷新 | 无效                  | 无效             |\n\n\n\n## 实际问题分析\n\n 代码更新到线上后用户浏览器不能自行更新，我们不能要求客户在系统更新后都进行一次缓存清理的操作。\n\n解决：\n\n在资源请求的URL中增加一个参数，比如： `js/main. js?ver=0.7.1`。这个参数是一个版本号，每一次部署的时候变更一下，当这个参数变化的时候，强缓存都会失效并重新加载。这样一来，静态资源，部署以后就需要重新加载。这样就比较完美的解决了问题。","source":"_posts/browser-cache.md","raw":"---\ntitle: 强缓存和协商缓存\ndate: 2023-02-15 22:28:18\ntags: [HTTP, 高频]\ncategories: JavaScript\ndescription: 浏览器缓存(Brower Caching)是浏览器对之前请求过的文件进行缓存，以便下一次访问时重复使用，节省带宽，提高访问速度，降低服务器压力。\n---\n\n浏览器缓存（Brower Caching）是浏览器在本地磁盘对用户最近请求过的文档进行存储，当访问者再次访问同一页面时，浏览器就可以直接从本地磁盘加载文档。\n\n浏览器缓存的优点有：\n\n- 减少了冗余的数据传输，节省了网费\n- 减少了服务器的负担，大大提升了网站的性能\n- 加快了客户端加载网页的速度\n\n\n\n## 浏览器缓存分类\n\n浏览器缓存主要有两类：缓存协商和强缓存。\n\n浏览器在第一次请求发生后，再次请求时：\n\n1. 浏览器会先获取该资源缓存的header信息，根据其中的**expires**和**cahe-control**判断是否命中强缓存，若命中则直接从缓存中获取资源，包括缓存的header信息，本次请求不会与服务器进行通信；\n\n2. 如果没有命中强缓存，浏览器会发送请求到服务器，该请求会携带第一次请求返回的有关缓存的header字段信息（**Last-Modified/IF-Modified-Since、Etag/IF-None-Match**）,由**服务器**根据请求中的相关header信息来对比结果是否命中协商缓存，若命中，则服务器返回新的响应header信息更新缓存中的对应header信息，但是并不返回资源内容，它会告知浏览器可以直接从缓存获取；否则返回最新的资源内容\n\n### 强缓存\n\n强缓存是利用http的返回头中的Expires或者Cache-Control两个字段来控制的，用来表示资源的缓存时间。\n\n- Expires\n  该字段是http1.0时的规范，它的值为一个绝对时间的GMT格式的时间字符串，比如 `Expires:Mon,18 Oct 2066 23:59:59 GMT`。这个时间代表着这个资源的失效时间，在此时间之前，即命中缓存。这种方式有一个明显的缺点，由于失效时间是一个绝对时间，所以当服务器与客户端时间偏差较大时，就会导致缓存混乱。\n\n- Cache-Control\n  Cache-Control是http1.1时出现的header信息，主要是利用该字段的max-age值来进行判断，它是一个相对时间，例如 `Cache-Control:max-age=3600`，代表着资源的有效期是3600秒。\n\nCache-Control与Expires可以在服务端配置同时启用，同时启用的时候Cache-Control优先级高。\n\n### 协商缓存\n\n协商缓存就是由服务器来确定缓存资源是否可用，所以客户端与服务器端要通过某种标识来进行通信，从而让服务器判断请求资源是否可以缓存访问，这主要涉及到下面两组header字段，这两组搭档都是成对出现的，即第一次请求的响应头带上某个字段（Last-Modified或者Etag），则后续请求则会带上对应的请求字段（If-Modified-Since或者If-None-Match），若响应头没有Last-Modified或者Etag字段，则请求头也不会有对应的字段。\n\n**Last-Modify/If-Modify-Since**\n\n浏览器第一次请求一个资源的时候，服务器返回的header中会加上Last-Modify，Last-modify是一个**时间标识**该资源的最后修改时间，例如 `Last-Modify: Thu,31 Dec 2037 23:59:59 GMT`。\n\n当浏览器再次请求该资源时，request的请求头中会包含If-Modify-Since，该值为缓存之前返回的Last-Modify。服务器收到If-Modify-Since后，根据资源的最后修改时间判断是否命中缓存。\n\n如果命中缓存，则返回304，并且不会返回资源内容，并且不会返回Last-Modify。\n\n**ETag/If-None-Match**\n\n与Last-Modify/If-Modify-Since不同的是，Etag/If-None-Match返回的是一个**校验码**。ETag可以保证每一个资源是唯一的，资源变化都会导致ETag变化。服务器根据浏览器上送的If-None-Match值来判断是否命中缓存。\n\n与Last-Modified不一样的是，当服务器返回304 Not Modified的响应时，由于ETag重新生成过，response header中还会把这个ETag返回，即使这个ETag跟之前的没有变化。\n\n**为什么要有Etag？**\n\n你可能会觉得使用Last-Modified已经足以让浏览器知道本地的缓存副本是否足够新，为什么还需要Etag呢？ HTTP1.1中Etag的出现主要是为了解决几个Last-Modified比较难解决的问题：\n\n- 一些文件也许会周期性的更改，但是他的内容并不改变(仅仅改变的修改时间)，这个时候我们并不希望客户端认为这个文件被修改了，而重新GET；\n- 某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说1s内修改了N次)，If-Modified-Since能检查到的粒度是s级的，这种修改无法判断(或者说UNIX记录MTIME只能精确到秒)；\n- 某些服务器不能精确的得到文件的最后修改时间。\n\n**Last-Modified与ETag是可以一起使用的，服务器会优先验证ETag，一致的情况下，才会继续比对Last-Modified，最后才决定是否返回304。**\n\n强缓存与协商缓存的区别可以用下表来表示：\n\n| 缓存类型 | 获取资源形式 | 状态码              | 发送请求到服务器                 |\n| -------- | ------------ | ------------------- | -------------------------------- |\n| 强缓存   | 从缓存取     | 200（from cache）   | 否，直接从缓存取                 |\n| 协商缓存 | 从缓存取     | 304（Not Modified） | 是，通过服务器来告知缓存是否可用 |\n\n\n\n\n## 用户行为对缓存的影响\n\n| 用户操作        | Expires/Cache-Control | Last-Modied/Etag |\n| --------------- | --------------------- | ---------------- |\n| 地址栏回车      | 有效                  | 有效             |\n| 页面链接跳转    | 有效                  | 有效             |\n| 新开窗口        | 有效                  | 有效             |\n| 前进回退        | 有效                  | 有效             |\n| F5刷新          | 无效                  | 有效             |\n| Ctrl+F5强制刷新 | 无效                  | 无效             |\n\n\n\n## 实际问题分析\n\n 代码更新到线上后用户浏览器不能自行更新，我们不能要求客户在系统更新后都进行一次缓存清理的操作。\n\n解决：\n\n在资源请求的URL中增加一个参数，比如： `js/main. js?ver=0.7.1`。这个参数是一个版本号，每一次部署的时候变更一下，当这个参数变化的时候，强缓存都会失效并重新加载。这样一来，静态资源，部署以后就需要重新加载。这样就比较完美的解决了问题。","slug":"browser-cache","published":1,"updated":"2023-02-18T02:36:53.511Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshh000fyt8wamb23mh0","content":"<p>浏览器缓存（Brower Caching）是浏览器在本地磁盘对用户最近请求过的文档进行存储，当访问者再次访问同一页面时，浏览器就可以直接从本地磁盘加载文档。</p>\n<p>浏览器缓存的优点有：</p>\n<ul>\n<li>减少了冗余的数据传输，节省了网费</li>\n<li>减少了服务器的负担，大大提升了网站的性能</li>\n<li>加快了客户端加载网页的速度</li>\n</ul>\n<h2 id=\"浏览器缓存分类\"><a href=\"#浏览器缓存分类\" class=\"headerlink\" title=\"浏览器缓存分类\"></a>浏览器缓存分类</h2><p>浏览器缓存主要有两类：缓存协商和强缓存。</p>\n<p>浏览器在第一次请求发生后，再次请求时：</p>\n<ol>\n<li><p>浏览器会先获取该资源缓存的header信息，根据其中的<strong>expires</strong>和<strong>cahe-control</strong>判断是否命中强缓存，若命中则直接从缓存中获取资源，包括缓存的header信息，本次请求不会与服务器进行通信；</p>\n</li>\n<li><p>如果没有命中强缓存，浏览器会发送请求到服务器，该请求会携带第一次请求返回的有关缓存的header字段信息（<strong>Last-Modified&#x2F;IF-Modified-Since、Etag&#x2F;IF-None-Match</strong>）,由<strong>服务器</strong>根据请求中的相关header信息来对比结果是否命中协商缓存，若命中，则服务器返回新的响应header信息更新缓存中的对应header信息，但是并不返回资源内容，它会告知浏览器可以直接从缓存获取；否则返回最新的资源内容</p>\n</li>\n</ol>\n<h3 id=\"强缓存\"><a href=\"#强缓存\" class=\"headerlink\" title=\"强缓存\"></a>强缓存</h3><p>强缓存是利用http的返回头中的Expires或者Cache-Control两个字段来控制的，用来表示资源的缓存时间。</p>\n<ul>\n<li><p>Expires<br>该字段是http1.0时的规范，它的值为一个绝对时间的GMT格式的时间字符串，比如 <code>Expires:Mon,18 Oct 2066 23:59:59 GMT</code>。这个时间代表着这个资源的失效时间，在此时间之前，即命中缓存。这种方式有一个明显的缺点，由于失效时间是一个绝对时间，所以当服务器与客户端时间偏差较大时，就会导致缓存混乱。</p>\n</li>\n<li><p>Cache-Control<br>Cache-Control是http1.1时出现的header信息，主要是利用该字段的max-age值来进行判断，它是一个相对时间，例如 <code>Cache-Control:max-age=3600</code>，代表着资源的有效期是3600秒。</p>\n</li>\n</ul>\n<p>Cache-Control与Expires可以在服务端配置同时启用，同时启用的时候Cache-Control优先级高。</p>\n<h3 id=\"协商缓存\"><a href=\"#协商缓存\" class=\"headerlink\" title=\"协商缓存\"></a>协商缓存</h3><p>协商缓存就是由服务器来确定缓存资源是否可用，所以客户端与服务器端要通过某种标识来进行通信，从而让服务器判断请求资源是否可以缓存访问，这主要涉及到下面两组header字段，这两组搭档都是成对出现的，即第一次请求的响应头带上某个字段（Last-Modified或者Etag），则后续请求则会带上对应的请求字段（If-Modified-Since或者If-None-Match），若响应头没有Last-Modified或者Etag字段，则请求头也不会有对应的字段。</p>\n<p><strong>Last-Modify&#x2F;If-Modify-Since</strong></p>\n<p>浏览器第一次请求一个资源的时候，服务器返回的header中会加上Last-Modify，Last-modify是一个<strong>时间标识</strong>该资源的最后修改时间，例如 <code>Last-Modify: Thu,31 Dec 2037 23:59:59 GMT</code>。</p>\n<p>当浏览器再次请求该资源时，request的请求头中会包含If-Modify-Since，该值为缓存之前返回的Last-Modify。服务器收到If-Modify-Since后，根据资源的最后修改时间判断是否命中缓存。</p>\n<p>如果命中缓存，则返回304，并且不会返回资源内容，并且不会返回Last-Modify。</p>\n<p><strong>ETag&#x2F;If-None-Match</strong></p>\n<p>与Last-Modify&#x2F;If-Modify-Since不同的是，Etag&#x2F;If-None-Match返回的是一个<strong>校验码</strong>。ETag可以保证每一个资源是唯一的，资源变化都会导致ETag变化。服务器根据浏览器上送的If-None-Match值来判断是否命中缓存。</p>\n<p>与Last-Modified不一样的是，当服务器返回304 Not Modified的响应时，由于ETag重新生成过，response header中还会把这个ETag返回，即使这个ETag跟之前的没有变化。</p>\n<p><strong>为什么要有Etag？</strong></p>\n<p>你可能会觉得使用Last-Modified已经足以让浏览器知道本地的缓存副本是否足够新，为什么还需要Etag呢？ HTTP1.1中Etag的出现主要是为了解决几个Last-Modified比较难解决的问题：</p>\n<ul>\n<li>一些文件也许会周期性的更改，但是他的内容并不改变(仅仅改变的修改时间)，这个时候我们并不希望客户端认为这个文件被修改了，而重新GET；</li>\n<li>某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说1s内修改了N次)，If-Modified-Since能检查到的粒度是s级的，这种修改无法判断(或者说UNIX记录MTIME只能精确到秒)；</li>\n<li>某些服务器不能精确的得到文件的最后修改时间。</li>\n</ul>\n<p><strong>Last-Modified与ETag是可以一起使用的，服务器会优先验证ETag，一致的情况下，才会继续比对Last-Modified，最后才决定是否返回304。</strong></p>\n<p>强缓存与协商缓存的区别可以用下表来表示：</p>\n<table>\n<thead>\n<tr>\n<th>缓存类型</th>\n<th>获取资源形式</th>\n<th>状态码</th>\n<th>发送请求到服务器</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>强缓存</td>\n<td>从缓存取</td>\n<td>200（from cache）</td>\n<td>否，直接从缓存取</td>\n</tr>\n<tr>\n<td>协商缓存</td>\n<td>从缓存取</td>\n<td>304（Not Modified）</td>\n<td>是，通过服务器来告知缓存是否可用</td>\n</tr>\n</tbody></table>\n<h2 id=\"用户行为对缓存的影响\"><a href=\"#用户行为对缓存的影响\" class=\"headerlink\" title=\"用户行为对缓存的影响\"></a>用户行为对缓存的影响</h2><table>\n<thead>\n<tr>\n<th>用户操作</th>\n<th>Expires&#x2F;Cache-Control</th>\n<th>Last-Modied&#x2F;Etag</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>地址栏回车</td>\n<td>有效</td>\n<td>有效</td>\n</tr>\n<tr>\n<td>页面链接跳转</td>\n<td>有效</td>\n<td>有效</td>\n</tr>\n<tr>\n<td>新开窗口</td>\n<td>有效</td>\n<td>有效</td>\n</tr>\n<tr>\n<td>前进回退</td>\n<td>有效</td>\n<td>有效</td>\n</tr>\n<tr>\n<td>F5刷新</td>\n<td>无效</td>\n<td>有效</td>\n</tr>\n<tr>\n<td>Ctrl+F5强制刷新</td>\n<td>无效</td>\n<td>无效</td>\n</tr>\n</tbody></table>\n<h2 id=\"实际问题分析\"><a href=\"#实际问题分析\" class=\"headerlink\" title=\"实际问题分析\"></a>实际问题分析</h2><p> 代码更新到线上后用户浏览器不能自行更新，我们不能要求客户在系统更新后都进行一次缓存清理的操作。</p>\n<p>解决：</p>\n<p>在资源请求的URL中增加一个参数，比如： <code>js/main. js?ver=0.7.1</code>。这个参数是一个版本号，每一次部署的时候变更一下，当这个参数变化的时候，强缓存都会失效并重新加载。这样一来，静态资源，部署以后就需要重新加载。这样就比较完美的解决了问题。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>浏览器缓存（Brower Caching）是浏览器在本地磁盘对用户最近请求过的文档进行存储，当访问者再次访问同一页面时，浏览器就可以直接从本地磁盘加载文档。</p>\n<p>浏览器缓存的优点有：</p>\n<ul>\n<li>减少了冗余的数据传输，节省了网费</li>\n<li>减少了服务器的负担，大大提升了网站的性能</li>\n<li>加快了客户端加载网页的速度</li>\n</ul>\n<h2 id=\"浏览器缓存分类\"><a href=\"#浏览器缓存分类\" class=\"headerlink\" title=\"浏览器缓存分类\"></a>浏览器缓存分类</h2><p>浏览器缓存主要有两类：缓存协商和强缓存。</p>\n<p>浏览器在第一次请求发生后，再次请求时：</p>\n<ol>\n<li><p>浏览器会先获取该资源缓存的header信息，根据其中的<strong>expires</strong>和<strong>cahe-control</strong>判断是否命中强缓存，若命中则直接从缓存中获取资源，包括缓存的header信息，本次请求不会与服务器进行通信；</p>\n</li>\n<li><p>如果没有命中强缓存，浏览器会发送请求到服务器，该请求会携带第一次请求返回的有关缓存的header字段信息（<strong>Last-Modified&#x2F;IF-Modified-Since、Etag&#x2F;IF-None-Match</strong>）,由<strong>服务器</strong>根据请求中的相关header信息来对比结果是否命中协商缓存，若命中，则服务器返回新的响应header信息更新缓存中的对应header信息，但是并不返回资源内容，它会告知浏览器可以直接从缓存获取；否则返回最新的资源内容</p>\n</li>\n</ol>\n<h3 id=\"强缓存\"><a href=\"#强缓存\" class=\"headerlink\" title=\"强缓存\"></a>强缓存</h3><p>强缓存是利用http的返回头中的Expires或者Cache-Control两个字段来控制的，用来表示资源的缓存时间。</p>\n<ul>\n<li><p>Expires<br>该字段是http1.0时的规范，它的值为一个绝对时间的GMT格式的时间字符串，比如 <code>Expires:Mon,18 Oct 2066 23:59:59 GMT</code>。这个时间代表着这个资源的失效时间，在此时间之前，即命中缓存。这种方式有一个明显的缺点，由于失效时间是一个绝对时间，所以当服务器与客户端时间偏差较大时，就会导致缓存混乱。</p>\n</li>\n<li><p>Cache-Control<br>Cache-Control是http1.1时出现的header信息，主要是利用该字段的max-age值来进行判断，它是一个相对时间，例如 <code>Cache-Control:max-age=3600</code>，代表着资源的有效期是3600秒。</p>\n</li>\n</ul>\n<p>Cache-Control与Expires可以在服务端配置同时启用，同时启用的时候Cache-Control优先级高。</p>\n<h3 id=\"协商缓存\"><a href=\"#协商缓存\" class=\"headerlink\" title=\"协商缓存\"></a>协商缓存</h3><p>协商缓存就是由服务器来确定缓存资源是否可用，所以客户端与服务器端要通过某种标识来进行通信，从而让服务器判断请求资源是否可以缓存访问，这主要涉及到下面两组header字段，这两组搭档都是成对出现的，即第一次请求的响应头带上某个字段（Last-Modified或者Etag），则后续请求则会带上对应的请求字段（If-Modified-Since或者If-None-Match），若响应头没有Last-Modified或者Etag字段，则请求头也不会有对应的字段。</p>\n<p><strong>Last-Modify&#x2F;If-Modify-Since</strong></p>\n<p>浏览器第一次请求一个资源的时候，服务器返回的header中会加上Last-Modify，Last-modify是一个<strong>时间标识</strong>该资源的最后修改时间，例如 <code>Last-Modify: Thu,31 Dec 2037 23:59:59 GMT</code>。</p>\n<p>当浏览器再次请求该资源时，request的请求头中会包含If-Modify-Since，该值为缓存之前返回的Last-Modify。服务器收到If-Modify-Since后，根据资源的最后修改时间判断是否命中缓存。</p>\n<p>如果命中缓存，则返回304，并且不会返回资源内容，并且不会返回Last-Modify。</p>\n<p><strong>ETag&#x2F;If-None-Match</strong></p>\n<p>与Last-Modify&#x2F;If-Modify-Since不同的是，Etag&#x2F;If-None-Match返回的是一个<strong>校验码</strong>。ETag可以保证每一个资源是唯一的，资源变化都会导致ETag变化。服务器根据浏览器上送的If-None-Match值来判断是否命中缓存。</p>\n<p>与Last-Modified不一样的是，当服务器返回304 Not Modified的响应时，由于ETag重新生成过，response header中还会把这个ETag返回，即使这个ETag跟之前的没有变化。</p>\n<p><strong>为什么要有Etag？</strong></p>\n<p>你可能会觉得使用Last-Modified已经足以让浏览器知道本地的缓存副本是否足够新，为什么还需要Etag呢？ HTTP1.1中Etag的出现主要是为了解决几个Last-Modified比较难解决的问题：</p>\n<ul>\n<li>一些文件也许会周期性的更改，但是他的内容并不改变(仅仅改变的修改时间)，这个时候我们并不希望客户端认为这个文件被修改了，而重新GET；</li>\n<li>某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说1s内修改了N次)，If-Modified-Since能检查到的粒度是s级的，这种修改无法判断(或者说UNIX记录MTIME只能精确到秒)；</li>\n<li>某些服务器不能精确的得到文件的最后修改时间。</li>\n</ul>\n<p><strong>Last-Modified与ETag是可以一起使用的，服务器会优先验证ETag，一致的情况下，才会继续比对Last-Modified，最后才决定是否返回304。</strong></p>\n<p>强缓存与协商缓存的区别可以用下表来表示：</p>\n<table>\n<thead>\n<tr>\n<th>缓存类型</th>\n<th>获取资源形式</th>\n<th>状态码</th>\n<th>发送请求到服务器</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>强缓存</td>\n<td>从缓存取</td>\n<td>200（from cache）</td>\n<td>否，直接从缓存取</td>\n</tr>\n<tr>\n<td>协商缓存</td>\n<td>从缓存取</td>\n<td>304（Not Modified）</td>\n<td>是，通过服务器来告知缓存是否可用</td>\n</tr>\n</tbody></table>\n<h2 id=\"用户行为对缓存的影响\"><a href=\"#用户行为对缓存的影响\" class=\"headerlink\" title=\"用户行为对缓存的影响\"></a>用户行为对缓存的影响</h2><table>\n<thead>\n<tr>\n<th>用户操作</th>\n<th>Expires&#x2F;Cache-Control</th>\n<th>Last-Modied&#x2F;Etag</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>地址栏回车</td>\n<td>有效</td>\n<td>有效</td>\n</tr>\n<tr>\n<td>页面链接跳转</td>\n<td>有效</td>\n<td>有效</td>\n</tr>\n<tr>\n<td>新开窗口</td>\n<td>有效</td>\n<td>有效</td>\n</tr>\n<tr>\n<td>前进回退</td>\n<td>有效</td>\n<td>有效</td>\n</tr>\n<tr>\n<td>F5刷新</td>\n<td>无效</td>\n<td>有效</td>\n</tr>\n<tr>\n<td>Ctrl+F5强制刷新</td>\n<td>无效</td>\n<td>无效</td>\n</tr>\n</tbody></table>\n<h2 id=\"实际问题分析\"><a href=\"#实际问题分析\" class=\"headerlink\" title=\"实际问题分析\"></a>实际问题分析</h2><p> 代码更新到线上后用户浏览器不能自行更新，我们不能要求客户在系统更新后都进行一次缓存清理的操作。</p>\n<p>解决：</p>\n<p>在资源请求的URL中增加一个参数，比如： <code>js/main. js?ver=0.7.1</code>。这个参数是一个版本号，每一次部署的时候变更一下，当这个参数变化的时候，强缓存都会失效并重新加载。这样一来，静态资源，部署以后就需要重新加载。这样就比较完美的解决了问题。</p>\n"},{"title":"Canvas 与 SVG","date":"2022-05-03T16:27:24.000Z","description":"Canvas 和 SVG 都允许您在浏览器中创建图形，但是它们在根本上是不同的。","_content":"\n> Canvas 和 SVG 都允许您在浏览器中创建图形，但是它们在根本上是不同的。\n\n## Canvas\n\n> Canvas API 提供了一个通过 JavaScript 和 HTML的 `<canvas>`元素来绘制图形的方式。它可以用于动画、游戏画面、数据可视化、图片编辑以及实时视频处理等方面。\n\n### 简介\n\n+ `HTML5 <canvas>` 元素用于图形的绘制，通过脚本 （通常是JavaScript）来完成；\n+ `<canvas>` 标签只是图形容器，必须使用脚本来绘制图形；\n+ 浏览器支持：Internet Explorer 9+, Firefox, Opera, Chrome, 和 Safari ；\n+ Canvas 坐标：canvas 是一个二维网格，左上角坐标为 (0,0)。\n\n实例：\n\n```js\n// 1. 获取HTML canvas 元素的引用\nconst canvas = document.getElementById('canvas');\n// 2. 方法获取这个元素的context——图像稍后将在此被渲染。\nconst ctx = canvas.getContext('2d');\n// 由 CanvasRenderingContext2D 接口完成实际的绘制。\n// 3. fillStyle 属性让长方形变成绿色。\nctx.fillStyle = 'green';\n// 4. 将它的左上角放在(10, 10)，把它的大小设置成宽150高100。\nctx.fillRect(10, 10, 150, 100);\n```\n\n### Canvas路径\n\n在Canvas上**画线**，我们将使用以下两种方法：\n\n- `moveTo(x,y)` 定义线条开始坐标\n- `lineTo(x,y)` 定义线条结束坐标\n\n实例：\n\n```js\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\nctx.moveTo(0,0);\nctx.lineTo(200,100);\nctx.stroke();\n```\n\n在canvas中**绘制圆形**, 我们将使用以下方法:\n\n- `arc(x,y,r,start,stop)`\n\n实例：\n\n```js\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\nctx.beginPath();\nctx.arc(95,50,40,0,2*Math.PI);\nctx.stroke();\n```\n\n### Canvas文本\n\n使用 canvas 绘制文本，重要的属性和方法如下：\n\n- font - 定义字体\n- `fillText(text,x,y)` - 在 canvas 上绘制实心的文本\n- `strokeText(text,x,y)` - 在 canvas 上绘制空心的文本\n\n实例：\n\n```js\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\nctx.font = \"30px Arial\";\nctx.fillText(\"Hello World\",10,50);\n```\n\n### Canvas渐变\n\n渐变可以填充在矩形, 圆形, 线条, 文本等等, 各种形状可以自己定义不同的颜色。\n\n以下有两种不同的方式来设置Canvas渐变：\n\n- `createLinearGradient(x,y,x1,y1)` - 创建线条渐变\n- `createRadialGradient(x,y,r,x1,y1,r1)` - 创建一个径向/圆渐变\n\n当我们使用渐变对象，必须使用两种或两种以上的停止颜色。\n\n`addColorStop()` 方法指定颜色停止，参数使用坐标来描述，可以是0至1。\n\n使用渐变，设置fillStyle或strokeStyle的值为 渐变，然后绘制形状，如矩形，文本，或一条线。\n\n实例：\n\n```js\n// 线性渐变\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\n\n// Create gradient\nvar grd = ctx.createLinearGradient(0,0,200,0);\ngrd.addColorStop(0,\"red\");\ngrd.addColorStop(1,\"white\");\n\n// Fill with gradient\nctx.fillStyle = grd;\nctx.fillRect(10,10,150,80);\n```\n\n```js\n// 圆渐变\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\n\n// Create gradient\nvar grd = ctx.createRadialGradient(75,50,5,90,60,100);\ngrd.addColorStop(0,\"red\");\ngrd.addColorStop(1,\"white\");\n\n// Fill with gradient\nctx.fillStyle = grd;\nctx.fillRect(10,10,150,80);\n```\n\n### Canvas图像\n\n把一幅图像放置到画布上, 使用以下方法:\n\n+ `drawImage(image,x,y)`\n\n实例：\n\n```js\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\nvar img = document.getElementById(\"scream\");\n\nimg.onload = function() {\n\tctx.drawImage(img,10,10);\n} \n```\n\n\n\n## SVG\n\n> 可缩放矢量图形（Scalable Vector Graphics，SVG），是一种用于描述二维的矢量图形，基于 XML 的标记语言。\n\n### 什么是SVG？\n\n+ SVG 指可伸缩矢量图形 (Scalable Vector Graphics)\n+ SVG 用于定义用于网络的基于矢量的图形\n+ SVG 使用 XML 格式定义图形\n+ SVG 图像在放大或改变尺寸的情况下其图形质量不会有损失\n+ SVG 是万维网联盟的标准\n+ 浏览器支持：Internet Explorer 9+, Firefox, Opera, Chrome, 和 Safari\n\n示例：\n\n```html\n<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" height=\"190\">\n   <polygon points=\"100,10 40,180 190,60 10,60 160,180\"\n   style=\"fill:lime;stroke:purple;stroke-width:5;fill-rule:evenodd;\">\n</svg>\n```\n\n### SVG优势\n\n与其他图像格式相比（比如 JPEG 和 GIF），使用 SVG 的优势在于：\n\n- SVG 图像可**通过文本编辑器来创建和修改**；\n- SVG 图像可被**搜索**、索引、脚本化或压缩；\n- SVG 是**可伸缩**的；\n- SVG 图像可在**任何的分辨率下被高质量地打印**；\n- SVG 可在**图像质量不下降**的情况下被放大；\n\n\n\n## SVG 与 Canvas两者间的区别\n\n+ SVG 是一种使用 XML 描述 2D 图形的语言；Canvas 通过 JavaScript 来绘制 2D 图形。\n+ SVG 基于 XML，这意味着 SVG DOM 中的每个元素都是可用的。您可以为某个元素附加 JavaScript 事件处理器。\n+ 在 SVG 中，每个被绘制的图形均被视为对象。如果 SVG 对象的属性发生变化，那么浏览器能够自动重现图形。\n+ Canvas 是逐像素进行渲染的。在 canvas 中，一旦图形被绘制完成，它就不会继续得到浏览器的关注。如果其位置发生变化，那么整个场景也需要重新绘制，包括任何或许已被图形覆盖的对象。\n\n| **Canvas**                                         | **SVG**                                                 |\n| -------------------------------------------------- | ------------------------------------------------------- |\n| 依赖分辨率                                         | 不依赖分辨率                                            |\n| 不支持事件处理器                                   | 支持事件处理器                                          |\n| 弱的文本渲染能力                                   | 最适合带有大型渲染区域的应用程序（比如谷歌地图）        |\n| 能够以 .png 或 .jpg 格式保存结果图像               | 复杂度高会减慢渲染速度（任何过度使用 DOM 的应用都不快） |\n| 最适合图像密集型的游戏，其中的许多对象会被频繁重绘 | 不适合游戏应用                                          |\n\n","source":"_posts/canvas-svg.md","raw":"---\ntitle: Canvas 与 SVG\ndate: 2022-05-04 00:27:24\ntags:\ncategories: JavaScript\ndescription: Canvas 和 SVG 都允许您在浏览器中创建图形，但是它们在根本上是不同的。\n---\n\n> Canvas 和 SVG 都允许您在浏览器中创建图形，但是它们在根本上是不同的。\n\n## Canvas\n\n> Canvas API 提供了一个通过 JavaScript 和 HTML的 `<canvas>`元素来绘制图形的方式。它可以用于动画、游戏画面、数据可视化、图片编辑以及实时视频处理等方面。\n\n### 简介\n\n+ `HTML5 <canvas>` 元素用于图形的绘制，通过脚本 （通常是JavaScript）来完成；\n+ `<canvas>` 标签只是图形容器，必须使用脚本来绘制图形；\n+ 浏览器支持：Internet Explorer 9+, Firefox, Opera, Chrome, 和 Safari ；\n+ Canvas 坐标：canvas 是一个二维网格，左上角坐标为 (0,0)。\n\n实例：\n\n```js\n// 1. 获取HTML canvas 元素的引用\nconst canvas = document.getElementById('canvas');\n// 2. 方法获取这个元素的context——图像稍后将在此被渲染。\nconst ctx = canvas.getContext('2d');\n// 由 CanvasRenderingContext2D 接口完成实际的绘制。\n// 3. fillStyle 属性让长方形变成绿色。\nctx.fillStyle = 'green';\n// 4. 将它的左上角放在(10, 10)，把它的大小设置成宽150高100。\nctx.fillRect(10, 10, 150, 100);\n```\n\n### Canvas路径\n\n在Canvas上**画线**，我们将使用以下两种方法：\n\n- `moveTo(x,y)` 定义线条开始坐标\n- `lineTo(x,y)` 定义线条结束坐标\n\n实例：\n\n```js\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\nctx.moveTo(0,0);\nctx.lineTo(200,100);\nctx.stroke();\n```\n\n在canvas中**绘制圆形**, 我们将使用以下方法:\n\n- `arc(x,y,r,start,stop)`\n\n实例：\n\n```js\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\nctx.beginPath();\nctx.arc(95,50,40,0,2*Math.PI);\nctx.stroke();\n```\n\n### Canvas文本\n\n使用 canvas 绘制文本，重要的属性和方法如下：\n\n- font - 定义字体\n- `fillText(text,x,y)` - 在 canvas 上绘制实心的文本\n- `strokeText(text,x,y)` - 在 canvas 上绘制空心的文本\n\n实例：\n\n```js\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\nctx.font = \"30px Arial\";\nctx.fillText(\"Hello World\",10,50);\n```\n\n### Canvas渐变\n\n渐变可以填充在矩形, 圆形, 线条, 文本等等, 各种形状可以自己定义不同的颜色。\n\n以下有两种不同的方式来设置Canvas渐变：\n\n- `createLinearGradient(x,y,x1,y1)` - 创建线条渐变\n- `createRadialGradient(x,y,r,x1,y1,r1)` - 创建一个径向/圆渐变\n\n当我们使用渐变对象，必须使用两种或两种以上的停止颜色。\n\n`addColorStop()` 方法指定颜色停止，参数使用坐标来描述，可以是0至1。\n\n使用渐变，设置fillStyle或strokeStyle的值为 渐变，然后绘制形状，如矩形，文本，或一条线。\n\n实例：\n\n```js\n// 线性渐变\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\n\n// Create gradient\nvar grd = ctx.createLinearGradient(0,0,200,0);\ngrd.addColorStop(0,\"red\");\ngrd.addColorStop(1,\"white\");\n\n// Fill with gradient\nctx.fillStyle = grd;\nctx.fillRect(10,10,150,80);\n```\n\n```js\n// 圆渐变\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\n\n// Create gradient\nvar grd = ctx.createRadialGradient(75,50,5,90,60,100);\ngrd.addColorStop(0,\"red\");\ngrd.addColorStop(1,\"white\");\n\n// Fill with gradient\nctx.fillStyle = grd;\nctx.fillRect(10,10,150,80);\n```\n\n### Canvas图像\n\n把一幅图像放置到画布上, 使用以下方法:\n\n+ `drawImage(image,x,y)`\n\n实例：\n\n```js\nvar c = document.getElementById(\"myCanvas\");\nvar ctx = c.getContext(\"2d\");\nvar img = document.getElementById(\"scream\");\n\nimg.onload = function() {\n\tctx.drawImage(img,10,10);\n} \n```\n\n\n\n## SVG\n\n> 可缩放矢量图形（Scalable Vector Graphics，SVG），是一种用于描述二维的矢量图形，基于 XML 的标记语言。\n\n### 什么是SVG？\n\n+ SVG 指可伸缩矢量图形 (Scalable Vector Graphics)\n+ SVG 用于定义用于网络的基于矢量的图形\n+ SVG 使用 XML 格式定义图形\n+ SVG 图像在放大或改变尺寸的情况下其图形质量不会有损失\n+ SVG 是万维网联盟的标准\n+ 浏览器支持：Internet Explorer 9+, Firefox, Opera, Chrome, 和 Safari\n\n示例：\n\n```html\n<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" height=\"190\">\n   <polygon points=\"100,10 40,180 190,60 10,60 160,180\"\n   style=\"fill:lime;stroke:purple;stroke-width:5;fill-rule:evenodd;\">\n</svg>\n```\n\n### SVG优势\n\n与其他图像格式相比（比如 JPEG 和 GIF），使用 SVG 的优势在于：\n\n- SVG 图像可**通过文本编辑器来创建和修改**；\n- SVG 图像可被**搜索**、索引、脚本化或压缩；\n- SVG 是**可伸缩**的；\n- SVG 图像可在**任何的分辨率下被高质量地打印**；\n- SVG 可在**图像质量不下降**的情况下被放大；\n\n\n\n## SVG 与 Canvas两者间的区别\n\n+ SVG 是一种使用 XML 描述 2D 图形的语言；Canvas 通过 JavaScript 来绘制 2D 图形。\n+ SVG 基于 XML，这意味着 SVG DOM 中的每个元素都是可用的。您可以为某个元素附加 JavaScript 事件处理器。\n+ 在 SVG 中，每个被绘制的图形均被视为对象。如果 SVG 对象的属性发生变化，那么浏览器能够自动重现图形。\n+ Canvas 是逐像素进行渲染的。在 canvas 中，一旦图形被绘制完成，它就不会继续得到浏览器的关注。如果其位置发生变化，那么整个场景也需要重新绘制，包括任何或许已被图形覆盖的对象。\n\n| **Canvas**                                         | **SVG**                                                 |\n| -------------------------------------------------- | ------------------------------------------------------- |\n| 依赖分辨率                                         | 不依赖分辨率                                            |\n| 不支持事件处理器                                   | 支持事件处理器                                          |\n| 弱的文本渲染能力                                   | 最适合带有大型渲染区域的应用程序（比如谷歌地图）        |\n| 能够以 .png 或 .jpg 格式保存结果图像               | 复杂度高会减慢渲染速度（任何过度使用 DOM 的应用都不快） |\n| 最适合图像密集型的游戏，其中的许多对象会被频繁重绘 | 不适合游戏应用                                          |\n\n","slug":"canvas-svg","published":1,"updated":"2022-05-10T16:21:12.144Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshi000gyt8w9d5w4lkk","content":"<blockquote>\n<p>Canvas 和 SVG 都允许您在浏览器中创建图形，但是它们在根本上是不同的。</p>\n</blockquote>\n<h2 id=\"Canvas\"><a href=\"#Canvas\" class=\"headerlink\" title=\"Canvas\"></a>Canvas</h2><blockquote>\n<p>Canvas API 提供了一个通过 JavaScript 和 HTML的 <code>&lt;canvas&gt;</code>元素来绘制图形的方式。它可以用于动画、游戏画面、数据可视化、图片编辑以及实时视频处理等方面。</p>\n</blockquote>\n<h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><ul>\n<li><code>HTML5 &lt;canvas&gt;</code> 元素用于图形的绘制，通过脚本 （通常是JavaScript）来完成；</li>\n<li><code>&lt;canvas&gt;</code> 标签只是图形容器，必须使用脚本来绘制图形；</li>\n<li>浏览器支持：Internet Explorer 9+, Firefox, Opera, Chrome, 和 Safari ；</li>\n<li>Canvas 坐标：canvas 是一个二维网格，左上角坐标为 (0,0)。</li>\n</ul>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1. 获取HTML canvas 元素的引用</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;canvas&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 2. 方法获取这个元素的context——图像稍后将在此被渲染。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> ctx = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 由 CanvasRenderingContext2D 接口完成实际的绘制。</span></span><br><span class=\"line\"><span class=\"comment\">// 3. fillStyle 属性让长方形变成绿色。</span></span><br><span class=\"line\">ctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;green&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// 4. 将它的左上角放在(10, 10)，把它的大小设置成宽150高100。</span></span><br><span class=\"line\">ctx.<span class=\"title function_\">fillRect</span>(<span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">150</span>, <span class=\"number\">100</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Canvas路径\"><a href=\"#Canvas路径\" class=\"headerlink\" title=\"Canvas路径\"></a>Canvas路径</h3><p>在Canvas上<strong>画线</strong>，我们将使用以下两种方法：</p>\n<ul>\n<li><code>moveTo(x,y)</code> 定义线条开始坐标</li>\n<li><code>lineTo(x,y)</code> 定义线条结束坐标</li>\n</ul>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\">ctx.<span class=\"title function_\">moveTo</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">ctx.<span class=\"title function_\">lineTo</span>(<span class=\"number\">200</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">ctx.<span class=\"title function_\">stroke</span>();</span><br></pre></td></tr></table></figure>\n\n<p>在canvas中<strong>绘制圆形</strong>, 我们将使用以下方法:</p>\n<ul>\n<li><code>arc(x,y,r,start,stop)</code></li>\n</ul>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\">ctx.<span class=\"title function_\">beginPath</span>();</span><br><span class=\"line\">ctx.<span class=\"title function_\">arc</span>(<span class=\"number\">95</span>,<span class=\"number\">50</span>,<span class=\"number\">40</span>,<span class=\"number\">0</span>,<span class=\"number\">2</span>*<span class=\"title class_\">Math</span>.<span class=\"property\">PI</span>);</span><br><span class=\"line\">ctx.<span class=\"title function_\">stroke</span>();</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Canvas文本\"><a href=\"#Canvas文本\" class=\"headerlink\" title=\"Canvas文本\"></a>Canvas文本</h3><p>使用 canvas 绘制文本，重要的属性和方法如下：</p>\n<ul>\n<li>font - 定义字体</li>\n<li><code>fillText(text,x,y)</code> - 在 canvas 上绘制实心的文本</li>\n<li><code>strokeText(text,x,y)</code> - 在 canvas 上绘制空心的文本</li>\n</ul>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\">ctx.<span class=\"property\">font</span> = <span class=\"string\">&quot;30px Arial&quot;</span>;</span><br><span class=\"line\">ctx.<span class=\"title function_\">fillText</span>(<span class=\"string\">&quot;Hello World&quot;</span>,<span class=\"number\">10</span>,<span class=\"number\">50</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Canvas渐变\"><a href=\"#Canvas渐变\" class=\"headerlink\" title=\"Canvas渐变\"></a>Canvas渐变</h3><p>渐变可以填充在矩形, 圆形, 线条, 文本等等, 各种形状可以自己定义不同的颜色。</p>\n<p>以下有两种不同的方式来设置Canvas渐变：</p>\n<ul>\n<li><code>createLinearGradient(x,y,x1,y1)</code> - 创建线条渐变</li>\n<li><code>createRadialGradient(x,y,r,x1,y1,r1)</code> - 创建一个径向&#x2F;圆渐变</li>\n</ul>\n<p>当我们使用渐变对象，必须使用两种或两种以上的停止颜色。</p>\n<p><code>addColorStop()</code> 方法指定颜色停止，参数使用坐标来描述，可以是0至1。</p>\n<p>使用渐变，设置fillStyle或strokeStyle的值为 渐变，然后绘制形状，如矩形，文本，或一条线。</p>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 线性渐变</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Create gradient</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> grd = ctx.<span class=\"title function_\">createLinearGradient</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">200</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">grd.<span class=\"title function_\">addColorStop</span>(<span class=\"number\">0</span>,<span class=\"string\">&quot;red&quot;</span>);</span><br><span class=\"line\">grd.<span class=\"title function_\">addColorStop</span>(<span class=\"number\">1</span>,<span class=\"string\">&quot;white&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Fill with gradient</span></span><br><span class=\"line\">ctx.<span class=\"property\">fillStyle</span> = grd;</span><br><span class=\"line\">ctx.<span class=\"title function_\">fillRect</span>(<span class=\"number\">10</span>,<span class=\"number\">10</span>,<span class=\"number\">150</span>,<span class=\"number\">80</span>);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 圆渐变</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Create gradient</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> grd = ctx.<span class=\"title function_\">createRadialGradient</span>(<span class=\"number\">75</span>,<span class=\"number\">50</span>,<span class=\"number\">5</span>,<span class=\"number\">90</span>,<span class=\"number\">60</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">grd.<span class=\"title function_\">addColorStop</span>(<span class=\"number\">0</span>,<span class=\"string\">&quot;red&quot;</span>);</span><br><span class=\"line\">grd.<span class=\"title function_\">addColorStop</span>(<span class=\"number\">1</span>,<span class=\"string\">&quot;white&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Fill with gradient</span></span><br><span class=\"line\">ctx.<span class=\"property\">fillStyle</span> = grd;</span><br><span class=\"line\">ctx.<span class=\"title function_\">fillRect</span>(<span class=\"number\">10</span>,<span class=\"number\">10</span>,<span class=\"number\">150</span>,<span class=\"number\">80</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Canvas图像\"><a href=\"#Canvas图像\" class=\"headerlink\" title=\"Canvas图像\"></a>Canvas图像</h3><p>把一幅图像放置到画布上, 使用以下方法:</p>\n<ul>\n<li><code>drawImage(image,x,y)</code></li>\n</ul>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;scream&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">img.<span class=\"property\">onload</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\tctx.<span class=\"title function_\">drawImage</span>(img,<span class=\"number\">10</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"SVG\"><a href=\"#SVG\" class=\"headerlink\" title=\"SVG\"></a>SVG</h2><blockquote>\n<p>可缩放矢量图形（Scalable Vector Graphics，SVG），是一种用于描述二维的矢量图形，基于 XML 的标记语言。</p>\n</blockquote>\n<h3 id=\"什么是SVG？\"><a href=\"#什么是SVG？\" class=\"headerlink\" title=\"什么是SVG？\"></a>什么是SVG？</h3><ul>\n<li>SVG 指可伸缩矢量图形 (Scalable Vector Graphics)</li>\n<li>SVG 用于定义用于网络的基于矢量的图形</li>\n<li>SVG 使用 XML 格式定义图形</li>\n<li>SVG 图像在放大或改变尺寸的情况下其图形质量不会有损失</li>\n<li>SVG 是万维网联盟的标准</li>\n<li>浏览器支持：Internet Explorer 9+, Firefox, Opera, Chrome, 和 Safari</li>\n</ul>\n<p>示例：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"attr\">version</span>=<span class=\"string\">&quot;1.1&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;190&quot;</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">polygon</span> <span class=\"attr\">points</span>=<span class=\"string\">&quot;100,10 40,180 190,60 10,60 160,180&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">   <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill:lime;stroke:purple;stroke-width:5;fill-rule:evenodd;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SVG优势\"><a href=\"#SVG优势\" class=\"headerlink\" title=\"SVG优势\"></a>SVG优势</h3><p>与其他图像格式相比（比如 JPEG 和 GIF），使用 SVG 的优势在于：</p>\n<ul>\n<li>SVG 图像可<strong>通过文本编辑器来创建和修改</strong>；</li>\n<li>SVG 图像可被<strong>搜索</strong>、索引、脚本化或压缩；</li>\n<li>SVG 是<strong>可伸缩</strong>的；</li>\n<li>SVG 图像可在<strong>任何的分辨率下被高质量地打印</strong>；</li>\n<li>SVG 可在<strong>图像质量不下降</strong>的情况下被放大；</li>\n</ul>\n<h2 id=\"SVG-与-Canvas两者间的区别\"><a href=\"#SVG-与-Canvas两者间的区别\" class=\"headerlink\" title=\"SVG 与 Canvas两者间的区别\"></a>SVG 与 Canvas两者间的区别</h2><ul>\n<li>SVG 是一种使用 XML 描述 2D 图形的语言；Canvas 通过 JavaScript 来绘制 2D 图形。</li>\n<li>SVG 基于 XML，这意味着 SVG DOM 中的每个元素都是可用的。您可以为某个元素附加 JavaScript 事件处理器。</li>\n<li>在 SVG 中，每个被绘制的图形均被视为对象。如果 SVG 对象的属性发生变化，那么浏览器能够自动重现图形。</li>\n<li>Canvas 是逐像素进行渲染的。在 canvas 中，一旦图形被绘制完成，它就不会继续得到浏览器的关注。如果其位置发生变化，那么整个场景也需要重新绘制，包括任何或许已被图形覆盖的对象。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><strong>Canvas</strong></th>\n<th><strong>SVG</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>依赖分辨率</td>\n<td>不依赖分辨率</td>\n</tr>\n<tr>\n<td>不支持事件处理器</td>\n<td>支持事件处理器</td>\n</tr>\n<tr>\n<td>弱的文本渲染能力</td>\n<td>最适合带有大型渲染区域的应用程序（比如谷歌地图）</td>\n</tr>\n<tr>\n<td>能够以 .png 或 .jpg 格式保存结果图像</td>\n<td>复杂度高会减慢渲染速度（任何过度使用 DOM 的应用都不快）</td>\n</tr>\n<tr>\n<td>最适合图像密集型的游戏，其中的许多对象会被频繁重绘</td>\n<td>不适合游戏应用</td>\n</tr>\n</tbody></table>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Canvas 和 SVG 都允许您在浏览器中创建图形，但是它们在根本上是不同的。</p>\n</blockquote>\n<h2 id=\"Canvas\"><a href=\"#Canvas\" class=\"headerlink\" title=\"Canvas\"></a>Canvas</h2><blockquote>\n<p>Canvas API 提供了一个通过 JavaScript 和 HTML的 <code>&lt;canvas&gt;</code>元素来绘制图形的方式。它可以用于动画、游戏画面、数据可视化、图片编辑以及实时视频处理等方面。</p>\n</blockquote>\n<h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><ul>\n<li><code>HTML5 &lt;canvas&gt;</code> 元素用于图形的绘制，通过脚本 （通常是JavaScript）来完成；</li>\n<li><code>&lt;canvas&gt;</code> 标签只是图形容器，必须使用脚本来绘制图形；</li>\n<li>浏览器支持：Internet Explorer 9+, Firefox, Opera, Chrome, 和 Safari ；</li>\n<li>Canvas 坐标：canvas 是一个二维网格，左上角坐标为 (0,0)。</li>\n</ul>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1. 获取HTML canvas 元素的引用</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;canvas&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 2. 方法获取这个元素的context——图像稍后将在此被渲染。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> ctx = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 由 CanvasRenderingContext2D 接口完成实际的绘制。</span></span><br><span class=\"line\"><span class=\"comment\">// 3. fillStyle 属性让长方形变成绿色。</span></span><br><span class=\"line\">ctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;green&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// 4. 将它的左上角放在(10, 10)，把它的大小设置成宽150高100。</span></span><br><span class=\"line\">ctx.<span class=\"title function_\">fillRect</span>(<span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">150</span>, <span class=\"number\">100</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Canvas路径\"><a href=\"#Canvas路径\" class=\"headerlink\" title=\"Canvas路径\"></a>Canvas路径</h3><p>在Canvas上<strong>画线</strong>，我们将使用以下两种方法：</p>\n<ul>\n<li><code>moveTo(x,y)</code> 定义线条开始坐标</li>\n<li><code>lineTo(x,y)</code> 定义线条结束坐标</li>\n</ul>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\">ctx.<span class=\"title function_\">moveTo</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">ctx.<span class=\"title function_\">lineTo</span>(<span class=\"number\">200</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">ctx.<span class=\"title function_\">stroke</span>();</span><br></pre></td></tr></table></figure>\n\n<p>在canvas中<strong>绘制圆形</strong>, 我们将使用以下方法:</p>\n<ul>\n<li><code>arc(x,y,r,start,stop)</code></li>\n</ul>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\">ctx.<span class=\"title function_\">beginPath</span>();</span><br><span class=\"line\">ctx.<span class=\"title function_\">arc</span>(<span class=\"number\">95</span>,<span class=\"number\">50</span>,<span class=\"number\">40</span>,<span class=\"number\">0</span>,<span class=\"number\">2</span>*<span class=\"title class_\">Math</span>.<span class=\"property\">PI</span>);</span><br><span class=\"line\">ctx.<span class=\"title function_\">stroke</span>();</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Canvas文本\"><a href=\"#Canvas文本\" class=\"headerlink\" title=\"Canvas文本\"></a>Canvas文本</h3><p>使用 canvas 绘制文本，重要的属性和方法如下：</p>\n<ul>\n<li>font - 定义字体</li>\n<li><code>fillText(text,x,y)</code> - 在 canvas 上绘制实心的文本</li>\n<li><code>strokeText(text,x,y)</code> - 在 canvas 上绘制空心的文本</li>\n</ul>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\">ctx.<span class=\"property\">font</span> = <span class=\"string\">&quot;30px Arial&quot;</span>;</span><br><span class=\"line\">ctx.<span class=\"title function_\">fillText</span>(<span class=\"string\">&quot;Hello World&quot;</span>,<span class=\"number\">10</span>,<span class=\"number\">50</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Canvas渐变\"><a href=\"#Canvas渐变\" class=\"headerlink\" title=\"Canvas渐变\"></a>Canvas渐变</h3><p>渐变可以填充在矩形, 圆形, 线条, 文本等等, 各种形状可以自己定义不同的颜色。</p>\n<p>以下有两种不同的方式来设置Canvas渐变：</p>\n<ul>\n<li><code>createLinearGradient(x,y,x1,y1)</code> - 创建线条渐变</li>\n<li><code>createRadialGradient(x,y,r,x1,y1,r1)</code> - 创建一个径向&#x2F;圆渐变</li>\n</ul>\n<p>当我们使用渐变对象，必须使用两种或两种以上的停止颜色。</p>\n<p><code>addColorStop()</code> 方法指定颜色停止，参数使用坐标来描述，可以是0至1。</p>\n<p>使用渐变，设置fillStyle或strokeStyle的值为 渐变，然后绘制形状，如矩形，文本，或一条线。</p>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 线性渐变</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Create gradient</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> grd = ctx.<span class=\"title function_\">createLinearGradient</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">200</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">grd.<span class=\"title function_\">addColorStop</span>(<span class=\"number\">0</span>,<span class=\"string\">&quot;red&quot;</span>);</span><br><span class=\"line\">grd.<span class=\"title function_\">addColorStop</span>(<span class=\"number\">1</span>,<span class=\"string\">&quot;white&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Fill with gradient</span></span><br><span class=\"line\">ctx.<span class=\"property\">fillStyle</span> = grd;</span><br><span class=\"line\">ctx.<span class=\"title function_\">fillRect</span>(<span class=\"number\">10</span>,<span class=\"number\">10</span>,<span class=\"number\">150</span>,<span class=\"number\">80</span>);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 圆渐变</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Create gradient</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> grd = ctx.<span class=\"title function_\">createRadialGradient</span>(<span class=\"number\">75</span>,<span class=\"number\">50</span>,<span class=\"number\">5</span>,<span class=\"number\">90</span>,<span class=\"number\">60</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">grd.<span class=\"title function_\">addColorStop</span>(<span class=\"number\">0</span>,<span class=\"string\">&quot;red&quot;</span>);</span><br><span class=\"line\">grd.<span class=\"title function_\">addColorStop</span>(<span class=\"number\">1</span>,<span class=\"string\">&quot;white&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Fill with gradient</span></span><br><span class=\"line\">ctx.<span class=\"property\">fillStyle</span> = grd;</span><br><span class=\"line\">ctx.<span class=\"title function_\">fillRect</span>(<span class=\"number\">10</span>,<span class=\"number\">10</span>,<span class=\"number\">150</span>,<span class=\"number\">80</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Canvas图像\"><a href=\"#Canvas图像\" class=\"headerlink\" title=\"Canvas图像\"></a>Canvas图像</h3><p>把一幅图像放置到画布上, 使用以下方法:</p>\n<ul>\n<li><code>drawImage(image,x,y)</code></li>\n</ul>\n<p>实例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;myCanvas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = c.<span class=\"title function_\">getContext</span>(<span class=\"string\">&quot;2d&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;scream&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">img.<span class=\"property\">onload</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\tctx.<span class=\"title function_\">drawImage</span>(img,<span class=\"number\">10</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"SVG\"><a href=\"#SVG\" class=\"headerlink\" title=\"SVG\"></a>SVG</h2><blockquote>\n<p>可缩放矢量图形（Scalable Vector Graphics，SVG），是一种用于描述二维的矢量图形，基于 XML 的标记语言。</p>\n</blockquote>\n<h3 id=\"什么是SVG？\"><a href=\"#什么是SVG？\" class=\"headerlink\" title=\"什么是SVG？\"></a>什么是SVG？</h3><ul>\n<li>SVG 指可伸缩矢量图形 (Scalable Vector Graphics)</li>\n<li>SVG 用于定义用于网络的基于矢量的图形</li>\n<li>SVG 使用 XML 格式定义图形</li>\n<li>SVG 图像在放大或改变尺寸的情况下其图形质量不会有损失</li>\n<li>SVG 是万维网联盟的标准</li>\n<li>浏览器支持：Internet Explorer 9+, Firefox, Opera, Chrome, 和 Safari</li>\n</ul>\n<p>示例：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"attr\">version</span>=<span class=\"string\">&quot;1.1&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;190&quot;</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">polygon</span> <span class=\"attr\">points</span>=<span class=\"string\">&quot;100,10 40,180 190,60 10,60 160,180&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">   <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill:lime;stroke:purple;stroke-width:5;fill-rule:evenodd;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SVG优势\"><a href=\"#SVG优势\" class=\"headerlink\" title=\"SVG优势\"></a>SVG优势</h3><p>与其他图像格式相比（比如 JPEG 和 GIF），使用 SVG 的优势在于：</p>\n<ul>\n<li>SVG 图像可<strong>通过文本编辑器来创建和修改</strong>；</li>\n<li>SVG 图像可被<strong>搜索</strong>、索引、脚本化或压缩；</li>\n<li>SVG 是<strong>可伸缩</strong>的；</li>\n<li>SVG 图像可在<strong>任何的分辨率下被高质量地打印</strong>；</li>\n<li>SVG 可在<strong>图像质量不下降</strong>的情况下被放大；</li>\n</ul>\n<h2 id=\"SVG-与-Canvas两者间的区别\"><a href=\"#SVG-与-Canvas两者间的区别\" class=\"headerlink\" title=\"SVG 与 Canvas两者间的区别\"></a>SVG 与 Canvas两者间的区别</h2><ul>\n<li>SVG 是一种使用 XML 描述 2D 图形的语言；Canvas 通过 JavaScript 来绘制 2D 图形。</li>\n<li>SVG 基于 XML，这意味着 SVG DOM 中的每个元素都是可用的。您可以为某个元素附加 JavaScript 事件处理器。</li>\n<li>在 SVG 中，每个被绘制的图形均被视为对象。如果 SVG 对象的属性发生变化，那么浏览器能够自动重现图形。</li>\n<li>Canvas 是逐像素进行渲染的。在 canvas 中，一旦图形被绘制完成，它就不会继续得到浏览器的关注。如果其位置发生变化，那么整个场景也需要重新绘制，包括任何或许已被图形覆盖的对象。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><strong>Canvas</strong></th>\n<th><strong>SVG</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>依赖分辨率</td>\n<td>不依赖分辨率</td>\n</tr>\n<tr>\n<td>不支持事件处理器</td>\n<td>支持事件处理器</td>\n</tr>\n<tr>\n<td>弱的文本渲染能力</td>\n<td>最适合带有大型渲染区域的应用程序（比如谷歌地图）</td>\n</tr>\n<tr>\n<td>能够以 .png 或 .jpg 格式保存结果图像</td>\n<td>复杂度高会减慢渲染速度（任何过度使用 DOM 的应用都不快）</td>\n</tr>\n<tr>\n<td>最适合图像密集型的游戏，其中的许多对象会被频繁重绘</td>\n<td>不适合游戏应用</td>\n</tr>\n</tbody></table>\n"},{"title":"CentOS7安装Nginx","date":"2022-05-14T05:53:44.000Z","description":"Nginx(engine x)是一款是由俄罗斯的程序设计师 Igor Sysoev 所开发高性能的Web和反向代理服务器 ，也是一个 IMAP/POP3/SMTP 代理服务器。","_content":"\n# CentOS7安装Nginx\n\n## 安装所需环境\n\nNginx 是 C语言 开发，建议在 Linux 上运行，当然，也可以安装 Windows 版本，本篇则使用 CentOS 7 作为安装环境。\n\n### 一、gcc 安装\n安装 nginx 需要先将官网下载的源码进行编译，编译依赖 gcc 环境，如果没有 gcc 环境，则需要安装：\n\n```shell\nyum install gcc-c++\n```\n\n### 二、PCRE pcre-devel 安装\nPCRE(Perl Compatible Regular Expressions) 是一个Perl库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要在 linux 上安装 pcre 库，pcre-devel 是使用 pcre 开发的一个二次开发库。nginx也需要此库。命令：\n\n```shell\nyum install -y pcre pcre-devel\n```\n\n### 三、zlib 安装\nzlib 库提供了很多种压缩和解压缩的方式， nginx 使用 zlib 对 http 包的内容进行 gzip ，所以需要在 Centos 上安装 zlib 库。\n\n```shell\nyum install -y zlib zlib-devel\n```\n\n### 四、OpenSSL 安装\nOpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。\nnginx 不仅支持 http 协议，还支持 https（即在ssl协议上传输http），所以需要在 Centos 安装 OpenSSL 库。\n\n```shell\nyum install -y openssl openssl-devel\n```\n\n\n\n## 官网下载\n\n1. 直接下载 .tar.gz 安装包，地址：https://nginx.org/en/download.html\n\n2. 使用 wget 命令下载（推荐）。确保系统已经安装了wget，如果没有安装，执行 `yum install wget` 安装。\n\n   ```shell\n   wget -c https://nginx.org/download/nginx-1.18.0.tar.gz\n   ```\n\n\n\n## 解压\n\n```shell\ntar -zxvf nginx-1.18.0.tar.gz\ncd nginx-1.18.0\n```\n\n\n\n## 配置\n\n其实在 nginx-1.18.0 版本中你就不需要去配置相关东西，默认就可以了。当然，如果你要自己配置目录也是可以的。\n\n1.使用默认配置\n\n```shell\n./configure\n```\n\n2.自定义配置（不推荐）\n\n```shell\n./configure \\\n--prefix=/usr/local/nginx \\\n--conf-path=/usr/local/nginx/conf/nginx.conf \\\n--pid-path=/usr/local/nginx/conf/nginx.pid \\\n--lock-path=/var/lock/nginx.lock \\\n--error-log-path=/var/log/nginx/error.log \\\n--http-log-path=/var/log/nginx/access.log \\\n--with-http_gzip_static_module \\\n--http-client-body-temp-path=/var/temp/nginx/client \\\n--http-proxy-temp-path=/var/temp/nginx/proxy \\\n--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \\\n--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \\\n--http-scgi-temp-path=/var/temp/nginx/scgi\n```\n\n> 注：将临时文件目录指定为/var/temp/nginx，需要在/var下创建temp及nginx目录\n\n\n\n## 编译安装\n```shell\nmake\nmake install\n```\n\n查找安装路径：\n\n```shell\nwhereis nginx\n```\n\n\n\n## 启动、停止nginx\n\n```shell\ncd /usr/local/nginx/sbin/\n./nginx \n./nginx -s stop\n./nginx -s quit\n./nginx -s reload\n```\n\n> 如果启动时报80端口被占用:\n>\n> nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)\n>\n> 解决：安装net-tool 包：yum install net-tools\n>\n> ./nginx -s quit:此方式停止步骤是待nginx进程处理任务完毕进行停止。\n>\n> ./nginx -s stop:此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程。\n>\n> 查询nginx进程：`ps aux|grep nginx`\n\n\n\n## 重启 nginx\n\n1. 先停止再启动（推荐）：\n   对 nginx 进行重启相当于先停止再启动，即先执行停止命令再执行启动命令。如下：\n\n   ```shell\n   ./nginx -s quit\n   ./nginx\n   ```\n\n2. 重新加载配置文件：\n   当 ngin x的配置文件 nginx.conf 修改后，要想让配置生效需要重启 nginx，使用 `-s reload` 不用先停止 nginx再启动 nginx 即可将配置信息在 nginx 中生效，如下：\n\n   ```shell\n   ./nginx -s reload\n   ```\n\n启动成功后，在浏览器可以看到“Welcome to nginx!”页面。\n\n\n\n## 开机自启动\n即在rc.local增加启动代码就可以了。\n\n```shell\nvi /etc/rc.local\n```\n\n增加一行 `/usr/local/nginx/sbin/nginx`\n设置执行权限：\n\n```shell\nchmod 755 rc.local\n```\n\n\n\n到这里，nginx就安装完毕了。\n","source":"_posts/centos-nginx.md","raw":"---\ntitle: CentOS7安装Nginx\ndate: 2022-05-14 13:53:44\ntags: 服务器\ncategories: 服务器\ndescription: Nginx(engine x)是一款是由俄罗斯的程序设计师 Igor Sysoev 所开发高性能的Web和反向代理服务器 ，也是一个 IMAP/POP3/SMTP 代理服务器。\n---\n\n# CentOS7安装Nginx\n\n## 安装所需环境\n\nNginx 是 C语言 开发，建议在 Linux 上运行，当然，也可以安装 Windows 版本，本篇则使用 CentOS 7 作为安装环境。\n\n### 一、gcc 安装\n安装 nginx 需要先将官网下载的源码进行编译，编译依赖 gcc 环境，如果没有 gcc 环境，则需要安装：\n\n```shell\nyum install gcc-c++\n```\n\n### 二、PCRE pcre-devel 安装\nPCRE(Perl Compatible Regular Expressions) 是一个Perl库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要在 linux 上安装 pcre 库，pcre-devel 是使用 pcre 开发的一个二次开发库。nginx也需要此库。命令：\n\n```shell\nyum install -y pcre pcre-devel\n```\n\n### 三、zlib 安装\nzlib 库提供了很多种压缩和解压缩的方式， nginx 使用 zlib 对 http 包的内容进行 gzip ，所以需要在 Centos 上安装 zlib 库。\n\n```shell\nyum install -y zlib zlib-devel\n```\n\n### 四、OpenSSL 安装\nOpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。\nnginx 不仅支持 http 协议，还支持 https（即在ssl协议上传输http），所以需要在 Centos 安装 OpenSSL 库。\n\n```shell\nyum install -y openssl openssl-devel\n```\n\n\n\n## 官网下载\n\n1. 直接下载 .tar.gz 安装包，地址：https://nginx.org/en/download.html\n\n2. 使用 wget 命令下载（推荐）。确保系统已经安装了wget，如果没有安装，执行 `yum install wget` 安装。\n\n   ```shell\n   wget -c https://nginx.org/download/nginx-1.18.0.tar.gz\n   ```\n\n\n\n## 解压\n\n```shell\ntar -zxvf nginx-1.18.0.tar.gz\ncd nginx-1.18.0\n```\n\n\n\n## 配置\n\n其实在 nginx-1.18.0 版本中你就不需要去配置相关东西，默认就可以了。当然，如果你要自己配置目录也是可以的。\n\n1.使用默认配置\n\n```shell\n./configure\n```\n\n2.自定义配置（不推荐）\n\n```shell\n./configure \\\n--prefix=/usr/local/nginx \\\n--conf-path=/usr/local/nginx/conf/nginx.conf \\\n--pid-path=/usr/local/nginx/conf/nginx.pid \\\n--lock-path=/var/lock/nginx.lock \\\n--error-log-path=/var/log/nginx/error.log \\\n--http-log-path=/var/log/nginx/access.log \\\n--with-http_gzip_static_module \\\n--http-client-body-temp-path=/var/temp/nginx/client \\\n--http-proxy-temp-path=/var/temp/nginx/proxy \\\n--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \\\n--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \\\n--http-scgi-temp-path=/var/temp/nginx/scgi\n```\n\n> 注：将临时文件目录指定为/var/temp/nginx，需要在/var下创建temp及nginx目录\n\n\n\n## 编译安装\n```shell\nmake\nmake install\n```\n\n查找安装路径：\n\n```shell\nwhereis nginx\n```\n\n\n\n## 启动、停止nginx\n\n```shell\ncd /usr/local/nginx/sbin/\n./nginx \n./nginx -s stop\n./nginx -s quit\n./nginx -s reload\n```\n\n> 如果启动时报80端口被占用:\n>\n> nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)\n>\n> 解决：安装net-tool 包：yum install net-tools\n>\n> ./nginx -s quit:此方式停止步骤是待nginx进程处理任务完毕进行停止。\n>\n> ./nginx -s stop:此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程。\n>\n> 查询nginx进程：`ps aux|grep nginx`\n\n\n\n## 重启 nginx\n\n1. 先停止再启动（推荐）：\n   对 nginx 进行重启相当于先停止再启动，即先执行停止命令再执行启动命令。如下：\n\n   ```shell\n   ./nginx -s quit\n   ./nginx\n   ```\n\n2. 重新加载配置文件：\n   当 ngin x的配置文件 nginx.conf 修改后，要想让配置生效需要重启 nginx，使用 `-s reload` 不用先停止 nginx再启动 nginx 即可将配置信息在 nginx 中生效，如下：\n\n   ```shell\n   ./nginx -s reload\n   ```\n\n启动成功后，在浏览器可以看到“Welcome to nginx!”页面。\n\n\n\n## 开机自启动\n即在rc.local增加启动代码就可以了。\n\n```shell\nvi /etc/rc.local\n```\n\n增加一行 `/usr/local/nginx/sbin/nginx`\n设置执行权限：\n\n```shell\nchmod 755 rc.local\n```\n\n\n\n到这里，nginx就安装完毕了。\n","slug":"centos-nginx","published":1,"updated":"2022-05-14T06:02:03.331Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshm000kyt8w7ufp6bp6","content":"<h1 id=\"CentOS7安装Nginx\"><a href=\"#CentOS7安装Nginx\" class=\"headerlink\" title=\"CentOS7安装Nginx\"></a>CentOS7安装Nginx</h1><h2 id=\"安装所需环境\"><a href=\"#安装所需环境\" class=\"headerlink\" title=\"安装所需环境\"></a>安装所需环境</h2><p>Nginx 是 C语言 开发，建议在 Linux 上运行，当然，也可以安装 Windows 版本，本篇则使用 CentOS 7 作为安装环境。</p>\n<h3 id=\"一、gcc-安装\"><a href=\"#一、gcc-安装\" class=\"headerlink\" title=\"一、gcc 安装\"></a>一、gcc 安装</h3><p>安装 nginx 需要先将官网下载的源码进行编译，编译依赖 gcc 环境，如果没有 gcc 环境，则需要安装：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc-c++</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二、PCRE-pcre-devel-安装\"><a href=\"#二、PCRE-pcre-devel-安装\" class=\"headerlink\" title=\"二、PCRE pcre-devel 安装\"></a>二、PCRE pcre-devel 安装</h3><p>PCRE(Perl Compatible Regular Expressions) 是一个Perl库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要在 linux 上安装 pcre 库，pcre-devel 是使用 pcre 开发的一个二次开发库。nginx也需要此库。命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"三、zlib-安装\"><a href=\"#三、zlib-安装\" class=\"headerlink\" title=\"三、zlib 安装\"></a>三、zlib 安装</h3><p>zlib 库提供了很多种压缩和解压缩的方式， nginx 使用 zlib 对 http 包的内容进行 gzip ，所以需要在 Centos 上安装 zlib 库。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y zlib zlib-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"四、OpenSSL-安装\"><a href=\"#四、OpenSSL-安装\" class=\"headerlink\" title=\"四、OpenSSL 安装\"></a>四、OpenSSL 安装</h3><p>OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。<br>nginx 不仅支持 http 协议，还支持 https（即在ssl协议上传输http），所以需要在 Centos 安装 OpenSSL 库。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"官网下载\"><a href=\"#官网下载\" class=\"headerlink\" title=\"官网下载\"></a>官网下载</h2><ol>\n<li><p>直接下载 .tar.gz 安装包，地址：<a href=\"https://nginx.org/en/download.html\">https://nginx.org/en/download.html</a></p>\n</li>\n<li><p>使用 wget 命令下载（推荐）。确保系统已经安装了wget，如果没有安装，执行 <code>yum install wget</code> 安装。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -c https://nginx.org/download/nginx-1.18.0.tar.gz</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf nginx-1.18.0.tar.gz</span><br><span class=\"line\">cd nginx-1.18.0</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>其实在 nginx-1.18.0 版本中你就不需要去配置相关东西，默认就可以了。当然，如果你要自己配置目录也是可以的。</p>\n<p>1.使用默认配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure</span><br></pre></td></tr></table></figure>\n\n<p>2.自定义配置（不推荐）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure \\</span><br><span class=\"line\">--prefix=/usr/local/nginx \\</span><br><span class=\"line\">--conf-path=/usr/local/nginx/conf/nginx.conf \\</span><br><span class=\"line\">--pid-path=/usr/local/nginx/conf/nginx.pid \\</span><br><span class=\"line\">--lock-path=/var/lock/nginx.lock \\</span><br><span class=\"line\">--error-log-path=/var/log/nginx/error.log \\</span><br><span class=\"line\">--http-log-path=/var/log/nginx/access.log \\</span><br><span class=\"line\">--with-http_gzip_static_module \\</span><br><span class=\"line\">--http-client-body-temp-path=/var/temp/nginx/client \\</span><br><span class=\"line\">--http-proxy-temp-path=/var/temp/nginx/proxy \\</span><br><span class=\"line\">--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \\</span><br><span class=\"line\">--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \\</span><br><span class=\"line\">--http-scgi-temp-path=/var/temp/nginx/scgi</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注：将临时文件目录指定为&#x2F;var&#x2F;temp&#x2F;nginx，需要在&#x2F;var下创建temp及nginx目录</p>\n</blockquote>\n<h2 id=\"编译安装\"><a href=\"#编译安装\" class=\"headerlink\" title=\"编译安装\"></a>编译安装</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n<p>查找安装路径：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">whereis nginx</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"启动、停止nginx\"><a href=\"#启动、停止nginx\" class=\"headerlink\" title=\"启动、停止nginx\"></a>启动、停止nginx</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /usr/local/nginx/sbin/</span><br><span class=\"line\">./nginx </span><br><span class=\"line\">./nginx -s stop</span><br><span class=\"line\">./nginx -s quit</span><br><span class=\"line\">./nginx -s reload</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>如果启动时报80端口被占用:</p>\n<p>nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)</p>\n<p>解决：安装net-tool 包：yum install net-tools</p>\n<p>.&#x2F;nginx -s quit:此方式停止步骤是待nginx进程处理任务完毕进行停止。</p>\n<p>.&#x2F;nginx -s stop:此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程。</p>\n<p>查询nginx进程：<code>ps aux|grep nginx</code></p>\n</blockquote>\n<h2 id=\"重启-nginx\"><a href=\"#重启-nginx\" class=\"headerlink\" title=\"重启 nginx\"></a>重启 nginx</h2><ol>\n<li><p>先停止再启动（推荐）：<br>对 nginx 进行重启相当于先停止再启动，即先执行停止命令再执行启动命令。如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./nginx -s quit</span><br><span class=\"line\">./nginx</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重新加载配置文件：<br>当 ngin x的配置文件 nginx.conf 修改后，要想让配置生效需要重启 nginx，使用 <code>-s reload</code> 不用先停止 nginx再启动 nginx 即可将配置信息在 nginx 中生效，如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./nginx -s reload</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>启动成功后，在浏览器可以看到“Welcome to nginx!”页面。</p>\n<h2 id=\"开机自启动\"><a href=\"#开机自启动\" class=\"headerlink\" title=\"开机自启动\"></a>开机自启动</h2><p>即在rc.local增加启动代码就可以了。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/rc.local</span><br></pre></td></tr></table></figure>\n\n<p>增加一行 <code>/usr/local/nginx/sbin/nginx</code><br>设置执行权限：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 755 rc.local</span><br></pre></td></tr></table></figure>\n\n\n\n<p>到这里，nginx就安装完毕了。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"CentOS7安装Nginx\"><a href=\"#CentOS7安装Nginx\" class=\"headerlink\" title=\"CentOS7安装Nginx\"></a>CentOS7安装Nginx</h1><h2 id=\"安装所需环境\"><a href=\"#安装所需环境\" class=\"headerlink\" title=\"安装所需环境\"></a>安装所需环境</h2><p>Nginx 是 C语言 开发，建议在 Linux 上运行，当然，也可以安装 Windows 版本，本篇则使用 CentOS 7 作为安装环境。</p>\n<h3 id=\"一、gcc-安装\"><a href=\"#一、gcc-安装\" class=\"headerlink\" title=\"一、gcc 安装\"></a>一、gcc 安装</h3><p>安装 nginx 需要先将官网下载的源码进行编译，编译依赖 gcc 环境，如果没有 gcc 环境，则需要安装：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc-c++</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二、PCRE-pcre-devel-安装\"><a href=\"#二、PCRE-pcre-devel-安装\" class=\"headerlink\" title=\"二、PCRE pcre-devel 安装\"></a>二、PCRE pcre-devel 安装</h3><p>PCRE(Perl Compatible Regular Expressions) 是一个Perl库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要在 linux 上安装 pcre 库，pcre-devel 是使用 pcre 开发的一个二次开发库。nginx也需要此库。命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"三、zlib-安装\"><a href=\"#三、zlib-安装\" class=\"headerlink\" title=\"三、zlib 安装\"></a>三、zlib 安装</h3><p>zlib 库提供了很多种压缩和解压缩的方式， nginx 使用 zlib 对 http 包的内容进行 gzip ，所以需要在 Centos 上安装 zlib 库。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y zlib zlib-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"四、OpenSSL-安装\"><a href=\"#四、OpenSSL-安装\" class=\"headerlink\" title=\"四、OpenSSL 安装\"></a>四、OpenSSL 安装</h3><p>OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。<br>nginx 不仅支持 http 协议，还支持 https（即在ssl协议上传输http），所以需要在 Centos 安装 OpenSSL 库。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"官网下载\"><a href=\"#官网下载\" class=\"headerlink\" title=\"官网下载\"></a>官网下载</h2><ol>\n<li><p>直接下载 .tar.gz 安装包，地址：<a href=\"https://nginx.org/en/download.html\">https://nginx.org/en/download.html</a></p>\n</li>\n<li><p>使用 wget 命令下载（推荐）。确保系统已经安装了wget，如果没有安装，执行 <code>yum install wget</code> 安装。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -c https://nginx.org/download/nginx-1.18.0.tar.gz</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf nginx-1.18.0.tar.gz</span><br><span class=\"line\">cd nginx-1.18.0</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>其实在 nginx-1.18.0 版本中你就不需要去配置相关东西，默认就可以了。当然，如果你要自己配置目录也是可以的。</p>\n<p>1.使用默认配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure</span><br></pre></td></tr></table></figure>\n\n<p>2.自定义配置（不推荐）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure \\</span><br><span class=\"line\">--prefix=/usr/local/nginx \\</span><br><span class=\"line\">--conf-path=/usr/local/nginx/conf/nginx.conf \\</span><br><span class=\"line\">--pid-path=/usr/local/nginx/conf/nginx.pid \\</span><br><span class=\"line\">--lock-path=/var/lock/nginx.lock \\</span><br><span class=\"line\">--error-log-path=/var/log/nginx/error.log \\</span><br><span class=\"line\">--http-log-path=/var/log/nginx/access.log \\</span><br><span class=\"line\">--with-http_gzip_static_module \\</span><br><span class=\"line\">--http-client-body-temp-path=/var/temp/nginx/client \\</span><br><span class=\"line\">--http-proxy-temp-path=/var/temp/nginx/proxy \\</span><br><span class=\"line\">--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \\</span><br><span class=\"line\">--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \\</span><br><span class=\"line\">--http-scgi-temp-path=/var/temp/nginx/scgi</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注：将临时文件目录指定为&#x2F;var&#x2F;temp&#x2F;nginx，需要在&#x2F;var下创建temp及nginx目录</p>\n</blockquote>\n<h2 id=\"编译安装\"><a href=\"#编译安装\" class=\"headerlink\" title=\"编译安装\"></a>编译安装</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n<p>查找安装路径：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">whereis nginx</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"启动、停止nginx\"><a href=\"#启动、停止nginx\" class=\"headerlink\" title=\"启动、停止nginx\"></a>启动、停止nginx</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /usr/local/nginx/sbin/</span><br><span class=\"line\">./nginx </span><br><span class=\"line\">./nginx -s stop</span><br><span class=\"line\">./nginx -s quit</span><br><span class=\"line\">./nginx -s reload</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>如果启动时报80端口被占用:</p>\n<p>nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)</p>\n<p>解决：安装net-tool 包：yum install net-tools</p>\n<p>.&#x2F;nginx -s quit:此方式停止步骤是待nginx进程处理任务完毕进行停止。</p>\n<p>.&#x2F;nginx -s stop:此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程。</p>\n<p>查询nginx进程：<code>ps aux|grep nginx</code></p>\n</blockquote>\n<h2 id=\"重启-nginx\"><a href=\"#重启-nginx\" class=\"headerlink\" title=\"重启 nginx\"></a>重启 nginx</h2><ol>\n<li><p>先停止再启动（推荐）：<br>对 nginx 进行重启相当于先停止再启动，即先执行停止命令再执行启动命令。如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./nginx -s quit</span><br><span class=\"line\">./nginx</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重新加载配置文件：<br>当 ngin x的配置文件 nginx.conf 修改后，要想让配置生效需要重启 nginx，使用 <code>-s reload</code> 不用先停止 nginx再启动 nginx 即可将配置信息在 nginx 中生效，如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./nginx -s reload</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>启动成功后，在浏览器可以看到“Welcome to nginx!”页面。</p>\n<h2 id=\"开机自启动\"><a href=\"#开机自启动\" class=\"headerlink\" title=\"开机自启动\"></a>开机自启动</h2><p>即在rc.local增加启动代码就可以了。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/rc.local</span><br></pre></td></tr></table></figure>\n\n<p>增加一行 <code>/usr/local/nginx/sbin/nginx</code><br>设置执行权限：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 755 rc.local</span><br></pre></td></tr></table></figure>\n\n\n\n<p>到这里，nginx就安装完毕了。</p>\n"},{"title":"单击点一些常用的坐标及宽高信息","date":"2022-05-14T12:58:22.000Z","description":"单击点一些常用的坐标及宽高信息汇总","_content":"\n## 单击点坐标\n\n+ x、y：单击点距离**屏幕左上角**的距离；\n+ screenX、screenY：单击点距离**屏幕左上角**的距离；\n+ clientX、clientY：单击点距离**页面可显示视图区域左上角**的距离；\n+ pageX = clientX + scrollLeft; pageY = clientY + scrollTop;\n+ offsetX、offsetY 属性，是单击点相对单击对象左上角的偏移量，取决于单击的对象位于哪是谁；\n\n\n\n其中clientX、clientY是W3C标准的属性。\n\n\n\n## 一些宽高\n\n+ **clientWidth** = width + 左右padding；\n+ **clientHeigh** = height + 上下padding；\n+ **clientTop** = boder.top(上边框的宽度)；\n+ **clientLeft** = boder.left(上边框的宽度)；\n\n\n\n+ **offsetWidth** = width + 左右padding + 左右boder\n+ **offsetHeith** = height + 上下padding + 上下boder\n+  **offsetTop**：当前元素上边框外边缘到最近的已定位父级（offsetParent）上边框内边缘的距离。如果父              级都没有定位，则分别是到body顶部和左边的距离\n+ **offsetLeft**：当前元素左边框外边缘到最近的已定位父级（offsetParent）左边框内边缘的距离。如果父级都没有定位，则分别是到body顶部和左边的距离\n\n\n\n+ **scrollWidth**：获取指定标签内容层的真实宽度（可视区域宽度+被隐藏区域宽度）。\n+ **scrollHeight**：获取指定标签内容层的真实高度（可视区域高度+被隐藏区域高度）。\n+ **scrollTop** ：内容层顶部 到 可视区域顶部的距离。\n+ **scrollLeft**：内容层左端 到 可视区域左端的距离。\n\n\n\n## 扩展\n\n### 获取scrollTop\n```js\nvar scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;\n```\n\n浏览器差异：\n\n+ IE6/7/8：\n  + 对于没有doctype声明的页面里可以使用  document.body.scrollTop 来获取 scrollTop高度 ； \n  + 对于有doctype声明的页面则可以使用 document.documentElement.scrollTop； \n+ Safari: safari 比较特别，有自己获取scrollTop的函数 ： window.pageYOffset ； \n+ Firefox: 火狐等等相对标准些的浏览器就省心多了，直接用 document.documentElement.scrollTop ；\n\n\n\n### 滚动加载更多的原理\n\n+ scrollHeight：文档内容实际高度，包括超出视窗的溢出部分；\n+ scrollTop：滚动条滚动距离；\n+ clientHeight：窗口可视范围高度。\n\n当 `clientHeight + scrollTop >= scrollHeight` 时，表示已经抵达内容的底部了，可以加载更多内容。\n\n+ scrollHeight：可以通过 document.documentElement.scrollHeight 、document.body.scrollHeight 获取;\n+ clientHeight：可以通过window.innerHeight 、 document.documentElement.clientHeight 获取;\n+ scrollTop：可以通过window.pageYOffset 、 document.documentElement.scrollTop 获取;\n","source":"_posts/click-coordinate.md","raw":"---\ntitle: 单击点一些常用的坐标及宽高信息\ndate: 2022-05-14 20:58:22\ntags:\ncategories: JavaScript\ndescription: 单击点一些常用的坐标及宽高信息汇总\n---\n\n## 单击点坐标\n\n+ x、y：单击点距离**屏幕左上角**的距离；\n+ screenX、screenY：单击点距离**屏幕左上角**的距离；\n+ clientX、clientY：单击点距离**页面可显示视图区域左上角**的距离；\n+ pageX = clientX + scrollLeft; pageY = clientY + scrollTop;\n+ offsetX、offsetY 属性，是单击点相对单击对象左上角的偏移量，取决于单击的对象位于哪是谁；\n\n\n\n其中clientX、clientY是W3C标准的属性。\n\n\n\n## 一些宽高\n\n+ **clientWidth** = width + 左右padding；\n+ **clientHeigh** = height + 上下padding；\n+ **clientTop** = boder.top(上边框的宽度)；\n+ **clientLeft** = boder.left(上边框的宽度)；\n\n\n\n+ **offsetWidth** = width + 左右padding + 左右boder\n+ **offsetHeith** = height + 上下padding + 上下boder\n+  **offsetTop**：当前元素上边框外边缘到最近的已定位父级（offsetParent）上边框内边缘的距离。如果父              级都没有定位，则分别是到body顶部和左边的距离\n+ **offsetLeft**：当前元素左边框外边缘到最近的已定位父级（offsetParent）左边框内边缘的距离。如果父级都没有定位，则分别是到body顶部和左边的距离\n\n\n\n+ **scrollWidth**：获取指定标签内容层的真实宽度（可视区域宽度+被隐藏区域宽度）。\n+ **scrollHeight**：获取指定标签内容层的真实高度（可视区域高度+被隐藏区域高度）。\n+ **scrollTop** ：内容层顶部 到 可视区域顶部的距离。\n+ **scrollLeft**：内容层左端 到 可视区域左端的距离。\n\n\n\n## 扩展\n\n### 获取scrollTop\n```js\nvar scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;\n```\n\n浏览器差异：\n\n+ IE6/7/8：\n  + 对于没有doctype声明的页面里可以使用  document.body.scrollTop 来获取 scrollTop高度 ； \n  + 对于有doctype声明的页面则可以使用 document.documentElement.scrollTop； \n+ Safari: safari 比较特别，有自己获取scrollTop的函数 ： window.pageYOffset ； \n+ Firefox: 火狐等等相对标准些的浏览器就省心多了，直接用 document.documentElement.scrollTop ；\n\n\n\n### 滚动加载更多的原理\n\n+ scrollHeight：文档内容实际高度，包括超出视窗的溢出部分；\n+ scrollTop：滚动条滚动距离；\n+ clientHeight：窗口可视范围高度。\n\n当 `clientHeight + scrollTop >= scrollHeight` 时，表示已经抵达内容的底部了，可以加载更多内容。\n\n+ scrollHeight：可以通过 document.documentElement.scrollHeight 、document.body.scrollHeight 获取;\n+ clientHeight：可以通过window.innerHeight 、 document.documentElement.clientHeight 获取;\n+ scrollTop：可以通过window.pageYOffset 、 document.documentElement.scrollTop 获取;\n","slug":"click-coordinate","published":1,"updated":"2022-05-14T12:59:39.158Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsho000myt8w01rbf1pv","content":"<h2 id=\"单击点坐标\"><a href=\"#单击点坐标\" class=\"headerlink\" title=\"单击点坐标\"></a>单击点坐标</h2><ul>\n<li>x、y：单击点距离<strong>屏幕左上角</strong>的距离；</li>\n<li>screenX、screenY：单击点距离<strong>屏幕左上角</strong>的距离；</li>\n<li>clientX、clientY：单击点距离<strong>页面可显示视图区域左上角</strong>的距离；</li>\n<li>pageX &#x3D; clientX + scrollLeft; pageY &#x3D; clientY + scrollTop;</li>\n<li>offsetX、offsetY 属性，是单击点相对单击对象左上角的偏移量，取决于单击的对象位于哪是谁；</li>\n</ul>\n<p>其中clientX、clientY是W3C标准的属性。</p>\n<h2 id=\"一些宽高\"><a href=\"#一些宽高\" class=\"headerlink\" title=\"一些宽高\"></a>一些宽高</h2><ul>\n<li><p><strong>clientWidth</strong> &#x3D; width + 左右padding；</p>\n</li>\n<li><p><strong>clientHeigh</strong> &#x3D; height + 上下padding；</p>\n</li>\n<li><p><strong>clientTop</strong> &#x3D; boder.top(上边框的宽度)；</p>\n</li>\n<li><p><strong>clientLeft</strong> &#x3D; boder.left(上边框的宽度)；</p>\n</li>\n<li><p><strong>offsetWidth</strong> &#x3D; width + 左右padding + 左右boder</p>\n</li>\n<li><p><strong>offsetHeith</strong> &#x3D; height + 上下padding + 上下boder</p>\n</li>\n<li><p><strong>offsetTop</strong>：当前元素上边框外边缘到最近的已定位父级（offsetParent）上边框内边缘的距离。如果父              级都没有定位，则分别是到body顶部和左边的距离</p>\n</li>\n<li><p><strong>offsetLeft</strong>：当前元素左边框外边缘到最近的已定位父级（offsetParent）左边框内边缘的距离。如果父级都没有定位，则分别是到body顶部和左边的距离</p>\n</li>\n<li><p><strong>scrollWidth</strong>：获取指定标签内容层的真实宽度（可视区域宽度+被隐藏区域宽度）。</p>\n</li>\n<li><p><strong>scrollHeight</strong>：获取指定标签内容层的真实高度（可视区域高度+被隐藏区域高度）。</p>\n</li>\n<li><p><strong>scrollTop</strong> ：内容层顶部 到 可视区域顶部的距离。</p>\n</li>\n<li><p><strong>scrollLeft</strong>：内容层左端 到 可视区域左端的距离。</p>\n</li>\n</ul>\n<h2 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h2><h3 id=\"获取scrollTop\"><a href=\"#获取scrollTop\" class=\"headerlink\" title=\"获取scrollTop\"></a>获取scrollTop</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> scrollTop = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">scrollTop</span> || <span class=\"variable language_\">window</span>.<span class=\"property\">pageYOffset</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollTop</span>;</span><br></pre></td></tr></table></figure>\n\n<p>浏览器差异：</p>\n<ul>\n<li>IE6&#x2F;7&#x2F;8：<ul>\n<li>对于没有doctype声明的页面里可以使用  document.body.scrollTop 来获取 scrollTop高度 ； </li>\n<li>对于有doctype声明的页面则可以使用 document.documentElement.scrollTop；</li>\n</ul>\n</li>\n<li>Safari: safari 比较特别，有自己获取scrollTop的函数 ： window.pageYOffset ； </li>\n<li>Firefox: 火狐等等相对标准些的浏览器就省心多了，直接用 document.documentElement.scrollTop ；</li>\n</ul>\n<h3 id=\"滚动加载更多的原理\"><a href=\"#滚动加载更多的原理\" class=\"headerlink\" title=\"滚动加载更多的原理\"></a>滚动加载更多的原理</h3><ul>\n<li>scrollHeight：文档内容实际高度，包括超出视窗的溢出部分；</li>\n<li>scrollTop：滚动条滚动距离；</li>\n<li>clientHeight：窗口可视范围高度。</li>\n</ul>\n<p>当 <code>clientHeight + scrollTop &gt;= scrollHeight</code> 时，表示已经抵达内容的底部了，可以加载更多内容。</p>\n<ul>\n<li>scrollHeight：可以通过 document.documentElement.scrollHeight 、document.body.scrollHeight 获取;</li>\n<li>clientHeight：可以通过window.innerHeight 、 document.documentElement.clientHeight 获取;</li>\n<li>scrollTop：可以通过window.pageYOffset 、 document.documentElement.scrollTop 获取;</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"单击点坐标\"><a href=\"#单击点坐标\" class=\"headerlink\" title=\"单击点坐标\"></a>单击点坐标</h2><ul>\n<li>x、y：单击点距离<strong>屏幕左上角</strong>的距离；</li>\n<li>screenX、screenY：单击点距离<strong>屏幕左上角</strong>的距离；</li>\n<li>clientX、clientY：单击点距离<strong>页面可显示视图区域左上角</strong>的距离；</li>\n<li>pageX &#x3D; clientX + scrollLeft; pageY &#x3D; clientY + scrollTop;</li>\n<li>offsetX、offsetY 属性，是单击点相对单击对象左上角的偏移量，取决于单击的对象位于哪是谁；</li>\n</ul>\n<p>其中clientX、clientY是W3C标准的属性。</p>\n<h2 id=\"一些宽高\"><a href=\"#一些宽高\" class=\"headerlink\" title=\"一些宽高\"></a>一些宽高</h2><ul>\n<li><p><strong>clientWidth</strong> &#x3D; width + 左右padding；</p>\n</li>\n<li><p><strong>clientHeigh</strong> &#x3D; height + 上下padding；</p>\n</li>\n<li><p><strong>clientTop</strong> &#x3D; boder.top(上边框的宽度)；</p>\n</li>\n<li><p><strong>clientLeft</strong> &#x3D; boder.left(上边框的宽度)；</p>\n</li>\n<li><p><strong>offsetWidth</strong> &#x3D; width + 左右padding + 左右boder</p>\n</li>\n<li><p><strong>offsetHeith</strong> &#x3D; height + 上下padding + 上下boder</p>\n</li>\n<li><p><strong>offsetTop</strong>：当前元素上边框外边缘到最近的已定位父级（offsetParent）上边框内边缘的距离。如果父              级都没有定位，则分别是到body顶部和左边的距离</p>\n</li>\n<li><p><strong>offsetLeft</strong>：当前元素左边框外边缘到最近的已定位父级（offsetParent）左边框内边缘的距离。如果父级都没有定位，则分别是到body顶部和左边的距离</p>\n</li>\n<li><p><strong>scrollWidth</strong>：获取指定标签内容层的真实宽度（可视区域宽度+被隐藏区域宽度）。</p>\n</li>\n<li><p><strong>scrollHeight</strong>：获取指定标签内容层的真实高度（可视区域高度+被隐藏区域高度）。</p>\n</li>\n<li><p><strong>scrollTop</strong> ：内容层顶部 到 可视区域顶部的距离。</p>\n</li>\n<li><p><strong>scrollLeft</strong>：内容层左端 到 可视区域左端的距离。</p>\n</li>\n</ul>\n<h2 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h2><h3 id=\"获取scrollTop\"><a href=\"#获取scrollTop\" class=\"headerlink\" title=\"获取scrollTop\"></a>获取scrollTop</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> scrollTop = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">scrollTop</span> || <span class=\"variable language_\">window</span>.<span class=\"property\">pageYOffset</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollTop</span>;</span><br></pre></td></tr></table></figure>\n\n<p>浏览器差异：</p>\n<ul>\n<li>IE6&#x2F;7&#x2F;8：<ul>\n<li>对于没有doctype声明的页面里可以使用  document.body.scrollTop 来获取 scrollTop高度 ； </li>\n<li>对于有doctype声明的页面则可以使用 document.documentElement.scrollTop；</li>\n</ul>\n</li>\n<li>Safari: safari 比较特别，有自己获取scrollTop的函数 ： window.pageYOffset ； </li>\n<li>Firefox: 火狐等等相对标准些的浏览器就省心多了，直接用 document.documentElement.scrollTop ；</li>\n</ul>\n<h3 id=\"滚动加载更多的原理\"><a href=\"#滚动加载更多的原理\" class=\"headerlink\" title=\"滚动加载更多的原理\"></a>滚动加载更多的原理</h3><ul>\n<li>scrollHeight：文档内容实际高度，包括超出视窗的溢出部分；</li>\n<li>scrollTop：滚动条滚动距离；</li>\n<li>clientHeight：窗口可视范围高度。</li>\n</ul>\n<p>当 <code>clientHeight + scrollTop &gt;= scrollHeight</code> 时，表示已经抵达内容的底部了，可以加载更多内容。</p>\n<ul>\n<li>scrollHeight：可以通过 document.documentElement.scrollHeight 、document.body.scrollHeight 获取;</li>\n<li>clientHeight：可以通过window.innerHeight 、 document.documentElement.clientHeight 获取;</li>\n<li>scrollTop：可以通过window.pageYOffset 、 document.documentElement.scrollTop 获取;</li>\n</ul>\n"},{"title":"cookie 18问","date":"2022-03-20T13:09:25.000Z","description":"很多场景下，我们需要知道下一次的会话和上一次的会话的关系（比如登陆之后我们需要记住登陆状态），这个时候就引入了Cookie和Session体系。","_content":"\n我们知道，HTTP是一种无状态协议，无状态是指服务端对于客户端每次发送的请求都认为它是一个新的请求，上一次会话和下一次会话没有联系。\n\n但是，很多场景下，我们需要知道下一次的会话和上一次的会话的关系（比如登陆之后我们需要记住登陆状态），这个时候就引入了Cookie和Session体系。\n\nCookie： 客户端请求服务器时，如果服务器需要记录该用户状态，就通过response Headers向客户端浏览器颁发一个Cookie，而客户端浏览器会把Cookie保存起来。当浏览器再请求服务器时，浏览器把请求的网址连同该Cookie一同提交给服务器。服务器通过检查该Cookie来获取用户状态。\n\nSession： 当服务器接收到请求时，就从存储在服务器上的无数session信息中去查找客户端请求时带过来的cookie的状态。如果服务器中没有这条session信息则添加一条session信息。\n\n通常Cookie中存的是session信息经过计算后的唯一Id（sessionId）。\n\n## 1. cookie存储在哪里？\n\ncookie一般是被浏览器以txt的形式存储在电脑硬盘中，供该浏览器进行读、写操作。\n\n\n## 2. cookie是如何工作的？\n\n- request：当浏览器发起一个请求时，浏览器会自动检查是否有相应的cookie，如果有则将cookie添加到Request Headers的Cookie字段中（cookie字段是很多name=value以分号分隔的字符串）。\n- response：当服务端需要种cookie时，在http请求的Response Headers中添加Set-Cookie字段，浏览器接收到之后会自动解析识别，将cookie种下。\n\n\n## 3. cookie和session的区别？\n\n- 存储位置不同： cookie数据存放在客户的浏览器上，session数据放在服务器上。\n- 存储大小不同： 一般单个cookie保存的数据不能超过4k, 单个域名最多保存30个cookie（不同浏览器有差异）；session则无大小和数量限制。\n\n\n## 4. 什么是session级别的cookie？\n\nsession级别的cookie只针对当前会话存在，会话终止则cookie消失。\n\n当cookie没有设置expires的时候，该cookie只会在网页会话期间存在，当浏览器退出的时候，该cookie就会消失。\n\n浏览器中的表现为Expires/Max-Age的内容为Session。\n\n\n## 5. cookie可以被谁来操作？\n\n服务端和js都可以读/写cookie。\n\n\n## 6. cookie各属性详解\n\n- Name: cookie名\n- Value: cookie值。\n- Domain: cookie的域名。如果设成.example.com，那么子域名a.example.com和b.example.com，都可以使用.example.com的cookie;反之则不可以。\n- Path: 允许读取cookie的url路径，一般设置为/。\n- Expires： cookie过期时间。不设置，则为Session会话期，页面退出时cookie失效。\n- HttpOnly: 设置为true时，只有http能读取。js只能读取未设置HttpOnly的cookie。\n- Secure: 标记为Secure的cookie，只有https的请求可以携带。\n- SameSite: 限制第三方url是否可以携带cookie。有3个值：Strict/Lax(默认)/None。（chrome51新增属性，chrome80+强制执行）\n  - Strict: 仅允许发送同站点请求的的cookie\n  - Lax: 允许部分第三方请求携带cookie，即导航到目标网址的get请求。包括超链接 ，预加载和get表单三种形式发送cookie\n  - None: 任意发送cookie，设置为None，（需要同时设置Secure，也就是说网站必须采用https）\n- Priority：优先级，chrome的提案（firefox不支持），定义了三种优先级，Low/Medium/High，当cookie数量超出时，低优先级的cookie会被优先清除。\n\n\n## 7. js和服务端对cookie的操作有什么不同？\ncookie有一个属性是HttpOnly，HttpOnly被设置时，表明该cookie只能被http请求读取，不能被js读取，具体的表现是:document.cookie读取到的内容不包含设置了HttpOnly的cookie。\n\n\n## 8. js如何操作cookie\n\njs操作读/写cookie的api是document.cookie。\n\n读cookie `document.cookie`\n\n```js\nconsole.log(document.cookie); \n// cna=8fDUF573wEQCAWoLI8izIL6X; xlly_s=1; t=4a2bcb7ef27d32dad6872f9124694e19; _tb_token_=e3e11308ee6fe; hng=CN%7Czh-CN%7CCNY%7C156; thw=cn;  v=0; \n```\n\n读取后的cookie是一个字符串，包含了所有cookie的name和value（用分号分隔），需要我们自行将cookie解析出来。\n\n写cookie\n\n```js\ndocument.cookie = 'uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/;secure;'\ndocument.cookie = 'uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/caikuai;domain=edu.360.cn;secure;samesite=lax' \n```\n\n一次只能写一个cookie，想要写多个cookie需要操作多次。\n\n```\n\n删除cookie 只需要将一个已经存在的cookie名字过期时间设置为过去的时间即可。\n\n​```js\ndocument.cookie = 'uid=dkfywqkrhkwehf23;expires=' + new Date(0) + ';path=/;secure;'\n```\n\n修改cookie 重新赋值就好，旧值会覆盖新值。\n\n注意：需要保证path和domain这两个值不变，否则会添加一个新的cookie。\n\n\n## 9. 服务端如何读写cookie\n\n第2节“cookie是如何工作的”告诉我们，服务端是可以读和写cookie的，从图中我们可以看到，写cookie时，一条Set-Cookie写入一条cookie。读cookie时，所有的cookie信息都被放进了cookie字段中。\n\n以express使用为例：\n\n写cookie\n\n```js\nres.setHeader('Set-Cookie', ['uid=123;maxAge: 900000; httpOnly: true']);\n// 或者\nres.cookie(\"uid\",'123',{maxAge: 900000, httpOnly: true});\n```\n\n读取cookie\n\n```js\nconsole.log(req.getHeader('Cookie')); // 拿到所有cookie\n// 或者\nconsole.log(req.cookie.name);\n```\n\n## 10. Cookie 大小和数量的限制\n\n不同的浏览器对Cookie的大小和数量的限制不一样，一般，单个域名下设置的Cookie不应超过30个，且每个Cookie的大小不应超过4kb，超过以后，Cookie将会被忽略，不会被设置。\n\n\n## 11. 查看浏览器是否打开 Cookie 功能\n\n```js\nwindow.navigator.cookieEnabled // true\n```\n\n\n## 12. cookie 的共享策略是什么\n\ndomain和path共同决定了cookie可以被哪些url访问。\n\n访问一个url时，如果url的host与domain一致或者是domain的子域名，并且url的路径与path部分匹配，那么cookie才可以被读取。\n\n\n## 13. 跨域请求（CORS）中的cookie\n\n首先cookie的SameSite需要设置为None。\n\n其次对于将Access-Control-Allow-Credentials设置为true的接口（表示允许发送cookie），需要我们在发送ajax请求时，将withCredentials属性设为true。\n\n\n## 14. cookie的编码\n\n```js\ndocument.cookie = 'uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/caikuai;domain=edu.360.cn;secure;samesite=lax'\n```\n\n从document.cookie的赋值中我们可以看到，存在等于号、冒号、分号、空格、逗号、斜杠等特殊字符，因此当cookie的key和value中存在这几种符号时，需要对其进行编码，一般会用encodeURIComponent/decodeURIComponent进行操作。\n\n\nQ: 为什么不使用escape和encodeURI进行编码呢？\nA: 因为相比这两个api，encodeURIComponent可以将更多的字符进行编码，比如\"/\"。\n\n\n## 15. cookie与web安全\n\n### cookie如何应对XSS漏洞\n\nXSS漏洞的原理是，由于未对用户提交的表单数据或者url参数等数据做处理就显示在了页面上，导致用户提交的内容在页面上被做为html解析执行。\n\n常规方案：对特殊字符进行处理，如\"<\"和\">\"等进行转义。\n\ncookie的应对方案：对于用户利用script脚本来采集cookie信息，我们可以将重要的cookie信息设置为HttpOnly来避免cookie被js采集。\n\n### cookie如何应对CSRF攻击\n\nCSRF，中文名叫跨站请求伪造，原理是，用户登陆了A网站，然后因为某些原因访问了B网站（比如跳转等），B网站直接发送一个A网站的请求进行一些危险操作，由于A网站处于登陆状态，就发生了CSRF攻击（核心就是利用了cookie信息可以被跨站携带）！\n\n常规方案：采用验证码或token等。\n\ncookie的应对方案：由于CSRF攻击核心就是利用了cookie信息可以被跨站携带，那么我们可以对核心cookie的SameSite设置为Strict或Lax来避免。\n\n\n## 16. 不同的浏览器共享cookie吗?\n\n不同的浏览器互相不通信，彼此是独立的cookie。因此，我们在一个浏览器上登陆了某个网站，换到另一个浏览器上的时候需要重新登陆。\n\n\n## 17. cookie和localStorage/sessionStorage的差异\n\n\n| 特性           | cookie                                       | localstorage             | sessionstorage                               |\n| -------------- | -------------------------------------------- | ------------------------ | -------------------------------------------- |\n| 操作者         | 服务器和js                                   | js                       | js                                           |\n| 数据的生命期   | 可设置失效时间                               | 除非被清除，否则永久保存 | 仅在当前会话下有效，关闭页面或浏览器后被清除 |\n| 存放数据大小   | 4K左右                                       | 一般为5M                 | 一般为5M                                     |\n| 与服务器端通信 | 每次都会携带在HTTP头中每次都会携带在HTTP头中 | 不与服务器通信           | 不与服务器通信                               |\n| 易用性         | 原生的Cookie接口不友好，需要封装             | 接口易用                 | 接口易用                                     |\n\n\n## 18. 哪些信息适合放到cookie中\n\ncookie的增多无疑会加重网络请求的开销，而且每次请求都会将cookie完整的带上，因此对于那些“每次请求都必须要携带的信息（如身份信息、A/B分桶信息等）”，才适合放进cookie中，其他类型的数据建议放进localStorage中。","source":"_posts/cookie18.md","raw":"---\ntitle: cookie 18问\ndate: 2022-03-20 21:09:25\ntags: [浏览器, JavaScript]\ncategories: 浏览器\ndescription: 很多场景下，我们需要知道下一次的会话和上一次的会话的关系（比如登陆之后我们需要记住登陆状态），这个时候就引入了Cookie和Session体系。\n---\n\n我们知道，HTTP是一种无状态协议，无状态是指服务端对于客户端每次发送的请求都认为它是一个新的请求，上一次会话和下一次会话没有联系。\n\n但是，很多场景下，我们需要知道下一次的会话和上一次的会话的关系（比如登陆之后我们需要记住登陆状态），这个时候就引入了Cookie和Session体系。\n\nCookie： 客户端请求服务器时，如果服务器需要记录该用户状态，就通过response Headers向客户端浏览器颁发一个Cookie，而客户端浏览器会把Cookie保存起来。当浏览器再请求服务器时，浏览器把请求的网址连同该Cookie一同提交给服务器。服务器通过检查该Cookie来获取用户状态。\n\nSession： 当服务器接收到请求时，就从存储在服务器上的无数session信息中去查找客户端请求时带过来的cookie的状态。如果服务器中没有这条session信息则添加一条session信息。\n\n通常Cookie中存的是session信息经过计算后的唯一Id（sessionId）。\n\n## 1. cookie存储在哪里？\n\ncookie一般是被浏览器以txt的形式存储在电脑硬盘中，供该浏览器进行读、写操作。\n\n\n## 2. cookie是如何工作的？\n\n- request：当浏览器发起一个请求时，浏览器会自动检查是否有相应的cookie，如果有则将cookie添加到Request Headers的Cookie字段中（cookie字段是很多name=value以分号分隔的字符串）。\n- response：当服务端需要种cookie时，在http请求的Response Headers中添加Set-Cookie字段，浏览器接收到之后会自动解析识别，将cookie种下。\n\n\n## 3. cookie和session的区别？\n\n- 存储位置不同： cookie数据存放在客户的浏览器上，session数据放在服务器上。\n- 存储大小不同： 一般单个cookie保存的数据不能超过4k, 单个域名最多保存30个cookie（不同浏览器有差异）；session则无大小和数量限制。\n\n\n## 4. 什么是session级别的cookie？\n\nsession级别的cookie只针对当前会话存在，会话终止则cookie消失。\n\n当cookie没有设置expires的时候，该cookie只会在网页会话期间存在，当浏览器退出的时候，该cookie就会消失。\n\n浏览器中的表现为Expires/Max-Age的内容为Session。\n\n\n## 5. cookie可以被谁来操作？\n\n服务端和js都可以读/写cookie。\n\n\n## 6. cookie各属性详解\n\n- Name: cookie名\n- Value: cookie值。\n- Domain: cookie的域名。如果设成.example.com，那么子域名a.example.com和b.example.com，都可以使用.example.com的cookie;反之则不可以。\n- Path: 允许读取cookie的url路径，一般设置为/。\n- Expires： cookie过期时间。不设置，则为Session会话期，页面退出时cookie失效。\n- HttpOnly: 设置为true时，只有http能读取。js只能读取未设置HttpOnly的cookie。\n- Secure: 标记为Secure的cookie，只有https的请求可以携带。\n- SameSite: 限制第三方url是否可以携带cookie。有3个值：Strict/Lax(默认)/None。（chrome51新增属性，chrome80+强制执行）\n  - Strict: 仅允许发送同站点请求的的cookie\n  - Lax: 允许部分第三方请求携带cookie，即导航到目标网址的get请求。包括超链接 ，预加载和get表单三种形式发送cookie\n  - None: 任意发送cookie，设置为None，（需要同时设置Secure，也就是说网站必须采用https）\n- Priority：优先级，chrome的提案（firefox不支持），定义了三种优先级，Low/Medium/High，当cookie数量超出时，低优先级的cookie会被优先清除。\n\n\n## 7. js和服务端对cookie的操作有什么不同？\ncookie有一个属性是HttpOnly，HttpOnly被设置时，表明该cookie只能被http请求读取，不能被js读取，具体的表现是:document.cookie读取到的内容不包含设置了HttpOnly的cookie。\n\n\n## 8. js如何操作cookie\n\njs操作读/写cookie的api是document.cookie。\n\n读cookie `document.cookie`\n\n```js\nconsole.log(document.cookie); \n// cna=8fDUF573wEQCAWoLI8izIL6X; xlly_s=1; t=4a2bcb7ef27d32dad6872f9124694e19; _tb_token_=e3e11308ee6fe; hng=CN%7Czh-CN%7CCNY%7C156; thw=cn;  v=0; \n```\n\n读取后的cookie是一个字符串，包含了所有cookie的name和value（用分号分隔），需要我们自行将cookie解析出来。\n\n写cookie\n\n```js\ndocument.cookie = 'uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/;secure;'\ndocument.cookie = 'uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/caikuai;domain=edu.360.cn;secure;samesite=lax' \n```\n\n一次只能写一个cookie，想要写多个cookie需要操作多次。\n\n```\n\n删除cookie 只需要将一个已经存在的cookie名字过期时间设置为过去的时间即可。\n\n​```js\ndocument.cookie = 'uid=dkfywqkrhkwehf23;expires=' + new Date(0) + ';path=/;secure;'\n```\n\n修改cookie 重新赋值就好，旧值会覆盖新值。\n\n注意：需要保证path和domain这两个值不变，否则会添加一个新的cookie。\n\n\n## 9. 服务端如何读写cookie\n\n第2节“cookie是如何工作的”告诉我们，服务端是可以读和写cookie的，从图中我们可以看到，写cookie时，一条Set-Cookie写入一条cookie。读cookie时，所有的cookie信息都被放进了cookie字段中。\n\n以express使用为例：\n\n写cookie\n\n```js\nres.setHeader('Set-Cookie', ['uid=123;maxAge: 900000; httpOnly: true']);\n// 或者\nres.cookie(\"uid\",'123',{maxAge: 900000, httpOnly: true});\n```\n\n读取cookie\n\n```js\nconsole.log(req.getHeader('Cookie')); // 拿到所有cookie\n// 或者\nconsole.log(req.cookie.name);\n```\n\n## 10. Cookie 大小和数量的限制\n\n不同的浏览器对Cookie的大小和数量的限制不一样，一般，单个域名下设置的Cookie不应超过30个，且每个Cookie的大小不应超过4kb，超过以后，Cookie将会被忽略，不会被设置。\n\n\n## 11. 查看浏览器是否打开 Cookie 功能\n\n```js\nwindow.navigator.cookieEnabled // true\n```\n\n\n## 12. cookie 的共享策略是什么\n\ndomain和path共同决定了cookie可以被哪些url访问。\n\n访问一个url时，如果url的host与domain一致或者是domain的子域名，并且url的路径与path部分匹配，那么cookie才可以被读取。\n\n\n## 13. 跨域请求（CORS）中的cookie\n\n首先cookie的SameSite需要设置为None。\n\n其次对于将Access-Control-Allow-Credentials设置为true的接口（表示允许发送cookie），需要我们在发送ajax请求时，将withCredentials属性设为true。\n\n\n## 14. cookie的编码\n\n```js\ndocument.cookie = 'uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/caikuai;domain=edu.360.cn;secure;samesite=lax'\n```\n\n从document.cookie的赋值中我们可以看到，存在等于号、冒号、分号、空格、逗号、斜杠等特殊字符，因此当cookie的key和value中存在这几种符号时，需要对其进行编码，一般会用encodeURIComponent/decodeURIComponent进行操作。\n\n\nQ: 为什么不使用escape和encodeURI进行编码呢？\nA: 因为相比这两个api，encodeURIComponent可以将更多的字符进行编码，比如\"/\"。\n\n\n## 15. cookie与web安全\n\n### cookie如何应对XSS漏洞\n\nXSS漏洞的原理是，由于未对用户提交的表单数据或者url参数等数据做处理就显示在了页面上，导致用户提交的内容在页面上被做为html解析执行。\n\n常规方案：对特殊字符进行处理，如\"<\"和\">\"等进行转义。\n\ncookie的应对方案：对于用户利用script脚本来采集cookie信息，我们可以将重要的cookie信息设置为HttpOnly来避免cookie被js采集。\n\n### cookie如何应对CSRF攻击\n\nCSRF，中文名叫跨站请求伪造，原理是，用户登陆了A网站，然后因为某些原因访问了B网站（比如跳转等），B网站直接发送一个A网站的请求进行一些危险操作，由于A网站处于登陆状态，就发生了CSRF攻击（核心就是利用了cookie信息可以被跨站携带）！\n\n常规方案：采用验证码或token等。\n\ncookie的应对方案：由于CSRF攻击核心就是利用了cookie信息可以被跨站携带，那么我们可以对核心cookie的SameSite设置为Strict或Lax来避免。\n\n\n## 16. 不同的浏览器共享cookie吗?\n\n不同的浏览器互相不通信，彼此是独立的cookie。因此，我们在一个浏览器上登陆了某个网站，换到另一个浏览器上的时候需要重新登陆。\n\n\n## 17. cookie和localStorage/sessionStorage的差异\n\n\n| 特性           | cookie                                       | localstorage             | sessionstorage                               |\n| -------------- | -------------------------------------------- | ------------------------ | -------------------------------------------- |\n| 操作者         | 服务器和js                                   | js                       | js                                           |\n| 数据的生命期   | 可设置失效时间                               | 除非被清除，否则永久保存 | 仅在当前会话下有效，关闭页面或浏览器后被清除 |\n| 存放数据大小   | 4K左右                                       | 一般为5M                 | 一般为5M                                     |\n| 与服务器端通信 | 每次都会携带在HTTP头中每次都会携带在HTTP头中 | 不与服务器通信           | 不与服务器通信                               |\n| 易用性         | 原生的Cookie接口不友好，需要封装             | 接口易用                 | 接口易用                                     |\n\n\n## 18. 哪些信息适合放到cookie中\n\ncookie的增多无疑会加重网络请求的开销，而且每次请求都会将cookie完整的带上，因此对于那些“每次请求都必须要携带的信息（如身份信息、A/B分桶信息等）”，才适合放进cookie中，其他类型的数据建议放进localStorage中。","slug":"cookie18","published":1,"updated":"2023-03-20T13:14:52.531Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshq000qyt8wd7xy2iox","content":"<p>我们知道，HTTP是一种无状态协议，无状态是指服务端对于客户端每次发送的请求都认为它是一个新的请求，上一次会话和下一次会话没有联系。</p>\n<p>但是，很多场景下，我们需要知道下一次的会话和上一次的会话的关系（比如登陆之后我们需要记住登陆状态），这个时候就引入了Cookie和Session体系。</p>\n<p>Cookie： 客户端请求服务器时，如果服务器需要记录该用户状态，就通过response Headers向客户端浏览器颁发一个Cookie，而客户端浏览器会把Cookie保存起来。当浏览器再请求服务器时，浏览器把请求的网址连同该Cookie一同提交给服务器。服务器通过检查该Cookie来获取用户状态。</p>\n<p>Session： 当服务器接收到请求时，就从存储在服务器上的无数session信息中去查找客户端请求时带过来的cookie的状态。如果服务器中没有这条session信息则添加一条session信息。</p>\n<p>通常Cookie中存的是session信息经过计算后的唯一Id（sessionId）。</p>\n<h2 id=\"1-cookie存储在哪里？\"><a href=\"#1-cookie存储在哪里？\" class=\"headerlink\" title=\"1. cookie存储在哪里？\"></a>1. cookie存储在哪里？</h2><p>cookie一般是被浏览器以txt的形式存储在电脑硬盘中，供该浏览器进行读、写操作。</p>\n<h2 id=\"2-cookie是如何工作的？\"><a href=\"#2-cookie是如何工作的？\" class=\"headerlink\" title=\"2. cookie是如何工作的？\"></a>2. cookie是如何工作的？</h2><ul>\n<li>request：当浏览器发起一个请求时，浏览器会自动检查是否有相应的cookie，如果有则将cookie添加到Request Headers的Cookie字段中（cookie字段是很多name&#x3D;value以分号分隔的字符串）。</li>\n<li>response：当服务端需要种cookie时，在http请求的Response Headers中添加Set-Cookie字段，浏览器接收到之后会自动解析识别，将cookie种下。</li>\n</ul>\n<h2 id=\"3-cookie和session的区别？\"><a href=\"#3-cookie和session的区别？\" class=\"headerlink\" title=\"3. cookie和session的区别？\"></a>3. cookie和session的区别？</h2><ul>\n<li>存储位置不同： cookie数据存放在客户的浏览器上，session数据放在服务器上。</li>\n<li>存储大小不同： 一般单个cookie保存的数据不能超过4k, 单个域名最多保存30个cookie（不同浏览器有差异）；session则无大小和数量限制。</li>\n</ul>\n<h2 id=\"4-什么是session级别的cookie？\"><a href=\"#4-什么是session级别的cookie？\" class=\"headerlink\" title=\"4. 什么是session级别的cookie？\"></a>4. 什么是session级别的cookie？</h2><p>session级别的cookie只针对当前会话存在，会话终止则cookie消失。</p>\n<p>当cookie没有设置expires的时候，该cookie只会在网页会话期间存在，当浏览器退出的时候，该cookie就会消失。</p>\n<p>浏览器中的表现为Expires&#x2F;Max-Age的内容为Session。</p>\n<h2 id=\"5-cookie可以被谁来操作？\"><a href=\"#5-cookie可以被谁来操作？\" class=\"headerlink\" title=\"5. cookie可以被谁来操作？\"></a>5. cookie可以被谁来操作？</h2><p>服务端和js都可以读&#x2F;写cookie。</p>\n<h2 id=\"6-cookie各属性详解\"><a href=\"#6-cookie各属性详解\" class=\"headerlink\" title=\"6. cookie各属性详解\"></a>6. cookie各属性详解</h2><ul>\n<li>Name: cookie名</li>\n<li>Value: cookie值。</li>\n<li>Domain: cookie的域名。如果设成.example.com，那么子域名a.example.com和b.example.com，都可以使用.example.com的cookie;反之则不可以。</li>\n<li>Path: 允许读取cookie的url路径，一般设置为&#x2F;。</li>\n<li>Expires： cookie过期时间。不设置，则为Session会话期，页面退出时cookie失效。</li>\n<li>HttpOnly: 设置为true时，只有http能读取。js只能读取未设置HttpOnly的cookie。</li>\n<li>Secure: 标记为Secure的cookie，只有https的请求可以携带。</li>\n<li>SameSite: 限制第三方url是否可以携带cookie。有3个值：Strict&#x2F;Lax(默认)&#x2F;None。（chrome51新增属性，chrome80+强制执行）<ul>\n<li>Strict: 仅允许发送同站点请求的的cookie</li>\n<li>Lax: 允许部分第三方请求携带cookie，即导航到目标网址的get请求。包括超链接 ，预加载和get表单三种形式发送cookie</li>\n<li>None: 任意发送cookie，设置为None，（需要同时设置Secure，也就是说网站必须采用https）</li>\n</ul>\n</li>\n<li>Priority：优先级，chrome的提案（firefox不支持），定义了三种优先级，Low&#x2F;Medium&#x2F;High，当cookie数量超出时，低优先级的cookie会被优先清除。</li>\n</ul>\n<h2 id=\"7-js和服务端对cookie的操作有什么不同？\"><a href=\"#7-js和服务端对cookie的操作有什么不同？\" class=\"headerlink\" title=\"7. js和服务端对cookie的操作有什么不同？\"></a>7. js和服务端对cookie的操作有什么不同？</h2><p>cookie有一个属性是HttpOnly，HttpOnly被设置时，表明该cookie只能被http请求读取，不能被js读取，具体的表现是:document.cookie读取到的内容不包含设置了HttpOnly的cookie。</p>\n<h2 id=\"8-js如何操作cookie\"><a href=\"#8-js如何操作cookie\" class=\"headerlink\" title=\"8. js如何操作cookie\"></a>8. js如何操作cookie</h2><p>js操作读&#x2F;写cookie的api是document.cookie。</p>\n<p>读cookie <code>document.cookie</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span>); </span><br><span class=\"line\"><span class=\"comment\">// cna=8fDUF573wEQCAWoLI8izIL6X; xlly_s=1; t=4a2bcb7ef27d32dad6872f9124694e19; _tb_token_=e3e11308ee6fe; hng=CN%7Czh-CN%7CCNY%7C156; thw=cn;  v=0; </span></span><br></pre></td></tr></table></figure>\n\n<p>读取后的cookie是一个字符串，包含了所有cookie的name和value（用分号分隔），需要我们自行将cookie解析出来。</p>\n<p>写cookie</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> = <span class=\"string\">&#x27;uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/;secure;&#x27;</span></span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> = <span class=\"string\">&#x27;uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/caikuai;domain=edu.360.cn;secure;samesite=lax&#x27;</span> </span><br></pre></td></tr></table></figure>\n\n<p>一次只能写一个cookie，想要写多个cookie需要操作多次。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">删除cookie 只需要将一个已经存在的cookie名字过期时间设置为过去的时间即可。</span><br><span class=\"line\"></span><br><span class=\"line\">​```js</span><br><span class=\"line\">document.cookie = &#x27;uid=dkfywqkrhkwehf23;expires=&#x27; + new Date(0) + &#x27;;path=/;secure;&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>修改cookie 重新赋值就好，旧值会覆盖新值。</p>\n<p>注意：需要保证path和domain这两个值不变，否则会添加一个新的cookie。</p>\n<h2 id=\"9-服务端如何读写cookie\"><a href=\"#9-服务端如何读写cookie\" class=\"headerlink\" title=\"9. 服务端如何读写cookie\"></a>9. 服务端如何读写cookie</h2><p>第2节“cookie是如何工作的”告诉我们，服务端是可以读和写cookie的，从图中我们可以看到，写cookie时，一条Set-Cookie写入一条cookie。读cookie时，所有的cookie信息都被放进了cookie字段中。</p>\n<p>以express使用为例：</p>\n<p>写cookie</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">res.<span class=\"title function_\">setHeader</span>(<span class=\"string\">&#x27;Set-Cookie&#x27;</span>, [<span class=\"string\">&#x27;uid=123;maxAge: 900000; httpOnly: true&#x27;</span>]);</span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\">res.<span class=\"title function_\">cookie</span>(<span class=\"string\">&quot;uid&quot;</span>,<span class=\"string\">&#x27;123&#x27;</span>,&#123;<span class=\"attr\">maxAge</span>: <span class=\"number\">900000</span>, <span class=\"attr\">httpOnly</span>: <span class=\"literal\">true</span>&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>读取cookie</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(req.<span class=\"title function_\">getHeader</span>(<span class=\"string\">&#x27;Cookie&#x27;</span>)); <span class=\"comment\">// 拿到所有cookie</span></span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(req.<span class=\"property\">cookie</span>.<span class=\"property\">name</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"10-Cookie-大小和数量的限制\"><a href=\"#10-Cookie-大小和数量的限制\" class=\"headerlink\" title=\"10. Cookie 大小和数量的限制\"></a>10. Cookie 大小和数量的限制</h2><p>不同的浏览器对Cookie的大小和数量的限制不一样，一般，单个域名下设置的Cookie不应超过30个，且每个Cookie的大小不应超过4kb，超过以后，Cookie将会被忽略，不会被设置。</p>\n<h2 id=\"11-查看浏览器是否打开-Cookie-功能\"><a href=\"#11-查看浏览器是否打开-Cookie-功能\" class=\"headerlink\" title=\"11. 查看浏览器是否打开 Cookie 功能\"></a>11. 查看浏览器是否打开 Cookie 功能</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"property\">navigator</span>.<span class=\"property\">cookieEnabled</span> <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"12-cookie-的共享策略是什么\"><a href=\"#12-cookie-的共享策略是什么\" class=\"headerlink\" title=\"12. cookie 的共享策略是什么\"></a>12. cookie 的共享策略是什么</h2><p>domain和path共同决定了cookie可以被哪些url访问。</p>\n<p>访问一个url时，如果url的host与domain一致或者是domain的子域名，并且url的路径与path部分匹配，那么cookie才可以被读取。</p>\n<h2 id=\"13-跨域请求（CORS）中的cookie\"><a href=\"#13-跨域请求（CORS）中的cookie\" class=\"headerlink\" title=\"13. 跨域请求（CORS）中的cookie\"></a>13. 跨域请求（CORS）中的cookie</h2><p>首先cookie的SameSite需要设置为None。</p>\n<p>其次对于将Access-Control-Allow-Credentials设置为true的接口（表示允许发送cookie），需要我们在发送ajax请求时，将withCredentials属性设为true。</p>\n<h2 id=\"14-cookie的编码\"><a href=\"#14-cookie的编码\" class=\"headerlink\" title=\"14. cookie的编码\"></a>14. cookie的编码</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> = <span class=\"string\">&#x27;uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/caikuai;domain=edu.360.cn;secure;samesite=lax&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>从document.cookie的赋值中我们可以看到，存在等于号、冒号、分号、空格、逗号、斜杠等特殊字符，因此当cookie的key和value中存在这几种符号时，需要对其进行编码，一般会用encodeURIComponent&#x2F;decodeURIComponent进行操作。</p>\n<p>Q: 为什么不使用escape和encodeURI进行编码呢？<br>A: 因为相比这两个api，encodeURIComponent可以将更多的字符进行编码，比如”&#x2F;“。</p>\n<h2 id=\"15-cookie与web安全\"><a href=\"#15-cookie与web安全\" class=\"headerlink\" title=\"15. cookie与web安全\"></a>15. cookie与web安全</h2><h3 id=\"cookie如何应对XSS漏洞\"><a href=\"#cookie如何应对XSS漏洞\" class=\"headerlink\" title=\"cookie如何应对XSS漏洞\"></a>cookie如何应对XSS漏洞</h3><p>XSS漏洞的原理是，由于未对用户提交的表单数据或者url参数等数据做处理就显示在了页面上，导致用户提交的内容在页面上被做为html解析执行。</p>\n<p>常规方案：对特殊字符进行处理，如”&lt;”和”&gt;”等进行转义。</p>\n<p>cookie的应对方案：对于用户利用script脚本来采集cookie信息，我们可以将重要的cookie信息设置为HttpOnly来避免cookie被js采集。</p>\n<h3 id=\"cookie如何应对CSRF攻击\"><a href=\"#cookie如何应对CSRF攻击\" class=\"headerlink\" title=\"cookie如何应对CSRF攻击\"></a>cookie如何应对CSRF攻击</h3><p>CSRF，中文名叫跨站请求伪造，原理是，用户登陆了A网站，然后因为某些原因访问了B网站（比如跳转等），B网站直接发送一个A网站的请求进行一些危险操作，由于A网站处于登陆状态，就发生了CSRF攻击（核心就是利用了cookie信息可以被跨站携带）！</p>\n<p>常规方案：采用验证码或token等。</p>\n<p>cookie的应对方案：由于CSRF攻击核心就是利用了cookie信息可以被跨站携带，那么我们可以对核心cookie的SameSite设置为Strict或Lax来避免。</p>\n<h2 id=\"16-不同的浏览器共享cookie吗\"><a href=\"#16-不同的浏览器共享cookie吗\" class=\"headerlink\" title=\"16. 不同的浏览器共享cookie吗?\"></a>16. 不同的浏览器共享cookie吗?</h2><p>不同的浏览器互相不通信，彼此是独立的cookie。因此，我们在一个浏览器上登陆了某个网站，换到另一个浏览器上的时候需要重新登陆。</p>\n<h2 id=\"17-cookie和localStorage-x2F-sessionStorage的差异\"><a href=\"#17-cookie和localStorage-x2F-sessionStorage的差异\" class=\"headerlink\" title=\"17. cookie和localStorage&#x2F;sessionStorage的差异\"></a>17. cookie和localStorage&#x2F;sessionStorage的差异</h2><table>\n<thead>\n<tr>\n<th>特性</th>\n<th>cookie</th>\n<th>localstorage</th>\n<th>sessionstorage</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>操作者</td>\n<td>服务器和js</td>\n<td>js</td>\n<td>js</td>\n</tr>\n<tr>\n<td>数据的生命期</td>\n<td>可设置失效时间</td>\n<td>除非被清除，否则永久保存</td>\n<td>仅在当前会话下有效，关闭页面或浏览器后被清除</td>\n</tr>\n<tr>\n<td>存放数据大小</td>\n<td>4K左右</td>\n<td>一般为5M</td>\n<td>一般为5M</td>\n</tr>\n<tr>\n<td>与服务器端通信</td>\n<td>每次都会携带在HTTP头中每次都会携带在HTTP头中</td>\n<td>不与服务器通信</td>\n<td>不与服务器通信</td>\n</tr>\n<tr>\n<td>易用性</td>\n<td>原生的Cookie接口不友好，需要封装</td>\n<td>接口易用</td>\n<td>接口易用</td>\n</tr>\n</tbody></table>\n<h2 id=\"18-哪些信息适合放到cookie中\"><a href=\"#18-哪些信息适合放到cookie中\" class=\"headerlink\" title=\"18. 哪些信息适合放到cookie中\"></a>18. 哪些信息适合放到cookie中</h2><p>cookie的增多无疑会加重网络请求的开销，而且每次请求都会将cookie完整的带上，因此对于那些“每次请求都必须要携带的信息（如身份信息、A&#x2F;B分桶信息等）”，才适合放进cookie中，其他类型的数据建议放进localStorage中。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>我们知道，HTTP是一种无状态协议，无状态是指服务端对于客户端每次发送的请求都认为它是一个新的请求，上一次会话和下一次会话没有联系。</p>\n<p>但是，很多场景下，我们需要知道下一次的会话和上一次的会话的关系（比如登陆之后我们需要记住登陆状态），这个时候就引入了Cookie和Session体系。</p>\n<p>Cookie： 客户端请求服务器时，如果服务器需要记录该用户状态，就通过response Headers向客户端浏览器颁发一个Cookie，而客户端浏览器会把Cookie保存起来。当浏览器再请求服务器时，浏览器把请求的网址连同该Cookie一同提交给服务器。服务器通过检查该Cookie来获取用户状态。</p>\n<p>Session： 当服务器接收到请求时，就从存储在服务器上的无数session信息中去查找客户端请求时带过来的cookie的状态。如果服务器中没有这条session信息则添加一条session信息。</p>\n<p>通常Cookie中存的是session信息经过计算后的唯一Id（sessionId）。</p>\n<h2 id=\"1-cookie存储在哪里？\"><a href=\"#1-cookie存储在哪里？\" class=\"headerlink\" title=\"1. cookie存储在哪里？\"></a>1. cookie存储在哪里？</h2><p>cookie一般是被浏览器以txt的形式存储在电脑硬盘中，供该浏览器进行读、写操作。</p>\n<h2 id=\"2-cookie是如何工作的？\"><a href=\"#2-cookie是如何工作的？\" class=\"headerlink\" title=\"2. cookie是如何工作的？\"></a>2. cookie是如何工作的？</h2><ul>\n<li>request：当浏览器发起一个请求时，浏览器会自动检查是否有相应的cookie，如果有则将cookie添加到Request Headers的Cookie字段中（cookie字段是很多name&#x3D;value以分号分隔的字符串）。</li>\n<li>response：当服务端需要种cookie时，在http请求的Response Headers中添加Set-Cookie字段，浏览器接收到之后会自动解析识别，将cookie种下。</li>\n</ul>\n<h2 id=\"3-cookie和session的区别？\"><a href=\"#3-cookie和session的区别？\" class=\"headerlink\" title=\"3. cookie和session的区别？\"></a>3. cookie和session的区别？</h2><ul>\n<li>存储位置不同： cookie数据存放在客户的浏览器上，session数据放在服务器上。</li>\n<li>存储大小不同： 一般单个cookie保存的数据不能超过4k, 单个域名最多保存30个cookie（不同浏览器有差异）；session则无大小和数量限制。</li>\n</ul>\n<h2 id=\"4-什么是session级别的cookie？\"><a href=\"#4-什么是session级别的cookie？\" class=\"headerlink\" title=\"4. 什么是session级别的cookie？\"></a>4. 什么是session级别的cookie？</h2><p>session级别的cookie只针对当前会话存在，会话终止则cookie消失。</p>\n<p>当cookie没有设置expires的时候，该cookie只会在网页会话期间存在，当浏览器退出的时候，该cookie就会消失。</p>\n<p>浏览器中的表现为Expires&#x2F;Max-Age的内容为Session。</p>\n<h2 id=\"5-cookie可以被谁来操作？\"><a href=\"#5-cookie可以被谁来操作？\" class=\"headerlink\" title=\"5. cookie可以被谁来操作？\"></a>5. cookie可以被谁来操作？</h2><p>服务端和js都可以读&#x2F;写cookie。</p>\n<h2 id=\"6-cookie各属性详解\"><a href=\"#6-cookie各属性详解\" class=\"headerlink\" title=\"6. cookie各属性详解\"></a>6. cookie各属性详解</h2><ul>\n<li>Name: cookie名</li>\n<li>Value: cookie值。</li>\n<li>Domain: cookie的域名。如果设成.example.com，那么子域名a.example.com和b.example.com，都可以使用.example.com的cookie;反之则不可以。</li>\n<li>Path: 允许读取cookie的url路径，一般设置为&#x2F;。</li>\n<li>Expires： cookie过期时间。不设置，则为Session会话期，页面退出时cookie失效。</li>\n<li>HttpOnly: 设置为true时，只有http能读取。js只能读取未设置HttpOnly的cookie。</li>\n<li>Secure: 标记为Secure的cookie，只有https的请求可以携带。</li>\n<li>SameSite: 限制第三方url是否可以携带cookie。有3个值：Strict&#x2F;Lax(默认)&#x2F;None。（chrome51新增属性，chrome80+强制执行）<ul>\n<li>Strict: 仅允许发送同站点请求的的cookie</li>\n<li>Lax: 允许部分第三方请求携带cookie，即导航到目标网址的get请求。包括超链接 ，预加载和get表单三种形式发送cookie</li>\n<li>None: 任意发送cookie，设置为None，（需要同时设置Secure，也就是说网站必须采用https）</li>\n</ul>\n</li>\n<li>Priority：优先级，chrome的提案（firefox不支持），定义了三种优先级，Low&#x2F;Medium&#x2F;High，当cookie数量超出时，低优先级的cookie会被优先清除。</li>\n</ul>\n<h2 id=\"7-js和服务端对cookie的操作有什么不同？\"><a href=\"#7-js和服务端对cookie的操作有什么不同？\" class=\"headerlink\" title=\"7. js和服务端对cookie的操作有什么不同？\"></a>7. js和服务端对cookie的操作有什么不同？</h2><p>cookie有一个属性是HttpOnly，HttpOnly被设置时，表明该cookie只能被http请求读取，不能被js读取，具体的表现是:document.cookie读取到的内容不包含设置了HttpOnly的cookie。</p>\n<h2 id=\"8-js如何操作cookie\"><a href=\"#8-js如何操作cookie\" class=\"headerlink\" title=\"8. js如何操作cookie\"></a>8. js如何操作cookie</h2><p>js操作读&#x2F;写cookie的api是document.cookie。</p>\n<p>读cookie <code>document.cookie</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span>); </span><br><span class=\"line\"><span class=\"comment\">// cna=8fDUF573wEQCAWoLI8izIL6X; xlly_s=1; t=4a2bcb7ef27d32dad6872f9124694e19; _tb_token_=e3e11308ee6fe; hng=CN%7Czh-CN%7CCNY%7C156; thw=cn;  v=0; </span></span><br></pre></td></tr></table></figure>\n\n<p>读取后的cookie是一个字符串，包含了所有cookie的name和value（用分号分隔），需要我们自行将cookie解析出来。</p>\n<p>写cookie</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> = <span class=\"string\">&#x27;uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/;secure;&#x27;</span></span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> = <span class=\"string\">&#x27;uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/caikuai;domain=edu.360.cn;secure;samesite=lax&#x27;</span> </span><br></pre></td></tr></table></figure>\n\n<p>一次只能写一个cookie，想要写多个cookie需要操作多次。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">删除cookie 只需要将一个已经存在的cookie名字过期时间设置为过去的时间即可。</span><br><span class=\"line\"></span><br><span class=\"line\">​```js</span><br><span class=\"line\">document.cookie = &#x27;uid=dkfywqkrhkwehf23;expires=&#x27; + new Date(0) + &#x27;;path=/;secure;&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>修改cookie 重新赋值就好，旧值会覆盖新值。</p>\n<p>注意：需要保证path和domain这两个值不变，否则会添加一个新的cookie。</p>\n<h2 id=\"9-服务端如何读写cookie\"><a href=\"#9-服务端如何读写cookie\" class=\"headerlink\" title=\"9. 服务端如何读写cookie\"></a>9. 服务端如何读写cookie</h2><p>第2节“cookie是如何工作的”告诉我们，服务端是可以读和写cookie的，从图中我们可以看到，写cookie时，一条Set-Cookie写入一条cookie。读cookie时，所有的cookie信息都被放进了cookie字段中。</p>\n<p>以express使用为例：</p>\n<p>写cookie</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">res.<span class=\"title function_\">setHeader</span>(<span class=\"string\">&#x27;Set-Cookie&#x27;</span>, [<span class=\"string\">&#x27;uid=123;maxAge: 900000; httpOnly: true&#x27;</span>]);</span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\">res.<span class=\"title function_\">cookie</span>(<span class=\"string\">&quot;uid&quot;</span>,<span class=\"string\">&#x27;123&#x27;</span>,&#123;<span class=\"attr\">maxAge</span>: <span class=\"number\">900000</span>, <span class=\"attr\">httpOnly</span>: <span class=\"literal\">true</span>&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>读取cookie</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(req.<span class=\"title function_\">getHeader</span>(<span class=\"string\">&#x27;Cookie&#x27;</span>)); <span class=\"comment\">// 拿到所有cookie</span></span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(req.<span class=\"property\">cookie</span>.<span class=\"property\">name</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"10-Cookie-大小和数量的限制\"><a href=\"#10-Cookie-大小和数量的限制\" class=\"headerlink\" title=\"10. Cookie 大小和数量的限制\"></a>10. Cookie 大小和数量的限制</h2><p>不同的浏览器对Cookie的大小和数量的限制不一样，一般，单个域名下设置的Cookie不应超过30个，且每个Cookie的大小不应超过4kb，超过以后，Cookie将会被忽略，不会被设置。</p>\n<h2 id=\"11-查看浏览器是否打开-Cookie-功能\"><a href=\"#11-查看浏览器是否打开-Cookie-功能\" class=\"headerlink\" title=\"11. 查看浏览器是否打开 Cookie 功能\"></a>11. 查看浏览器是否打开 Cookie 功能</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"property\">navigator</span>.<span class=\"property\">cookieEnabled</span> <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"12-cookie-的共享策略是什么\"><a href=\"#12-cookie-的共享策略是什么\" class=\"headerlink\" title=\"12. cookie 的共享策略是什么\"></a>12. cookie 的共享策略是什么</h2><p>domain和path共同决定了cookie可以被哪些url访问。</p>\n<p>访问一个url时，如果url的host与domain一致或者是domain的子域名，并且url的路径与path部分匹配，那么cookie才可以被读取。</p>\n<h2 id=\"13-跨域请求（CORS）中的cookie\"><a href=\"#13-跨域请求（CORS）中的cookie\" class=\"headerlink\" title=\"13. 跨域请求（CORS）中的cookie\"></a>13. 跨域请求（CORS）中的cookie</h2><p>首先cookie的SameSite需要设置为None。</p>\n<p>其次对于将Access-Control-Allow-Credentials设置为true的接口（表示允许发送cookie），需要我们在发送ajax请求时，将withCredentials属性设为true。</p>\n<h2 id=\"14-cookie的编码\"><a href=\"#14-cookie的编码\" class=\"headerlink\" title=\"14. cookie的编码\"></a>14. cookie的编码</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> = <span class=\"string\">&#x27;uid=123;expires=Mon Jan 04 2022 17:42:40 GMT;path=/caikuai;domain=edu.360.cn;secure;samesite=lax&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>从document.cookie的赋值中我们可以看到，存在等于号、冒号、分号、空格、逗号、斜杠等特殊字符，因此当cookie的key和value中存在这几种符号时，需要对其进行编码，一般会用encodeURIComponent&#x2F;decodeURIComponent进行操作。</p>\n<p>Q: 为什么不使用escape和encodeURI进行编码呢？<br>A: 因为相比这两个api，encodeURIComponent可以将更多的字符进行编码，比如”&#x2F;“。</p>\n<h2 id=\"15-cookie与web安全\"><a href=\"#15-cookie与web安全\" class=\"headerlink\" title=\"15. cookie与web安全\"></a>15. cookie与web安全</h2><h3 id=\"cookie如何应对XSS漏洞\"><a href=\"#cookie如何应对XSS漏洞\" class=\"headerlink\" title=\"cookie如何应对XSS漏洞\"></a>cookie如何应对XSS漏洞</h3><p>XSS漏洞的原理是，由于未对用户提交的表单数据或者url参数等数据做处理就显示在了页面上，导致用户提交的内容在页面上被做为html解析执行。</p>\n<p>常规方案：对特殊字符进行处理，如”&lt;”和”&gt;”等进行转义。</p>\n<p>cookie的应对方案：对于用户利用script脚本来采集cookie信息，我们可以将重要的cookie信息设置为HttpOnly来避免cookie被js采集。</p>\n<h3 id=\"cookie如何应对CSRF攻击\"><a href=\"#cookie如何应对CSRF攻击\" class=\"headerlink\" title=\"cookie如何应对CSRF攻击\"></a>cookie如何应对CSRF攻击</h3><p>CSRF，中文名叫跨站请求伪造，原理是，用户登陆了A网站，然后因为某些原因访问了B网站（比如跳转等），B网站直接发送一个A网站的请求进行一些危险操作，由于A网站处于登陆状态，就发生了CSRF攻击（核心就是利用了cookie信息可以被跨站携带）！</p>\n<p>常规方案：采用验证码或token等。</p>\n<p>cookie的应对方案：由于CSRF攻击核心就是利用了cookie信息可以被跨站携带，那么我们可以对核心cookie的SameSite设置为Strict或Lax来避免。</p>\n<h2 id=\"16-不同的浏览器共享cookie吗\"><a href=\"#16-不同的浏览器共享cookie吗\" class=\"headerlink\" title=\"16. 不同的浏览器共享cookie吗?\"></a>16. 不同的浏览器共享cookie吗?</h2><p>不同的浏览器互相不通信，彼此是独立的cookie。因此，我们在一个浏览器上登陆了某个网站，换到另一个浏览器上的时候需要重新登陆。</p>\n<h2 id=\"17-cookie和localStorage-x2F-sessionStorage的差异\"><a href=\"#17-cookie和localStorage-x2F-sessionStorage的差异\" class=\"headerlink\" title=\"17. cookie和localStorage&#x2F;sessionStorage的差异\"></a>17. cookie和localStorage&#x2F;sessionStorage的差异</h2><table>\n<thead>\n<tr>\n<th>特性</th>\n<th>cookie</th>\n<th>localstorage</th>\n<th>sessionstorage</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>操作者</td>\n<td>服务器和js</td>\n<td>js</td>\n<td>js</td>\n</tr>\n<tr>\n<td>数据的生命期</td>\n<td>可设置失效时间</td>\n<td>除非被清除，否则永久保存</td>\n<td>仅在当前会话下有效，关闭页面或浏览器后被清除</td>\n</tr>\n<tr>\n<td>存放数据大小</td>\n<td>4K左右</td>\n<td>一般为5M</td>\n<td>一般为5M</td>\n</tr>\n<tr>\n<td>与服务器端通信</td>\n<td>每次都会携带在HTTP头中每次都会携带在HTTP头中</td>\n<td>不与服务器通信</td>\n<td>不与服务器通信</td>\n</tr>\n<tr>\n<td>易用性</td>\n<td>原生的Cookie接口不友好，需要封装</td>\n<td>接口易用</td>\n<td>接口易用</td>\n</tr>\n</tbody></table>\n<h2 id=\"18-哪些信息适合放到cookie中\"><a href=\"#18-哪些信息适合放到cookie中\" class=\"headerlink\" title=\"18. 哪些信息适合放到cookie中\"></a>18. 哪些信息适合放到cookie中</h2><p>cookie的增多无疑会加重网络请求的开销，而且每次请求都会将cookie完整的带上，因此对于那些“每次请求都必须要携带的信息（如身份信息、A&#x2F;B分桶信息等）”，才适合放进cookie中，其他类型的数据建议放进localStorage中。</p>\n"},{"title":"CSS8个常见的布局","date":"2022-06-21T15:17:22.000Z","description":"记录CSS中8个常见的布局","_content":"\n## 水平居中\n\n**1. 使用 text-align**\n\n```css\n.parent { text-align: center; }\n.child { display: inline-block; }\n```\n\n**2. 定宽块级元素**\n\n方法一：\n\n```css\n.child { margin: 0 auto; }\n```\n\n方法二：\n\n```css\n.child {\n    position: relative;\n    left: 50%;\n    margin-left: -150px;\t/* margin-left 值为宽度的一半 */\n}\n```\n\n方法三：\n\n```js\n.parent {\n    height: 300px;\n  \tposition: relative;\n}\n.child {\n    position: absolute;\n  \tleft: 0;\n  \tright: 0;\n  \tmargin: 0 auto;\n}\n```\n\n方法四：\n\n```css\n.parent { position: relative; }\n.child {\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n}\n```\n\n**3. flex 布局**\n\n```css\n.parent {\n    height: 300px;\n    display: flex;\n    justify-content: center;\n}\n```\n\n**4. grid 布局**\n\n```css\n.parent {\n    height: 300px;\n    display: grid;\n    /* 方法一 */\n    justify-items: center;\n    /* 方法二 */\n    justify-content: center;\n}\n.child {\n    /* 方法三 */\n    margin: auto;\n}\n```\n\n\n\n## 垂直居中\n\n**1. 行内块级元素**\n\n```css\n.parent {\n    line-height: 500px;\n}\n.child {\n    display: inline-block;\n    vertical-align: middle;\n}\n```\n\n**2. 定位方式**\n\n方法一：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    top: 50%;\n    margin-top: -150px; /* margin-top 值为高度的一半 */\n}\n```\n\n方法二：\n\n```css\n.parent {\n  \tposition: relative;\n}\n.child {\n    height: 300px;\n    position: absolute;\n  \ttop: 0;\n  \tbottom: 0;\n  \tmargin: auto;\n}\n```\n\n方法三：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n}\n```\n\n**3. flex 布局**\n\n```css\n.parent {\n    display: flex;\n    /* 方法一 */\n    align-items: center;\n}\n.child {\n    /* 方法二 */\n    margin: auto;\n}\n```\n\n**4. grid 布局**\n\n```css\n.parent {\n    display: grid;\n    /* 方法一 */\n    align-items: center;\n    /* 方法二 */\n    align-content: center;\n}\n.child {\n    /* 方法三 */\n    margin: auto;\n    /* 方法四 */\n    align-self: center;\n}\n```\n\n\n\n## 水平垂直居中\n\n**1. 行内块级元素**\n\n```css\n.parent {\n    line-height: 500px;\n    text-align: center;\n}\n.child {\n    diaplay: inline-block;\n    vertical-align: middle;\n}\n```\n\n**2. 定位方式**\n\n方法一：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    left: calc(50% - 150px);\n    top: calc(50% - 150px);\n}\n```\n\n方法二：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -150px;\n    margin-top: -150px;\n}\n```\n\n方法三：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    margin: auto;\n}\n```\n\n方法四：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n}\n```\n\n**3. flex 布局**\n\n```css\n.parent {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.child {\n    /* 方法二 */\n    margin: auto;\n}\n```\n\n**4. grid 布局**\n\n```css\n.parent {\n    display: grid;\n    /* items属性 */\n    align-items: center;\n    justify-items: center;\n    /* items的缩写 */\n    place-items: center;\n    \n    /* content属性 */\n    align-content: center;\n    justify-content: center;\n    /* content的缩写 */\n    place-content: center;\n}\n.child {\n    /* 或者 margin auto */\n    margin: auto;\n    \n    /* 或者self属性 */\n    align-self: center;\n    justify-self: center;\n    /* self的缩写 */\n    place-self: center;\n}\n```\n\n\n\n## 两列布局\n\n所谓的两列布局就是一列定宽(也有可能由子元素决定宽度)，一列自适应的布局。\n\n![04_两列布局.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d9ab7fc2f1eb471eb1a82838921b3aae~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n**1. float + calc()**\n\n```css\n.left {\n    float: left;\n}\n.right {\n    float: left; \n    width: calc(100% - 200px);\n}\n```\n\n**2. float + margin-left**\n\n```css\n.left {\n    float: left;\n}\n.right {\n    margin-left: 200px;\n}\n```\n\n**3. absolute + margin-left**\n\n```css\n.left {\n    position: absolute;\n}\n.right {\n    margin-left: 200px;\n}\n```\n\n**4. float + overflow**\n\n```css\n.left {\n    float: left;\n}\n.right {\n    /* overflow创建一个BFC完成自适应 */\n    overflow: hidden;\n}\n```\n\n**5. flex 布局**\n\n```css\n.container {\n    display: flex;\n}\n.right { flex: 1; }\n```\n\n**6. grid 布局**\n\n```css\n.container {\n    display: grid;\n    grid-template-columns: auto 1fr;\n}\n```\n\n\n\n## 三列布局\n\n三列布局主要分为两种：\n\n- 第一种是前两列定宽，最后一列自适应，这一种本质上与两列布局没有什么区别，可以参照两列布局实现。\n- 第二种是前后两列定宽，中间自适应。\n\n![05_三列布局.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70c32186e66b4d7992a5a2f795b664ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n**1. position**\n\n```css\n.left {\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n.center {\n    width: calc(100% - 400px);\n    margin-left: 200px;\n    margin-right: 200px;\n}\n.right {\n    position: absolute;\n    right: 0;\n    top: 0;\n}\n```\n\n**2. flex 布局**\n\n```css\n.container { display: flex; }\n.center { flex: 1; }\n```\n\n**3. grid 布局**\n\n```css\n.container {\n    display: grid;\n    grid-template-columns: auto 1fr auto;\n}\n```\n\n\n\n## 等分布局\n\n等分布局就是将一个容器平均分成几等份，这里以 4 等分为例。\n\n**1. 浮动 + 百分比**\n\n```css\n.item {\n    float: left;\n    width: 25%;\n}\n```\n\n**2. 行内块级 + 百分比**\n\n```css\n.container {\n    font-size: 0;\n}\n.item {\n    display: inline-block;\n    width: 25%;\n}\n```\n\n**3. flex 布局**\n\n```css\n.container { display: flex; }\n.item { flex: 1; }\n```\n\n**4. grid 布局**\n\n```css\n.container {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n}\n```\n\n\n\n## Sticky Footer布局\n\nSticky Footer布局是页面内容不够长时，底部栏就会固定到浏览器的底部；如果足够长时，底部栏就后跟随在内容的后面。\n\n![07_Sticky Footer布局.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b4571c2f11445d983243d4bbb7648e0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n**1. 绝对定位**\n\n```css\nhtml,\nbody {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\n.main {\n  position: relative;\n  min-height: 100%;\n}\n.bottom {\n  position: absolute;\n  width: 100%;\n  height: 100px;\n  bottom: 0;\n}\n```\n\n**2. calc 函数**\n\n``` css\n.container {\n    min-height: calc(100vh - 200px);\n}\n```\n\n**3. flex 布局**\n\n```css\n.main {\n    display: flex;\n    flex-flow: column;\n    min-height: 100vh;\n}\n.container {\n    flex: 1;\n}\n```\n\n**4. grid**\n\n```css\n.main {\n    display: grid;\n    grid-template-rows: auto 1fr auto;\n    min-height: 100vh;\n}\n```\n\n\n\n\n\n## 全屏布局\n\n全部布局主要应用在后台，主要效果如下所示：\n\n![08_全屏布局.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d73b7dae92dd44f5b7c80fb39509f2d2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n**1. calc 函数**\n\n```css\n.content {\n    overflow: hidden;\n    height: calc(100vh - 200px);\n}\n.left {\n    height: 100%;\n}\n.right {\n    overflow: auto;\n    height: 100%;\n}\n```\n\n**2. flex**\n\n```css\n.container {\n    display: flex;\n    flex-flow: column;\n}\n.content {\n    overflow: auto;\n    flex: 1;\n}\n```\n\n**3. gird**\n\n```css\n.container {\n    display: grid;\n    grid-template-rows: auto 1fr auto;\n}\n.content {\n    overflow: auto;\n}\n```\n","source":"_posts/css-basic-layout.md","raw":"---\ntitle: CSS8个常见的布局\ndate: 2022-06-21 23:17:22\ntags:\ncategories: 前端\ndescription: 记录CSS中8个常见的布局\n---\n\n## 水平居中\n\n**1. 使用 text-align**\n\n```css\n.parent { text-align: center; }\n.child { display: inline-block; }\n```\n\n**2. 定宽块级元素**\n\n方法一：\n\n```css\n.child { margin: 0 auto; }\n```\n\n方法二：\n\n```css\n.child {\n    position: relative;\n    left: 50%;\n    margin-left: -150px;\t/* margin-left 值为宽度的一半 */\n}\n```\n\n方法三：\n\n```js\n.parent {\n    height: 300px;\n  \tposition: relative;\n}\n.child {\n    position: absolute;\n  \tleft: 0;\n  \tright: 0;\n  \tmargin: 0 auto;\n}\n```\n\n方法四：\n\n```css\n.parent { position: relative; }\n.child {\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n}\n```\n\n**3. flex 布局**\n\n```css\n.parent {\n    height: 300px;\n    display: flex;\n    justify-content: center;\n}\n```\n\n**4. grid 布局**\n\n```css\n.parent {\n    height: 300px;\n    display: grid;\n    /* 方法一 */\n    justify-items: center;\n    /* 方法二 */\n    justify-content: center;\n}\n.child {\n    /* 方法三 */\n    margin: auto;\n}\n```\n\n\n\n## 垂直居中\n\n**1. 行内块级元素**\n\n```css\n.parent {\n    line-height: 500px;\n}\n.child {\n    display: inline-block;\n    vertical-align: middle;\n}\n```\n\n**2. 定位方式**\n\n方法一：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    top: 50%;\n    margin-top: -150px; /* margin-top 值为高度的一半 */\n}\n```\n\n方法二：\n\n```css\n.parent {\n  \tposition: relative;\n}\n.child {\n    height: 300px;\n    position: absolute;\n  \ttop: 0;\n  \tbottom: 0;\n  \tmargin: auto;\n}\n```\n\n方法三：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n}\n```\n\n**3. flex 布局**\n\n```css\n.parent {\n    display: flex;\n    /* 方法一 */\n    align-items: center;\n}\n.child {\n    /* 方法二 */\n    margin: auto;\n}\n```\n\n**4. grid 布局**\n\n```css\n.parent {\n    display: grid;\n    /* 方法一 */\n    align-items: center;\n    /* 方法二 */\n    align-content: center;\n}\n.child {\n    /* 方法三 */\n    margin: auto;\n    /* 方法四 */\n    align-self: center;\n}\n```\n\n\n\n## 水平垂直居中\n\n**1. 行内块级元素**\n\n```css\n.parent {\n    line-height: 500px;\n    text-align: center;\n}\n.child {\n    diaplay: inline-block;\n    vertical-align: middle;\n}\n```\n\n**2. 定位方式**\n\n方法一：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    left: calc(50% - 150px);\n    top: calc(50% - 150px);\n}\n```\n\n方法二：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -150px;\n    margin-top: -150px;\n}\n```\n\n方法三：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    margin: auto;\n}\n```\n\n方法四：\n\n```css\n.parent {\n    position: relative;\n}\n.child {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n}\n```\n\n**3. flex 布局**\n\n```css\n.parent {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.child {\n    /* 方法二 */\n    margin: auto;\n}\n```\n\n**4. grid 布局**\n\n```css\n.parent {\n    display: grid;\n    /* items属性 */\n    align-items: center;\n    justify-items: center;\n    /* items的缩写 */\n    place-items: center;\n    \n    /* content属性 */\n    align-content: center;\n    justify-content: center;\n    /* content的缩写 */\n    place-content: center;\n}\n.child {\n    /* 或者 margin auto */\n    margin: auto;\n    \n    /* 或者self属性 */\n    align-self: center;\n    justify-self: center;\n    /* self的缩写 */\n    place-self: center;\n}\n```\n\n\n\n## 两列布局\n\n所谓的两列布局就是一列定宽(也有可能由子元素决定宽度)，一列自适应的布局。\n\n![04_两列布局.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d9ab7fc2f1eb471eb1a82838921b3aae~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n**1. float + calc()**\n\n```css\n.left {\n    float: left;\n}\n.right {\n    float: left; \n    width: calc(100% - 200px);\n}\n```\n\n**2. float + margin-left**\n\n```css\n.left {\n    float: left;\n}\n.right {\n    margin-left: 200px;\n}\n```\n\n**3. absolute + margin-left**\n\n```css\n.left {\n    position: absolute;\n}\n.right {\n    margin-left: 200px;\n}\n```\n\n**4. float + overflow**\n\n```css\n.left {\n    float: left;\n}\n.right {\n    /* overflow创建一个BFC完成自适应 */\n    overflow: hidden;\n}\n```\n\n**5. flex 布局**\n\n```css\n.container {\n    display: flex;\n}\n.right { flex: 1; }\n```\n\n**6. grid 布局**\n\n```css\n.container {\n    display: grid;\n    grid-template-columns: auto 1fr;\n}\n```\n\n\n\n## 三列布局\n\n三列布局主要分为两种：\n\n- 第一种是前两列定宽，最后一列自适应，这一种本质上与两列布局没有什么区别，可以参照两列布局实现。\n- 第二种是前后两列定宽，中间自适应。\n\n![05_三列布局.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70c32186e66b4d7992a5a2f795b664ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n**1. position**\n\n```css\n.left {\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n.center {\n    width: calc(100% - 400px);\n    margin-left: 200px;\n    margin-right: 200px;\n}\n.right {\n    position: absolute;\n    right: 0;\n    top: 0;\n}\n```\n\n**2. flex 布局**\n\n```css\n.container { display: flex; }\n.center { flex: 1; }\n```\n\n**3. grid 布局**\n\n```css\n.container {\n    display: grid;\n    grid-template-columns: auto 1fr auto;\n}\n```\n\n\n\n## 等分布局\n\n等分布局就是将一个容器平均分成几等份，这里以 4 等分为例。\n\n**1. 浮动 + 百分比**\n\n```css\n.item {\n    float: left;\n    width: 25%;\n}\n```\n\n**2. 行内块级 + 百分比**\n\n```css\n.container {\n    font-size: 0;\n}\n.item {\n    display: inline-block;\n    width: 25%;\n}\n```\n\n**3. flex 布局**\n\n```css\n.container { display: flex; }\n.item { flex: 1; }\n```\n\n**4. grid 布局**\n\n```css\n.container {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n}\n```\n\n\n\n## Sticky Footer布局\n\nSticky Footer布局是页面内容不够长时，底部栏就会固定到浏览器的底部；如果足够长时，底部栏就后跟随在内容的后面。\n\n![07_Sticky Footer布局.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b4571c2f11445d983243d4bbb7648e0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n**1. 绝对定位**\n\n```css\nhtml,\nbody {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\n.main {\n  position: relative;\n  min-height: 100%;\n}\n.bottom {\n  position: absolute;\n  width: 100%;\n  height: 100px;\n  bottom: 0;\n}\n```\n\n**2. calc 函数**\n\n``` css\n.container {\n    min-height: calc(100vh - 200px);\n}\n```\n\n**3. flex 布局**\n\n```css\n.main {\n    display: flex;\n    flex-flow: column;\n    min-height: 100vh;\n}\n.container {\n    flex: 1;\n}\n```\n\n**4. grid**\n\n```css\n.main {\n    display: grid;\n    grid-template-rows: auto 1fr auto;\n    min-height: 100vh;\n}\n```\n\n\n\n\n\n## 全屏布局\n\n全部布局主要应用在后台，主要效果如下所示：\n\n![08_全屏布局.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d73b7dae92dd44f5b7c80fb39509f2d2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n**1. calc 函数**\n\n```css\n.content {\n    overflow: hidden;\n    height: calc(100vh - 200px);\n}\n.left {\n    height: 100%;\n}\n.right {\n    overflow: auto;\n    height: 100%;\n}\n```\n\n**2. flex**\n\n```css\n.container {\n    display: flex;\n    flex-flow: column;\n}\n.content {\n    overflow: auto;\n    flex: 1;\n}\n```\n\n**3. gird**\n\n```css\n.container {\n    display: grid;\n    grid-template-rows: auto 1fr auto;\n}\n.content {\n    overflow: auto;\n}\n```\n","slug":"css-basic-layout","published":1,"updated":"2022-06-21T15:20:10.372Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshr000tyt8w0tnefxdj","content":"<h2 id=\"水平居中\"><a href=\"#水平居中\" class=\"headerlink\" title=\"水平居中\"></a>水平居中</h2><p><strong>1. 使用 text-align</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123; <span class=\"attribute\">text-align</span>: center; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123; <span class=\"attribute\">display</span>: inline-block; &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 定宽块级元素</strong></p>\n<p>方法一：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.child</span> &#123; <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法二：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: -<span class=\"number\">150px</span>;\t<span class=\"comment\">/* margin-left 值为宽度的一半 */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法三：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.<span class=\"property\">parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">height</span>: 300px;</span><br><span class=\"line\">  \t<span class=\"attr\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">.<span class=\"property\">child</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">position</span>: absolute;</span><br><span class=\"line\">  \t<span class=\"attr\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  \t<span class=\"attr\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  \t<span class=\"attr\">margin</span>: <span class=\"number\">0</span> auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法四：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123; <span class=\"attribute\">position</span>: relative; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateX</span>(-<span class=\"number\">50%</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">300px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">300px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法一 */</span></span><br><span class=\"line\">    justify-items: center;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法二 */</span></span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法三 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"垂直居中\"><a href=\"#垂直居中\" class=\"headerlink\" title=\"垂直居中\"></a>垂直居中</h2><p><strong>1. 行内块级元素</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">500px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 定位方式</strong></p>\n<p>方法一：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: -<span class=\"number\">150px</span>; <span class=\"comment\">/* margin-top 值为高度的一半 */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法二：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">  \t<span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">300px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  \t<span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  \t<span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  \t<span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法三：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateY</span>(-<span class=\"number\">50%</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法一 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法二 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法一 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法二 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-content</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法三 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法四 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-self</span>: center;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"水平垂直居中\"><a href=\"#水平垂直居中\" class=\"headerlink\" title=\"水平垂直居中\"></a>水平垂直居中</h2><p><strong>1. 行内块级元素</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">500px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    diaplay: inline-block;</span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 定位方式</strong></p>\n<p>方法一：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">50%</span> - <span class=\"number\">150px</span>);</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">50%</span> - <span class=\"number\">150px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法二：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: -<span class=\"number\">150px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: -<span class=\"number\">150px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法三：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法四：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-<span class=\"number\">50%</span>, -<span class=\"number\">50%</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法二 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"comment\">/* items属性 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">    justify-items: center;</span><br><span class=\"line\">    <span class=\"comment\">/* items的缩写 */</span></span><br><span class=\"line\">    place-items: center;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/* content属性 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-content</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">    <span class=\"comment\">/* content的缩写 */</span></span><br><span class=\"line\">    place-<span class=\"attribute\">content</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 或者 margin auto */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/* 或者self属性 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-self</span>: center;</span><br><span class=\"line\">    justify-self: center;</span><br><span class=\"line\">    <span class=\"comment\">/* self的缩写 */</span></span><br><span class=\"line\">    place-self: center;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"两列布局\"><a href=\"#两列布局\" class=\"headerlink\" title=\"两列布局\"></a>两列布局</h2><p>所谓的两列布局就是一列定宽(也有可能由子元素决定宽度)，一列自适应的布局。</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d9ab7fc2f1eb471eb1a82838921b3aae~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"04_两列布局.gif\"></p>\n<p><strong>1. float + calc()</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left; </span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">100%</span> - <span class=\"number\">200px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. float + margin-left</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. absolute + margin-left</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. float + overflow</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* overflow创建一个BFC完成自适应 */</span></span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>5. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123; <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>; &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>6. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"attribute\">grid-template-columns</span>: auto <span class=\"number\">1</span>fr;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"三列布局\"><a href=\"#三列布局\" class=\"headerlink\" title=\"三列布局\"></a>三列布局</h2><p>三列布局主要分为两种：</p>\n<ul>\n<li>第一种是前两列定宽，最后一列自适应，这一种本质上与两列布局没有什么区别，可以参照两列布局实现。</li>\n<li>第二种是前后两列定宽，中间自适应。</li>\n</ul>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70c32186e66b4d7992a5a2f795b664ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"05_三列布局.gif\"></p>\n<p><strong>1. position</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.center</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">100%</span> - <span class=\"number\">400px</span>);</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-right</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123; <span class=\"attribute\">display</span>: flex; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.center</span> &#123; <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>; &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"attribute\">grid-template-columns</span>: auto <span class=\"number\">1</span>fr auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"等分布局\"><a href=\"#等分布局\" class=\"headerlink\" title=\"等分布局\"></a>等分布局</h2><p>等分布局就是将一个容器平均分成几等份，这里以 4 等分为例。</p>\n<p><strong>1. 浮动 + 百分比</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.item</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">25%</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 行内块级 + 百分比</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.item</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">25%</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123; <span class=\"attribute\">display</span>: flex; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.item</span> &#123; <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>; &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"attribute\">grid-template-columns</span>: <span class=\"built_in\">repeat</span>(<span class=\"number\">4</span>, <span class=\"number\">1</span>fr);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Sticky-Footer布局\"><a href=\"#Sticky-Footer布局\" class=\"headerlink\" title=\"Sticky Footer布局\"></a>Sticky Footer布局</h2><p>Sticky Footer布局是页面内容不够长时，底部栏就会固定到浏览器的底部；如果足够长时，底部栏就后跟随在内容的后面。</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b4571c2f11445d983243d4bbb7648e0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"07_Sticky Footer布局.png\"></p>\n<p><strong>1. 绝对定位</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">html</span>,</span><br><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">  <span class=\"attribute\">min-height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.bottom</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. calc 函数</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">min-height</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">100vh</span> - <span class=\"number\">200px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">flex-flow</span>: column;</span><br><span class=\"line\">    <span class=\"attribute\">min-height</span>: <span class=\"number\">100vh</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. grid</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"attribute\">grid-template-rows</span>: auto <span class=\"number\">1</span>fr auto;</span><br><span class=\"line\">    <span class=\"attribute\">min-height</span>: <span class=\"number\">100vh</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"全屏布局\"><a href=\"#全屏布局\" class=\"headerlink\" title=\"全屏布局\"></a>全屏布局</h2><p>全部布局主要应用在后台，主要效果如下所示：</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d73b7dae92dd44f5b7c80fb39509f2d2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"08_全屏布局.png\"></p>\n<p><strong>1. calc 函数</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">100vh</span> - <span class=\"number\">200px</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. flex</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">flex-flow</span>: column;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">    <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. gird</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"attribute\">grid-template-rows</span>: auto <span class=\"number\">1</span>fr auto;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"水平居中\"><a href=\"#水平居中\" class=\"headerlink\" title=\"水平居中\"></a>水平居中</h2><p><strong>1. 使用 text-align</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123; <span class=\"attribute\">text-align</span>: center; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123; <span class=\"attribute\">display</span>: inline-block; &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 定宽块级元素</strong></p>\n<p>方法一：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.child</span> &#123; <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法二：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: -<span class=\"number\">150px</span>;\t<span class=\"comment\">/* margin-left 值为宽度的一半 */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法三：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.<span class=\"property\">parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">height</span>: 300px;</span><br><span class=\"line\">  \t<span class=\"attr\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">.<span class=\"property\">child</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">position</span>: absolute;</span><br><span class=\"line\">  \t<span class=\"attr\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  \t<span class=\"attr\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  \t<span class=\"attr\">margin</span>: <span class=\"number\">0</span> auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法四：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123; <span class=\"attribute\">position</span>: relative; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateX</span>(-<span class=\"number\">50%</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">300px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">300px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法一 */</span></span><br><span class=\"line\">    justify-items: center;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法二 */</span></span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法三 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"垂直居中\"><a href=\"#垂直居中\" class=\"headerlink\" title=\"垂直居中\"></a>垂直居中</h2><p><strong>1. 行内块级元素</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">500px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 定位方式</strong></p>\n<p>方法一：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: -<span class=\"number\">150px</span>; <span class=\"comment\">/* margin-top 值为高度的一半 */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法二：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">  \t<span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">300px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  \t<span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  \t<span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  \t<span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法三：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateY</span>(-<span class=\"number\">50%</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法一 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法二 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法一 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法二 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-content</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法三 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法四 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-self</span>: center;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"水平垂直居中\"><a href=\"#水平垂直居中\" class=\"headerlink\" title=\"水平垂直居中\"></a>水平垂直居中</h2><p><strong>1. 行内块级元素</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">500px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    diaplay: inline-block;</span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 定位方式</strong></p>\n<p>方法一：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">50%</span> - <span class=\"number\">150px</span>);</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">50%</span> - <span class=\"number\">150px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法二：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: -<span class=\"number\">150px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: -<span class=\"number\">150px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法三：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方法四：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-<span class=\"number\">50%</span>, -<span class=\"number\">50%</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 方法二 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"comment\">/* items属性 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">    justify-items: center;</span><br><span class=\"line\">    <span class=\"comment\">/* items的缩写 */</span></span><br><span class=\"line\">    place-items: center;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/* content属性 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-content</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">    <span class=\"comment\">/* content的缩写 */</span></span><br><span class=\"line\">    place-<span class=\"attribute\">content</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* 或者 margin auto */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/* 或者self属性 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-self</span>: center;</span><br><span class=\"line\">    justify-self: center;</span><br><span class=\"line\">    <span class=\"comment\">/* self的缩写 */</span></span><br><span class=\"line\">    place-self: center;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"两列布局\"><a href=\"#两列布局\" class=\"headerlink\" title=\"两列布局\"></a>两列布局</h2><p>所谓的两列布局就是一列定宽(也有可能由子元素决定宽度)，一列自适应的布局。</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d9ab7fc2f1eb471eb1a82838921b3aae~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"04_两列布局.gif\"></p>\n<p><strong>1. float + calc()</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left; </span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">100%</span> - <span class=\"number\">200px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. float + margin-left</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. absolute + margin-left</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. float + overflow</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* overflow创建一个BFC完成自适应 */</span></span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>5. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123; <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>; &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>6. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"attribute\">grid-template-columns</span>: auto <span class=\"number\">1</span>fr;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"三列布局\"><a href=\"#三列布局\" class=\"headerlink\" title=\"三列布局\"></a>三列布局</h2><p>三列布局主要分为两种：</p>\n<ul>\n<li>第一种是前两列定宽，最后一列自适应，这一种本质上与两列布局没有什么区别，可以参照两列布局实现。</li>\n<li>第二种是前后两列定宽，中间自适应。</li>\n</ul>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70c32186e66b4d7992a5a2f795b664ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"05_三列布局.gif\"></p>\n<p><strong>1. position</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.center</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">100%</span> - <span class=\"number\">400px</span>);</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-right</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123; <span class=\"attribute\">display</span>: flex; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.center</span> &#123; <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>; &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"attribute\">grid-template-columns</span>: auto <span class=\"number\">1</span>fr auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"等分布局\"><a href=\"#等分布局\" class=\"headerlink\" title=\"等分布局\"></a>等分布局</h2><p>等分布局就是将一个容器平均分成几等份，这里以 4 等分为例。</p>\n<p><strong>1. 浮动 + 百分比</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.item</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">25%</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 行内块级 + 百分比</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.item</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">25%</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123; <span class=\"attribute\">display</span>: flex; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.item</span> &#123; <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>; &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. grid 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"attribute\">grid-template-columns</span>: <span class=\"built_in\">repeat</span>(<span class=\"number\">4</span>, <span class=\"number\">1</span>fr);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Sticky-Footer布局\"><a href=\"#Sticky-Footer布局\" class=\"headerlink\" title=\"Sticky Footer布局\"></a>Sticky Footer布局</h2><p>Sticky Footer布局是页面内容不够长时，底部栏就会固定到浏览器的底部；如果足够长时，底部栏就后跟随在内容的后面。</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b4571c2f11445d983243d4bbb7648e0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"07_Sticky Footer布局.png\"></p>\n<p><strong>1. 绝对定位</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">html</span>,</span><br><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">  <span class=\"attribute\">min-height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.bottom</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. calc 函数</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">min-height</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">100vh</span> - <span class=\"number\">200px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. flex 布局</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">flex-flow</span>: column;</span><br><span class=\"line\">    <span class=\"attribute\">min-height</span>: <span class=\"number\">100vh</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. grid</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"attribute\">grid-template-rows</span>: auto <span class=\"number\">1</span>fr auto;</span><br><span class=\"line\">    <span class=\"attribute\">min-height</span>: <span class=\"number\">100vh</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"全屏布局\"><a href=\"#全屏布局\" class=\"headerlink\" title=\"全屏布局\"></a>全屏布局</h2><p>全部布局主要应用在后台，主要效果如下所示：</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d73b7dae92dd44f5b7c80fb39509f2d2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"08_全屏布局.png\"></p>\n<p><strong>1. calc 函数</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">100vh</span> - <span class=\"number\">200px</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.left</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.right</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. flex</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">flex-flow</span>: column;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">    <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. gird</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">    <span class=\"attribute\">grid-template-rows</span>: auto <span class=\"number\">1</span>fr auto;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"防抖与节流","date":"2023-02-15T13:30:01.000Z","description":"在前端开发中会遇到一些频繁的事件触发，比如：resize、scroll、mousedown、mousemove、keyup、keydown。频繁触发很容易造成一些性能问题，目前解决这种性能问题最常用的就是防抖和节流。","_content":"\n在前端开发中会遇到一些频繁的事件触发，比如：resize、scroll、mousedown、mousemove、keyup、keydown。频繁触发很容易造成一些性能问题，目前解决这种性能问题最常用的就是防抖和节流。\n\n\n\n## 防抖\n\n防抖(debounce)，**在事件被触发n秒后再执行回调，如果在这n秒内又被触发，则重新计时**。\n\n防抖的原理就是：你尽管触发事件，但是我一定在事件触发 n 秒后才执行，如果你在一个事件触发的 n 秒内又触发了这个事件，那我就以新的事件的时间为准，n 秒后才执行，总之，就是要等你触发完事件 n 秒内不再触发事件才执行。\n\n实现一个简单的防抖：\n\n```js\n// 第二版\nfunction debounce(func, wait) {\n    var timeout;\n\n    return function () {\n        var context = this;\n        var args = arguments;\n\n        clearTimeout(timeout)\n        timeout = setTimeout(function(){\n            func.apply(context, args)\n        }, wait);\n    }\n}\n```\n\n\n\n## 节流\n\n节流(throttle)，**规定在一个单位时间内，只能触发一次函数。如果这个单位时间内触发多次函数，只有一次生效**。\n\n节流的原理：如果你持续触发事件，每隔一段时间，只执行一次事件。\n\n实现一个简单的节流：\n\n```js\n// 使用时间戳实现\nfunction throttle(func, wait) {\n    var context, args;\n    var previous = 0;\n\n    return function() {\n        var now = +new Date();\n        context = this;\n        args = arguments;\n        if (now - previous > wait) {\n            func.apply(context, args);\n            previous = now;\n        }\n    }\n}\n\n// 使用定时器实现\nfunction throttle(func, wait) {\n    var timeout;\n    var previous = 0;\n\n    return function() {\n        context = this;\n        args = arguments;\n        if (!timeout) {\n            timeout = setTimeout(function(){\n                timeout = null;\n                func.apply(context, args)\n            }, wait)\n        }\n\n    }\n}\n```\n\n\n\n## 区别\n\n相同点：\n\n- 都可以通过 setTimeout 实现\n- 都是为了降低回调执行频率，节省计算资源\n\n不同点：\n\n- 防抖一段时间内利连续触发事件，只在最后执行一次；节流一段时间内连续触发只执行一次。\n\n例如，都设置时间频率为500ms，在2秒时间内，频繁触发函数，节流，每隔 500ms 就执行一次。防抖，则不管调动多少次方法，在2s后，只会执行一次。\n\n\n\n## 应用场景\n\n防抖在连续的事件，只需触发一次回调的场景有：\n\n- 搜索框搜索输入。只需用户最后一次输入完，再发送请求\n- 手机号、邮箱验证输入检测\n- 窗口大小`resize`。只需窗口调整完成后，计算窗口大小。防止重复渲染。\n\n节流在间隔一段时间执行一次回调的场景有：\n\n- 滚动加载，加载更多或滚到底部监听\n- 搜索框，搜索联想功能","source":"_posts/debounce-throttle.md","raw":"---\ntitle: 防抖与节流\ndate: 2023-02-15 21:30:01\ntags: 高频\ncategories: JavaScript\ndescription: 在前端开发中会遇到一些频繁的事件触发，比如：resize、scroll、mousedown、mousemove、keyup、keydown。频繁触发很容易造成一些性能问题，目前解决这种性能问题最常用的就是防抖和节流。\n---\n\n在前端开发中会遇到一些频繁的事件触发，比如：resize、scroll、mousedown、mousemove、keyup、keydown。频繁触发很容易造成一些性能问题，目前解决这种性能问题最常用的就是防抖和节流。\n\n\n\n## 防抖\n\n防抖(debounce)，**在事件被触发n秒后再执行回调，如果在这n秒内又被触发，则重新计时**。\n\n防抖的原理就是：你尽管触发事件，但是我一定在事件触发 n 秒后才执行，如果你在一个事件触发的 n 秒内又触发了这个事件，那我就以新的事件的时间为准，n 秒后才执行，总之，就是要等你触发完事件 n 秒内不再触发事件才执行。\n\n实现一个简单的防抖：\n\n```js\n// 第二版\nfunction debounce(func, wait) {\n    var timeout;\n\n    return function () {\n        var context = this;\n        var args = arguments;\n\n        clearTimeout(timeout)\n        timeout = setTimeout(function(){\n            func.apply(context, args)\n        }, wait);\n    }\n}\n```\n\n\n\n## 节流\n\n节流(throttle)，**规定在一个单位时间内，只能触发一次函数。如果这个单位时间内触发多次函数，只有一次生效**。\n\n节流的原理：如果你持续触发事件，每隔一段时间，只执行一次事件。\n\n实现一个简单的节流：\n\n```js\n// 使用时间戳实现\nfunction throttle(func, wait) {\n    var context, args;\n    var previous = 0;\n\n    return function() {\n        var now = +new Date();\n        context = this;\n        args = arguments;\n        if (now - previous > wait) {\n            func.apply(context, args);\n            previous = now;\n        }\n    }\n}\n\n// 使用定时器实现\nfunction throttle(func, wait) {\n    var timeout;\n    var previous = 0;\n\n    return function() {\n        context = this;\n        args = arguments;\n        if (!timeout) {\n            timeout = setTimeout(function(){\n                timeout = null;\n                func.apply(context, args)\n            }, wait)\n        }\n\n    }\n}\n```\n\n\n\n## 区别\n\n相同点：\n\n- 都可以通过 setTimeout 实现\n- 都是为了降低回调执行频率，节省计算资源\n\n不同点：\n\n- 防抖一段时间内利连续触发事件，只在最后执行一次；节流一段时间内连续触发只执行一次。\n\n例如，都设置时间频率为500ms，在2秒时间内，频繁触发函数，节流，每隔 500ms 就执行一次。防抖，则不管调动多少次方法，在2s后，只会执行一次。\n\n\n\n## 应用场景\n\n防抖在连续的事件，只需触发一次回调的场景有：\n\n- 搜索框搜索输入。只需用户最后一次输入完，再发送请求\n- 手机号、邮箱验证输入检测\n- 窗口大小`resize`。只需窗口调整完成后，计算窗口大小。防止重复渲染。\n\n节流在间隔一段时间执行一次回调的场景有：\n\n- 滚动加载，加载更多或滚到底部监听\n- 搜索框，搜索联想功能","slug":"debounce-throttle","published":1,"updated":"2023-02-18T02:37:06.714Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsht000xyt8wcjzhac08","content":"<p>在前端开发中会遇到一些频繁的事件触发，比如：resize、scroll、mousedown、mousemove、keyup、keydown。频繁触发很容易造成一些性能问题，目前解决这种性能问题最常用的就是防抖和节流。</p>\n<h2 id=\"防抖\"><a href=\"#防抖\" class=\"headerlink\" title=\"防抖\"></a>防抖</h2><p>防抖(debounce)，<strong>在事件被触发n秒后再执行回调，如果在这n秒内又被触发，则重新计时</strong>。</p>\n<p>防抖的原理就是：你尽管触发事件，但是我一定在事件触发 n 秒后才执行，如果你在一个事件触发的 n 秒内又触发了这个事件，那我就以新的事件的时间为准，n 秒后才执行，总之，就是要等你触发完事件 n 秒内不再触发事件才执行。</p>\n<p>实现一个简单的防抖：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第二版</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">debounce</span>(<span class=\"params\">func, wait</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timeout;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> args = <span class=\"variable language_\">arguments</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">clearTimeout</span>(timeout)</span><br><span class=\"line\">        timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            func.<span class=\"title function_\">apply</span>(context, args)</span><br><span class=\"line\">        &#125;, wait);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"节流\"><a href=\"#节流\" class=\"headerlink\" title=\"节流\"></a>节流</h2><p>节流(throttle)，<strong>规定在一个单位时间内，只能触发一次函数。如果这个单位时间内触发多次函数，只有一次生效</strong>。</p>\n<p>节流的原理：如果你持续触发事件，每隔一段时间，只执行一次事件。</p>\n<p>实现一个简单的节流：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用时间戳实现</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">throttle</span>(<span class=\"params\">func, wait</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context, args;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> previous = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> now = +<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>();</span><br><span class=\"line\">        context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">        args = <span class=\"variable language_\">arguments</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (now - previous &gt; wait) &#123;</span><br><span class=\"line\">            func.<span class=\"title function_\">apply</span>(context, args);</span><br><span class=\"line\">            previous = now;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用定时器实现</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">throttle</span>(<span class=\"params\">func, wait</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timeout;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> previous = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">        args = <span class=\"variable language_\">arguments</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!timeout) &#123;</span><br><span class=\"line\">            timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">                timeout = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                func.<span class=\"title function_\">apply</span>(context, args)</span><br><span class=\"line\">            &#125;, wait)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"区别\"><a href=\"#区别\" class=\"headerlink\" title=\"区别\"></a>区别</h2><p>相同点：</p>\n<ul>\n<li>都可以通过 setTimeout 实现</li>\n<li>都是为了降低回调执行频率，节省计算资源</li>\n</ul>\n<p>不同点：</p>\n<ul>\n<li>防抖一段时间内利连续触发事件，只在最后执行一次；节流一段时间内连续触发只执行一次。</li>\n</ul>\n<p>例如，都设置时间频率为500ms，在2秒时间内，频繁触发函数，节流，每隔 500ms 就执行一次。防抖，则不管调动多少次方法，在2s后，只会执行一次。</p>\n<h2 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h2><p>防抖在连续的事件，只需触发一次回调的场景有：</p>\n<ul>\n<li>搜索框搜索输入。只需用户最后一次输入完，再发送请求</li>\n<li>手机号、邮箱验证输入检测</li>\n<li>窗口大小<code>resize</code>。只需窗口调整完成后，计算窗口大小。防止重复渲染。</li>\n</ul>\n<p>节流在间隔一段时间执行一次回调的场景有：</p>\n<ul>\n<li>滚动加载，加载更多或滚到底部监听</li>\n<li>搜索框，搜索联想功能</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>在前端开发中会遇到一些频繁的事件触发，比如：resize、scroll、mousedown、mousemove、keyup、keydown。频繁触发很容易造成一些性能问题，目前解决这种性能问题最常用的就是防抖和节流。</p>\n<h2 id=\"防抖\"><a href=\"#防抖\" class=\"headerlink\" title=\"防抖\"></a>防抖</h2><p>防抖(debounce)，<strong>在事件被触发n秒后再执行回调，如果在这n秒内又被触发，则重新计时</strong>。</p>\n<p>防抖的原理就是：你尽管触发事件，但是我一定在事件触发 n 秒后才执行，如果你在一个事件触发的 n 秒内又触发了这个事件，那我就以新的事件的时间为准，n 秒后才执行，总之，就是要等你触发完事件 n 秒内不再触发事件才执行。</p>\n<p>实现一个简单的防抖：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第二版</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">debounce</span>(<span class=\"params\">func, wait</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timeout;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> args = <span class=\"variable language_\">arguments</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">clearTimeout</span>(timeout)</span><br><span class=\"line\">        timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            func.<span class=\"title function_\">apply</span>(context, args)</span><br><span class=\"line\">        &#125;, wait);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"节流\"><a href=\"#节流\" class=\"headerlink\" title=\"节流\"></a>节流</h2><p>节流(throttle)，<strong>规定在一个单位时间内，只能触发一次函数。如果这个单位时间内触发多次函数，只有一次生效</strong>。</p>\n<p>节流的原理：如果你持续触发事件，每隔一段时间，只执行一次事件。</p>\n<p>实现一个简单的节流：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用时间戳实现</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">throttle</span>(<span class=\"params\">func, wait</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context, args;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> previous = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> now = +<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>();</span><br><span class=\"line\">        context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">        args = <span class=\"variable language_\">arguments</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (now - previous &gt; wait) &#123;</span><br><span class=\"line\">            func.<span class=\"title function_\">apply</span>(context, args);</span><br><span class=\"line\">            previous = now;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用定时器实现</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">throttle</span>(<span class=\"params\">func, wait</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timeout;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> previous = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">        args = <span class=\"variable language_\">arguments</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!timeout) &#123;</span><br><span class=\"line\">            timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">                timeout = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                func.<span class=\"title function_\">apply</span>(context, args)</span><br><span class=\"line\">            &#125;, wait)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"区别\"><a href=\"#区别\" class=\"headerlink\" title=\"区别\"></a>区别</h2><p>相同点：</p>\n<ul>\n<li>都可以通过 setTimeout 实现</li>\n<li>都是为了降低回调执行频率，节省计算资源</li>\n</ul>\n<p>不同点：</p>\n<ul>\n<li>防抖一段时间内利连续触发事件，只在最后执行一次；节流一段时间内连续触发只执行一次。</li>\n</ul>\n<p>例如，都设置时间频率为500ms，在2秒时间内，频繁触发函数，节流，每隔 500ms 就执行一次。防抖，则不管调动多少次方法，在2s后，只会执行一次。</p>\n<h2 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h2><p>防抖在连续的事件，只需触发一次回调的场景有：</p>\n<ul>\n<li>搜索框搜索输入。只需用户最后一次输入完，再发送请求</li>\n<li>手机号、邮箱验证输入检测</li>\n<li>窗口大小<code>resize</code>。只需窗口调整完成后，计算窗口大小。防止重复渲染。</li>\n</ul>\n<p>节流在间隔一段时间执行一次回调的场景有：</p>\n<ul>\n<li>滚动加载，加载更多或滚到底部监听</li>\n<li>搜索框，搜索联想功能</li>\n</ul>\n"},{"title":"deep-copy","date":"2023-02-18T02:59:37.000Z","description":null,"_content":"\n","source":"_posts/deep-copy.md","raw":"---\ntitle: deep-copy\ndate: 2023-02-18 10:59:37\ntags:\ncategories:\ndescription:\n---\n\n","slug":"deep-copy","published":1,"updated":"2023-02-18T02:59:55.832Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshu000zyt8wbccs7t0f","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"前端小组代码审查相关","date":"2022-02-20T13:18:25.000Z","description":"代码审查（Code review）是指对计算机源代码系统化地审查，常用软件同行评审的方式进行，其目的是在找出及修正在软件开发初期未发现的错误，提升软件质量及开发者的技术。","_content":"\n## 审查原则\n1. 保证代码可读性和健壮性\n2. 团队知识共享\n3. 尽早定位和解决bug\n\n## 审查内容\n### 一般项\n- 是否实现预期的功能 ✅\n- 逻辑是否正确完备 ✅\n- 是否简单易懂（KISS） ✅\n- 是否有更好的实现方式 ✅\n- 是否符合规范（见审查清单） ✅\n- 是否存在多余的或重复的代码（DRY） ✅\n- 是否尽可能地模块化 ✅\n- 是否有可以删除的日志或调试代码 ✅\n\n### 注释/文档\n- 函数是否有注释（公用的函数强制注释） ✅\n- 是否对边界情况或特殊操作有说明（如 hack）（必须注释） ✅\n- 是否对未完成的内容做说明 TODO：XXX ✅\n\n### 安全\n- 是否处理边界情况 ✅\n- 是否对输入做校验 ✅\n- 是否对异常做处理 ✅\n\n## 审查方式\n### 小片段式\n小片段式的代码审查，又称事前审查，是在代码合并到主分支之前就做的一种审查形式。如果发现了问题，在代码合并之前就会进行需改。\n\n### 大规模式\n大规模式的代码审查，又称事后审查，大模块式的Code Review会议，进行大规模的代码检视，提出问题并记录，之后可以以重构的方式来处理在会议上发现的问题。\n\n## 审查清单\n### 命名\n**拼写正确**\n\nVSCode 可安装 Code Spell Checker\n\n**语义化**\n\n- can：判断是否可执行某个动作\n- has：判断是否含有某个值\n- is：判断是否为某个值\n- get：获取某个值\n- set：设置某个值\n\n常量均需命名且大写，使用 _ 连接 const MAX_VALUE = 9999\n\n变量使用小驼峰（Camel Case）\n\n```js\n// 推荐：\nlet formInstance = 'foo'\n// 不推荐：\nlet form_instance = 'foo'\n```\n\n### 函数\n函数参数超过3个时，尽量使用 ES6 解构语法， 避免参数引入顺序问题\n\n```js\nfunction setContact({ name, phone, email }) {\n        // ...\n}\n```\n\n使用参数默认值，使用参数默认值代替使用条件语句进行赋值\n\n```js\n// 推荐\nfunction foo(bar = \"baz\") {\n  // ...\n}\n// 不推荐\nfunction foo(bar) {\n  const mybar = bar || \"baz\";\n  // ...\n}\n```\n\n尽量使用纯函数，避免副作用\n\n```js\n// 纯函数\nfunction checkAge(age) {\n  let mini = 18\n  return age >= mini\n}\n// 非纯函数\nlet mini= 18\nfunction checkAe(age) {\n  return age >= mini\n}\n```\n\n尽早 return：通过用 if/return 替换 if/else 来减少缩进（代码可读性）\n\n```js\nfunction foo() {\n  if (error) return\n  \n  // doStuff...\n}\n```\n\n### 性能相关\n1. 避免全局变量\n2. 清除无用的定时器、事件监听、event bus、闭包内变量\n3. 优化消耗性能的操作，如递归、cloneDeep 等\n4. 缓存复杂计算结果\n5. 合理使用节流、防抖\n6. 减少页面回流、重绘\n7. 图片 CDN \n\n\n## Vue相关\n\n### 组件（文件）名称\n1. 所有组件使用 SFC + TSX 形式\n2. SFC 中的标签顺序统一为 `<template>、<script>、<style>`\n3. 凡是跟组件名相关的（组件名、文件名及在模板中使用），都必须采用大驼峰 PascalCase 形式\n4. 一般化描述放前，特殊化描述放后，例：\n\n```js\nSearchButtonClear.vue\nSearchButtonRun.vue\nSearchInput.vue\nSearchInputQuery.vue\nSettingsCheckbox.vue\nSettingsTerms.vue \n```\n\n### 属性相关\n1. defineProps、defineEmits 要用类型声明的方式，而非运行时声明\n2. 始终使用指令缩写，即 : @ #\n\n### 性能\n1. 避免非必要更新，合理使用 v-once、v-memo、computed（Vue: When a computed property can be the wrong tool）\n例如 props 使用 isActive 而不是 activeId，导致每次 id 变化使所有子组件都更新\n2. 代码复用，stateful logic 使用自定义 hooks，以 use 开头\n3. setup await？hook 放前\n\n\n## 开发流程相关\n### 分支\n👉 master\n- 主分支，稳定版本，用于部署生产环境\n- 不允许直接 push 代码，只能 Gitlab 上提交 merge request，且只允许 hotfix、release 分支代码合入\n- 每次发版成功后打 tag，加上日期\n- 常驻分支\n\n👉 release\n- 预发布分支\n- 验证过程中，bug 在 dev 分支自测，合入 test 分支提交给测试人员测试，测试通过后合入 release 分支验证\n- 验证通过后，合入 master 分支，master 分支发布版本\n- 常驻分支\n\n👉 test\n- 提测分支\n- 常驻分支\n\n👉 dev\n- 开发分支，包括新特性和 bug 修复，始终保持最新代码\n- 常驻分支\n\n👉 feature\n- 新功能，以 master 为基础创建\n- 命名以 feat/ 开头\n- ❗️需 push 到远程\n- 临时分支，合并后删除\n\nfix\n- 修复非生产 bug\n- 命名以 fix/ 开头\n- 修复完成后合入 dev 验证\n- 临时分支，合并后删除\n\n👉 hotfix\n- 紧急 bug 修复分支，修复生产 bug\n- 命名以 hotfix/ 开头\n- 修复完成后合入 master 验证\n- 临时分支，合并后删除\n\n### Commit 提交规范\n1. 提交格式（考虑 commitizen）\n`<type>(<scope>): <subject>`\n\ntype\n- feat: 新功能/特性\n- fix: 修复 bug\n- perf: 修改代码，以提高性能\n- refactor: 代码重构\n- docs: 文档修改\n- style: 代码格式修改, 注意不是 css 修改（例如分号修改）\n- test: 测试用例新增、修改\n- build: 影响项目构建或依赖项修改\n- revert: 恢复上一次提交\n- ci: 持续集成相关文件修改\n- chore: 其他修改（不在上述类型中的修改）\n- release: 发布新版本\n\nscope\ncommit 影响的功能或文件范围，比如: route、component、utils、build...\n\nsubject\ncommit message 的概述\n\n2. husky pre-commit\n\n\n## 环境说明\n- 开发环境 Develop\n用于开发人员开发新特性，修复缺陷，自测使用\n- 测试环境 Test\n用于测试人员测试，提出缺陷\n- 预发布环境 Release\n用于上线前的真实环境验证\n- 生产环境 Production\n用于发布稳定版本，打标签","source":"_posts/fe-code-review.md","raw":"---\ntitle: 前端小组代码审查相关\ndate: 2022-02-20 21:18:25\ntags: 前端\ncategories: 前端\ndescription: 代码审查（Code review）是指对计算机源代码系统化地审查，常用软件同行评审的方式进行，其目的是在找出及修正在软件开发初期未发现的错误，提升软件质量及开发者的技术。\n---\n\n## 审查原则\n1. 保证代码可读性和健壮性\n2. 团队知识共享\n3. 尽早定位和解决bug\n\n## 审查内容\n### 一般项\n- 是否实现预期的功能 ✅\n- 逻辑是否正确完备 ✅\n- 是否简单易懂（KISS） ✅\n- 是否有更好的实现方式 ✅\n- 是否符合规范（见审查清单） ✅\n- 是否存在多余的或重复的代码（DRY） ✅\n- 是否尽可能地模块化 ✅\n- 是否有可以删除的日志或调试代码 ✅\n\n### 注释/文档\n- 函数是否有注释（公用的函数强制注释） ✅\n- 是否对边界情况或特殊操作有说明（如 hack）（必须注释） ✅\n- 是否对未完成的内容做说明 TODO：XXX ✅\n\n### 安全\n- 是否处理边界情况 ✅\n- 是否对输入做校验 ✅\n- 是否对异常做处理 ✅\n\n## 审查方式\n### 小片段式\n小片段式的代码审查，又称事前审查，是在代码合并到主分支之前就做的一种审查形式。如果发现了问题，在代码合并之前就会进行需改。\n\n### 大规模式\n大规模式的代码审查，又称事后审查，大模块式的Code Review会议，进行大规模的代码检视，提出问题并记录，之后可以以重构的方式来处理在会议上发现的问题。\n\n## 审查清单\n### 命名\n**拼写正确**\n\nVSCode 可安装 Code Spell Checker\n\n**语义化**\n\n- can：判断是否可执行某个动作\n- has：判断是否含有某个值\n- is：判断是否为某个值\n- get：获取某个值\n- set：设置某个值\n\n常量均需命名且大写，使用 _ 连接 const MAX_VALUE = 9999\n\n变量使用小驼峰（Camel Case）\n\n```js\n// 推荐：\nlet formInstance = 'foo'\n// 不推荐：\nlet form_instance = 'foo'\n```\n\n### 函数\n函数参数超过3个时，尽量使用 ES6 解构语法， 避免参数引入顺序问题\n\n```js\nfunction setContact({ name, phone, email }) {\n        // ...\n}\n```\n\n使用参数默认值，使用参数默认值代替使用条件语句进行赋值\n\n```js\n// 推荐\nfunction foo(bar = \"baz\") {\n  // ...\n}\n// 不推荐\nfunction foo(bar) {\n  const mybar = bar || \"baz\";\n  // ...\n}\n```\n\n尽量使用纯函数，避免副作用\n\n```js\n// 纯函数\nfunction checkAge(age) {\n  let mini = 18\n  return age >= mini\n}\n// 非纯函数\nlet mini= 18\nfunction checkAe(age) {\n  return age >= mini\n}\n```\n\n尽早 return：通过用 if/return 替换 if/else 来减少缩进（代码可读性）\n\n```js\nfunction foo() {\n  if (error) return\n  \n  // doStuff...\n}\n```\n\n### 性能相关\n1. 避免全局变量\n2. 清除无用的定时器、事件监听、event bus、闭包内变量\n3. 优化消耗性能的操作，如递归、cloneDeep 等\n4. 缓存复杂计算结果\n5. 合理使用节流、防抖\n6. 减少页面回流、重绘\n7. 图片 CDN \n\n\n## Vue相关\n\n### 组件（文件）名称\n1. 所有组件使用 SFC + TSX 形式\n2. SFC 中的标签顺序统一为 `<template>、<script>、<style>`\n3. 凡是跟组件名相关的（组件名、文件名及在模板中使用），都必须采用大驼峰 PascalCase 形式\n4. 一般化描述放前，特殊化描述放后，例：\n\n```js\nSearchButtonClear.vue\nSearchButtonRun.vue\nSearchInput.vue\nSearchInputQuery.vue\nSettingsCheckbox.vue\nSettingsTerms.vue \n```\n\n### 属性相关\n1. defineProps、defineEmits 要用类型声明的方式，而非运行时声明\n2. 始终使用指令缩写，即 : @ #\n\n### 性能\n1. 避免非必要更新，合理使用 v-once、v-memo、computed（Vue: When a computed property can be the wrong tool）\n例如 props 使用 isActive 而不是 activeId，导致每次 id 变化使所有子组件都更新\n2. 代码复用，stateful logic 使用自定义 hooks，以 use 开头\n3. setup await？hook 放前\n\n\n## 开发流程相关\n### 分支\n👉 master\n- 主分支，稳定版本，用于部署生产环境\n- 不允许直接 push 代码，只能 Gitlab 上提交 merge request，且只允许 hotfix、release 分支代码合入\n- 每次发版成功后打 tag，加上日期\n- 常驻分支\n\n👉 release\n- 预发布分支\n- 验证过程中，bug 在 dev 分支自测，合入 test 分支提交给测试人员测试，测试通过后合入 release 分支验证\n- 验证通过后，合入 master 分支，master 分支发布版本\n- 常驻分支\n\n👉 test\n- 提测分支\n- 常驻分支\n\n👉 dev\n- 开发分支，包括新特性和 bug 修复，始终保持最新代码\n- 常驻分支\n\n👉 feature\n- 新功能，以 master 为基础创建\n- 命名以 feat/ 开头\n- ❗️需 push 到远程\n- 临时分支，合并后删除\n\nfix\n- 修复非生产 bug\n- 命名以 fix/ 开头\n- 修复完成后合入 dev 验证\n- 临时分支，合并后删除\n\n👉 hotfix\n- 紧急 bug 修复分支，修复生产 bug\n- 命名以 hotfix/ 开头\n- 修复完成后合入 master 验证\n- 临时分支，合并后删除\n\n### Commit 提交规范\n1. 提交格式（考虑 commitizen）\n`<type>(<scope>): <subject>`\n\ntype\n- feat: 新功能/特性\n- fix: 修复 bug\n- perf: 修改代码，以提高性能\n- refactor: 代码重构\n- docs: 文档修改\n- style: 代码格式修改, 注意不是 css 修改（例如分号修改）\n- test: 测试用例新增、修改\n- build: 影响项目构建或依赖项修改\n- revert: 恢复上一次提交\n- ci: 持续集成相关文件修改\n- chore: 其他修改（不在上述类型中的修改）\n- release: 发布新版本\n\nscope\ncommit 影响的功能或文件范围，比如: route、component、utils、build...\n\nsubject\ncommit message 的概述\n\n2. husky pre-commit\n\n\n## 环境说明\n- 开发环境 Develop\n用于开发人员开发新特性，修复缺陷，自测使用\n- 测试环境 Test\n用于测试人员测试，提出缺陷\n- 预发布环境 Release\n用于上线前的真实环境验证\n- 生产环境 Production\n用于发布稳定版本，打标签","slug":"fe-code-review","published":1,"updated":"2023-03-20T13:20:49.553Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshv0014yt8w94gg1kzw","content":"<h2 id=\"审查原则\"><a href=\"#审查原则\" class=\"headerlink\" title=\"审查原则\"></a>审查原则</h2><ol>\n<li>保证代码可读性和健壮性</li>\n<li>团队知识共享</li>\n<li>尽早定位和解决bug</li>\n</ol>\n<h2 id=\"审查内容\"><a href=\"#审查内容\" class=\"headerlink\" title=\"审查内容\"></a>审查内容</h2><h3 id=\"一般项\"><a href=\"#一般项\" class=\"headerlink\" title=\"一般项\"></a>一般项</h3><ul>\n<li>是否实现预期的功能 ✅</li>\n<li>逻辑是否正确完备 ✅</li>\n<li>是否简单易懂（KISS） ✅</li>\n<li>是否有更好的实现方式 ✅</li>\n<li>是否符合规范（见审查清单） ✅</li>\n<li>是否存在多余的或重复的代码（DRY） ✅</li>\n<li>是否尽可能地模块化 ✅</li>\n<li>是否有可以删除的日志或调试代码 ✅</li>\n</ul>\n<h3 id=\"注释-x2F-文档\"><a href=\"#注释-x2F-文档\" class=\"headerlink\" title=\"注释&#x2F;文档\"></a>注释&#x2F;文档</h3><ul>\n<li>函数是否有注释（公用的函数强制注释） ✅</li>\n<li>是否对边界情况或特殊操作有说明（如 hack）（必须注释） ✅</li>\n<li>是否对未完成的内容做说明 TODO：XXX ✅</li>\n</ul>\n<h3 id=\"安全\"><a href=\"#安全\" class=\"headerlink\" title=\"安全\"></a>安全</h3><ul>\n<li>是否处理边界情况 ✅</li>\n<li>是否对输入做校验 ✅</li>\n<li>是否对异常做处理 ✅</li>\n</ul>\n<h2 id=\"审查方式\"><a href=\"#审查方式\" class=\"headerlink\" title=\"审查方式\"></a>审查方式</h2><h3 id=\"小片段式\"><a href=\"#小片段式\" class=\"headerlink\" title=\"小片段式\"></a>小片段式</h3><p>小片段式的代码审查，又称事前审查，是在代码合并到主分支之前就做的一种审查形式。如果发现了问题，在代码合并之前就会进行需改。</p>\n<h3 id=\"大规模式\"><a href=\"#大规模式\" class=\"headerlink\" title=\"大规模式\"></a>大规模式</h3><p>大规模式的代码审查，又称事后审查，大模块式的Code Review会议，进行大规模的代码检视，提出问题并记录，之后可以以重构的方式来处理在会议上发现的问题。</p>\n<h2 id=\"审查清单\"><a href=\"#审查清单\" class=\"headerlink\" title=\"审查清单\"></a>审查清单</h2><h3 id=\"命名\"><a href=\"#命名\" class=\"headerlink\" title=\"命名\"></a>命名</h3><p><strong>拼写正确</strong></p>\n<p>VSCode 可安装 Code Spell Checker</p>\n<p><strong>语义化</strong></p>\n<ul>\n<li>can：判断是否可执行某个动作</li>\n<li>has：判断是否含有某个值</li>\n<li>is：判断是否为某个值</li>\n<li>get：获取某个值</li>\n<li>set：设置某个值</li>\n</ul>\n<p>常量均需命名且大写，使用 _ 连接 const MAX_VALUE &#x3D; 9999</p>\n<p>变量使用小驼峰（Camel Case）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 推荐：</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> formInstance = <span class=\"string\">&#x27;foo&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// 不推荐：</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> form_instance = <span class=\"string\">&#x27;foo&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h3><p>函数参数超过3个时，尽量使用 ES6 解构语法， 避免参数引入顺序问题</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setContact</span>(<span class=\"params\">&#123; name, phone, email &#125;</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用参数默认值，使用参数默认值代替使用条件语句进行赋值</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 推荐</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">foo</span>(<span class=\"params\">bar = <span class=\"string\">&quot;baz&quot;</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 不推荐</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">foo</span>(<span class=\"params\">bar</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> mybar = bar || <span class=\"string\">&quot;baz&quot;</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>尽量使用纯函数，避免副作用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 纯函数</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">checkAge</span>(<span class=\"params\">age</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> mini = <span class=\"number\">18</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> age &gt;= mini</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 非纯函数</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> mini= <span class=\"number\">18</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">checkAe</span>(<span class=\"params\">age</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> age &gt;= mini</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>尽早 return：通过用 if&#x2F;return 替换 if&#x2F;else 来减少缩进（代码可读性）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">foo</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (error) <span class=\"keyword\">return</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// doStuff...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"性能相关\"><a href=\"#性能相关\" class=\"headerlink\" title=\"性能相关\"></a>性能相关</h3><ol>\n<li>避免全局变量</li>\n<li>清除无用的定时器、事件监听、event bus、闭包内变量</li>\n<li>优化消耗性能的操作，如递归、cloneDeep 等</li>\n<li>缓存复杂计算结果</li>\n<li>合理使用节流、防抖</li>\n<li>减少页面回流、重绘</li>\n<li>图片 CDN</li>\n</ol>\n<h2 id=\"Vue相关\"><a href=\"#Vue相关\" class=\"headerlink\" title=\"Vue相关\"></a>Vue相关</h2><h3 id=\"组件（文件）名称\"><a href=\"#组件（文件）名称\" class=\"headerlink\" title=\"组件（文件）名称\"></a>组件（文件）名称</h3><ol>\n<li>所有组件使用 SFC + TSX 形式</li>\n<li>SFC 中的标签顺序统一为 <code>&lt;template&gt;、&lt;script&gt;、&lt;style&gt;</code></li>\n<li>凡是跟组件名相关的（组件名、文件名及在模板中使用），都必须采用大驼峰 PascalCase 形式</li>\n<li>一般化描述放前，特殊化描述放后，例：</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">SearchButtonClear</span>.<span class=\"property\">vue</span></span><br><span class=\"line\"><span class=\"title class_\">SearchButtonRun</span>.<span class=\"property\">vue</span></span><br><span class=\"line\"><span class=\"title class_\">SearchInput</span>.<span class=\"property\">vue</span></span><br><span class=\"line\"><span class=\"title class_\">SearchInputQuery</span>.<span class=\"property\">vue</span></span><br><span class=\"line\"><span class=\"title class_\">SettingsCheckbox</span>.<span class=\"property\">vue</span></span><br><span class=\"line\"><span class=\"title class_\">SettingsTerms</span>.<span class=\"property\">vue</span> </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"属性相关\"><a href=\"#属性相关\" class=\"headerlink\" title=\"属性相关\"></a>属性相关</h3><ol>\n<li>defineProps、defineEmits 要用类型声明的方式，而非运行时声明</li>\n<li>始终使用指令缩写，即 : @ #</li>\n</ol>\n<h3 id=\"性能\"><a href=\"#性能\" class=\"headerlink\" title=\"性能\"></a>性能</h3><ol>\n<li>避免非必要更新，合理使用 v-once、v-memo、computed（Vue: When a computed property can be the wrong tool）<br>例如 props 使用 isActive 而不是 activeId，导致每次 id 变化使所有子组件都更新</li>\n<li>代码复用，stateful logic 使用自定义 hooks，以 use 开头</li>\n<li>setup await？hook 放前</li>\n</ol>\n<h2 id=\"开发流程相关\"><a href=\"#开发流程相关\" class=\"headerlink\" title=\"开发流程相关\"></a>开发流程相关</h2><h3 id=\"分支\"><a href=\"#分支\" class=\"headerlink\" title=\"分支\"></a>分支</h3><p>👉 master</p>\n<ul>\n<li>主分支，稳定版本，用于部署生产环境</li>\n<li>不允许直接 push 代码，只能 Gitlab 上提交 merge request，且只允许 hotfix、release 分支代码合入</li>\n<li>每次发版成功后打 tag，加上日期</li>\n<li>常驻分支</li>\n</ul>\n<p>👉 release</p>\n<ul>\n<li>预发布分支</li>\n<li>验证过程中，bug 在 dev 分支自测，合入 test 分支提交给测试人员测试，测试通过后合入 release 分支验证</li>\n<li>验证通过后，合入 master 分支，master 分支发布版本</li>\n<li>常驻分支</li>\n</ul>\n<p>👉 test</p>\n<ul>\n<li>提测分支</li>\n<li>常驻分支</li>\n</ul>\n<p>👉 dev</p>\n<ul>\n<li>开发分支，包括新特性和 bug 修复，始终保持最新代码</li>\n<li>常驻分支</li>\n</ul>\n<p>👉 feature</p>\n<ul>\n<li>新功能，以 master 为基础创建</li>\n<li>命名以 feat&#x2F; 开头</li>\n<li>❗️需 push 到远程</li>\n<li>临时分支，合并后删除</li>\n</ul>\n<p>fix</p>\n<ul>\n<li>修复非生产 bug</li>\n<li>命名以 fix&#x2F; 开头</li>\n<li>修复完成后合入 dev 验证</li>\n<li>临时分支，合并后删除</li>\n</ul>\n<p>👉 hotfix</p>\n<ul>\n<li>紧急 bug 修复分支，修复生产 bug</li>\n<li>命名以 hotfix&#x2F; 开头</li>\n<li>修复完成后合入 master 验证</li>\n<li>临时分支，合并后删除</li>\n</ul>\n<h3 id=\"Commit-提交规范\"><a href=\"#Commit-提交规范\" class=\"headerlink\" title=\"Commit 提交规范\"></a>Commit 提交规范</h3><ol>\n<li>提交格式（考虑 commitizen）<br><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</code></li>\n</ol>\n<p>type</p>\n<ul>\n<li>feat: 新功能&#x2F;特性</li>\n<li>fix: 修复 bug</li>\n<li>perf: 修改代码，以提高性能</li>\n<li>refactor: 代码重构</li>\n<li>docs: 文档修改</li>\n<li>style: 代码格式修改, 注意不是 css 修改（例如分号修改）</li>\n<li>test: 测试用例新增、修改</li>\n<li>build: 影响项目构建或依赖项修改</li>\n<li>revert: 恢复上一次提交</li>\n<li>ci: 持续集成相关文件修改</li>\n<li>chore: 其他修改（不在上述类型中的修改）</li>\n<li>release: 发布新版本</li>\n</ul>\n<p>scope<br>commit 影响的功能或文件范围，比如: route、component、utils、build…</p>\n<p>subject<br>commit message 的概述</p>\n<ol start=\"2\">\n<li>husky pre-commit</li>\n</ol>\n<h2 id=\"环境说明\"><a href=\"#环境说明\" class=\"headerlink\" title=\"环境说明\"></a>环境说明</h2><ul>\n<li>开发环境 Develop<br>用于开发人员开发新特性，修复缺陷，自测使用</li>\n<li>测试环境 Test<br>用于测试人员测试，提出缺陷</li>\n<li>预发布环境 Release<br>用于上线前的真实环境验证</li>\n<li>生产环境 Production<br>用于发布稳定版本，打标签</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"审查原则\"><a href=\"#审查原则\" class=\"headerlink\" title=\"审查原则\"></a>审查原则</h2><ol>\n<li>保证代码可读性和健壮性</li>\n<li>团队知识共享</li>\n<li>尽早定位和解决bug</li>\n</ol>\n<h2 id=\"审查内容\"><a href=\"#审查内容\" class=\"headerlink\" title=\"审查内容\"></a>审查内容</h2><h3 id=\"一般项\"><a href=\"#一般项\" class=\"headerlink\" title=\"一般项\"></a>一般项</h3><ul>\n<li>是否实现预期的功能 ✅</li>\n<li>逻辑是否正确完备 ✅</li>\n<li>是否简单易懂（KISS） ✅</li>\n<li>是否有更好的实现方式 ✅</li>\n<li>是否符合规范（见审查清单） ✅</li>\n<li>是否存在多余的或重复的代码（DRY） ✅</li>\n<li>是否尽可能地模块化 ✅</li>\n<li>是否有可以删除的日志或调试代码 ✅</li>\n</ul>\n<h3 id=\"注释-x2F-文档\"><a href=\"#注释-x2F-文档\" class=\"headerlink\" title=\"注释&#x2F;文档\"></a>注释&#x2F;文档</h3><ul>\n<li>函数是否有注释（公用的函数强制注释） ✅</li>\n<li>是否对边界情况或特殊操作有说明（如 hack）（必须注释） ✅</li>\n<li>是否对未完成的内容做说明 TODO：XXX ✅</li>\n</ul>\n<h3 id=\"安全\"><a href=\"#安全\" class=\"headerlink\" title=\"安全\"></a>安全</h3><ul>\n<li>是否处理边界情况 ✅</li>\n<li>是否对输入做校验 ✅</li>\n<li>是否对异常做处理 ✅</li>\n</ul>\n<h2 id=\"审查方式\"><a href=\"#审查方式\" class=\"headerlink\" title=\"审查方式\"></a>审查方式</h2><h3 id=\"小片段式\"><a href=\"#小片段式\" class=\"headerlink\" title=\"小片段式\"></a>小片段式</h3><p>小片段式的代码审查，又称事前审查，是在代码合并到主分支之前就做的一种审查形式。如果发现了问题，在代码合并之前就会进行需改。</p>\n<h3 id=\"大规模式\"><a href=\"#大规模式\" class=\"headerlink\" title=\"大规模式\"></a>大规模式</h3><p>大规模式的代码审查，又称事后审查，大模块式的Code Review会议，进行大规模的代码检视，提出问题并记录，之后可以以重构的方式来处理在会议上发现的问题。</p>\n<h2 id=\"审查清单\"><a href=\"#审查清单\" class=\"headerlink\" title=\"审查清单\"></a>审查清单</h2><h3 id=\"命名\"><a href=\"#命名\" class=\"headerlink\" title=\"命名\"></a>命名</h3><p><strong>拼写正确</strong></p>\n<p>VSCode 可安装 Code Spell Checker</p>\n<p><strong>语义化</strong></p>\n<ul>\n<li>can：判断是否可执行某个动作</li>\n<li>has：判断是否含有某个值</li>\n<li>is：判断是否为某个值</li>\n<li>get：获取某个值</li>\n<li>set：设置某个值</li>\n</ul>\n<p>常量均需命名且大写，使用 _ 连接 const MAX_VALUE &#x3D; 9999</p>\n<p>变量使用小驼峰（Camel Case）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 推荐：</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> formInstance = <span class=\"string\">&#x27;foo&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// 不推荐：</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> form_instance = <span class=\"string\">&#x27;foo&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h3><p>函数参数超过3个时，尽量使用 ES6 解构语法， 避免参数引入顺序问题</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setContact</span>(<span class=\"params\">&#123; name, phone, email &#125;</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用参数默认值，使用参数默认值代替使用条件语句进行赋值</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 推荐</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">foo</span>(<span class=\"params\">bar = <span class=\"string\">&quot;baz&quot;</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 不推荐</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">foo</span>(<span class=\"params\">bar</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> mybar = bar || <span class=\"string\">&quot;baz&quot;</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>尽量使用纯函数，避免副作用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 纯函数</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">checkAge</span>(<span class=\"params\">age</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> mini = <span class=\"number\">18</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> age &gt;= mini</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 非纯函数</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> mini= <span class=\"number\">18</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">checkAe</span>(<span class=\"params\">age</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> age &gt;= mini</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>尽早 return：通过用 if&#x2F;return 替换 if&#x2F;else 来减少缩进（代码可读性）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">foo</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (error) <span class=\"keyword\">return</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// doStuff...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"性能相关\"><a href=\"#性能相关\" class=\"headerlink\" title=\"性能相关\"></a>性能相关</h3><ol>\n<li>避免全局变量</li>\n<li>清除无用的定时器、事件监听、event bus、闭包内变量</li>\n<li>优化消耗性能的操作，如递归、cloneDeep 等</li>\n<li>缓存复杂计算结果</li>\n<li>合理使用节流、防抖</li>\n<li>减少页面回流、重绘</li>\n<li>图片 CDN</li>\n</ol>\n<h2 id=\"Vue相关\"><a href=\"#Vue相关\" class=\"headerlink\" title=\"Vue相关\"></a>Vue相关</h2><h3 id=\"组件（文件）名称\"><a href=\"#组件（文件）名称\" class=\"headerlink\" title=\"组件（文件）名称\"></a>组件（文件）名称</h3><ol>\n<li>所有组件使用 SFC + TSX 形式</li>\n<li>SFC 中的标签顺序统一为 <code>&lt;template&gt;、&lt;script&gt;、&lt;style&gt;</code></li>\n<li>凡是跟组件名相关的（组件名、文件名及在模板中使用），都必须采用大驼峰 PascalCase 形式</li>\n<li>一般化描述放前，特殊化描述放后，例：</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">SearchButtonClear</span>.<span class=\"property\">vue</span></span><br><span class=\"line\"><span class=\"title class_\">SearchButtonRun</span>.<span class=\"property\">vue</span></span><br><span class=\"line\"><span class=\"title class_\">SearchInput</span>.<span class=\"property\">vue</span></span><br><span class=\"line\"><span class=\"title class_\">SearchInputQuery</span>.<span class=\"property\">vue</span></span><br><span class=\"line\"><span class=\"title class_\">SettingsCheckbox</span>.<span class=\"property\">vue</span></span><br><span class=\"line\"><span class=\"title class_\">SettingsTerms</span>.<span class=\"property\">vue</span> </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"属性相关\"><a href=\"#属性相关\" class=\"headerlink\" title=\"属性相关\"></a>属性相关</h3><ol>\n<li>defineProps、defineEmits 要用类型声明的方式，而非运行时声明</li>\n<li>始终使用指令缩写，即 : @ #</li>\n</ol>\n<h3 id=\"性能\"><a href=\"#性能\" class=\"headerlink\" title=\"性能\"></a>性能</h3><ol>\n<li>避免非必要更新，合理使用 v-once、v-memo、computed（Vue: When a computed property can be the wrong tool）<br>例如 props 使用 isActive 而不是 activeId，导致每次 id 变化使所有子组件都更新</li>\n<li>代码复用，stateful logic 使用自定义 hooks，以 use 开头</li>\n<li>setup await？hook 放前</li>\n</ol>\n<h2 id=\"开发流程相关\"><a href=\"#开发流程相关\" class=\"headerlink\" title=\"开发流程相关\"></a>开发流程相关</h2><h3 id=\"分支\"><a href=\"#分支\" class=\"headerlink\" title=\"分支\"></a>分支</h3><p>👉 master</p>\n<ul>\n<li>主分支，稳定版本，用于部署生产环境</li>\n<li>不允许直接 push 代码，只能 Gitlab 上提交 merge request，且只允许 hotfix、release 分支代码合入</li>\n<li>每次发版成功后打 tag，加上日期</li>\n<li>常驻分支</li>\n</ul>\n<p>👉 release</p>\n<ul>\n<li>预发布分支</li>\n<li>验证过程中，bug 在 dev 分支自测，合入 test 分支提交给测试人员测试，测试通过后合入 release 分支验证</li>\n<li>验证通过后，合入 master 分支，master 分支发布版本</li>\n<li>常驻分支</li>\n</ul>\n<p>👉 test</p>\n<ul>\n<li>提测分支</li>\n<li>常驻分支</li>\n</ul>\n<p>👉 dev</p>\n<ul>\n<li>开发分支，包括新特性和 bug 修复，始终保持最新代码</li>\n<li>常驻分支</li>\n</ul>\n<p>👉 feature</p>\n<ul>\n<li>新功能，以 master 为基础创建</li>\n<li>命名以 feat&#x2F; 开头</li>\n<li>❗️需 push 到远程</li>\n<li>临时分支，合并后删除</li>\n</ul>\n<p>fix</p>\n<ul>\n<li>修复非生产 bug</li>\n<li>命名以 fix&#x2F; 开头</li>\n<li>修复完成后合入 dev 验证</li>\n<li>临时分支，合并后删除</li>\n</ul>\n<p>👉 hotfix</p>\n<ul>\n<li>紧急 bug 修复分支，修复生产 bug</li>\n<li>命名以 hotfix&#x2F; 开头</li>\n<li>修复完成后合入 master 验证</li>\n<li>临时分支，合并后删除</li>\n</ul>\n<h3 id=\"Commit-提交规范\"><a href=\"#Commit-提交规范\" class=\"headerlink\" title=\"Commit 提交规范\"></a>Commit 提交规范</h3><ol>\n<li>提交格式（考虑 commitizen）<br><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</code></li>\n</ol>\n<p>type</p>\n<ul>\n<li>feat: 新功能&#x2F;特性</li>\n<li>fix: 修复 bug</li>\n<li>perf: 修改代码，以提高性能</li>\n<li>refactor: 代码重构</li>\n<li>docs: 文档修改</li>\n<li>style: 代码格式修改, 注意不是 css 修改（例如分号修改）</li>\n<li>test: 测试用例新增、修改</li>\n<li>build: 影响项目构建或依赖项修改</li>\n<li>revert: 恢复上一次提交</li>\n<li>ci: 持续集成相关文件修改</li>\n<li>chore: 其他修改（不在上述类型中的修改）</li>\n<li>release: 发布新版本</li>\n</ul>\n<p>scope<br>commit 影响的功能或文件范围，比如: route、component、utils、build…</p>\n<p>subject<br>commit message 的概述</p>\n<ol start=\"2\">\n<li>husky pre-commit</li>\n</ol>\n<h2 id=\"环境说明\"><a href=\"#环境说明\" class=\"headerlink\" title=\"环境说明\"></a>环境说明</h2><ul>\n<li>开发环境 Develop<br>用于开发人员开发新特性，修复缺陷，自测使用</li>\n<li>测试环境 Test<br>用于测试人员测试，提出缺陷</li>\n<li>预发布环境 Release<br>用于上线前的真实环境验证</li>\n<li>生产环境 Production<br>用于发布稳定版本，打标签</li>\n</ul>\n"},{"title":"flex 1 是怎么工作的","date":"2023-02-18T02:37:51.000Z","description":"你有没有想过 CSS 中的 flex属性如何工作?它是 flex-grow，flex-shrink和flex-basis的简写。开发中最常见的写法是flex：1，它表示 flex 项目扩展并填充可用空间。","_content":"\n# flex 1\n\nflex: 1 实际上是三个属性的缩写：flex-grow: 1; flex-shrink: 1 flex-basis: auto。开发中最常见的写法是flex：1，它表示 flex 项目扩展并填充可用空间。\n\n## flex-grow\n\n> flex-grow 设置 flex 项 主尺寸 的 flex 增长系数。\n\n默认为0，即如果存在剩余空间，也不放大。\n\n设置了 flex-grow 的项目宽度 = (( flex-grow / flex-grow 总个数) * 可用空间）+ 初始项目宽度。\n\n有一个常见的误解，使用flex-grow会使项目的宽度相等。这是不正确的，flex-grow的作用是分配可用空间。正如在公式中看到的，每 flex 项目的宽度是基于其初始宽度计算的(应用flex-grow之前的宽度)。\n\n如果你想让项目的宽度相等，可以使用flex-basis，这个在接下来的部分会对此进行讲解。\n\n\n## flex-shrink\n\n> 指定 flex 元素的收缩规则。flex 元素仅在默认宽度之和大于容器的时候才会发生收缩，其收缩的大小是依据 flex-shrink 的值。\n\n举个例子：\n\n```css\n.content {\n    width: 500px;\n    display: flex; \n}\n.box-1 {\n    background: aqua;\n    width: 400px;\n    flex-shrink: 1;\n}\n.box-2 {\n    background: pink;\n    width: 200px;\n    flex-shrink: 2;\n}\n```\n\n这边设置flex下2个子元素的宽度分别是 400px 和 300px，可以明显的看出已经超出父元素设置的500px。\n\n那么这是flex-shrink就会起到作用，它会根据flex-shrink设置的值进行收缩。\n\n如果flex-shrink设置为0表示当前元素不会进行收缩，flex-shrink的默认值为1;\n\nflex-shrink的收缩公式（以这个为例）：\n\n **子元素超出的宽度 * flex-shrink的值 * 子元素宽度 / 总值** \n\n总值的获取（以当前代码为例）：1(box-1的flex-shrink值) * 400(box-1的宽度) + 2(box-2的flex-shrink值) * 300(box-2的宽度) = 1000;\n\n以当前代码为例计算：\n\n子元素超出的值：500 - (400 + 300) = 200;\n\n总值：1 * 400 + 2 * 300 = 1000;\n\n.box-1收缩的宽度：200 * 1 * 400 / 1000 = 80;\n\n.box-2收缩的宽度：200 * 2 * 300 / 1000 = 120;\n\n\n## flex-basis\n\n> 指定 flex 元素在主轴方向上的初始大小。如果不使用 box-sizing 改变盒模型的话，那么这个属性就决定了 flex 元素的内容盒（content-box）的尺寸。\n\n浏览器根据这个属性，计算主轴是否有多余空间。它的默认值为auto，即项目的本来大小。\n\nflex-basis可以设为跟width或height属性一样的值(比如350px，默认值为 auto)，则项目将占据固定空间。\n\n当一个元素同时被设置了 flex-basis (除值为 auto 外) 和 width (或者在 flex-direction: column 情况下设置了height) , flex-basis 具有更高的优先级。\n\n\n## flex 属性\n\nflex属性是flex-grow, flex-shrink 和 flex-basis的简写，默认值为0 1 auto。后两个属性可选。这也说 flex 项目会根据其内容大小增长。\n\n\nflex 项目的大小取决于内容。因此，内容越多的flex项目就会越大：\n\n```css\n.item { \n    /* 默认值，相当于 flex：1 1 auto */ \n    flex: auto; \n} \n```\n\n当flex-basis属性设置为0时，所有flex项目大小会保持一致：\n\n```css\n.item { \n    /* 相当于  flex: 1 1 0% */ \n    flex: 1; \n} \n```\n\n\n## 最后\n\n参考链接：\n\n- https://www.51cto.com/article/683878.html\n- https://blog.csdn.net/m0_58875326/article/details/124444419\n- https://blog.csdn.net/LueLueLue77/article/details/124860668","source":"_posts/flex-1.md","raw":"---\ntitle: flex 1 是怎么工作的\ndate: 2023-02-18 10:37:51\ntags:\ncategories: CSS\ndescription: 你有没有想过 CSS 中的 flex属性如何工作?它是 flex-grow，flex-shrink和flex-basis的简写。开发中最常见的写法是flex：1，它表示 flex 项目扩展并填充可用空间。\n---\n\n# flex 1\n\nflex: 1 实际上是三个属性的缩写：flex-grow: 1; flex-shrink: 1 flex-basis: auto。开发中最常见的写法是flex：1，它表示 flex 项目扩展并填充可用空间。\n\n## flex-grow\n\n> flex-grow 设置 flex 项 主尺寸 的 flex 增长系数。\n\n默认为0，即如果存在剩余空间，也不放大。\n\n设置了 flex-grow 的项目宽度 = (( flex-grow / flex-grow 总个数) * 可用空间）+ 初始项目宽度。\n\n有一个常见的误解，使用flex-grow会使项目的宽度相等。这是不正确的，flex-grow的作用是分配可用空间。正如在公式中看到的，每 flex 项目的宽度是基于其初始宽度计算的(应用flex-grow之前的宽度)。\n\n如果你想让项目的宽度相等，可以使用flex-basis，这个在接下来的部分会对此进行讲解。\n\n\n## flex-shrink\n\n> 指定 flex 元素的收缩规则。flex 元素仅在默认宽度之和大于容器的时候才会发生收缩，其收缩的大小是依据 flex-shrink 的值。\n\n举个例子：\n\n```css\n.content {\n    width: 500px;\n    display: flex; \n}\n.box-1 {\n    background: aqua;\n    width: 400px;\n    flex-shrink: 1;\n}\n.box-2 {\n    background: pink;\n    width: 200px;\n    flex-shrink: 2;\n}\n```\n\n这边设置flex下2个子元素的宽度分别是 400px 和 300px，可以明显的看出已经超出父元素设置的500px。\n\n那么这是flex-shrink就会起到作用，它会根据flex-shrink设置的值进行收缩。\n\n如果flex-shrink设置为0表示当前元素不会进行收缩，flex-shrink的默认值为1;\n\nflex-shrink的收缩公式（以这个为例）：\n\n **子元素超出的宽度 * flex-shrink的值 * 子元素宽度 / 总值** \n\n总值的获取（以当前代码为例）：1(box-1的flex-shrink值) * 400(box-1的宽度) + 2(box-2的flex-shrink值) * 300(box-2的宽度) = 1000;\n\n以当前代码为例计算：\n\n子元素超出的值：500 - (400 + 300) = 200;\n\n总值：1 * 400 + 2 * 300 = 1000;\n\n.box-1收缩的宽度：200 * 1 * 400 / 1000 = 80;\n\n.box-2收缩的宽度：200 * 2 * 300 / 1000 = 120;\n\n\n## flex-basis\n\n> 指定 flex 元素在主轴方向上的初始大小。如果不使用 box-sizing 改变盒模型的话，那么这个属性就决定了 flex 元素的内容盒（content-box）的尺寸。\n\n浏览器根据这个属性，计算主轴是否有多余空间。它的默认值为auto，即项目的本来大小。\n\nflex-basis可以设为跟width或height属性一样的值(比如350px，默认值为 auto)，则项目将占据固定空间。\n\n当一个元素同时被设置了 flex-basis (除值为 auto 外) 和 width (或者在 flex-direction: column 情况下设置了height) , flex-basis 具有更高的优先级。\n\n\n## flex 属性\n\nflex属性是flex-grow, flex-shrink 和 flex-basis的简写，默认值为0 1 auto。后两个属性可选。这也说 flex 项目会根据其内容大小增长。\n\n\nflex 项目的大小取决于内容。因此，内容越多的flex项目就会越大：\n\n```css\n.item { \n    /* 默认值，相当于 flex：1 1 auto */ \n    flex: auto; \n} \n```\n\n当flex-basis属性设置为0时，所有flex项目大小会保持一致：\n\n```css\n.item { \n    /* 相当于  flex: 1 1 0% */ \n    flex: 1; \n} \n```\n\n\n## 最后\n\n参考链接：\n\n- https://www.51cto.com/article/683878.html\n- https://blog.csdn.net/m0_58875326/article/details/124444419\n- https://blog.csdn.net/LueLueLue77/article/details/124860668","slug":"flex-1","published":1,"updated":"2023-03-11T16:42:49.733Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshw0017yt8w0pzx2yxk","content":"<h1 id=\"flex-1\"><a href=\"#flex-1\" class=\"headerlink\" title=\"flex 1\"></a>flex 1</h1><p>flex: 1 实际上是三个属性的缩写：flex-grow: 1; flex-shrink: 1 flex-basis: auto。开发中最常见的写法是flex：1，它表示 flex 项目扩展并填充可用空间。</p>\n<h2 id=\"flex-grow\"><a href=\"#flex-grow\" class=\"headerlink\" title=\"flex-grow\"></a>flex-grow</h2><blockquote>\n<p>flex-grow 设置 flex 项 主尺寸 的 flex 增长系数。</p>\n</blockquote>\n<p>默认为0，即如果存在剩余空间，也不放大。</p>\n<p>设置了 flex-grow 的项目宽度 &#x3D; (( flex-grow &#x2F; flex-grow 总个数) * 可用空间）+ 初始项目宽度。</p>\n<p>有一个常见的误解，使用flex-grow会使项目的宽度相等。这是不正确的，flex-grow的作用是分配可用空间。正如在公式中看到的，每 flex 项目的宽度是基于其初始宽度计算的(应用flex-grow之前的宽度)。</p>\n<p>如果你想让项目的宽度相等，可以使用flex-basis，这个在接下来的部分会对此进行讲解。</p>\n<h2 id=\"flex-shrink\"><a href=\"#flex-shrink\" class=\"headerlink\" title=\"flex-shrink\"></a>flex-shrink</h2><blockquote>\n<p>指定 flex 元素的收缩规则。flex 元素仅在默认宽度之和大于容器的时候才会发生收缩，其收缩的大小是依据 flex-shrink 的值。</p>\n</blockquote>\n<p>举个例子：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">500px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.box-1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: aqua;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">400px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">flex-shrink</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.box-2</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: pink;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">flex-shrink</span>: <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这边设置flex下2个子元素的宽度分别是 400px 和 300px，可以明显的看出已经超出父元素设置的500px。</p>\n<p>那么这是flex-shrink就会起到作用，它会根据flex-shrink设置的值进行收缩。</p>\n<p>如果flex-shrink设置为0表示当前元素不会进行收缩，flex-shrink的默认值为1;</p>\n<p>flex-shrink的收缩公式（以这个为例）：</p>\n<p> <strong>子元素超出的宽度 * flex-shrink的值 * 子元素宽度 &#x2F; 总值</strong> </p>\n<p>总值的获取（以当前代码为例）：1(box-1的flex-shrink值) * 400(box-1的宽度) + 2(box-2的flex-shrink值) * 300(box-2的宽度) &#x3D; 1000;</p>\n<p>以当前代码为例计算：</p>\n<p>子元素超出的值：500 - (400 + 300) &#x3D; 200;</p>\n<p>总值：1 * 400 + 2 * 300 &#x3D; 1000;</p>\n<p>.box-1收缩的宽度：200 * 1 * 400 &#x2F; 1000 &#x3D; 80;</p>\n<p>.box-2收缩的宽度：200 * 2 * 300 &#x2F; 1000 &#x3D; 120;</p>\n<h2 id=\"flex-basis\"><a href=\"#flex-basis\" class=\"headerlink\" title=\"flex-basis\"></a>flex-basis</h2><blockquote>\n<p>指定 flex 元素在主轴方向上的初始大小。如果不使用 box-sizing 改变盒模型的话，那么这个属性就决定了 flex 元素的内容盒（content-box）的尺寸。</p>\n</blockquote>\n<p>浏览器根据这个属性，计算主轴是否有多余空间。它的默认值为auto，即项目的本来大小。</p>\n<p>flex-basis可以设为跟width或height属性一样的值(比如350px，默认值为 auto)，则项目将占据固定空间。</p>\n<p>当一个元素同时被设置了 flex-basis (除值为 auto 外) 和 width (或者在 flex-direction: column 情况下设置了height) , flex-basis 具有更高的优先级。</p>\n<h2 id=\"flex-属性\"><a href=\"#flex-属性\" class=\"headerlink\" title=\"flex 属性\"></a>flex 属性</h2><p>flex属性是flex-grow, flex-shrink 和 flex-basis的简写，默认值为0 1 auto。后两个属性可选。这也说 flex 项目会根据其内容大小增长。</p>\n<p>flex 项目的大小取决于内容。因此，内容越多的flex项目就会越大：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.item</span> &#123; </span><br><span class=\"line\">    <span class=\"comment\">/* 默认值，相当于 flex：1 1 auto */</span> </span><br><span class=\"line\">    <span class=\"attribute\">flex</span>: auto; </span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n<p>当flex-basis属性设置为0时，所有flex项目大小会保持一致：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.item</span> &#123; </span><br><span class=\"line\">    <span class=\"comment\">/* 相当于  flex: 1 1 0% */</span> </span><br><span class=\"line\">    <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>; </span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>参考链接：</p>\n<ul>\n<li><a href=\"https://www.51cto.com/article/683878.html\">https://www.51cto.com/article/683878.html</a></li>\n<li><a href=\"https://blog.csdn.net/m0_58875326/article/details/124444419\">https://blog.csdn.net/m0_58875326/article/details/124444419</a></li>\n<li><a href=\"https://blog.csdn.net/LueLueLue77/article/details/124860668\">https://blog.csdn.net/LueLueLue77/article/details/124860668</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"flex-1\"><a href=\"#flex-1\" class=\"headerlink\" title=\"flex 1\"></a>flex 1</h1><p>flex: 1 实际上是三个属性的缩写：flex-grow: 1; flex-shrink: 1 flex-basis: auto。开发中最常见的写法是flex：1，它表示 flex 项目扩展并填充可用空间。</p>\n<h2 id=\"flex-grow\"><a href=\"#flex-grow\" class=\"headerlink\" title=\"flex-grow\"></a>flex-grow</h2><blockquote>\n<p>flex-grow 设置 flex 项 主尺寸 的 flex 增长系数。</p>\n</blockquote>\n<p>默认为0，即如果存在剩余空间，也不放大。</p>\n<p>设置了 flex-grow 的项目宽度 &#x3D; (( flex-grow &#x2F; flex-grow 总个数) * 可用空间）+ 初始项目宽度。</p>\n<p>有一个常见的误解，使用flex-grow会使项目的宽度相等。这是不正确的，flex-grow的作用是分配可用空间。正如在公式中看到的，每 flex 项目的宽度是基于其初始宽度计算的(应用flex-grow之前的宽度)。</p>\n<p>如果你想让项目的宽度相等，可以使用flex-basis，这个在接下来的部分会对此进行讲解。</p>\n<h2 id=\"flex-shrink\"><a href=\"#flex-shrink\" class=\"headerlink\" title=\"flex-shrink\"></a>flex-shrink</h2><blockquote>\n<p>指定 flex 元素的收缩规则。flex 元素仅在默认宽度之和大于容器的时候才会发生收缩，其收缩的大小是依据 flex-shrink 的值。</p>\n</blockquote>\n<p>举个例子：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">500px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.box-1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: aqua;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">400px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">flex-shrink</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.box-2</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: pink;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">flex-shrink</span>: <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这边设置flex下2个子元素的宽度分别是 400px 和 300px，可以明显的看出已经超出父元素设置的500px。</p>\n<p>那么这是flex-shrink就会起到作用，它会根据flex-shrink设置的值进行收缩。</p>\n<p>如果flex-shrink设置为0表示当前元素不会进行收缩，flex-shrink的默认值为1;</p>\n<p>flex-shrink的收缩公式（以这个为例）：</p>\n<p> <strong>子元素超出的宽度 * flex-shrink的值 * 子元素宽度 &#x2F; 总值</strong> </p>\n<p>总值的获取（以当前代码为例）：1(box-1的flex-shrink值) * 400(box-1的宽度) + 2(box-2的flex-shrink值) * 300(box-2的宽度) &#x3D; 1000;</p>\n<p>以当前代码为例计算：</p>\n<p>子元素超出的值：500 - (400 + 300) &#x3D; 200;</p>\n<p>总值：1 * 400 + 2 * 300 &#x3D; 1000;</p>\n<p>.box-1收缩的宽度：200 * 1 * 400 &#x2F; 1000 &#x3D; 80;</p>\n<p>.box-2收缩的宽度：200 * 2 * 300 &#x2F; 1000 &#x3D; 120;</p>\n<h2 id=\"flex-basis\"><a href=\"#flex-basis\" class=\"headerlink\" title=\"flex-basis\"></a>flex-basis</h2><blockquote>\n<p>指定 flex 元素在主轴方向上的初始大小。如果不使用 box-sizing 改变盒模型的话，那么这个属性就决定了 flex 元素的内容盒（content-box）的尺寸。</p>\n</blockquote>\n<p>浏览器根据这个属性，计算主轴是否有多余空间。它的默认值为auto，即项目的本来大小。</p>\n<p>flex-basis可以设为跟width或height属性一样的值(比如350px，默认值为 auto)，则项目将占据固定空间。</p>\n<p>当一个元素同时被设置了 flex-basis (除值为 auto 外) 和 width (或者在 flex-direction: column 情况下设置了height) , flex-basis 具有更高的优先级。</p>\n<h2 id=\"flex-属性\"><a href=\"#flex-属性\" class=\"headerlink\" title=\"flex 属性\"></a>flex 属性</h2><p>flex属性是flex-grow, flex-shrink 和 flex-basis的简写，默认值为0 1 auto。后两个属性可选。这也说 flex 项目会根据其内容大小增长。</p>\n<p>flex 项目的大小取决于内容。因此，内容越多的flex项目就会越大：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.item</span> &#123; </span><br><span class=\"line\">    <span class=\"comment\">/* 默认值，相当于 flex：1 1 auto */</span> </span><br><span class=\"line\">    <span class=\"attribute\">flex</span>: auto; </span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n<p>当flex-basis属性设置为0时，所有flex项目大小会保持一致：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.item</span> &#123; </span><br><span class=\"line\">    <span class=\"comment\">/* 相当于  flex: 1 1 0% */</span> </span><br><span class=\"line\">    <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>; </span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>参考链接：</p>\n<ul>\n<li><a href=\"https://www.51cto.com/article/683878.html\">https://www.51cto.com/article/683878.html</a></li>\n<li><a href=\"https://blog.csdn.net/m0_58875326/article/details/124444419\">https://blog.csdn.net/m0_58875326/article/details/124444419</a></li>\n<li><a href=\"https://blog.csdn.net/LueLueLue77/article/details/124860668\">https://blog.csdn.net/LueLueLue77/article/details/124860668</a></li>\n</ul>\n"},{"title":"手写一个Ajax","date":"2022-05-10T12:31:27.000Z","description":"Ajax（Asynchronous JavaScript and XML），即异步JavaScript和XML，可以无需刷新页面即可从服务器取得数据。","_content":"\n> Ajax（Asynchronous JavaScript and XML），即异步JavaScript和XML，可以无需刷新页面即可从服务器取得数据。\n\n\n\n**一个简单的Ajax（get）请求：**\n\n```js\nvar xhr = new XMLHttpRequest(); \nxhr.open(\"GET\", \"/xxx\");\nxhr.onreadystatechange = function() {\n  if (xhr.readyState === 4) {\n    if (xhr.status >= 200 && xhr.status < 300 || xhr.status === 304) {\n      alert(xhr.responseText);\n    } else {\n      alert(\"Error:\" + xhr.status);\n    }\n  }\n}\nxhr.send();\n```\n\n\n\n说明：\n\n+ `new XMLHttpRequest()` 创建 xhr 对象，IE通过 `new ActiveXObject(\"Microsoft.XMLHTTP\")` 创建；\n+ `open` 方法初始化一个请求，原始API：`open(method, url, async)`；\n+ `onreadystatechange` 方法只要 readystate 属性变化，就会调用相应的函数，readystate的值：\n  + 0 - （未初始化）还没有调用send()方法\n  + 1 - （载入) 已调用 send()方法，正在发送请求\n  + 2 - （载入完成） send()方法执行完成，已经接受到全部响应内容\n  + 3 - （交互）正在解析响应内容\n  + 4 - （完成）响应内容解析完成，可以在客户端调用\n+ status 状态码：\n  + 2xx - 表示成功处理请求，如200\n  + 3xx - 需要重定向，浏览器直接跳转，如301（永久重定向，永远都直接从A地址跳转到B址）302（临时重定向，只有一次重定向） 304（资源未改变，没有新资源使用缓存中的资源）\n  + 4xx - 客户端请求错误，如 404（找不到） 403（没有访问权限）\n  + 5xx - 服务器端错误\n+ `XMLHttpRequest.send(body)` 方法用于发送 HTTP 请求。\n\n\n\n\n\n**如果是 post 请求：**\n\n+ open 方法第一个参数改为 `POST`；\n+ `XMLHttpRequest.send(body)` 方法参数可以传数据体；\n+ `XMLHttpRequest.setRequestHeader(header, value)` 方法设置请求头；\n\n\n\n---\n\n*XMLHttpRequest MDN：https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest*\n\n","source":"_posts/handwrite-ajax.md","raw":"---\ntitle: 手写一个Ajax\ndate: 2022-05-10 20:31:27\ntags: 手写\ncategories: JavaScript\ndescription: Ajax（Asynchronous JavaScript and XML），即异步JavaScript和XML，可以无需刷新页面即可从服务器取得数据。\n---\n\n> Ajax（Asynchronous JavaScript and XML），即异步JavaScript和XML，可以无需刷新页面即可从服务器取得数据。\n\n\n\n**一个简单的Ajax（get）请求：**\n\n```js\nvar xhr = new XMLHttpRequest(); \nxhr.open(\"GET\", \"/xxx\");\nxhr.onreadystatechange = function() {\n  if (xhr.readyState === 4) {\n    if (xhr.status >= 200 && xhr.status < 300 || xhr.status === 304) {\n      alert(xhr.responseText);\n    } else {\n      alert(\"Error:\" + xhr.status);\n    }\n  }\n}\nxhr.send();\n```\n\n\n\n说明：\n\n+ `new XMLHttpRequest()` 创建 xhr 对象，IE通过 `new ActiveXObject(\"Microsoft.XMLHTTP\")` 创建；\n+ `open` 方法初始化一个请求，原始API：`open(method, url, async)`；\n+ `onreadystatechange` 方法只要 readystate 属性变化，就会调用相应的函数，readystate的值：\n  + 0 - （未初始化）还没有调用send()方法\n  + 1 - （载入) 已调用 send()方法，正在发送请求\n  + 2 - （载入完成） send()方法执行完成，已经接受到全部响应内容\n  + 3 - （交互）正在解析响应内容\n  + 4 - （完成）响应内容解析完成，可以在客户端调用\n+ status 状态码：\n  + 2xx - 表示成功处理请求，如200\n  + 3xx - 需要重定向，浏览器直接跳转，如301（永久重定向，永远都直接从A地址跳转到B址）302（临时重定向，只有一次重定向） 304（资源未改变，没有新资源使用缓存中的资源）\n  + 4xx - 客户端请求错误，如 404（找不到） 403（没有访问权限）\n  + 5xx - 服务器端错误\n+ `XMLHttpRequest.send(body)` 方法用于发送 HTTP 请求。\n\n\n\n\n\n**如果是 post 请求：**\n\n+ open 方法第一个参数改为 `POST`；\n+ `XMLHttpRequest.send(body)` 方法参数可以传数据体；\n+ `XMLHttpRequest.setRequestHeader(header, value)` 方法设置请求头；\n\n\n\n---\n\n*XMLHttpRequest MDN：https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest*\n\n","slug":"handwrite-ajax","published":1,"updated":"2022-05-10T13:28:21.933Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshx001byt8w854vbcg9","content":"<blockquote>\n<p>Ajax（Asynchronous JavaScript and XML），即异步JavaScript和XML，可以无需刷新页面即可从服务器取得数据。</p>\n</blockquote>\n<p><strong>一个简单的Ajax（get）请求：</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>(); </span><br><span class=\"line\">xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;GET&quot;</span>, <span class=\"string\">&quot;/xxx&quot;</span>);</span><br><span class=\"line\">xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (xhr.<span class=\"property\">readyState</span> === <span class=\"number\">4</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> &gt;= <span class=\"number\">200</span> &amp;&amp; xhr.<span class=\"property\">status</span> &lt; <span class=\"number\">300</span> || xhr.<span class=\"property\">status</span> === <span class=\"number\">304</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(xhr.<span class=\"property\">responseText</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;Error:&quot;</span> + xhr.<span class=\"property\">status</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">xhr.<span class=\"title function_\">send</span>();</span><br></pre></td></tr></table></figure>\n\n\n\n<p>说明：</p>\n<ul>\n<li><code>new XMLHttpRequest()</code> 创建 xhr 对象，IE通过 <code>new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;)</code> 创建；</li>\n<li><code>open</code> 方法初始化一个请求，原始API：<code>open(method, url, async)</code>；</li>\n<li><code>onreadystatechange</code> 方法只要 readystate 属性变化，就会调用相应的函数，readystate的值：<ul>\n<li>0 - （未初始化）还没有调用send()方法</li>\n<li>1 - （载入) 已调用 send()方法，正在发送请求</li>\n<li>2 - （载入完成） send()方法执行完成，已经接受到全部响应内容</li>\n<li>3 - （交互）正在解析响应内容</li>\n<li>4 - （完成）响应内容解析完成，可以在客户端调用</li>\n</ul>\n</li>\n<li>status 状态码：<ul>\n<li>2xx - 表示成功处理请求，如200</li>\n<li>3xx - 需要重定向，浏览器直接跳转，如301（永久重定向，永远都直接从A地址跳转到B址）302（临时重定向，只有一次重定向） 304（资源未改变，没有新资源使用缓存中的资源）</li>\n<li>4xx - 客户端请求错误，如 404（找不到） 403（没有访问权限）</li>\n<li>5xx - 服务器端错误</li>\n</ul>\n</li>\n<li><code>XMLHttpRequest.send(body)</code> 方法用于发送 HTTP 请求。</li>\n</ul>\n<p><strong>如果是 post 请求：</strong></p>\n<ul>\n<li>open 方法第一个参数改为 <code>POST</code>；</li>\n<li><code>XMLHttpRequest.send(body)</code> 方法参数可以传数据体；</li>\n<li><code>XMLHttpRequest.setRequestHeader(header, value)</code> 方法设置请求头；</li>\n</ul>\n<hr>\n<p><em>XMLHttpRequest MDN：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest\">https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest</a></em></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Ajax（Asynchronous JavaScript and XML），即异步JavaScript和XML，可以无需刷新页面即可从服务器取得数据。</p>\n</blockquote>\n<p><strong>一个简单的Ajax（get）请求：</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>(); </span><br><span class=\"line\">xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;GET&quot;</span>, <span class=\"string\">&quot;/xxx&quot;</span>);</span><br><span class=\"line\">xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (xhr.<span class=\"property\">readyState</span> === <span class=\"number\">4</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> &gt;= <span class=\"number\">200</span> &amp;&amp; xhr.<span class=\"property\">status</span> &lt; <span class=\"number\">300</span> || xhr.<span class=\"property\">status</span> === <span class=\"number\">304</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(xhr.<span class=\"property\">responseText</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;Error:&quot;</span> + xhr.<span class=\"property\">status</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">xhr.<span class=\"title function_\">send</span>();</span><br></pre></td></tr></table></figure>\n\n\n\n<p>说明：</p>\n<ul>\n<li><code>new XMLHttpRequest()</code> 创建 xhr 对象，IE通过 <code>new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;)</code> 创建；</li>\n<li><code>open</code> 方法初始化一个请求，原始API：<code>open(method, url, async)</code>；</li>\n<li><code>onreadystatechange</code> 方法只要 readystate 属性变化，就会调用相应的函数，readystate的值：<ul>\n<li>0 - （未初始化）还没有调用send()方法</li>\n<li>1 - （载入) 已调用 send()方法，正在发送请求</li>\n<li>2 - （载入完成） send()方法执行完成，已经接受到全部响应内容</li>\n<li>3 - （交互）正在解析响应内容</li>\n<li>4 - （完成）响应内容解析完成，可以在客户端调用</li>\n</ul>\n</li>\n<li>status 状态码：<ul>\n<li>2xx - 表示成功处理请求，如200</li>\n<li>3xx - 需要重定向，浏览器直接跳转，如301（永久重定向，永远都直接从A地址跳转到B址）302（临时重定向，只有一次重定向） 304（资源未改变，没有新资源使用缓存中的资源）</li>\n<li>4xx - 客户端请求错误，如 404（找不到） 403（没有访问权限）</li>\n<li>5xx - 服务器端错误</li>\n</ul>\n</li>\n<li><code>XMLHttpRequest.send(body)</code> 方法用于发送 HTTP 请求。</li>\n</ul>\n<p><strong>如果是 post 请求：</strong></p>\n<ul>\n<li>open 方法第一个参数改为 <code>POST</code>；</li>\n<li><code>XMLHttpRequest.send(body)</code> 方法参数可以传数据体；</li>\n<li><code>XMLHttpRequest.setRequestHeader(header, value)</code> 方法设置请求头；</li>\n</ul>\n<hr>\n<p><em>XMLHttpRequest MDN：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest\">https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest</a></em></p>\n"},{"title":"call和apply模拟实现","date":"2022-05-02T11:12:48.000Z","description":"call 方法在使用一个指定的 this 值和若干个指定的参数值的前提下调用某个函数或方法。","_content":"\n## call\n\n一句话介绍 call：\n\n> call() 方法在使用一个指定的 this 值和若干个指定的参数值的前提下调用某个函数或方法。\n> 举个例子：\n\n```js\nvar foo = {\n    value: 1\n};\nfunction bar() {\n    console.log(this.value);\n}\nbar.call(foo); // 1\n```\n\n注意两点：\n\n1. call 改变了 this 的指向，指向到 foo\n2. bar 函数执行了\n\n**模拟实现第一步：**\n\n那么我们该怎么模拟实现这两个效果呢？\n\n试想当调用 call 的时候，把 foo 对象改造成如下：\n\n```js\nvar foo = {\n    value: 1,\n    bar: function() {\n        console.log(this.value)\n    }\n};\nfoo.bar(); // 1\n```\n\n个时候 this 就指向了 foo，是不是很简单呢？\n\n但是这样却给 foo 对象本身添加了一个属性，这可不行呐！\n\n不过也不用担心，我们用 delete 再删除它不就好了~\n\n所以我们模拟的步骤可以分为：\n\n1. 将函数设为对象的属性\n2. 执行该函数\n3. 删除该函数\n\n以上个例子为例，就是：\n\n```js\n// 第一步\nfoo.fn = bar\n// 第二步\nfoo.fn()\n// 第三步\ndelete foo.fn\n```\n\nfn 是对象的属性名，反正最后也要删除它，所以起成什么都无所谓。\n\n根据这个思路，我们可以尝试着去写第一版的 **call2** 函数：\n\n```js\n// 第一版\nFunction.prototype.call2 = function(context) {\n    // 首先要获取调用call的函数，用this可以获取\n    context.fn = this;\n    context.fn();\n    delete context.fn;\n}\n// 测试一下\nvar foo = {\n    value: 1\n};\nfunction bar() {\n    console.log(this.value);\n}\nbar.call2(foo); // 1 成功\n```\n\n**模拟实现第二步：**\n\n最一开始也讲了，call 函数还能给定参数执行函数。举个例子：\n\n```js\nvar foo = {\n    value: 1\n};\nfunction bar(name, age) {\n    console.log(name)\n    console.log(age)\n    console.log(this.value);\n}\nbar.call(foo, 'kevin', 18);\n// kevin\n// 18\n// 1\n```\n\n注意：传入的参数并不确定，这可咋办？\n\n不急，我们可以从 Arguments 对象中取值，取出第二个到最后一个参数，然后放到一个数组里。\n\n比如这样：\n\n```js\n// 以上个例子为例，此时的arguments为：\n// arguments = {\n//      0: foo,\n//      1: 'kevin',\n//      2: 18,\n//      length: 3\n// }\n// 因为arguments是类数组对象，所以可以用for循环\nvar args = [];\nfor(var i = 1, len = arguments.length; i < len; i++) {\n    args.push('arguments[' + i + ']');\n}\n// 执行后 args为 [\"arguments[1]\", \"arguments[2]\", \"arguments[3]\"]\n```\n\n不定长的参数问题解决了，我们接着要把这个参数数组放到要执行的函数的参数里面去。也许有人想到用 ES6 的方法，不过 call 是 ES3 的方法，我们为了模拟实现一个 ES3 的方法，要用到ES6的方法，好像……，嗯，也可以啦。但是我们这次用 eval 方法拼成一个函数，类似于这样：\n\n```js\neval('context.fn(' + args +')')\n```\n\n这里 args 会自动调用 Array.toString() 这个方法。\n\n所以我们的第二版克服了两个大问题，代码如下：\n\n```js\n// 第二版\nFunction.prototype.call2 = function(context) {\n    context.fn = this;\n    var args = [];\n    for(var i = 1, len = arguments.length; i < len; i++) {\n        args.push('arguments[' + i + ']');\n    }\n    eval('context.fn(' + args +')');\n    delete context.fn;\n}\n// 测试一下\nvar foo = {\n    value: 1\n};\nfunction bar(name, age) {\n    console.log(name)\n    console.log(age)\n    console.log(this.value);\n}\nbar.call2(foo, 'kevin', 18); \n// kevin\n// 18\n// 1\n```\n\n**模拟实现第三步：**\n\n还有两个小点要注意：\n\n1. this 参数可以传 null，当为 null 的时候，视为指向 window\n\n   举个例子：\n\n   ```js\n   var value = 1;\n   function bar() {\n       console.log(this.value);\n   }\n   bar.call(null); // 1\n   ```\n\n2. 函数是可以有返回值的！\n\n   举个例子：\n\n   ```js\n   var obj = {\n       value: 1\n   }\n   function bar(name, age) {\n       return {\n           value: this.value,\n           name: name,\n           age: age\n       }\n   }\n   console.log(bar.call(obj, 'kevin', 18));\n   // Object {\n   //    value: 1,\n   //    name: 'kevin',\n   //    age: 18\n   // }\n   ```\n\n不过都好解决，最终版：\n\n```js\n// 第三版\nFunction.prototype.call2 = function (context) {\n    var context = context || window;\n    context.fn = this;\n    var args = [];\n    for(var i = 1, len = arguments.length; i < len; i++) {\n        args.push('arguments[' + i + ']');\n    }\n    var result = eval('context.fn(' + args +')');\n    delete context.fn\n    return result;\n}\n// 测试一下\nvar value = 2;\nvar obj = {\n    value: 1\n}\nfunction bar(name, age) {\n    console.log(this.value);\n    return {\n        value: this.value,\n        name: name,\n        age: age\n    }\n}\nbar.call2(null); // 2\nconsole.log(bar.call2(obj, 'kevin', 18));\n// 1\n// Object {\n//    value: 1,\n//    name: 'kevin',\n//    age: 18\n// }\n```\n\n到此，我们完成了 call 的模拟实现。\n\n\n\n## apply的模拟实现\n\napply 的实现跟 call 类似：\n\n```js\nFunction.prototype.apply = function (context, arr) {\n    var context = Object(context) || window;\n    context.fn = this;\n    var result;\n    if (!arr) {\n        result = context.fn();\n    }\n    else {\n        var args = [];\n        for (var i = 0, len = arr.length; i < len; i++) {\n            args.push('arr[' + i + ']');\n        }\n        result = eval('context.fn(' + args + ')')\n    }\n    delete context.fn\n    return result;\n}\n```\n","source":"_posts/handwrite-call-apply.md","raw":"---\ntitle: call和apply模拟实现\ndate: 2022-05-02 19:12:48\ntags: [手写]\ncategories: JavaScript\ndescription: call 方法在使用一个指定的 this 值和若干个指定的参数值的前提下调用某个函数或方法。\n---\n\n## call\n\n一句话介绍 call：\n\n> call() 方法在使用一个指定的 this 值和若干个指定的参数值的前提下调用某个函数或方法。\n> 举个例子：\n\n```js\nvar foo = {\n    value: 1\n};\nfunction bar() {\n    console.log(this.value);\n}\nbar.call(foo); // 1\n```\n\n注意两点：\n\n1. call 改变了 this 的指向，指向到 foo\n2. bar 函数执行了\n\n**模拟实现第一步：**\n\n那么我们该怎么模拟实现这两个效果呢？\n\n试想当调用 call 的时候，把 foo 对象改造成如下：\n\n```js\nvar foo = {\n    value: 1,\n    bar: function() {\n        console.log(this.value)\n    }\n};\nfoo.bar(); // 1\n```\n\n个时候 this 就指向了 foo，是不是很简单呢？\n\n但是这样却给 foo 对象本身添加了一个属性，这可不行呐！\n\n不过也不用担心，我们用 delete 再删除它不就好了~\n\n所以我们模拟的步骤可以分为：\n\n1. 将函数设为对象的属性\n2. 执行该函数\n3. 删除该函数\n\n以上个例子为例，就是：\n\n```js\n// 第一步\nfoo.fn = bar\n// 第二步\nfoo.fn()\n// 第三步\ndelete foo.fn\n```\n\nfn 是对象的属性名，反正最后也要删除它，所以起成什么都无所谓。\n\n根据这个思路，我们可以尝试着去写第一版的 **call2** 函数：\n\n```js\n// 第一版\nFunction.prototype.call2 = function(context) {\n    // 首先要获取调用call的函数，用this可以获取\n    context.fn = this;\n    context.fn();\n    delete context.fn;\n}\n// 测试一下\nvar foo = {\n    value: 1\n};\nfunction bar() {\n    console.log(this.value);\n}\nbar.call2(foo); // 1 成功\n```\n\n**模拟实现第二步：**\n\n最一开始也讲了，call 函数还能给定参数执行函数。举个例子：\n\n```js\nvar foo = {\n    value: 1\n};\nfunction bar(name, age) {\n    console.log(name)\n    console.log(age)\n    console.log(this.value);\n}\nbar.call(foo, 'kevin', 18);\n// kevin\n// 18\n// 1\n```\n\n注意：传入的参数并不确定，这可咋办？\n\n不急，我们可以从 Arguments 对象中取值，取出第二个到最后一个参数，然后放到一个数组里。\n\n比如这样：\n\n```js\n// 以上个例子为例，此时的arguments为：\n// arguments = {\n//      0: foo,\n//      1: 'kevin',\n//      2: 18,\n//      length: 3\n// }\n// 因为arguments是类数组对象，所以可以用for循环\nvar args = [];\nfor(var i = 1, len = arguments.length; i < len; i++) {\n    args.push('arguments[' + i + ']');\n}\n// 执行后 args为 [\"arguments[1]\", \"arguments[2]\", \"arguments[3]\"]\n```\n\n不定长的参数问题解决了，我们接着要把这个参数数组放到要执行的函数的参数里面去。也许有人想到用 ES6 的方法，不过 call 是 ES3 的方法，我们为了模拟实现一个 ES3 的方法，要用到ES6的方法，好像……，嗯，也可以啦。但是我们这次用 eval 方法拼成一个函数，类似于这样：\n\n```js\neval('context.fn(' + args +')')\n```\n\n这里 args 会自动调用 Array.toString() 这个方法。\n\n所以我们的第二版克服了两个大问题，代码如下：\n\n```js\n// 第二版\nFunction.prototype.call2 = function(context) {\n    context.fn = this;\n    var args = [];\n    for(var i = 1, len = arguments.length; i < len; i++) {\n        args.push('arguments[' + i + ']');\n    }\n    eval('context.fn(' + args +')');\n    delete context.fn;\n}\n// 测试一下\nvar foo = {\n    value: 1\n};\nfunction bar(name, age) {\n    console.log(name)\n    console.log(age)\n    console.log(this.value);\n}\nbar.call2(foo, 'kevin', 18); \n// kevin\n// 18\n// 1\n```\n\n**模拟实现第三步：**\n\n还有两个小点要注意：\n\n1. this 参数可以传 null，当为 null 的时候，视为指向 window\n\n   举个例子：\n\n   ```js\n   var value = 1;\n   function bar() {\n       console.log(this.value);\n   }\n   bar.call(null); // 1\n   ```\n\n2. 函数是可以有返回值的！\n\n   举个例子：\n\n   ```js\n   var obj = {\n       value: 1\n   }\n   function bar(name, age) {\n       return {\n           value: this.value,\n           name: name,\n           age: age\n       }\n   }\n   console.log(bar.call(obj, 'kevin', 18));\n   // Object {\n   //    value: 1,\n   //    name: 'kevin',\n   //    age: 18\n   // }\n   ```\n\n不过都好解决，最终版：\n\n```js\n// 第三版\nFunction.prototype.call2 = function (context) {\n    var context = context || window;\n    context.fn = this;\n    var args = [];\n    for(var i = 1, len = arguments.length; i < len; i++) {\n        args.push('arguments[' + i + ']');\n    }\n    var result = eval('context.fn(' + args +')');\n    delete context.fn\n    return result;\n}\n// 测试一下\nvar value = 2;\nvar obj = {\n    value: 1\n}\nfunction bar(name, age) {\n    console.log(this.value);\n    return {\n        value: this.value,\n        name: name,\n        age: age\n    }\n}\nbar.call2(null); // 2\nconsole.log(bar.call2(obj, 'kevin', 18));\n// 1\n// Object {\n//    value: 1,\n//    name: 'kevin',\n//    age: 18\n// }\n```\n\n到此，我们完成了 call 的模拟实现。\n\n\n\n## apply的模拟实现\n\napply 的实现跟 call 类似：\n\n```js\nFunction.prototype.apply = function (context, arr) {\n    var context = Object(context) || window;\n    context.fn = this;\n    var result;\n    if (!arr) {\n        result = context.fn();\n    }\n    else {\n        var args = [];\n        for (var i = 0, len = arr.length; i < len; i++) {\n            args.push('arr[' + i + ']');\n        }\n        result = eval('context.fn(' + args + ')')\n    }\n    delete context.fn\n    return result;\n}\n```\n","slug":"handwrite-call-apply","published":1,"updated":"2022-05-02T11:41:59.635Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjshy001fyt8w3xrb4t9m","content":"<h2 id=\"call\"><a href=\"#call\" class=\"headerlink\" title=\"call\"></a>call</h2><p>一句话介绍 call：</p>\n<blockquote>\n<p>call() 方法在使用一个指定的 this 值和若干个指定的参数值的前提下调用某个函数或方法。<br>举个例子：</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call</span>(foo); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<p>注意两点：</p>\n<ol>\n<li>call 改变了 this 的指向，指向到 foo</li>\n<li>bar 函数执行了</li>\n</ol>\n<p><strong>模拟实现第一步：</strong></p>\n<p>那么我们该怎么模拟实现这两个效果呢？</p>\n<p>试想当调用 call 的时候，把 foo 对象改造成如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">bar</span>: <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">foo.<span class=\"title function_\">bar</span>(); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<p>个时候 this 就指向了 foo，是不是很简单呢？</p>\n<p>但是这样却给 foo 对象本身添加了一个属性，这可不行呐！</p>\n<p>不过也不用担心，我们用 delete 再删除它不就好了~</p>\n<p>所以我们模拟的步骤可以分为：</p>\n<ol>\n<li>将函数设为对象的属性</li>\n<li>执行该函数</li>\n<li>删除该函数</li>\n</ol>\n<p>以上个例子为例，就是：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第一步</span></span><br><span class=\"line\">foo.<span class=\"property\">fn</span> = bar</span><br><span class=\"line\"><span class=\"comment\">// 第二步</span></span><br><span class=\"line\">foo.<span class=\"title function_\">fn</span>()</span><br><span class=\"line\"><span class=\"comment\">// 第三步</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span> foo.<span class=\"property\">fn</span></span><br></pre></td></tr></table></figure>\n\n<p>fn 是对象的属性名，反正最后也要删除它，所以起成什么都无所谓。</p>\n<p>根据这个思路，我们可以尝试着去写第一版的 <strong>call2</strong> 函数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第一版</span></span><br><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">call2</span> = <span class=\"keyword\">function</span>(<span class=\"params\">context</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 首先要获取调用call的函数，用this可以获取</span></span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    context.<span class=\"title function_\">fn</span>();</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 测试一下</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call2</span>(foo); <span class=\"comment\">// 1 成功</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>模拟实现第二步：</strong></p>\n<p>最一开始也讲了，call 函数还能给定参数执行函数。举个例子：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\">name, age</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(age)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call</span>(foo, <span class=\"string\">&#x27;kevin&#x27;</span>, <span class=\"number\">18</span>);</span><br><span class=\"line\"><span class=\"comment\">// kevin</span></span><br><span class=\"line\"><span class=\"comment\">// 18</span></span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<p>注意：传入的参数并不确定，这可咋办？</p>\n<p>不急，我们可以从 Arguments 对象中取值，取出第二个到最后一个参数，然后放到一个数组里。</p>\n<p>比如这样：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 以上个例子为例，此时的arguments为：</span></span><br><span class=\"line\"><span class=\"comment\">// arguments = &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//      0: foo,</span></span><br><span class=\"line\"><span class=\"comment\">//      1: &#x27;kevin&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">//      2: 18,</span></span><br><span class=\"line\"><span class=\"comment\">//      length: 3</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// 因为arguments是类数组对象，所以可以用for循环</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> args = [];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>, len = <span class=\"variable language_\">arguments</span>.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">    args.<span class=\"title function_\">push</span>(<span class=\"string\">&#x27;arguments[&#x27;</span> + i + <span class=\"string\">&#x27;]&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 执行后 args为 [&quot;arguments[1]&quot;, &quot;arguments[2]&quot;, &quot;arguments[3]&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<p>不定长的参数问题解决了，我们接着要把这个参数数组放到要执行的函数的参数里面去。也许有人想到用 ES6 的方法，不过 call 是 ES3 的方法，我们为了模拟实现一个 ES3 的方法，要用到ES6的方法，好像……，嗯，也可以啦。但是我们这次用 eval 方法拼成一个函数，类似于这样：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;context.fn(&#x27;</span> + args +<span class=\"string\">&#x27;)&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这里 args 会自动调用 Array.toString() 这个方法。</p>\n<p>所以我们的第二版克服了两个大问题，代码如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第二版</span></span><br><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">call2</span> = <span class=\"keyword\">function</span>(<span class=\"params\">context</span>) &#123;</span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> args = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>, len = <span class=\"variable language_\">arguments</span>.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        args.<span class=\"title function_\">push</span>(<span class=\"string\">&#x27;arguments[&#x27;</span> + i + <span class=\"string\">&#x27;]&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;context.fn(&#x27;</span> + args +<span class=\"string\">&#x27;)&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 测试一下</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\">name, age</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(age)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call2</span>(foo, <span class=\"string\">&#x27;kevin&#x27;</span>, <span class=\"number\">18</span>); </span><br><span class=\"line\"><span class=\"comment\">// kevin</span></span><br><span class=\"line\"><span class=\"comment\">// 18</span></span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>模拟实现第三步：</strong></p>\n<p>还有两个小点要注意：</p>\n<ol>\n<li><p>this 参数可以传 null，当为 null 的时候，视为指向 window</p>\n<p>举个例子：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call</span>(<span class=\"literal\">null</span>); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>函数是可以有返回值的！</p>\n<p>举个例子：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\">name, age</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">value</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>,</span><br><span class=\"line\">        <span class=\"attr\">name</span>: name,</span><br><span class=\"line\">        <span class=\"attr\">age</span>: age</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(bar.<span class=\"title function_\">call</span>(obj, <span class=\"string\">&#x27;kevin&#x27;</span>, <span class=\"number\">18</span>));</span><br><span class=\"line\"><span class=\"comment\">// Object &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//    value: 1,</span></span><br><span class=\"line\"><span class=\"comment\">//    name: &#x27;kevin&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">//    age: 18</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>不过都好解决，最终版：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第三版</span></span><br><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">call2</span> = <span class=\"keyword\">function</span> (<span class=\"params\">context</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = context || <span class=\"variable language_\">window</span>;</span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> args = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>, len = <span class=\"variable language_\">arguments</span>.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        args.<span class=\"title function_\">push</span>(<span class=\"string\">&#x27;arguments[&#x27;</span> + i + <span class=\"string\">&#x27;]&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = <span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;context.fn(&#x27;</span> + args +<span class=\"string\">&#x27;)&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 测试一下</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\">name, age</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">value</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>,</span><br><span class=\"line\">        <span class=\"attr\">name</span>: name,</span><br><span class=\"line\">        <span class=\"attr\">age</span>: age</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call2</span>(<span class=\"literal\">null</span>); <span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(bar.<span class=\"title function_\">call2</span>(obj, <span class=\"string\">&#x27;kevin&#x27;</span>, <span class=\"number\">18</span>));</span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"comment\">// Object &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//    value: 1,</span></span><br><span class=\"line\"><span class=\"comment\">//    name: &#x27;kevin&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">//    age: 18</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>到此，我们完成了 call 的模拟实现。</p>\n<h2 id=\"apply的模拟实现\"><a href=\"#apply的模拟实现\" class=\"headerlink\" title=\"apply的模拟实现\"></a>apply的模拟实现</h2><p>apply 的实现跟 call 类似：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">apply</span> = <span class=\"keyword\">function</span> (<span class=\"params\">context, arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = <span class=\"title class_\">Object</span>(context) || <span class=\"variable language_\">window</span>;</span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!arr) &#123;</span><br><span class=\"line\">        result = context.<span class=\"title function_\">fn</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> args = [];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = arr.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">            args.<span class=\"title function_\">push</span>(<span class=\"string\">&#x27;arr[&#x27;</span> + i + <span class=\"string\">&#x27;]&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        result = <span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;context.fn(&#x27;</span> + args + <span class=\"string\">&#x27;)&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"call\"><a href=\"#call\" class=\"headerlink\" title=\"call\"></a>call</h2><p>一句话介绍 call：</p>\n<blockquote>\n<p>call() 方法在使用一个指定的 this 值和若干个指定的参数值的前提下调用某个函数或方法。<br>举个例子：</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call</span>(foo); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<p>注意两点：</p>\n<ol>\n<li>call 改变了 this 的指向，指向到 foo</li>\n<li>bar 函数执行了</li>\n</ol>\n<p><strong>模拟实现第一步：</strong></p>\n<p>那么我们该怎么模拟实现这两个效果呢？</p>\n<p>试想当调用 call 的时候，把 foo 对象改造成如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">bar</span>: <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">foo.<span class=\"title function_\">bar</span>(); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<p>个时候 this 就指向了 foo，是不是很简单呢？</p>\n<p>但是这样却给 foo 对象本身添加了一个属性，这可不行呐！</p>\n<p>不过也不用担心，我们用 delete 再删除它不就好了~</p>\n<p>所以我们模拟的步骤可以分为：</p>\n<ol>\n<li>将函数设为对象的属性</li>\n<li>执行该函数</li>\n<li>删除该函数</li>\n</ol>\n<p>以上个例子为例，就是：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第一步</span></span><br><span class=\"line\">foo.<span class=\"property\">fn</span> = bar</span><br><span class=\"line\"><span class=\"comment\">// 第二步</span></span><br><span class=\"line\">foo.<span class=\"title function_\">fn</span>()</span><br><span class=\"line\"><span class=\"comment\">// 第三步</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span> foo.<span class=\"property\">fn</span></span><br></pre></td></tr></table></figure>\n\n<p>fn 是对象的属性名，反正最后也要删除它，所以起成什么都无所谓。</p>\n<p>根据这个思路，我们可以尝试着去写第一版的 <strong>call2</strong> 函数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第一版</span></span><br><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">call2</span> = <span class=\"keyword\">function</span>(<span class=\"params\">context</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 首先要获取调用call的函数，用this可以获取</span></span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    context.<span class=\"title function_\">fn</span>();</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 测试一下</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call2</span>(foo); <span class=\"comment\">// 1 成功</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>模拟实现第二步：</strong></p>\n<p>最一开始也讲了，call 函数还能给定参数执行函数。举个例子：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\">name, age</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(age)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call</span>(foo, <span class=\"string\">&#x27;kevin&#x27;</span>, <span class=\"number\">18</span>);</span><br><span class=\"line\"><span class=\"comment\">// kevin</span></span><br><span class=\"line\"><span class=\"comment\">// 18</span></span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<p>注意：传入的参数并不确定，这可咋办？</p>\n<p>不急，我们可以从 Arguments 对象中取值，取出第二个到最后一个参数，然后放到一个数组里。</p>\n<p>比如这样：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 以上个例子为例，此时的arguments为：</span></span><br><span class=\"line\"><span class=\"comment\">// arguments = &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//      0: foo,</span></span><br><span class=\"line\"><span class=\"comment\">//      1: &#x27;kevin&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">//      2: 18,</span></span><br><span class=\"line\"><span class=\"comment\">//      length: 3</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// 因为arguments是类数组对象，所以可以用for循环</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> args = [];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>, len = <span class=\"variable language_\">arguments</span>.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">    args.<span class=\"title function_\">push</span>(<span class=\"string\">&#x27;arguments[&#x27;</span> + i + <span class=\"string\">&#x27;]&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 执行后 args为 [&quot;arguments[1]&quot;, &quot;arguments[2]&quot;, &quot;arguments[3]&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<p>不定长的参数问题解决了，我们接着要把这个参数数组放到要执行的函数的参数里面去。也许有人想到用 ES6 的方法，不过 call 是 ES3 的方法，我们为了模拟实现一个 ES3 的方法，要用到ES6的方法，好像……，嗯，也可以啦。但是我们这次用 eval 方法拼成一个函数，类似于这样：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;context.fn(&#x27;</span> + args +<span class=\"string\">&#x27;)&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这里 args 会自动调用 Array.toString() 这个方法。</p>\n<p>所以我们的第二版克服了两个大问题，代码如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第二版</span></span><br><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">call2</span> = <span class=\"keyword\">function</span>(<span class=\"params\">context</span>) &#123;</span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> args = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>, len = <span class=\"variable language_\">arguments</span>.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        args.<span class=\"title function_\">push</span>(<span class=\"string\">&#x27;arguments[&#x27;</span> + i + <span class=\"string\">&#x27;]&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;context.fn(&#x27;</span> + args +<span class=\"string\">&#x27;)&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 测试一下</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\">name, age</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(age)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call2</span>(foo, <span class=\"string\">&#x27;kevin&#x27;</span>, <span class=\"number\">18</span>); </span><br><span class=\"line\"><span class=\"comment\">// kevin</span></span><br><span class=\"line\"><span class=\"comment\">// 18</span></span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>模拟实现第三步：</strong></p>\n<p>还有两个小点要注意：</p>\n<ol>\n<li><p>this 参数可以传 null，当为 null 的时候，视为指向 window</p>\n<p>举个例子：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call</span>(<span class=\"literal\">null</span>); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>函数是可以有返回值的！</p>\n<p>举个例子：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\">name, age</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">value</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>,</span><br><span class=\"line\">        <span class=\"attr\">name</span>: name,</span><br><span class=\"line\">        <span class=\"attr\">age</span>: age</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(bar.<span class=\"title function_\">call</span>(obj, <span class=\"string\">&#x27;kevin&#x27;</span>, <span class=\"number\">18</span>));</span><br><span class=\"line\"><span class=\"comment\">// Object &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//    value: 1,</span></span><br><span class=\"line\"><span class=\"comment\">//    name: &#x27;kevin&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">//    age: 18</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>不过都好解决，最终版：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第三版</span></span><br><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">call2</span> = <span class=\"keyword\">function</span> (<span class=\"params\">context</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = context || <span class=\"variable language_\">window</span>;</span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> args = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>, len = <span class=\"variable language_\">arguments</span>.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        args.<span class=\"title function_\">push</span>(<span class=\"string\">&#x27;arguments[&#x27;</span> + i + <span class=\"string\">&#x27;]&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = <span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;context.fn(&#x27;</span> + args +<span class=\"string\">&#x27;)&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 测试一下</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">bar</span>(<span class=\"params\">name, age</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">value</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>,</span><br><span class=\"line\">        <span class=\"attr\">name</span>: name,</span><br><span class=\"line\">        <span class=\"attr\">age</span>: age</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.<span class=\"title function_\">call2</span>(<span class=\"literal\">null</span>); <span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(bar.<span class=\"title function_\">call2</span>(obj, <span class=\"string\">&#x27;kevin&#x27;</span>, <span class=\"number\">18</span>));</span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"comment\">// Object &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//    value: 1,</span></span><br><span class=\"line\"><span class=\"comment\">//    name: &#x27;kevin&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">//    age: 18</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>到此，我们完成了 call 的模拟实现。</p>\n<h2 id=\"apply的模拟实现\"><a href=\"#apply的模拟实现\" class=\"headerlink\" title=\"apply的模拟实现\"></a>apply的模拟实现</h2><p>apply 的实现跟 call 类似：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">apply</span> = <span class=\"keyword\">function</span> (<span class=\"params\">context, arr</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = <span class=\"title class_\">Object</span>(context) || <span class=\"variable language_\">window</span>;</span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!arr) &#123;</span><br><span class=\"line\">        result = context.<span class=\"title function_\">fn</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> args = [];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = arr.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">            args.<span class=\"title function_\">push</span>(<span class=\"string\">&#x27;arr[&#x27;</span> + i + <span class=\"string\">&#x27;]&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        result = <span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;context.fn(&#x27;</span> + args + <span class=\"string\">&#x27;)&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"事件委托","date":"2022-05-06T15:31:18.000Z","description":"事件委托，也叫事件代理，即把原本需要绑定在子元素的响应事件委托给父元素，让父元素担当事件监听的职务。","_content":"\n## 事件委托\n\n> 事件委托，也叫事件代理，即把原本需要绑定在子元素的响应事件委托给父元素，让父元素担当事件监听的职务。\n\n\n\n事件委托的好处：\n\n+ 节省资源, 当子元素个数较多, 且都要设置监听事件时, 可以统一设置到父元素上, **节省大量事件注册函数**；\n+ **对异步插入的子元素仍然生效**。如果不使用事件委托, 那么异步插入的子元素默认不会有任何事件注册, 需要显式声明. 而使用事件委托, 即便是异步插入的元素, 事件仍然可以处理到。\n\n\n\n事件委托的坏处:\n\n+ 调试比较复杂，**不容易确定监听者**\n\n\n\n示例：\n\n```js\nul.addEventListener(\"click\", function(e) {\n    if (e.target && e.target.tagName.toLowerCase() === \"li\") {\n        // ...\n    }\n})\n```\n\n\n\n这样写的问题在于，如果用户点击的是 li 里面的 span，就没法触发 fn，这显然不对。\n\n\n\n\n\n## 手写\n\n解决以上问题，思路是点击 span 后，递归遍历 span 的祖先元素看其中有没有 ul 里面的 li。\n\n```js\nfunction delegate(element, eventType, selector, fn) {\n  element.addEventListener(eventType, e = >{\n    let el = e.target\n    while (!el.matches(selector)) {\n      if (element === el) {\n        el = null\n        break\n      }\n      el = el.parentNode\n    }\n    el && fn.call(el, e, el)\n  }) return element\n}\n```\n\n\n\n使用：\n\n```js\ndelegate(ul, 'click', 'li', f1)\n```\n\n","source":"_posts/handwrite-delegate.md","raw":"---\ntitle: 事件委托\ndate: 2022-05-06 23:31:18\ntags: 手写\ncategories: JavaScript\ndescription: 事件委托，也叫事件代理，即把原本需要绑定在子元素的响应事件委托给父元素，让父元素担当事件监听的职务。\n---\n\n## 事件委托\n\n> 事件委托，也叫事件代理，即把原本需要绑定在子元素的响应事件委托给父元素，让父元素担当事件监听的职务。\n\n\n\n事件委托的好处：\n\n+ 节省资源, 当子元素个数较多, 且都要设置监听事件时, 可以统一设置到父元素上, **节省大量事件注册函数**；\n+ **对异步插入的子元素仍然生效**。如果不使用事件委托, 那么异步插入的子元素默认不会有任何事件注册, 需要显式声明. 而使用事件委托, 即便是异步插入的元素, 事件仍然可以处理到。\n\n\n\n事件委托的坏处:\n\n+ 调试比较复杂，**不容易确定监听者**\n\n\n\n示例：\n\n```js\nul.addEventListener(\"click\", function(e) {\n    if (e.target && e.target.tagName.toLowerCase() === \"li\") {\n        // ...\n    }\n})\n```\n\n\n\n这样写的问题在于，如果用户点击的是 li 里面的 span，就没法触发 fn，这显然不对。\n\n\n\n\n\n## 手写\n\n解决以上问题，思路是点击 span 后，递归遍历 span 的祖先元素看其中有没有 ul 里面的 li。\n\n```js\nfunction delegate(element, eventType, selector, fn) {\n  element.addEventListener(eventType, e = >{\n    let el = e.target\n    while (!el.matches(selector)) {\n      if (element === el) {\n        el = null\n        break\n      }\n      el = el.parentNode\n    }\n    el && fn.call(el, e, el)\n  }) return element\n}\n```\n\n\n\n使用：\n\n```js\ndelegate(ul, 'click', 'li', f1)\n```\n\n","slug":"handwrite-delegate","published":1,"updated":"2022-05-08T13:37:48.326Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsi0001hyt8w09yt0x64","content":"<h2 id=\"事件委托\"><a href=\"#事件委托\" class=\"headerlink\" title=\"事件委托\"></a>事件委托</h2><blockquote>\n<p>事件委托，也叫事件代理，即把原本需要绑定在子元素的响应事件委托给父元素，让父元素担当事件监听的职务。</p>\n</blockquote>\n<p>事件委托的好处：</p>\n<ul>\n<li>节省资源, 当子元素个数较多, 且都要设置监听事件时, 可以统一设置到父元素上, <strong>节省大量事件注册函数</strong>；</li>\n<li><strong>对异步插入的子元素仍然生效</strong>。如果不使用事件委托, 那么异步插入的子元素默认不会有任何事件注册, 需要显式声明. 而使用事件委托, 即便是异步插入的元素, 事件仍然可以处理到。</li>\n</ul>\n<p>事件委托的坏处:</p>\n<ul>\n<li>调试比较复杂，<strong>不容易确定监听者</strong></li>\n</ul>\n<p>示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ul.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (e.<span class=\"property\">target</span> &amp;&amp; e.<span class=\"property\">target</span>.<span class=\"property\">tagName</span>.<span class=\"title function_\">toLowerCase</span>() === <span class=\"string\">&quot;li&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n\n\n<p>这样写的问题在于，如果用户点击的是 li 里面的 span，就没法触发 fn，这显然不对。</p>\n<h2 id=\"手写\"><a href=\"#手写\" class=\"headerlink\" title=\"手写\"></a>手写</h2><p>解决以上问题，思路是点击 span 后，递归遍历 span 的祖先元素看其中有没有 ul 里面的 li。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">delegate</span>(<span class=\"params\">element, eventType, selector, fn</span>) &#123;</span><br><span class=\"line\">  element.<span class=\"title function_\">addEventListener</span>(eventType, e = &gt;&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> el = e.<span class=\"property\">target</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!el.<span class=\"title function_\">matches</span>(selector)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (element === el) &#123;</span><br><span class=\"line\">        el = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      el = el.<span class=\"property\">parentNode</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    el &amp;&amp; fn.<span class=\"title function_\">call</span>(el, e, el)</span><br><span class=\"line\">  &#125;) <span class=\"keyword\">return</span> element</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">delegate</span>(ul, <span class=\"string\">&#x27;click&#x27;</span>, <span class=\"string\">&#x27;li&#x27;</span>, f1)</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"事件委托\"><a href=\"#事件委托\" class=\"headerlink\" title=\"事件委托\"></a>事件委托</h2><blockquote>\n<p>事件委托，也叫事件代理，即把原本需要绑定在子元素的响应事件委托给父元素，让父元素担当事件监听的职务。</p>\n</blockquote>\n<p>事件委托的好处：</p>\n<ul>\n<li>节省资源, 当子元素个数较多, 且都要设置监听事件时, 可以统一设置到父元素上, <strong>节省大量事件注册函数</strong>；</li>\n<li><strong>对异步插入的子元素仍然生效</strong>。如果不使用事件委托, 那么异步插入的子元素默认不会有任何事件注册, 需要显式声明. 而使用事件委托, 即便是异步插入的元素, 事件仍然可以处理到。</li>\n</ul>\n<p>事件委托的坏处:</p>\n<ul>\n<li>调试比较复杂，<strong>不容易确定监听者</strong></li>\n</ul>\n<p>示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ul.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (e.<span class=\"property\">target</span> &amp;&amp; e.<span class=\"property\">target</span>.<span class=\"property\">tagName</span>.<span class=\"title function_\">toLowerCase</span>() === <span class=\"string\">&quot;li&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n\n\n<p>这样写的问题在于，如果用户点击的是 li 里面的 span，就没法触发 fn，这显然不对。</p>\n<h2 id=\"手写\"><a href=\"#手写\" class=\"headerlink\" title=\"手写\"></a>手写</h2><p>解决以上问题，思路是点击 span 后，递归遍历 span 的祖先元素看其中有没有 ul 里面的 li。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">delegate</span>(<span class=\"params\">element, eventType, selector, fn</span>) &#123;</span><br><span class=\"line\">  element.<span class=\"title function_\">addEventListener</span>(eventType, e = &gt;&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> el = e.<span class=\"property\">target</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!el.<span class=\"title function_\">matches</span>(selector)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (element === el) &#123;</span><br><span class=\"line\">        el = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      el = el.<span class=\"property\">parentNode</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    el &amp;&amp; fn.<span class=\"title function_\">call</span>(el, e, el)</span><br><span class=\"line\">  &#125;) <span class=\"keyword\">return</span> element</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">delegate</span>(ul, <span class=\"string\">&#x27;click&#x27;</span>, <span class=\"string\">&#x27;li&#x27;</span>, f1)</span><br></pre></td></tr></table></figure>\n\n"},{"title":"写一个可拖拽的div","date":"2022-05-05T11:24:36.000Z","description":"写一个可拖拽的div","_content":"\nhtml：\n```html\n<div id=\"box\"></div>\n```\n\njs：\n```js\nlet isDragging = false;\nlet position = [0, 0];\nlet box = document.querySelector('#box');\n\nbox.addEventListener('mousedown', function(e) {\n    isDragging = true;\n    position = [e.clientX, e.clientY];\n})\n\ndocument.addEventListener('mousemove', function(e) {\n    if (!isDragging) return;\n    let deltaX = e.clientX - position[0];\n    let deltaY = e.clientY - position[1];\n    const left = parseInt(box.style.left || 0);\n    const top = parseInt(box.style.top || 0);\n    box.style.left = left + deltaX + 'px';\n    box.style.top = top + deltaY + 'px';\n    position = [e.clientX, e.clientY]\n})\n\ndocument.addEventListener('mouseup', function() {\n    isDragging = false;\n})\n```\n\ncss：\n```css\n#box {\n    width: 100px;\n    height: 100px;\n    background-color: brown;\n    cursor: pointer;\n    position: relative;\n}\n```\n\n\n\n要点：\n\n1. 注意监听范围，不能只监听div；\n2. 不要使用drag事件，很难用；\n3. 使用 transform 会比 top / left 性能更好，因为可以避免回流和重绘。\n\n\n\n\n\n**transform版本：**\n\n```js\ndocument.addEventListener('mousemove', function(e) {\n    if (!isDragging) return;\n    let deltaX = e.clientX - position[0];\n    let deltaY = e.clientY - position[1];\n\n    // 需要获取到box的transform偏移量，最好改为正则匹配获取\n    let transformArr = [0, 0];\n    if (box.style.transform) {\n        transformArr = box.style.transform.replace(/translate\\(/g, '').split(',');\n    }\n    const left = parseInt(transformArr[0] || 0);\n    const top = parseInt(transformArr[1] || 0);\n\n    box.style.transform = `translate(${left + deltaX}px, ${top + deltaY}px)`;\n    position = [e.clientX, e.clientY];\n})\n```\n\n","source":"_posts/handwrite-drag-div.md","raw":"---\ntitle: 写一个可拖拽的div\ndate: 2022-05-05 19:24:36\ntags: [手写]\ncategories: JavaScript\ndescription: 写一个可拖拽的div\n---\n\nhtml：\n```html\n<div id=\"box\"></div>\n```\n\njs：\n```js\nlet isDragging = false;\nlet position = [0, 0];\nlet box = document.querySelector('#box');\n\nbox.addEventListener('mousedown', function(e) {\n    isDragging = true;\n    position = [e.clientX, e.clientY];\n})\n\ndocument.addEventListener('mousemove', function(e) {\n    if (!isDragging) return;\n    let deltaX = e.clientX - position[0];\n    let deltaY = e.clientY - position[1];\n    const left = parseInt(box.style.left || 0);\n    const top = parseInt(box.style.top || 0);\n    box.style.left = left + deltaX + 'px';\n    box.style.top = top + deltaY + 'px';\n    position = [e.clientX, e.clientY]\n})\n\ndocument.addEventListener('mouseup', function() {\n    isDragging = false;\n})\n```\n\ncss：\n```css\n#box {\n    width: 100px;\n    height: 100px;\n    background-color: brown;\n    cursor: pointer;\n    position: relative;\n}\n```\n\n\n\n要点：\n\n1. 注意监听范围，不能只监听div；\n2. 不要使用drag事件，很难用；\n3. 使用 transform 会比 top / left 性能更好，因为可以避免回流和重绘。\n\n\n\n\n\n**transform版本：**\n\n```js\ndocument.addEventListener('mousemove', function(e) {\n    if (!isDragging) return;\n    let deltaX = e.clientX - position[0];\n    let deltaY = e.clientY - position[1];\n\n    // 需要获取到box的transform偏移量，最好改为正则匹配获取\n    let transformArr = [0, 0];\n    if (box.style.transform) {\n        transformArr = box.style.transform.replace(/translate\\(/g, '').split(',');\n    }\n    const left = parseInt(transformArr[0] || 0);\n    const top = parseInt(transformArr[1] || 0);\n\n    box.style.transform = `translate(${left + deltaX}px, ${top + deltaY}px)`;\n    position = [e.clientX, e.clientY];\n})\n```\n\n","slug":"handwrite-drag-div","published":1,"updated":"2022-05-05T14:36:27.171Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsi1001kyt8wf7zjc050","content":"<p>html：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;box&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>js：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> isDragging = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> position = [<span class=\"number\">0</span>, <span class=\"number\">0</span>];</span><br><span class=\"line\"><span class=\"keyword\">let</span> box = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;#box&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">box.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    isDragging = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    position = [e.<span class=\"property\">clientX</span>, e.<span class=\"property\">clientY</span>];</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isDragging) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> deltaX = e.<span class=\"property\">clientX</span> - position[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> deltaY = e.<span class=\"property\">clientY</span> - position[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">const</span> left = <span class=\"built_in\">parseInt</span>(box.<span class=\"property\">style</span>.<span class=\"property\">left</span> || <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> top = <span class=\"built_in\">parseInt</span>(box.<span class=\"property\">style</span>.<span class=\"property\">top</span> || <span class=\"number\">0</span>);</span><br><span class=\"line\">    box.<span class=\"property\">style</span>.<span class=\"property\">left</span> = left + deltaX + <span class=\"string\">&#x27;px&#x27;</span>;</span><br><span class=\"line\">    box.<span class=\"property\">style</span>.<span class=\"property\">top</span> = top + deltaY + <span class=\"string\">&#x27;px&#x27;</span>;</span><br><span class=\"line\">    position = [e.<span class=\"property\">clientX</span>, e.<span class=\"property\">clientY</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    isDragging = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>css：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#box</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: brown;</span><br><span class=\"line\">    <span class=\"attribute\">cursor</span>: pointer;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>要点：</p>\n<ol>\n<li>注意监听范围，不能只监听div；</li>\n<li>不要使用drag事件，很难用；</li>\n<li>使用 transform 会比 top &#x2F; left 性能更好，因为可以避免回流和重绘。</li>\n</ol>\n<p><strong>transform版本：</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isDragging) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> deltaX = e.<span class=\"property\">clientX</span> - position[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> deltaY = e.<span class=\"property\">clientY</span> - position[<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 需要获取到box的transform偏移量，最好改为正则匹配获取</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> transformArr = [<span class=\"number\">0</span>, <span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (box.<span class=\"property\">style</span>.<span class=\"property\">transform</span>) &#123;</span><br><span class=\"line\">        transformArr = box.<span class=\"property\">style</span>.<span class=\"property\">transform</span>.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/translate\\(/g</span>, <span class=\"string\">&#x27;&#x27;</span>).<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> left = <span class=\"built_in\">parseInt</span>(transformArr[<span class=\"number\">0</span>] || <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> top = <span class=\"built_in\">parseInt</span>(transformArr[<span class=\"number\">1</span>] || <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    box.<span class=\"property\">style</span>.<span class=\"property\">transform</span> = <span class=\"string\">`translate(<span class=\"subst\">$&#123;left + deltaX&#125;</span>px, <span class=\"subst\">$&#123;top + deltaY&#125;</span>px)`</span>;</span><br><span class=\"line\">    position = [e.<span class=\"property\">clientX</span>, e.<span class=\"property\">clientY</span>];</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>html：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;box&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>js：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> isDragging = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> position = [<span class=\"number\">0</span>, <span class=\"number\">0</span>];</span><br><span class=\"line\"><span class=\"keyword\">let</span> box = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;#box&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">box.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    isDragging = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    position = [e.<span class=\"property\">clientX</span>, e.<span class=\"property\">clientY</span>];</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isDragging) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> deltaX = e.<span class=\"property\">clientX</span> - position[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> deltaY = e.<span class=\"property\">clientY</span> - position[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">const</span> left = <span class=\"built_in\">parseInt</span>(box.<span class=\"property\">style</span>.<span class=\"property\">left</span> || <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> top = <span class=\"built_in\">parseInt</span>(box.<span class=\"property\">style</span>.<span class=\"property\">top</span> || <span class=\"number\">0</span>);</span><br><span class=\"line\">    box.<span class=\"property\">style</span>.<span class=\"property\">left</span> = left + deltaX + <span class=\"string\">&#x27;px&#x27;</span>;</span><br><span class=\"line\">    box.<span class=\"property\">style</span>.<span class=\"property\">top</span> = top + deltaY + <span class=\"string\">&#x27;px&#x27;</span>;</span><br><span class=\"line\">    position = [e.<span class=\"property\">clientX</span>, e.<span class=\"property\">clientY</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    isDragging = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>css：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#box</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: brown;</span><br><span class=\"line\">    <span class=\"attribute\">cursor</span>: pointer;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>要点：</p>\n<ol>\n<li>注意监听范围，不能只监听div；</li>\n<li>不要使用drag事件，很难用；</li>\n<li>使用 transform 会比 top &#x2F; left 性能更好，因为可以避免回流和重绘。</li>\n</ol>\n<p><strong>transform版本：</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isDragging) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> deltaX = e.<span class=\"property\">clientX</span> - position[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> deltaY = e.<span class=\"property\">clientY</span> - position[<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 需要获取到box的transform偏移量，最好改为正则匹配获取</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> transformArr = [<span class=\"number\">0</span>, <span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (box.<span class=\"property\">style</span>.<span class=\"property\">transform</span>) &#123;</span><br><span class=\"line\">        transformArr = box.<span class=\"property\">style</span>.<span class=\"property\">transform</span>.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/translate\\(/g</span>, <span class=\"string\">&#x27;&#x27;</span>).<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> left = <span class=\"built_in\">parseInt</span>(transformArr[<span class=\"number\">0</span>] || <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> top = <span class=\"built_in\">parseInt</span>(transformArr[<span class=\"number\">1</span>] || <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    box.<span class=\"property\">style</span>.<span class=\"property\">transform</span> = <span class=\"string\">`translate(<span class=\"subst\">$&#123;left + deltaX&#125;</span>px, <span class=\"subst\">$&#123;top + deltaY&#125;</span>px)`</span>;</span><br><span class=\"line\">    position = [e.<span class=\"property\">clientX</span>, e.<span class=\"property\">clientY</span>];</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n"},{"title":"Node.js 模块查找规则","date":"2023-03-08T04:14:27.000Z","description":"Node.js 模块查找规则","_content":"\n## 当前模块拥有路径但没有后缀时\n\n```javascript\nrequire('./find.js')\t// 1\nrequire('./find')\t\t// 2\n```\n\n1. require 方法根据模块查找路径查找模块，如果是完整路径，直接引入模块\n2. 如果模块后缀省略，先找同名 JS 文件，再找同名文件夹\n3. 如果找到了同名文件夹，找文件夹中的 `index.js`\n4. 如果文件夹中没有 index.js 就会去当前文件夹中的 `package.json` 文件中查找 `main` 选项中的入口文件\n5. 如果找指定的入口文件不存在或者没有指定入口文件就会报错，模块没有找到\n\n## 当模块没有路径且没有后缀时\n\n```javascript\nrequire('find')\n```\n\n1. Node.js 会假设它是系统模块\n2. Node.js 会去 `node_modules` 文件夹中\n3. 首先看是否有该名字的 JS 文件\n4. 再看是否有该名字的文件夹\n5. 如果是文件夹看里面是否有 `index.js`\n6. 如果没有 index.js 查看该文件夹中的 `package.json` 中的 `main` 选项确定模块入口文件\n7. 否则找不到报错","source":"_posts/node-module-rule.md","raw":"---\ntitle: Node.js 模块查找规则\ndate: 2023-03-08 12:14:27\ntags: Node.js\ncategories: Node.js\ndescription: Node.js 模块查找规则\n---\n\n## 当前模块拥有路径但没有后缀时\n\n```javascript\nrequire('./find.js')\t// 1\nrequire('./find')\t\t// 2\n```\n\n1. require 方法根据模块查找路径查找模块，如果是完整路径，直接引入模块\n2. 如果模块后缀省略，先找同名 JS 文件，再找同名文件夹\n3. 如果找到了同名文件夹，找文件夹中的 `index.js`\n4. 如果文件夹中没有 index.js 就会去当前文件夹中的 `package.json` 文件中查找 `main` 选项中的入口文件\n5. 如果找指定的入口文件不存在或者没有指定入口文件就会报错，模块没有找到\n\n## 当模块没有路径且没有后缀时\n\n```javascript\nrequire('find')\n```\n\n1. Node.js 会假设它是系统模块\n2. Node.js 会去 `node_modules` 文件夹中\n3. 首先看是否有该名字的 JS 文件\n4. 再看是否有该名字的文件夹\n5. 如果是文件夹看里面是否有 `index.js`\n6. 如果没有 index.js 查看该文件夹中的 `package.json` 中的 `main` 选项确定模块入口文件\n7. 否则找不到报错","slug":"node-module-rule","published":1,"updated":"2023-03-11T17:17:11.517Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsi1001nyt8w2wfud3nw","content":"<h2 id=\"当前模块拥有路径但没有后缀时\"><a href=\"#当前模块拥有路径但没有后缀时\" class=\"headerlink\" title=\"当前模块拥有路径但没有后缀时\"></a>当前模块拥有路径但没有后缀时</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./find.js&#x27;</span>)\t<span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./find&#x27;</span>)\t\t<span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>require 方法根据模块查找路径查找模块，如果是完整路径，直接引入模块</li>\n<li>如果模块后缀省略，先找同名 JS 文件，再找同名文件夹</li>\n<li>如果找到了同名文件夹，找文件夹中的 <code>index.js</code></li>\n<li>如果文件夹中没有 index.js 就会去当前文件夹中的 <code>package.json</code> 文件中查找 <code>main</code> 选项中的入口文件</li>\n<li>如果找指定的入口文件不存在或者没有指定入口文件就会报错，模块没有找到</li>\n</ol>\n<h2 id=\"当模块没有路径且没有后缀时\"><a href=\"#当模块没有路径且没有后缀时\" class=\"headerlink\" title=\"当模块没有路径且没有后缀时\"></a>当模块没有路径且没有后缀时</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&#x27;find&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>Node.js 会假设它是系统模块</li>\n<li>Node.js 会去 <code>node_modules</code> 文件夹中</li>\n<li>首先看是否有该名字的 JS 文件</li>\n<li>再看是否有该名字的文件夹</li>\n<li>如果是文件夹看里面是否有 <code>index.js</code></li>\n<li>如果没有 index.js 查看该文件夹中的 <code>package.json</code> 中的 <code>main</code> 选项确定模块入口文件</li>\n<li>否则找不到报错</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"当前模块拥有路径但没有后缀时\"><a href=\"#当前模块拥有路径但没有后缀时\" class=\"headerlink\" title=\"当前模块拥有路径但没有后缀时\"></a>当前模块拥有路径但没有后缀时</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./find.js&#x27;</span>)\t<span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./find&#x27;</span>)\t\t<span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>require 方法根据模块查找路径查找模块，如果是完整路径，直接引入模块</li>\n<li>如果模块后缀省略，先找同名 JS 文件，再找同名文件夹</li>\n<li>如果找到了同名文件夹，找文件夹中的 <code>index.js</code></li>\n<li>如果文件夹中没有 index.js 就会去当前文件夹中的 <code>package.json</code> 文件中查找 <code>main</code> 选项中的入口文件</li>\n<li>如果找指定的入口文件不存在或者没有指定入口文件就会报错，模块没有找到</li>\n</ol>\n<h2 id=\"当模块没有路径且没有后缀时\"><a href=\"#当模块没有路径且没有后缀时\" class=\"headerlink\" title=\"当模块没有路径且没有后缀时\"></a>当模块没有路径且没有后缀时</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&#x27;find&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>Node.js 会假设它是系统模块</li>\n<li>Node.js 会去 <code>node_modules</code> 文件夹中</li>\n<li>首先看是否有该名字的 JS 文件</li>\n<li>再看是否有该名字的文件夹</li>\n<li>如果是文件夹看里面是否有 <code>index.js</code></li>\n<li>如果没有 index.js 查看该文件夹中的 <code>package.json</code> 中的 <code>main</code> 选项确定模块入口文件</li>\n<li>否则找不到报错</li>\n</ol>\n"},{"title":"npm 使用淘宝镜像","date":"2022-05-14T06:17:58.000Z","description":"npm 设置淘宝镜像源，来解决安装失败的问题。","_content":"\n**单次修改：**\n\n```shell\nnpm install --registry=https://registry.npm.taobao.org\n```\n\n\n\n**永久使用：**\n\n```shell\nnpm config set registry https://registry.npm.taobao.org\n```\n\n\n\n**检测是否成功：**\n\n```shell\nnpm config get registry\n```\n\n\n\n**还原**\n\n```shell\nnpm config set registry https://registry.npmjs.org/\n```\n","source":"_posts/npm-taobao.md","raw":"---\ntitle: npm 使用淘宝镜像\ndate: 2022-05-14 14:17:58\ntags: npm\ncategories: 工程化\ndescription: npm 设置淘宝镜像源，来解决安装失败的问题。\n---\n\n**单次修改：**\n\n```shell\nnpm install --registry=https://registry.npm.taobao.org\n```\n\n\n\n**永久使用：**\n\n```shell\nnpm config set registry https://registry.npm.taobao.org\n```\n\n\n\n**检测是否成功：**\n\n```shell\nnpm config get registry\n```\n\n\n\n**还原**\n\n```shell\nnpm config set registry https://registry.npmjs.org/\n```\n","slug":"npm-taobao","published":1,"updated":"2022-05-14T06:19:24.520Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsi3001syt8whr6lbd9r","content":"<p><strong>单次修改：</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>永久使用：</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config set registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>检测是否成功：</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config get registry</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>还原</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config set registry https://registry.npmjs.org/</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p><strong>单次修改：</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>永久使用：</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config set registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>检测是否成功：</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config get registry</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>还原</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config set registry https://registry.npmjs.org/</span><br></pre></td></tr></table></figure>\n"},{"title":"pdfjs-dist 加载发票文字丢失","date":"2023-08-09T15:16:14.000Z","description":"pdfjs-dist 加载发票文字丢失","_content":"\n# pdfjs-dist 加载发票文字丢失\n\n控制台报错 缺少字体包\n`Warning: Error during font loading: The CMap \"baseUrl\" parameter must be specified, ensure that the \"cMapUrl\" and \"cMapPacked\" API parameters are provided.`\n\n原因：打开部分pdf文件，pdfjs-dist需要引入特殊字体。\n\n看到网上解决方案，加载线上地址文件字体，直接改 node_modules 里的 pdf.js ：\n\n```js\n  params.rangeChunkSize = params.rangeChunkSize || DEFAULT_RANGE_CHUNK_SIZE;\n  params.CMapReaderFactory = params.CMapReaderFactory || _display_utils.DOMCMapReaderFactory;\n  params.ignoreErrors = params.stopAtErrors !== true;\n  params.fontExtraProperties = params.fontExtraProperties === true;\n  params.pdfBug = params.pdfBug === true;\n  \n  //解决文字缺少问题\n  params.cMapPacked = true\n  params.cMapUrl = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@2.2.228/cmaps/'\n```\n\n比较扯，又找了另一种方法：\n\n1. 把下面 node_modules/pdfjs-dist/cmaps/ 的 cmaps 目录直接拷贝到public目录下；\n2. 把cMapUrl设置为 '/cmaps/'，从项目跟路径加载字体文件：\n   ```js\n    const DEFAULT_URL = pdf文件url\n    const CMAP_URL = './cmaps/';\n    const CMAP_PACKED = true;\n    // ....\n    // Loading document.\n    const loadingTask = pdfjsLib.getDocument({\n        url: DEFAULT_URL,\n        cMapUrl: CMAP_URL,\n        cMapPacked: CMAP_PACKED,\n    });\n    // ...\n   ```\n\n解决。","source":"_posts/pdfjs-font-missing.md","raw":"---\ntitle: pdfjs-dist 加载发票文字丢失\ndate: 2023-08-09 23:16:14\ntags: pdfs\ncategories: JavaScript\ndescription: pdfjs-dist 加载发票文字丢失\n---\n\n# pdfjs-dist 加载发票文字丢失\n\n控制台报错 缺少字体包\n`Warning: Error during font loading: The CMap \"baseUrl\" parameter must be specified, ensure that the \"cMapUrl\" and \"cMapPacked\" API parameters are provided.`\n\n原因：打开部分pdf文件，pdfjs-dist需要引入特殊字体。\n\n看到网上解决方案，加载线上地址文件字体，直接改 node_modules 里的 pdf.js ：\n\n```js\n  params.rangeChunkSize = params.rangeChunkSize || DEFAULT_RANGE_CHUNK_SIZE;\n  params.CMapReaderFactory = params.CMapReaderFactory || _display_utils.DOMCMapReaderFactory;\n  params.ignoreErrors = params.stopAtErrors !== true;\n  params.fontExtraProperties = params.fontExtraProperties === true;\n  params.pdfBug = params.pdfBug === true;\n  \n  //解决文字缺少问题\n  params.cMapPacked = true\n  params.cMapUrl = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@2.2.228/cmaps/'\n```\n\n比较扯，又找了另一种方法：\n\n1. 把下面 node_modules/pdfjs-dist/cmaps/ 的 cmaps 目录直接拷贝到public目录下；\n2. 把cMapUrl设置为 '/cmaps/'，从项目跟路径加载字体文件：\n   ```js\n    const DEFAULT_URL = pdf文件url\n    const CMAP_URL = './cmaps/';\n    const CMAP_PACKED = true;\n    // ....\n    // Loading document.\n    const loadingTask = pdfjsLib.getDocument({\n        url: DEFAULT_URL,\n        cMapUrl: CMAP_URL,\n        cMapPacked: CMAP_PACKED,\n    });\n    // ...\n   ```\n\n解决。","slug":"pdfjs-font-missing","published":1,"updated":"2023-08-09T15:17:34.908Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsi4001vyt8wgjengaa7","content":"<h1 id=\"pdfjs-dist-加载发票文字丢失\"><a href=\"#pdfjs-dist-加载发票文字丢失\" class=\"headerlink\" title=\"pdfjs-dist 加载发票文字丢失\"></a>pdfjs-dist 加载发票文字丢失</h1><p>控制台报错 缺少字体包<br><code>Warning: Error during font loading: The CMap &quot;baseUrl&quot; parameter must be specified, ensure that the &quot;cMapUrl&quot; and &quot;cMapPacked&quot; API parameters are provided.</code></p>\n<p>原因：打开部分pdf文件，pdfjs-dist需要引入特殊字体。</p>\n<p>看到网上解决方案，加载线上地址文件字体，直接改 node_modules 里的 pdf.js ：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">params.<span class=\"property\">rangeChunkSize</span> = params.<span class=\"property\">rangeChunkSize</span> || <span class=\"variable constant_\">DEFAULT_RANGE_CHUNK_SIZE</span>;</span><br><span class=\"line\">params.<span class=\"property\">CMapReaderFactory</span> = params.<span class=\"property\">CMapReaderFactory</span> || _display_utils.<span class=\"property\">DOMCMapReaderFactory</span>;</span><br><span class=\"line\">params.<span class=\"property\">ignoreErrors</span> = params.<span class=\"property\">stopAtErrors</span> !== <span class=\"literal\">true</span>;</span><br><span class=\"line\">params.<span class=\"property\">fontExtraProperties</span> = params.<span class=\"property\">fontExtraProperties</span> === <span class=\"literal\">true</span>;</span><br><span class=\"line\">params.<span class=\"property\">pdfBug</span> = params.<span class=\"property\">pdfBug</span> === <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//解决文字缺少问题</span></span><br><span class=\"line\">params.<span class=\"property\">cMapPacked</span> = <span class=\"literal\">true</span></span><br><span class=\"line\">params.<span class=\"property\">cMapUrl</span> = <span class=\"string\">&#x27;https://cdn.jsdelivr.net/npm/pdfjs-dist@2.2.228/cmaps/&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>比较扯，又找了另一种方法：</p>\n<ol>\n<li>把下面 node_modules&#x2F;pdfjs-dist&#x2F;cmaps&#x2F; 的 cmaps 目录直接拷贝到public目录下；</li>\n<li>把cMapUrl设置为 ‘&#x2F;cmaps&#x2F;‘，从项目跟路径加载字体文件：<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">DEFAULT_URL</span> = pdf文件url</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">CMAP_URL</span> = <span class=\"string\">&#x27;./cmaps/&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">CMAP_PACKED</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"comment\">// ....</span></span><br><span class=\"line\"><span class=\"comment\">// Loading document.</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> loadingTask = pdfjsLib.<span class=\"title function_\">getDocument</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">url</span>: <span class=\"variable constant_\">DEFAULT_URL</span>,</span><br><span class=\"line\">    <span class=\"attr\">cMapUrl</span>: <span class=\"variable constant_\">CMAP_URL</span>,</span><br><span class=\"line\">    <span class=\"attr\">cMapPacked</span>: <span class=\"variable constant_\">CMAP_PACKED</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// ...</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>解决。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"pdfjs-dist-加载发票文字丢失\"><a href=\"#pdfjs-dist-加载发票文字丢失\" class=\"headerlink\" title=\"pdfjs-dist 加载发票文字丢失\"></a>pdfjs-dist 加载发票文字丢失</h1><p>控制台报错 缺少字体包<br><code>Warning: Error during font loading: The CMap &quot;baseUrl&quot; parameter must be specified, ensure that the &quot;cMapUrl&quot; and &quot;cMapPacked&quot; API parameters are provided.</code></p>\n<p>原因：打开部分pdf文件，pdfjs-dist需要引入特殊字体。</p>\n<p>看到网上解决方案，加载线上地址文件字体，直接改 node_modules 里的 pdf.js ：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">params.<span class=\"property\">rangeChunkSize</span> = params.<span class=\"property\">rangeChunkSize</span> || <span class=\"variable constant_\">DEFAULT_RANGE_CHUNK_SIZE</span>;</span><br><span class=\"line\">params.<span class=\"property\">CMapReaderFactory</span> = params.<span class=\"property\">CMapReaderFactory</span> || _display_utils.<span class=\"property\">DOMCMapReaderFactory</span>;</span><br><span class=\"line\">params.<span class=\"property\">ignoreErrors</span> = params.<span class=\"property\">stopAtErrors</span> !== <span class=\"literal\">true</span>;</span><br><span class=\"line\">params.<span class=\"property\">fontExtraProperties</span> = params.<span class=\"property\">fontExtraProperties</span> === <span class=\"literal\">true</span>;</span><br><span class=\"line\">params.<span class=\"property\">pdfBug</span> = params.<span class=\"property\">pdfBug</span> === <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//解决文字缺少问题</span></span><br><span class=\"line\">params.<span class=\"property\">cMapPacked</span> = <span class=\"literal\">true</span></span><br><span class=\"line\">params.<span class=\"property\">cMapUrl</span> = <span class=\"string\">&#x27;https://cdn.jsdelivr.net/npm/pdfjs-dist@2.2.228/cmaps/&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>比较扯，又找了另一种方法：</p>\n<ol>\n<li>把下面 node_modules&#x2F;pdfjs-dist&#x2F;cmaps&#x2F; 的 cmaps 目录直接拷贝到public目录下；</li>\n<li>把cMapUrl设置为 ‘&#x2F;cmaps&#x2F;‘，从项目跟路径加载字体文件：<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">DEFAULT_URL</span> = pdf文件url</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">CMAP_URL</span> = <span class=\"string\">&#x27;./cmaps/&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">CMAP_PACKED</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"comment\">// ....</span></span><br><span class=\"line\"><span class=\"comment\">// Loading document.</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> loadingTask = pdfjsLib.<span class=\"title function_\">getDocument</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">url</span>: <span class=\"variable constant_\">DEFAULT_URL</span>,</span><br><span class=\"line\">    <span class=\"attr\">cMapUrl</span>: <span class=\"variable constant_\">CMAP_URL</span>,</span><br><span class=\"line\">    <span class=\"attr\">cMapPacked</span>: <span class=\"variable constant_\">CMAP_PACKED</span>,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// ...</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>解决。</p>\n"},{"title":"在 Mac 上调试 Office 加载项","date":"2023-04-13T13:46:24.000Z","description":"由于加载项是使用 HTML 和 JavaScript 开发的，因此它们设计为跨平台工作，但不同浏览器呈现 HTML 的方式可能存在细微差异。 本文介绍如何调试在 Mac 上运行的加载项。","_content":"\n由于加载项是使用 HTML 和 JavaScript 开发的，因此它们设计为跨平台工作，但不同浏览器呈现 HTML 的方式可能存在细微差异。 本文介绍如何调试在 Mac 上运行的加载项。\n\n## 在 Mac 上使用 Safari Web 检查器进行调试\n\n如果有在任务窗格或内容加载项中显示 UI 的加载项，可以使用 Safari Web 检查器调试 Office 加载项。\n\n为了能够在 Mac 上调试 Office 加载项，必须具有 Mac OS High Sierra AND Mac Office 版本 16.9.1 (内部版本18012504) 或更高版本。 如果没有 Office on Mac 版本，可以通过加入 Microsoft 365 开发人员计划来获取一个。\n\n首先，打开终端，设置相关 Office 应用程序的 OfficeWebAddinDeveloperExtras 属性，如下所示：\n\n- `defaults write com.microsoft.Word OfficeWebAddinDeveloperExtras -bool true`\n- `defaults write com.microsoft.Excel OfficeWebAddinDeveloperExtras -bool true`\n- `defaults write com.microsoft.Powerpoint OfficeWebAddinDeveloperExtras -bool true`\n- `defaults write com.microsoft.Outlook OfficeWebAddinDeveloperExtras -bool true`\n\n> 注意：Mac App Store Office 版本不支持 标志OfficeWebAddinDeveloperExtras。\n\n然后，打开 Office 应用程序并旁加载你的加载项。 右键单击加载项，应在上下文菜单中看到一个“检查元素”选项。 选择该选项，它将弹出检查器，可以在其中设置断点并调试加载项。\n\n参考：[https://learn.microsoft.com/zh-cn/office/dev/add-ins/testing/debug-office-add-ins-on-ipad-and-mac](https://gitee.com/link?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Foffice%2Fdev%2Fadd-ins%2Ftesting%2Fdebug-office-add-ins-on-ipad-and-mac)","source":"_posts/office-add-in-debug.md","raw":"---\ntitle: 在 Mac 上调试 Office 加载项\ndate: 2023-04-13 21:46:24\ntags: office加载项\ncategories: 前端\ndescription: 由于加载项是使用 HTML 和 JavaScript 开发的，因此它们设计为跨平台工作，但不同浏览器呈现 HTML 的方式可能存在细微差异。 本文介绍如何调试在 Mac 上运行的加载项。\n---\n\n由于加载项是使用 HTML 和 JavaScript 开发的，因此它们设计为跨平台工作，但不同浏览器呈现 HTML 的方式可能存在细微差异。 本文介绍如何调试在 Mac 上运行的加载项。\n\n## 在 Mac 上使用 Safari Web 检查器进行调试\n\n如果有在任务窗格或内容加载项中显示 UI 的加载项，可以使用 Safari Web 检查器调试 Office 加载项。\n\n为了能够在 Mac 上调试 Office 加载项，必须具有 Mac OS High Sierra AND Mac Office 版本 16.9.1 (内部版本18012504) 或更高版本。 如果没有 Office on Mac 版本，可以通过加入 Microsoft 365 开发人员计划来获取一个。\n\n首先，打开终端，设置相关 Office 应用程序的 OfficeWebAddinDeveloperExtras 属性，如下所示：\n\n- `defaults write com.microsoft.Word OfficeWebAddinDeveloperExtras -bool true`\n- `defaults write com.microsoft.Excel OfficeWebAddinDeveloperExtras -bool true`\n- `defaults write com.microsoft.Powerpoint OfficeWebAddinDeveloperExtras -bool true`\n- `defaults write com.microsoft.Outlook OfficeWebAddinDeveloperExtras -bool true`\n\n> 注意：Mac App Store Office 版本不支持 标志OfficeWebAddinDeveloperExtras。\n\n然后，打开 Office 应用程序并旁加载你的加载项。 右键单击加载项，应在上下文菜单中看到一个“检查元素”选项。 选择该选项，它将弹出检查器，可以在其中设置断点并调试加载项。\n\n参考：[https://learn.microsoft.com/zh-cn/office/dev/add-ins/testing/debug-office-add-ins-on-ipad-and-mac](https://gitee.com/link?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Foffice%2Fdev%2Fadd-ins%2Ftesting%2Fdebug-office-add-ins-on-ipad-and-mac)","slug":"office-add-in-debug","published":1,"updated":"2023-04-13T13:48:24.304Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsi5001zyt8waisr4dy0","content":"<p>由于加载项是使用 HTML 和 JavaScript 开发的，因此它们设计为跨平台工作，但不同浏览器呈现 HTML 的方式可能存在细微差异。 本文介绍如何调试在 Mac 上运行的加载项。</p>\n<h2 id=\"在-Mac-上使用-Safari-Web-检查器进行调试\"><a href=\"#在-Mac-上使用-Safari-Web-检查器进行调试\" class=\"headerlink\" title=\"在 Mac 上使用 Safari Web 检查器进行调试\"></a>在 Mac 上使用 Safari Web 检查器进行调试</h2><p>如果有在任务窗格或内容加载项中显示 UI 的加载项，可以使用 Safari Web 检查器调试 Office 加载项。</p>\n<p>为了能够在 Mac 上调试 Office 加载项，必须具有 Mac OS High Sierra AND Mac Office 版本 16.9.1 (内部版本18012504) 或更高版本。 如果没有 Office on Mac 版本，可以通过加入 Microsoft 365 开发人员计划来获取一个。</p>\n<p>首先，打开终端，设置相关 Office 应用程序的 OfficeWebAddinDeveloperExtras 属性，如下所示：</p>\n<ul>\n<li><code>defaults write com.microsoft.Word OfficeWebAddinDeveloperExtras -bool true</code></li>\n<li><code>defaults write com.microsoft.Excel OfficeWebAddinDeveloperExtras -bool true</code></li>\n<li><code>defaults write com.microsoft.Powerpoint OfficeWebAddinDeveloperExtras -bool true</code></li>\n<li><code>defaults write com.microsoft.Outlook OfficeWebAddinDeveloperExtras -bool true</code></li>\n</ul>\n<blockquote>\n<p>注意：Mac App Store Office 版本不支持 标志OfficeWebAddinDeveloperExtras。</p>\n</blockquote>\n<p>然后，打开 Office 应用程序并旁加载你的加载项。 右键单击加载项，应在上下文菜单中看到一个“检查元素”选项。 选择该选项，它将弹出检查器，可以在其中设置断点并调试加载项。</p>\n<p>参考：<a href=\"https://gitee.com/link?target=https://learn.microsoft.com/zh-cn/office/dev/add-ins/testing/debug-office-add-ins-on-ipad-and-mac\">https://learn.microsoft.com/zh-cn/office/dev/add-ins/testing/debug-office-add-ins-on-ipad-and-mac</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>由于加载项是使用 HTML 和 JavaScript 开发的，因此它们设计为跨平台工作，但不同浏览器呈现 HTML 的方式可能存在细微差异。 本文介绍如何调试在 Mac 上运行的加载项。</p>\n<h2 id=\"在-Mac-上使用-Safari-Web-检查器进行调试\"><a href=\"#在-Mac-上使用-Safari-Web-检查器进行调试\" class=\"headerlink\" title=\"在 Mac 上使用 Safari Web 检查器进行调试\"></a>在 Mac 上使用 Safari Web 检查器进行调试</h2><p>如果有在任务窗格或内容加载项中显示 UI 的加载项，可以使用 Safari Web 检查器调试 Office 加载项。</p>\n<p>为了能够在 Mac 上调试 Office 加载项，必须具有 Mac OS High Sierra AND Mac Office 版本 16.9.1 (内部版本18012504) 或更高版本。 如果没有 Office on Mac 版本，可以通过加入 Microsoft 365 开发人员计划来获取一个。</p>\n<p>首先，打开终端，设置相关 Office 应用程序的 OfficeWebAddinDeveloperExtras 属性，如下所示：</p>\n<ul>\n<li><code>defaults write com.microsoft.Word OfficeWebAddinDeveloperExtras -bool true</code></li>\n<li><code>defaults write com.microsoft.Excel OfficeWebAddinDeveloperExtras -bool true</code></li>\n<li><code>defaults write com.microsoft.Powerpoint OfficeWebAddinDeveloperExtras -bool true</code></li>\n<li><code>defaults write com.microsoft.Outlook OfficeWebAddinDeveloperExtras -bool true</code></li>\n</ul>\n<blockquote>\n<p>注意：Mac App Store Office 版本不支持 标志OfficeWebAddinDeveloperExtras。</p>\n</blockquote>\n<p>然后，打开 Office 应用程序并旁加载你的加载项。 右键单击加载项，应在上下文菜单中看到一个“检查元素”选项。 选择该选项，它将弹出检查器，可以在其中设置断点并调试加载项。</p>\n<p>参考：<a href=\"https://gitee.com/link?target=https://learn.microsoft.com/zh-cn/office/dev/add-ins/testing/debug-office-add-ins-on-ipad-and-mac\">https://learn.microsoft.com/zh-cn/office/dev/add-ins/testing/debug-office-add-ins-on-ipad-and-mac</a></p>\n"},{"title":"PicGo + github 搭建图床","date":"2022-05-08T14:14:00.000Z","description":"Markdown 文档编写时可使用本地图片，但是无法在网络上使用。图床的作用可以理解为将文档中的图片放到网络上，直接引用网络地址，这样可以做到无论在那个平台都可以使用统一的图片地址。","_content":"\n**1. 在github上创建一个仓库。**\n\n**2. 下载并安装 PicGo：**\n\n官网：https://molunerfinn.com/PicGo/\n\n下载：https://github.com/Molunerfinn/picgo/releases\n\n**3. 配置PicGo：**\n\n+ GitHub中创建一个token：依次打开 `Settings -> Developer settings -> Personal access tokens`，最后点击 `generate new token`。勾选相关信息（expiration 改为 no expiration、select scope 勾选repo），然后点击生成token；\n+ 打开 PicGo，`图床设置 -> Github 图床`\n+ 填写相关设置：\n\n![](https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/使用Github搭建图床_imgs_47.png)\n\n**4. 设置完成，可以上传图片测试了。**\n\n**5. 设置cdn加速：**设置自定义域名为 `https://cdn.jsdelivr.net/gh/用户名/图床仓库名`。\n\n![](https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/picGo设置自定义域名.png)\n","source":"_posts/picgo.md","raw":"---\ntitle: PicGo + github 搭建图床\ndate: 2022-05-08 22:14:00\ntags: \ncategories: 博客\ndescription: Markdown 文档编写时可使用本地图片，但是无法在网络上使用。图床的作用可以理解为将文档中的图片放到网络上，直接引用网络地址，这样可以做到无论在那个平台都可以使用统一的图片地址。\n---\n\n**1. 在github上创建一个仓库。**\n\n**2. 下载并安装 PicGo：**\n\n官网：https://molunerfinn.com/PicGo/\n\n下载：https://github.com/Molunerfinn/picgo/releases\n\n**3. 配置PicGo：**\n\n+ GitHub中创建一个token：依次打开 `Settings -> Developer settings -> Personal access tokens`，最后点击 `generate new token`。勾选相关信息（expiration 改为 no expiration、select scope 勾选repo），然后点击生成token；\n+ 打开 PicGo，`图床设置 -> Github 图床`\n+ 填写相关设置：\n\n![](https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/使用Github搭建图床_imgs_47.png)\n\n**4. 设置完成，可以上传图片测试了。**\n\n**5. 设置cdn加速：**设置自定义域名为 `https://cdn.jsdelivr.net/gh/用户名/图床仓库名`。\n\n![](https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/picGo设置自定义域名.png)\n","slug":"picgo","published":1,"updated":"2022-05-10T13:35:38.750Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsi60022yt8whbweggfa","content":"<p><strong>1. 在github上创建一个仓库。</strong></p>\n<p><strong>2. 下载并安装 PicGo：</strong></p>\n<p>官网：<a href=\"https://molunerfinn.com/PicGo/\">https://molunerfinn.com/PicGo/</a></p>\n<p>下载：<a href=\"https://github.com/Molunerfinn/picgo/releases\">https://github.com/Molunerfinn/picgo/releases</a></p>\n<p><strong>3. 配置PicGo：</strong></p>\n<ul>\n<li>GitHub中创建一个token：依次打开 <code>Settings -&gt; Developer settings -&gt; Personal access tokens</code>，最后点击 <code>generate new token</code>。勾选相关信息（expiration 改为 no expiration、select scope 勾选repo），然后点击生成token；</li>\n<li>打开 PicGo，<code>图床设置 -&gt; Github 图床</code></li>\n<li>填写相关设置：</li>\n</ul>\n<p><img src=\"https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/%E4%BD%BF%E7%94%A8Github%E6%90%AD%E5%BB%BA%E5%9B%BE%E5%BA%8A_imgs_47.png\"></p>\n<p><strong>4. 设置完成，可以上传图片测试了。</strong></p>\n<p><strong>5. 设置cdn加速：</strong>设置自定义域名为 <code>https://cdn.jsdelivr.net/gh/用户名/图床仓库名</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/picGo%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D.png\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p><strong>1. 在github上创建一个仓库。</strong></p>\n<p><strong>2. 下载并安装 PicGo：</strong></p>\n<p>官网：<a href=\"https://molunerfinn.com/PicGo/\">https://molunerfinn.com/PicGo/</a></p>\n<p>下载：<a href=\"https://github.com/Molunerfinn/picgo/releases\">https://github.com/Molunerfinn/picgo/releases</a></p>\n<p><strong>3. 配置PicGo：</strong></p>\n<ul>\n<li>GitHub中创建一个token：依次打开 <code>Settings -&gt; Developer settings -&gt; Personal access tokens</code>，最后点击 <code>generate new token</code>。勾选相关信息（expiration 改为 no expiration、select scope 勾选repo），然后点击生成token；</li>\n<li>打开 PicGo，<code>图床设置 -&gt; Github 图床</code></li>\n<li>填写相关设置：</li>\n</ul>\n<p><img src=\"https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/%E4%BD%BF%E7%94%A8Github%E6%90%AD%E5%BB%BA%E5%9B%BE%E5%BA%8A_imgs_47.png\"></p>\n<p><strong>4. 设置完成，可以上传图片测试了。</strong></p>\n<p><strong>5. 设置cdn加速：</strong>设置自定义域名为 <code>https://cdn.jsdelivr.net/gh/用户名/图床仓库名</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/picGo%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D.png\"></p>\n"},{"title":"Pinia 快速入门","date":"2023-03-06T14:34:53.000Z","description":"Pinia（发音为/piːnjʌ/，如英语中的“peenya”）是最接近 piña（西班牙语中的菠萝）的词。 Pinia本质上依然是一个全局状态管理的库，用于跨组件、页面进行状态共享（这点和Vuex、Redux、Mobx一样）。","_content":"\n# pinia\n\n## 概念\n\nPinia（发音为/piːnjʌ/，如英语中的“peenya”）是最接近 piña（西班牙语中的菠萝）的词。 Pinia本质上依然是一个全局状态管理的库，用于跨组件、页面进行状态共享（这点和Vuex、Redux、Mobx一样）。\n\n**什么是store？**\n\n一个 Store （如 Pinia）是一个实体，它持有未绑定到您的组件树的状态和业务逻辑。换句话说，它托管全局状态。它有点像一个始终存在并且每个人都可以读取和写入的组件。它有三个概念，state、getters 和 actions 并且可以安全地假设这些概念等同于组件中的“数据”、“计算”和“方法”。\n\n**我什么时候应该使用store？**\n\n存储应该包含可以在整个应用程序中访问的数据。这包括在许多地方使用的数据，例如导航栏中显示的用户信息，以及需要通过页面保留的数据，例如一个非常复杂的多步骤表格。\n\n另一方面，您应该避免在存储中包含可以托管在组件中的本地数据，例如页面本地元素的可见性。\n\n并非所有应用程序都需要访问全局状态，但如果您需要一个，Pania 将使您的生活更轻松。\n\n## 与 Vuex 3.x/4.x 的比较\n> Vuex 3.x 是 Vuex 的 Vue 2 而 Vuex 4.x 是 Vue 3\n\nPinia API 与 Vuex ≤4 有很大不同，即：\n\n- mutations 不再存在。他们经常被认为是 非常 冗长。他们最初带来了 devtools 集成，但这不再是问题。\n- 无需创建自定义复杂包装器来支持 TypeScript，所有内容都是类型化的，并且 API 的设计方式尽可能利用 TS 类型推断。\n- 不再需要注入、导入函数、调用函数、享受自动完成功能！\n- 无需动态添加 Store，默认情况下它们都是动态的，您甚至都不会注意到。请注意，您仍然可以随时手动使用 Store 进行注册，但因为它是自动的，您无需担心。\n- 不再有 modules 的嵌套结构。您仍然可以通过在另一个 Store 中导入和 使用 来隐式嵌套 Store，但 Pinia 通过设计提供平面结构，同时仍然支持 Store 之间的交叉组合方式。 您甚至可以拥有 Store 的循环依赖关系。\n- 没有 命名空间模块。鉴于 Store 的扁平架构，“命名空间” Store 是其定义方式所固有的，您可以说所有 Store 都是命名空间的。\n\n\n## 开始使用\n\n用你最喜欢的包管理器安装 pinia：\n\n```sh\nyarn add pinia\n# 或者使用 npm\nnpm install pinia\n```\n\n如果您的应用使用 Vue 2，您还需要安装组合 API：@vue/composition-api。 本文将基于 vue3 示范，vue2 具体用法参考 [pinia官网](https://pinia.web3doc.top/getting-started.html#%E5%AE%89%E8%A3%85)。\n\n创建一个 pinia（根存储）并将其传递给应用程序：\n\n```js\nimport { createPinia } from 'pinia'\napp.use(createPinia())\n```\n\n\n## 核心概念\n\n### 定义一个store\n\n在深入了解核心概念之前，我们需要知道 Store 是使用 defineStore() 定义的，并且它需要一个唯一名称，作为第一个参数传递：\n\n```js\nimport { defineStore } from 'pinia'\n\n// useStore 可以是 useUser、useCart 之类的任何东西\n// 第一个参数是应用程序中 store 的唯一 id\nexport const useStore = defineStore('main', {\n  // other options...\n})\n```\n\n这个 name，也称为 id，是必要的，Pinia 使用它来将 store 连接到 devtools。 将返回的函数命名为 use... 是跨可组合项的约定，以使其符合你的使用习惯。\n\n### 使用store\n\n我们正在 定义 一个 store，因为在 setup() 中调用 useStore() 之前不会创建 store：\n\n```js\nimport { useStore } from '@/stores/counter'\n\nexport default {\n  setup() {\n    const store = useStore()\n\n    return {\n      // 您可以返回整个 store 实例以在模板中使用它\n      store,\n    }\n  },\n}\n```\n\n您可以根据需要定义任意数量的 store ，并且**您应该在不同的文件中定义每个 store **以充分利用 pinia（例如自动允许您的包进行代码拆分和 TypeScript 推理）。\n\n一旦 store 被实例化，你就可以直接在 store 上访问 state、getters 和 actions 中定义的任何属性。 我们将在接下来的页面中详细介绍这些内容，但自动补全会对您有所帮助。\n\n请注意，store 是一个用reactive 包裹的对象，这意味着不需要在getter 之后写.value，但是，就像setup 中的props 一样，我们不能对其进行解构：\n\n```js\nexport default defineComponent({\n  setup() {\n    const store = useStore()\n    // ❌ 这不起作用，因为它会破坏响应式\n    // 这和从 props 解构是一样的\n    const { name, doubleCount } = store\n\n    name // \"eduardo\"\n    doubleCount // 2\n\n    return {\n      // 一直会是 \"eduardo\"\n      name,\n      // 一直会是 2\n      doubleCount,\n      // 这将是响应式的\n      doubleValue: computed(() => store.doubleCount),\n      }\n  },\n})\n```\n\n为了从 Store 中提取属性同时保持其响应式，您需要使用 `storeToRefs()`。 它将为任何响应式属性创建 refs。 当您仅使用 store 中的状态但不调用任何操作时，这很有用：\n\n```js\nimport { storeToRefs } from 'pinia'\n\nexport default defineComponent({\n  setup() {\n    const store = useStore()\n    // `name` 和 `doubleCount` 是响应式引用\n    // 这也会为插件添加的属性创建引用\n    // 但跳过任何 action 或 非响应式（不是 ref/reactive）的属性\n    const { name, doubleCount } = storeToRefs(store)\n\n    return {\n      name,\n      doubleCount\n    }\n  },\n})\n```\n\n### state\n\n大多数时候，state 是 store 的核心部分。 我们通常从定义应用程序的状态开始。 在 Pinia 中，状态被定义为返回初始状态的函数。 Pinia 在服务器端和客户端都可以工作。\n\n```js\nimport { defineStore } from 'pinia'\n\nconst useStore = defineStore('storeId', {\n  // 推荐使用 完整类型推断的箭头函数\n  state: () => {\n    return {\n      // 所有这些属性都将自动推断其类型\n      counter: 0,\n      name: 'Eduardo',\n      isAdmin: true,\n    }\n  },\n})\n```\n\n#### 访问state\n\n默认情况下，您可以通过 store 实例访问状态来直接读取和写入状态：\n\n```js\nconst store = useStore()\nstore.counter++\n```\n\n#### 重置状态\n\n您可以通过调用 store 上的 `$reset()` 方法将状态 重置 到其初始值：\n\n```js\nconst store = useStore()\nstore.$reset()\n```\n\n#### 改变状态\n\n除了直接用 store.counter++ 修改 store，你还可以调用 $patch 方法。 它允许您使用部分“state”对象同时应用多个更改：\n\n```js\nstore.$patch({\n  counter: store.counter + 1,\n  name: 'Abalam',\n})\n```\n\n但是，使用这种语法应用某些突变非常困难或代价高昂：任何集合修改（例如，从数组中推送、删除、拼接元素）都需要您创建一个新集合。 正因为如此，$patch 方法也接受一个函数来批量修改集合内部分对象的情况：\n\n```js\ncartStore.$patch((state) => {\n  state.items.push({ name: 'shoes', quantity: 1 })\n  state.hasChanged = true\n})\n```\n\n这里的主要区别是$patch() 允许您将批量更改的日志写入开发工具中的一个条目中。 注意两者，state 和 $patch() 的直接更改都出现在 devtools 中，并且可以进行 time travelled（在 Vue 3 中还没有）。\n\n#### 替换state\n\n您可以通过将其 $state 属性设置为新对象来替换 Store 的整个状态：\n\n```js\nstore.$state = { counter: 666, name: 'Paimon' }\n```\n\n您还可以通过更改 pinia 实例的 state 来替换应用程序的整个状态。 这在 SSR for hydration 期间使用。\n\n```js\npinia.state.value = {}\n```\n\n#### 订阅状态\n\n可以通过 store 的 $subscribe() 方法查看状态及其变化，类似于 Vuex 的 subscribe 方法。 与常规的 watch() 相比，使用 $subscribe() 的优点是 subscriptions 只会在 patches 之后触发一次（例如，当使用上面的函数版本时）。\n\n```js\ncartStore.$subscribe((mutation, state) => {\n  // import { MutationType } from 'pinia'\n  mutation.type // 'direct' | 'patch object' | 'patch function'\n  // 与 cartStore.$id 相同\n  mutation.storeId // 'cart'\n  // 仅适用于 mutation.type === 'patch object'\n  mutation.payload // 补丁对象传递给 to cartStore.$patch()\n\n  // 每当它发生变化时，将整个状态持久化到本地存储\n  localStorage.setItem('cart', JSON.stringify(state))\n})\n```\n\n默认情况下，state subscriptions 绑定到添加它们的组件（如果 store 位于组件的 setup() 中）。 意思是，当组件被卸载时，它们将被自动删除。 如果要在卸载组件后保留它们，请将 { detached: true } 作为第二个参数传递给 detach 当前组件的 state subscription：\n\n```js\nexport default {\n  setup() {\n    const someStore = useSomeStore()\n\n    // 此订阅将在组件卸载后保留\n    someStore.$subscribe(callback, { detached: true })\n\n    // ...\n  },\n}\n```\n\n您可以在 pinia 实例上查看整个状态：\n\n```js\nwatch(\n  pinia.state,\n  (state) => {\n    // 每当它发生变化时，将整个状态持久化到本地存储\n    localStorage.setItem('piniaState', JSON.stringify(state))\n  },\n  { deep: true }\n)\n```\n\n### Getters\n\nGetter 完全等同于 Store 状态的 计算值。 它们可以用 defineStore() 中的 getters 属性定义。 他们接收“状态”作为第一个参数以鼓励箭头函数的使用：\n\n```js\nexport const useStore = defineStore('main', {\n  state: () => ({\n    counter: 0,\n  }),\n  getters: {\n    doubleCount: (state) => state.counter * 2,\n  },\n})\n```\n\n大多数时候，getter 只会依赖状态，但是，他们可能需要使用其他 getter。 正因为如此，我们可以在定义常规函数时通过 this 访问到 整个 store 的实例， 但是需要定义返回类型（在 TypeScript 中）。 这是由于 TypeScript 中的一个已知限制，并且不会影响使用箭头函数定义的 getter，也不会影响不使用 this 的 getter：\n\n```js\nexport const useStore = defineStore('main', {\n  state: () => ({\n    counter: 0,\n  }),\n  getters: {\n    // 自动将返回类型推断为数字\n    doubleCount(state) {\n      return state.counter * 2\n    },\n    // 返回类型必须明确设置\n    doublePlusOne(): number {\n      return this.counter * 2 + 1\n    },\n  },\n})\n```\n\n然后你可以直接在 store 实例上访问 getter。\n\n#### 访问其他 getter\n\n与计算属性一样，您可以组合多个 getter。 通过 this 访问任何其他 getter。 即使您不使用 TypeScript，您也可以使用 JSDoc 提示您的 IDE 类型：\n\n```js\nexport const useStore = defineStore('main', {\n  state: () => ({\n    counter: 0,\n  }),\n  getters: {\n    // 类型是自动推断的，因为我们没有使用 `this`\n    doubleCount: (state) => state.counter * 2,\n    // 这里需要我们自己添加类型（在 JS 中使用 JSDoc）。 我们还可以\n    // 使用它来记录 getter\n    /**\n     * 返回计数器值乘以二加一。\n     *\n     * @returns {number}\n     */\n    doubleCountPlusOne() {\n      // 自动完成 ✨\n      return this.doubleCount + 1\n    },\n  },\n})\n```\n\n#### 将参数传递给 getter\n\nGetters 只是幕后的 computed 属性，因此无法向它们传递任何参数。 但是，您可以从 getter 返回一个函数以接受任何参数：\n\n```js\nexport const useStore = defineStore('main', {\n  getters: {\n    getUserById: (state) => {\n      return (userId) => state.users.find((user) => user.id === userId)\n    },\n  },\n})\n```\n\n并在组件中使用：\n\n```html\n<script>\nexport default {\n  setup() {\n    const store = useStore()\n\n    return { getUserById: store.getUserById }\n  },\n}\n</script>\n\n<template>\n  <p>User 2: {{ getUserById(2) }}</p>\n</template>\n```\n\n请注意，在执行此操作时，getter 不再缓存，它们只是您调用的函数。 但是，您可以在 getter 本身内部缓存一些结果，这并不常见，但应该证明性能更高：\n\n```js\nexport const useStore = defineStore('main', {\n  getters: {\n    getActiveUserById(state) {\n      const activeUsers = state.users.filter((user) => user.active)\n      return (userId) => activeUsers.find((user) => user.id === userId)\n    },\n  },\n})\n```\n\n#### 访问其他 Store 的getter\n\n要使用其他存储 getter，您可以直接在 better 内部使用它：\n\n```js\nimport { useOtherStore } from './other-store'\n\nexport const useStore = defineStore('main', {\n  state: () => ({\n    // ...\n  }),\n  getters: {\n    otherGetter(state) {\n      const otherStore = useOtherStore()\n      return state.localData + otherStore.data\n    },\n  },\n})\n```\n\n### Actions\n\nActions 相当于组件中的 methods。 它们可以使用 defineStore() 中的 actions 属性定义，并且它们非常适合定义业务逻辑：\n\n```js\nexport const useStore = defineStore('main', {\n  state: () => ({\n    counter: 0,\n  }),\n  actions: {\n    increment() {\n      this.counter++\n    },\n    randomizeCounter() {\n      this.counter = Math.round(100 * Math.random())\n    },\n  },\n})\n```\n\n与 getters 一样，操作可以通过 this 访问 whole store instance 并提供完整类型（和自动完成✨）支持。 与它们不同，actions 可以是异步的，您可以在其中await 任何 API 调用甚至其他操作！ 这是使用 Mande 的示例。 请注意，只要您获得“Promise”，您使用的库并不重要，您甚至可以使用浏览器的“fetch”函数：\n\n```js\nimport { mande } from 'mande'\n\nconst api = mande('/api/users')\n\nexport const useUsers = defineStore('users', {\n  state: () => ({\n    userData: null,\n    // ...\n  }),\n\n  actions: {\n    async registerUser(login, password) {\n      try {\n        this.userData = await api.post({ login, password })\n        showTooltip(`Welcome back ${this.userData.name}!`)\n      } catch (error) {\n        showTooltip(error)\n        // 让表单组件显示错误\n        return error\n      }\n    },\n  },\n})\n```\n\n你也可以完全自由地设置你想要的任何参数并返回任何东西。 调用 Action 时，一切都会自动推断！\n\nActions 像 methods 一样被调用：\n\n```js\nexport default defineComponent({\n  setup() {\n    const main = useMainStore()\n    // Actions 像 methods 一样被调用：\n    main.randomizeCounter()\n\n    return {}\n  },\n})\n```\n\n#### 访问其他 store 操作\n\n要使用另一个 store ，您可以直接在操作内部使用它：\n\n```js\nimport { useAuthStore } from './auth-store'\n\nexport const useSettingsStore = defineStore('settings', {\n  state: () => ({\n    // ...\n  }),\n  actions: {\n    async fetchUserPreferences(preferences) {\n      const auth = useAuthStore()\n      if (auth.isAuthenticated) {\n        this.preferences = await fetchPreferences()\n      } else {\n        throw new Error('User must be authenticated')\n      }\n    },\n  },\n})\n```\n\n#### 订阅 Actions\n\n可以使用 store.$onAction() 订阅 action 及其结果。 传递给它的回调在 action 之前执行。 after 处理 Promise 并允许您在 action 完成后执行函数。 以类似的方式，onError 允许您在处理中抛出错误。 这些对于在运行时跟踪错误很有用，类似于 Vue 文档中的这个提示。\n\n这是一个在运行 action 之前和它们 resolve/reject 之后记录的示例。\n\n```js\nconst unsubscribe = someStore.$onAction(\n  ({\n    name, // action 的名字\n    store, // store 实例\n    args, // 调用这个 action 的参数\n    after, // 在这个 action 执行完毕之后，执行这个函数\n    onError, // 在这个 action 抛出异常的时候，执行这个函数\n  }) => {\n    // 记录开始的时间变量\n    const startTime = Date.now()\n    // 这将在 `store` 上的操作执行之前触发\n    console.log(`Start \"${name}\" with params [${args.join(', ')}].`)\n\n    // 如果 action 成功并且完全运行后，after 将触发。\n    // 它将等待任何返回的 promise\n    after((result) => {\n      console.log(\n        `Finished \"${name}\" after ${\n          Date.now() - startTime\n        }ms.\\nResult: ${result}.`\n      )\n    })\n\n    // 如果 action 抛出或返回 Promise.reject ，onError 将触发\n    onError((error) => {\n      console.warn(\n        `Failed \"${name}\" after ${Date.now() - startTime}ms.\\nError: ${error}.`\n      )\n    })\n  }\n)\n\n// 手动移除订阅\nunsubscribe()\n```\n\n默认情况下，action subscriptions 绑定到添加它们的组件（如果 store 位于组件的 setup() 内）。 意思是，当组件被卸载时，它们将被自动删除。 如果要在卸载组件后保留它们，请将 true 作为第二个参数传递给当前组件的 detach action subscription：\n\n```js\nexport default {\n  setup() {\n    const someStore = useSomeStore()\n\n    // 此订阅将在组件卸载后保留\n    someStore.$onAction(callback, true)\n\n    // ...\n  },\n}\n```\n\n## 最后\n\nPinia 相较于 Vuex 来说，更简单的API，更少的写法，并且对于TypeScript 支持非常好，可以自动推断类型，可以随意调用，不用局限于 mutations，大大提高了开发效率，并且降低了学习成本。","source":"_posts/pinia101.md","raw":"---\ntitle: Pinia 快速入门\ndate: 2023-03-06 22:34:53\ntags: Vue.js\ncategories: JavaScript\ndescription: Pinia（发音为/piːnjʌ/，如英语中的“peenya”）是最接近 piña（西班牙语中的菠萝）的词。 Pinia本质上依然是一个全局状态管理的库，用于跨组件、页面进行状态共享（这点和Vuex、Redux、Mobx一样）。\n---\n\n# pinia\n\n## 概念\n\nPinia（发音为/piːnjʌ/，如英语中的“peenya”）是最接近 piña（西班牙语中的菠萝）的词。 Pinia本质上依然是一个全局状态管理的库，用于跨组件、页面进行状态共享（这点和Vuex、Redux、Mobx一样）。\n\n**什么是store？**\n\n一个 Store （如 Pinia）是一个实体，它持有未绑定到您的组件树的状态和业务逻辑。换句话说，它托管全局状态。它有点像一个始终存在并且每个人都可以读取和写入的组件。它有三个概念，state、getters 和 actions 并且可以安全地假设这些概念等同于组件中的“数据”、“计算”和“方法”。\n\n**我什么时候应该使用store？**\n\n存储应该包含可以在整个应用程序中访问的数据。这包括在许多地方使用的数据，例如导航栏中显示的用户信息，以及需要通过页面保留的数据，例如一个非常复杂的多步骤表格。\n\n另一方面，您应该避免在存储中包含可以托管在组件中的本地数据，例如页面本地元素的可见性。\n\n并非所有应用程序都需要访问全局状态，但如果您需要一个，Pania 将使您的生活更轻松。\n\n## 与 Vuex 3.x/4.x 的比较\n> Vuex 3.x 是 Vuex 的 Vue 2 而 Vuex 4.x 是 Vue 3\n\nPinia API 与 Vuex ≤4 有很大不同，即：\n\n- mutations 不再存在。他们经常被认为是 非常 冗长。他们最初带来了 devtools 集成，但这不再是问题。\n- 无需创建自定义复杂包装器来支持 TypeScript，所有内容都是类型化的，并且 API 的设计方式尽可能利用 TS 类型推断。\n- 不再需要注入、导入函数、调用函数、享受自动完成功能！\n- 无需动态添加 Store，默认情况下它们都是动态的，您甚至都不会注意到。请注意，您仍然可以随时手动使用 Store 进行注册，但因为它是自动的，您无需担心。\n- 不再有 modules 的嵌套结构。您仍然可以通过在另一个 Store 中导入和 使用 来隐式嵌套 Store，但 Pinia 通过设计提供平面结构，同时仍然支持 Store 之间的交叉组合方式。 您甚至可以拥有 Store 的循环依赖关系。\n- 没有 命名空间模块。鉴于 Store 的扁平架构，“命名空间” Store 是其定义方式所固有的，您可以说所有 Store 都是命名空间的。\n\n\n## 开始使用\n\n用你最喜欢的包管理器安装 pinia：\n\n```sh\nyarn add pinia\n# 或者使用 npm\nnpm install pinia\n```\n\n如果您的应用使用 Vue 2，您还需要安装组合 API：@vue/composition-api。 本文将基于 vue3 示范，vue2 具体用法参考 [pinia官网](https://pinia.web3doc.top/getting-started.html#%E5%AE%89%E8%A3%85)。\n\n创建一个 pinia（根存储）并将其传递给应用程序：\n\n```js\nimport { createPinia } from 'pinia'\napp.use(createPinia())\n```\n\n\n## 核心概念\n\n### 定义一个store\n\n在深入了解核心概念之前，我们需要知道 Store 是使用 defineStore() 定义的，并且它需要一个唯一名称，作为第一个参数传递：\n\n```js\nimport { defineStore } from 'pinia'\n\n// useStore 可以是 useUser、useCart 之类的任何东西\n// 第一个参数是应用程序中 store 的唯一 id\nexport const useStore = defineStore('main', {\n  // other options...\n})\n```\n\n这个 name，也称为 id，是必要的，Pinia 使用它来将 store 连接到 devtools。 将返回的函数命名为 use... 是跨可组合项的约定，以使其符合你的使用习惯。\n\n### 使用store\n\n我们正在 定义 一个 store，因为在 setup() 中调用 useStore() 之前不会创建 store：\n\n```js\nimport { useStore } from '@/stores/counter'\n\nexport default {\n  setup() {\n    const store = useStore()\n\n    return {\n      // 您可以返回整个 store 实例以在模板中使用它\n      store,\n    }\n  },\n}\n```\n\n您可以根据需要定义任意数量的 store ，并且**您应该在不同的文件中定义每个 store **以充分利用 pinia（例如自动允许您的包进行代码拆分和 TypeScript 推理）。\n\n一旦 store 被实例化，你就可以直接在 store 上访问 state、getters 和 actions 中定义的任何属性。 我们将在接下来的页面中详细介绍这些内容，但自动补全会对您有所帮助。\n\n请注意，store 是一个用reactive 包裹的对象，这意味着不需要在getter 之后写.value，但是，就像setup 中的props 一样，我们不能对其进行解构：\n\n```js\nexport default defineComponent({\n  setup() {\n    const store = useStore()\n    // ❌ 这不起作用，因为它会破坏响应式\n    // 这和从 props 解构是一样的\n    const { name, doubleCount } = store\n\n    name // \"eduardo\"\n    doubleCount // 2\n\n    return {\n      // 一直会是 \"eduardo\"\n      name,\n      // 一直会是 2\n      doubleCount,\n      // 这将是响应式的\n      doubleValue: computed(() => store.doubleCount),\n      }\n  },\n})\n```\n\n为了从 Store 中提取属性同时保持其响应式，您需要使用 `storeToRefs()`。 它将为任何响应式属性创建 refs。 当您仅使用 store 中的状态但不调用任何操作时，这很有用：\n\n```js\nimport { storeToRefs } from 'pinia'\n\nexport default defineComponent({\n  setup() {\n    const store = useStore()\n    // `name` 和 `doubleCount` 是响应式引用\n    // 这也会为插件添加的属性创建引用\n    // 但跳过任何 action 或 非响应式（不是 ref/reactive）的属性\n    const { name, doubleCount } = storeToRefs(store)\n\n    return {\n      name,\n      doubleCount\n    }\n  },\n})\n```\n\n### state\n\n大多数时候，state 是 store 的核心部分。 我们通常从定义应用程序的状态开始。 在 Pinia 中，状态被定义为返回初始状态的函数。 Pinia 在服务器端和客户端都可以工作。\n\n```js\nimport { defineStore } from 'pinia'\n\nconst useStore = defineStore('storeId', {\n  // 推荐使用 完整类型推断的箭头函数\n  state: () => {\n    return {\n      // 所有这些属性都将自动推断其类型\n      counter: 0,\n      name: 'Eduardo',\n      isAdmin: true,\n    }\n  },\n})\n```\n\n#### 访问state\n\n默认情况下，您可以通过 store 实例访问状态来直接读取和写入状态：\n\n```js\nconst store = useStore()\nstore.counter++\n```\n\n#### 重置状态\n\n您可以通过调用 store 上的 `$reset()` 方法将状态 重置 到其初始值：\n\n```js\nconst store = useStore()\nstore.$reset()\n```\n\n#### 改变状态\n\n除了直接用 store.counter++ 修改 store，你还可以调用 $patch 方法。 它允许您使用部分“state”对象同时应用多个更改：\n\n```js\nstore.$patch({\n  counter: store.counter + 1,\n  name: 'Abalam',\n})\n```\n\n但是，使用这种语法应用某些突变非常困难或代价高昂：任何集合修改（例如，从数组中推送、删除、拼接元素）都需要您创建一个新集合。 正因为如此，$patch 方法也接受一个函数来批量修改集合内部分对象的情况：\n\n```js\ncartStore.$patch((state) => {\n  state.items.push({ name: 'shoes', quantity: 1 })\n  state.hasChanged = true\n})\n```\n\n这里的主要区别是$patch() 允许您将批量更改的日志写入开发工具中的一个条目中。 注意两者，state 和 $patch() 的直接更改都出现在 devtools 中，并且可以进行 time travelled（在 Vue 3 中还没有）。\n\n#### 替换state\n\n您可以通过将其 $state 属性设置为新对象来替换 Store 的整个状态：\n\n```js\nstore.$state = { counter: 666, name: 'Paimon' }\n```\n\n您还可以通过更改 pinia 实例的 state 来替换应用程序的整个状态。 这在 SSR for hydration 期间使用。\n\n```js\npinia.state.value = {}\n```\n\n#### 订阅状态\n\n可以通过 store 的 $subscribe() 方法查看状态及其变化，类似于 Vuex 的 subscribe 方法。 与常规的 watch() 相比，使用 $subscribe() 的优点是 subscriptions 只会在 patches 之后触发一次（例如，当使用上面的函数版本时）。\n\n```js\ncartStore.$subscribe((mutation, state) => {\n  // import { MutationType } from 'pinia'\n  mutation.type // 'direct' | 'patch object' | 'patch function'\n  // 与 cartStore.$id 相同\n  mutation.storeId // 'cart'\n  // 仅适用于 mutation.type === 'patch object'\n  mutation.payload // 补丁对象传递给 to cartStore.$patch()\n\n  // 每当它发生变化时，将整个状态持久化到本地存储\n  localStorage.setItem('cart', JSON.stringify(state))\n})\n```\n\n默认情况下，state subscriptions 绑定到添加它们的组件（如果 store 位于组件的 setup() 中）。 意思是，当组件被卸载时，它们将被自动删除。 如果要在卸载组件后保留它们，请将 { detached: true } 作为第二个参数传递给 detach 当前组件的 state subscription：\n\n```js\nexport default {\n  setup() {\n    const someStore = useSomeStore()\n\n    // 此订阅将在组件卸载后保留\n    someStore.$subscribe(callback, { detached: true })\n\n    // ...\n  },\n}\n```\n\n您可以在 pinia 实例上查看整个状态：\n\n```js\nwatch(\n  pinia.state,\n  (state) => {\n    // 每当它发生变化时，将整个状态持久化到本地存储\n    localStorage.setItem('piniaState', JSON.stringify(state))\n  },\n  { deep: true }\n)\n```\n\n### Getters\n\nGetter 完全等同于 Store 状态的 计算值。 它们可以用 defineStore() 中的 getters 属性定义。 他们接收“状态”作为第一个参数以鼓励箭头函数的使用：\n\n```js\nexport const useStore = defineStore('main', {\n  state: () => ({\n    counter: 0,\n  }),\n  getters: {\n    doubleCount: (state) => state.counter * 2,\n  },\n})\n```\n\n大多数时候，getter 只会依赖状态，但是，他们可能需要使用其他 getter。 正因为如此，我们可以在定义常规函数时通过 this 访问到 整个 store 的实例， 但是需要定义返回类型（在 TypeScript 中）。 这是由于 TypeScript 中的一个已知限制，并且不会影响使用箭头函数定义的 getter，也不会影响不使用 this 的 getter：\n\n```js\nexport const useStore = defineStore('main', {\n  state: () => ({\n    counter: 0,\n  }),\n  getters: {\n    // 自动将返回类型推断为数字\n    doubleCount(state) {\n      return state.counter * 2\n    },\n    // 返回类型必须明确设置\n    doublePlusOne(): number {\n      return this.counter * 2 + 1\n    },\n  },\n})\n```\n\n然后你可以直接在 store 实例上访问 getter。\n\n#### 访问其他 getter\n\n与计算属性一样，您可以组合多个 getter。 通过 this 访问任何其他 getter。 即使您不使用 TypeScript，您也可以使用 JSDoc 提示您的 IDE 类型：\n\n```js\nexport const useStore = defineStore('main', {\n  state: () => ({\n    counter: 0,\n  }),\n  getters: {\n    // 类型是自动推断的，因为我们没有使用 `this`\n    doubleCount: (state) => state.counter * 2,\n    // 这里需要我们自己添加类型（在 JS 中使用 JSDoc）。 我们还可以\n    // 使用它来记录 getter\n    /**\n     * 返回计数器值乘以二加一。\n     *\n     * @returns {number}\n     */\n    doubleCountPlusOne() {\n      // 自动完成 ✨\n      return this.doubleCount + 1\n    },\n  },\n})\n```\n\n#### 将参数传递给 getter\n\nGetters 只是幕后的 computed 属性，因此无法向它们传递任何参数。 但是，您可以从 getter 返回一个函数以接受任何参数：\n\n```js\nexport const useStore = defineStore('main', {\n  getters: {\n    getUserById: (state) => {\n      return (userId) => state.users.find((user) => user.id === userId)\n    },\n  },\n})\n```\n\n并在组件中使用：\n\n```html\n<script>\nexport default {\n  setup() {\n    const store = useStore()\n\n    return { getUserById: store.getUserById }\n  },\n}\n</script>\n\n<template>\n  <p>User 2: {{ getUserById(2) }}</p>\n</template>\n```\n\n请注意，在执行此操作时，getter 不再缓存，它们只是您调用的函数。 但是，您可以在 getter 本身内部缓存一些结果，这并不常见，但应该证明性能更高：\n\n```js\nexport const useStore = defineStore('main', {\n  getters: {\n    getActiveUserById(state) {\n      const activeUsers = state.users.filter((user) => user.active)\n      return (userId) => activeUsers.find((user) => user.id === userId)\n    },\n  },\n})\n```\n\n#### 访问其他 Store 的getter\n\n要使用其他存储 getter，您可以直接在 better 内部使用它：\n\n```js\nimport { useOtherStore } from './other-store'\n\nexport const useStore = defineStore('main', {\n  state: () => ({\n    // ...\n  }),\n  getters: {\n    otherGetter(state) {\n      const otherStore = useOtherStore()\n      return state.localData + otherStore.data\n    },\n  },\n})\n```\n\n### Actions\n\nActions 相当于组件中的 methods。 它们可以使用 defineStore() 中的 actions 属性定义，并且它们非常适合定义业务逻辑：\n\n```js\nexport const useStore = defineStore('main', {\n  state: () => ({\n    counter: 0,\n  }),\n  actions: {\n    increment() {\n      this.counter++\n    },\n    randomizeCounter() {\n      this.counter = Math.round(100 * Math.random())\n    },\n  },\n})\n```\n\n与 getters 一样，操作可以通过 this 访问 whole store instance 并提供完整类型（和自动完成✨）支持。 与它们不同，actions 可以是异步的，您可以在其中await 任何 API 调用甚至其他操作！ 这是使用 Mande 的示例。 请注意，只要您获得“Promise”，您使用的库并不重要，您甚至可以使用浏览器的“fetch”函数：\n\n```js\nimport { mande } from 'mande'\n\nconst api = mande('/api/users')\n\nexport const useUsers = defineStore('users', {\n  state: () => ({\n    userData: null,\n    // ...\n  }),\n\n  actions: {\n    async registerUser(login, password) {\n      try {\n        this.userData = await api.post({ login, password })\n        showTooltip(`Welcome back ${this.userData.name}!`)\n      } catch (error) {\n        showTooltip(error)\n        // 让表单组件显示错误\n        return error\n      }\n    },\n  },\n})\n```\n\n你也可以完全自由地设置你想要的任何参数并返回任何东西。 调用 Action 时，一切都会自动推断！\n\nActions 像 methods 一样被调用：\n\n```js\nexport default defineComponent({\n  setup() {\n    const main = useMainStore()\n    // Actions 像 methods 一样被调用：\n    main.randomizeCounter()\n\n    return {}\n  },\n})\n```\n\n#### 访问其他 store 操作\n\n要使用另一个 store ，您可以直接在操作内部使用它：\n\n```js\nimport { useAuthStore } from './auth-store'\n\nexport const useSettingsStore = defineStore('settings', {\n  state: () => ({\n    // ...\n  }),\n  actions: {\n    async fetchUserPreferences(preferences) {\n      const auth = useAuthStore()\n      if (auth.isAuthenticated) {\n        this.preferences = await fetchPreferences()\n      } else {\n        throw new Error('User must be authenticated')\n      }\n    },\n  },\n})\n```\n\n#### 订阅 Actions\n\n可以使用 store.$onAction() 订阅 action 及其结果。 传递给它的回调在 action 之前执行。 after 处理 Promise 并允许您在 action 完成后执行函数。 以类似的方式，onError 允许您在处理中抛出错误。 这些对于在运行时跟踪错误很有用，类似于 Vue 文档中的这个提示。\n\n这是一个在运行 action 之前和它们 resolve/reject 之后记录的示例。\n\n```js\nconst unsubscribe = someStore.$onAction(\n  ({\n    name, // action 的名字\n    store, // store 实例\n    args, // 调用这个 action 的参数\n    after, // 在这个 action 执行完毕之后，执行这个函数\n    onError, // 在这个 action 抛出异常的时候，执行这个函数\n  }) => {\n    // 记录开始的时间变量\n    const startTime = Date.now()\n    // 这将在 `store` 上的操作执行之前触发\n    console.log(`Start \"${name}\" with params [${args.join(', ')}].`)\n\n    // 如果 action 成功并且完全运行后，after 将触发。\n    // 它将等待任何返回的 promise\n    after((result) => {\n      console.log(\n        `Finished \"${name}\" after ${\n          Date.now() - startTime\n        }ms.\\nResult: ${result}.`\n      )\n    })\n\n    // 如果 action 抛出或返回 Promise.reject ，onError 将触发\n    onError((error) => {\n      console.warn(\n        `Failed \"${name}\" after ${Date.now() - startTime}ms.\\nError: ${error}.`\n      )\n    })\n  }\n)\n\n// 手动移除订阅\nunsubscribe()\n```\n\n默认情况下，action subscriptions 绑定到添加它们的组件（如果 store 位于组件的 setup() 内）。 意思是，当组件被卸载时，它们将被自动删除。 如果要在卸载组件后保留它们，请将 true 作为第二个参数传递给当前组件的 detach action subscription：\n\n```js\nexport default {\n  setup() {\n    const someStore = useSomeStore()\n\n    // 此订阅将在组件卸载后保留\n    someStore.$onAction(callback, true)\n\n    // ...\n  },\n}\n```\n\n## 最后\n\nPinia 相较于 Vuex 来说，更简单的API，更少的写法，并且对于TypeScript 支持非常好，可以自动推断类型，可以随意调用，不用局限于 mutations，大大提高了开发效率，并且降低了学习成本。","slug":"pinia101","published":1,"updated":"2023-03-07T14:53:26.403Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsi70026yt8w0tqu7pqt","content":"<h1 id=\"pinia\"><a href=\"#pinia\" class=\"headerlink\" title=\"pinia\"></a>pinia</h1><h2 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h2><p>Pinia（发音为&#x2F;piːnjʌ&#x2F;，如英语中的“peenya”）是最接近 piña（西班牙语中的菠萝）的词。 Pinia本质上依然是一个全局状态管理的库，用于跨组件、页面进行状态共享（这点和Vuex、Redux、Mobx一样）。</p>\n<p><strong>什么是store？</strong></p>\n<p>一个 Store （如 Pinia）是一个实体，它持有未绑定到您的组件树的状态和业务逻辑。换句话说，它托管全局状态。它有点像一个始终存在并且每个人都可以读取和写入的组件。它有三个概念，state、getters 和 actions 并且可以安全地假设这些概念等同于组件中的“数据”、“计算”和“方法”。</p>\n<p><strong>我什么时候应该使用store？</strong></p>\n<p>存储应该包含可以在整个应用程序中访问的数据。这包括在许多地方使用的数据，例如导航栏中显示的用户信息，以及需要通过页面保留的数据，例如一个非常复杂的多步骤表格。</p>\n<p>另一方面，您应该避免在存储中包含可以托管在组件中的本地数据，例如页面本地元素的可见性。</p>\n<p>并非所有应用程序都需要访问全局状态，但如果您需要一个，Pania 将使您的生活更轻松。</p>\n<h2 id=\"与-Vuex-3-x-x2F-4-x-的比较\"><a href=\"#与-Vuex-3-x-x2F-4-x-的比较\" class=\"headerlink\" title=\"与 Vuex 3.x&#x2F;4.x 的比较\"></a>与 Vuex 3.x&#x2F;4.x 的比较</h2><blockquote>\n<p>Vuex 3.x 是 Vuex 的 Vue 2 而 Vuex 4.x 是 Vue 3</p>\n</blockquote>\n<p>Pinia API 与 Vuex ≤4 有很大不同，即：</p>\n<ul>\n<li>mutations 不再存在。他们经常被认为是 非常 冗长。他们最初带来了 devtools 集成，但这不再是问题。</li>\n<li>无需创建自定义复杂包装器来支持 TypeScript，所有内容都是类型化的，并且 API 的设计方式尽可能利用 TS 类型推断。</li>\n<li>不再需要注入、导入函数、调用函数、享受自动完成功能！</li>\n<li>无需动态添加 Store，默认情况下它们都是动态的，您甚至都不会注意到。请注意，您仍然可以随时手动使用 Store 进行注册，但因为它是自动的，您无需担心。</li>\n<li>不再有 modules 的嵌套结构。您仍然可以通过在另一个 Store 中导入和 使用 来隐式嵌套 Store，但 Pinia 通过设计提供平面结构，同时仍然支持 Store 之间的交叉组合方式。 您甚至可以拥有 Store 的循环依赖关系。</li>\n<li>没有 命名空间模块。鉴于 Store 的扁平架构，“命名空间” Store 是其定义方式所固有的，您可以说所有 Store 都是命名空间的。</li>\n</ul>\n<h2 id=\"开始使用\"><a href=\"#开始使用\" class=\"headerlink\" title=\"开始使用\"></a>开始使用</h2><p>用你最喜欢的包管理器安装 pinia：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add pinia</span><br><span class=\"line\"><span class=\"comment\"># 或者使用 npm</span></span><br><span class=\"line\">npm install pinia</span><br></pre></td></tr></table></figure>\n\n<p>如果您的应用使用 Vue 2，您还需要安装组合 API：@vue&#x2F;composition-api。 本文将基于 vue3 示范，vue2 具体用法参考 <a href=\"https://pinia.web3doc.top/getting-started.html#%E5%AE%89%E8%A3%85\">pinia官网</a>。</p>\n<p>创建一个 pinia（根存储）并将其传递给应用程序：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createPinia &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;pinia&#x27;</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">createPinia</span>())</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"核心概念\"><a href=\"#核心概念\" class=\"headerlink\" title=\"核心概念\"></a>核心概念</h2><h3 id=\"定义一个store\"><a href=\"#定义一个store\" class=\"headerlink\" title=\"定义一个store\"></a>定义一个store</h3><p>在深入了解核心概念之前，我们需要知道 Store 是使用 defineStore() 定义的，并且它需要一个唯一名称，作为第一个参数传递：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; defineStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;pinia&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// useStore 可以是 useUser、useCart 之类的任何东西</span></span><br><span class=\"line\"><span class=\"comment\">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"comment\">// other options...</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这个 name，也称为 id，是必要的，Pinia 使用它来将 store 连接到 devtools。 将返回的函数命名为 use… 是跨可组合项的约定，以使其符合你的使用习惯。</p>\n<h3 id=\"使用store\"><a href=\"#使用store\" class=\"headerlink\" title=\"使用store\"></a>使用store</h3><p>我们正在 定义 一个 store，因为在 setup() 中调用 useStore() 之前不会创建 store：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/stores/counter&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 您可以返回整个 store 实例以在模板中使用它</span></span><br><span class=\"line\">      store,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>您可以根据需要定义任意数量的 store ，并且**您应该在不同的文件中定义每个 store **以充分利用 pinia（例如自动允许您的包进行代码拆分和 TypeScript 推理）。</p>\n<p>一旦 store 被实例化，你就可以直接在 store 上访问 state、getters 和 actions 中定义的任何属性。 我们将在接下来的页面中详细介绍这些内容，但自动补全会对您有所帮助。</p>\n<p>请注意，store 是一个用reactive 包裹的对象，这意味着不需要在getter 之后写.value，但是，就像setup 中的props 一样，我们不能对其进行解构：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title function_\">defineComponent</span>(&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span><br><span class=\"line\">    <span class=\"comment\">// ❌ 这不起作用，因为它会破坏响应式</span></span><br><span class=\"line\">    <span class=\"comment\">// 这和从 props 解构是一样的</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; name, doubleCount &#125; = store</span><br><span class=\"line\"></span><br><span class=\"line\">    name <span class=\"comment\">// &quot;eduardo&quot;</span></span><br><span class=\"line\">    doubleCount <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 一直会是 &quot;eduardo&quot;</span></span><br><span class=\"line\">      name,</span><br><span class=\"line\">      <span class=\"comment\">// 一直会是 2</span></span><br><span class=\"line\">      doubleCount,</span><br><span class=\"line\">      <span class=\"comment\">// 这将是响应式的</span></span><br><span class=\"line\">      <span class=\"attr\">doubleValue</span>: <span class=\"title function_\">computed</span>(<span class=\"function\">() =&gt;</span> store.<span class=\"property\">doubleCount</span>),</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>为了从 Store 中提取属性同时保持其响应式，您需要使用 <code>storeToRefs()</code>。 它将为任何响应式属性创建 refs。 当您仅使用 store 中的状态但不调用任何操作时，这很有用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; storeToRefs &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;pinia&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title function_\">defineComponent</span>(&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span><br><span class=\"line\">    <span class=\"comment\">// `name` 和 `doubleCount` 是响应式引用</span></span><br><span class=\"line\">    <span class=\"comment\">// 这也会为插件添加的属性创建引用</span></span><br><span class=\"line\">    <span class=\"comment\">// 但跳过任何 action 或 非响应式（不是 ref/reactive）的属性</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; name, doubleCount &#125; = <span class=\"title function_\">storeToRefs</span>(store)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      name,</span><br><span class=\"line\">      doubleCount</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"state\"><a href=\"#state\" class=\"headerlink\" title=\"state\"></a>state</h3><p>大多数时候，state 是 store 的核心部分。 我们通常从定义应用程序的状态开始。 在 Pinia 中，状态被定义为返回初始状态的函数。 Pinia 在服务器端和客户端都可以工作。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; defineStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;pinia&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;storeId&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 推荐使用 完整类型推断的箭头函数</span></span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 所有这些属性都将自动推断其类型</span></span><br><span class=\"line\">      <span class=\"attr\">counter</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&#x27;Eduardo&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">isAdmin</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"访问state\"><a href=\"#访问state\" class=\"headerlink\" title=\"访问state\"></a>访问state</h4><p>默认情况下，您可以通过 store 实例访问状态来直接读取和写入状态：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span><br><span class=\"line\">store.<span class=\"property\">counter</span>++</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"重置状态\"><a href=\"#重置状态\" class=\"headerlink\" title=\"重置状态\"></a>重置状态</h4><p>您可以通过调用 store 上的 <code>$reset()</code> 方法将状态 重置 到其初始值：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span><br><span class=\"line\">store.$reset()</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"改变状态\"><a href=\"#改变状态\" class=\"headerlink\" title=\"改变状态\"></a>改变状态</h4><p>除了直接用 store.counter++ 修改 store，你还可以调用 $patch 方法。 它允许您使用部分“state”对象同时应用多个更改：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store.$patch(&#123;</span><br><span class=\"line\">  <span class=\"attr\">counter</span>: store.<span class=\"property\">counter</span> + <span class=\"number\">1</span>,</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"string\">&#x27;Abalam&#x27;</span>,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>但是，使用这种语法应用某些突变非常困难或代价高昂：任何集合修改（例如，从数组中推送、删除、拼接元素）都需要您创建一个新集合。 正因为如此，$patch 方法也接受一个函数来批量修改集合内部分对象的情况：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cartStore.$patch(<span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  state.<span class=\"property\">items</span>.<span class=\"title function_\">push</span>(&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;shoes&#x27;</span>, <span class=\"attr\">quantity</span>: <span class=\"number\">1</span> &#125;)</span><br><span class=\"line\">  state.<span class=\"property\">hasChanged</span> = <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这里的主要区别是$patch() 允许您将批量更改的日志写入开发工具中的一个条目中。 注意两者，state 和 $patch() 的直接更改都出现在 devtools 中，并且可以进行 time travelled（在 Vue 3 中还没有）。</p>\n<h4 id=\"替换state\"><a href=\"#替换state\" class=\"headerlink\" title=\"替换state\"></a>替换state</h4><p>您可以通过将其 $state 属性设置为新对象来替换 Store 的整个状态：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store.<span class=\"property\">$state</span> = &#123; <span class=\"attr\">counter</span>: <span class=\"number\">666</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;Paimon&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>您还可以通过更改 pinia 实例的 state 来替换应用程序的整个状态。 这在 SSR for hydration 期间使用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pinia.<span class=\"property\">state</span>.<span class=\"property\">value</span> = &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"订阅状态\"><a href=\"#订阅状态\" class=\"headerlink\" title=\"订阅状态\"></a>订阅状态</h4><p>可以通过 store 的 $subscribe() 方法查看状态及其变化，类似于 Vuex 的 subscribe 方法。 与常规的 watch() 相比，使用 $subscribe() 的优点是 subscriptions 只会在 patches 之后触发一次（例如，当使用上面的函数版本时）。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cartStore.$subscribe(<span class=\"function\">(<span class=\"params\">mutation, state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// import &#123; MutationType &#125; from &#x27;pinia&#x27;</span></span><br><span class=\"line\">  mutation.<span class=\"property\">type</span> <span class=\"comment\">// &#x27;direct&#x27; | &#x27;patch object&#x27; | &#x27;patch function&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\">// 与 cartStore.$id 相同</span></span><br><span class=\"line\">  mutation.<span class=\"property\">storeId</span> <span class=\"comment\">// &#x27;cart&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\">// 仅适用于 mutation.type === &#x27;patch object&#x27;</span></span><br><span class=\"line\">  mutation.<span class=\"property\">payload</span> <span class=\"comment\">// 补丁对象传递给 to cartStore.$patch()</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 每当它发生变化时，将整个状态持久化到本地存储</span></span><br><span class=\"line\">  <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;cart&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(state))</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>默认情况下，state subscriptions 绑定到添加它们的组件（如果 store 位于组件的 setup() 中）。 意思是，当组件被卸载时，它们将被自动删除。 如果要在卸载组件后保留它们，请将 { detached: true } 作为第二个参数传递给 detach 当前组件的 state subscription：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> someStore = <span class=\"title function_\">useSomeStore</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 此订阅将在组件卸载后保留</span></span><br><span class=\"line\">    someStore.$subscribe(callback, &#123; <span class=\"attr\">detached</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>您可以在 pinia 实例上查看整个状态：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">  pinia.<span class=\"property\">state</span>,</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 每当它发生变化时，将整个状态持久化到本地存储</span></span><br><span class=\"line\">    <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;piniaState&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(state))</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">deep</span>: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Getters\"><a href=\"#Getters\" class=\"headerlink\" title=\"Getters\"></a>Getters</h3><p>Getter 完全等同于 Store 状态的 计算值。 它们可以用 defineStore() 中的 getters 属性定义。 他们接收“状态”作为第一个参数以鼓励箭头函数的使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">counter</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">doubleCount</span>: <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> state.<span class=\"property\">counter</span> * <span class=\"number\">2</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>大多数时候，getter 只会依赖状态，但是，他们可能需要使用其他 getter。 正因为如此，我们可以在定义常规函数时通过 this 访问到 整个 store 的实例， 但是需要定义返回类型（在 TypeScript 中）。 这是由于 TypeScript 中的一个已知限制，并且不会影响使用箭头函数定义的 getter，也不会影响不使用 this 的 getter：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">counter</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 自动将返回类型推断为数字</span></span><br><span class=\"line\">    <span class=\"title function_\">doubleCount</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state.<span class=\"property\">counter</span> * <span class=\"number\">2</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 返回类型必须明确设置</span></span><br><span class=\"line\">    <span class=\"title function_\">doublePlusOne</span>(): number &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">counter</span> * <span class=\"number\">2</span> + <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>然后你可以直接在 store 实例上访问 getter。</p>\n<h4 id=\"访问其他-getter\"><a href=\"#访问其他-getter\" class=\"headerlink\" title=\"访问其他 getter\"></a>访问其他 getter</h4><p>与计算属性一样，您可以组合多个 getter。 通过 this 访问任何其他 getter。 即使您不使用 TypeScript，您也可以使用 JSDoc 提示您的 IDE 类型：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">counter</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 类型是自动推断的，因为我们没有使用 `this`</span></span><br><span class=\"line\">    <span class=\"attr\">doubleCount</span>: <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> state.<span class=\"property\">counter</span> * <span class=\"number\">2</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 这里需要我们自己添加类型（在 JS 中使用 JSDoc）。 我们还可以</span></span><br><span class=\"line\">    <span class=\"comment\">// 使用它来记录 getter</span></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回计数器值乘以二加一。</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">number</span>&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"title function_\">doubleCountPlusOne</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 自动完成 ✨</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">doubleCount</span> + <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"将参数传递给-getter\"><a href=\"#将参数传递给-getter\" class=\"headerlink\" title=\"将参数传递给 getter\"></a>将参数传递给 getter</h4><p>Getters 只是幕后的 computed 属性，因此无法向它们传递任何参数。 但是，您可以从 getter 返回一个函数以接受任何参数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">getUserById</span>: <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">userId</span>) =&gt;</span> state.<span class=\"property\">users</span>.<span class=\"title function_\">find</span>(<span class=\"function\">(<span class=\"params\">user</span>) =&gt;</span> user.<span class=\"property\">id</span> === userId)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>并在组件中使用：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">return</span> &#123; <span class=\"attr\">getUserById</span>: store.<span class=\"property\">getUserById</span> &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>User 2: &#123;&#123; getUserById(2) &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>请注意，在执行此操作时，getter 不再缓存，它们只是您调用的函数。 但是，您可以在 getter 本身内部缓存一些结果，这并不常见，但应该证明性能更高：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">getActiveUserById</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> activeUsers = state.<span class=\"property\">users</span>.<span class=\"title function_\">filter</span>(<span class=\"function\">(<span class=\"params\">user</span>) =&gt;</span> user.<span class=\"property\">active</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">userId</span>) =&gt;</span> activeUsers.<span class=\"title function_\">find</span>(<span class=\"function\">(<span class=\"params\">user</span>) =&gt;</span> user.<span class=\"property\">id</span> === userId)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"访问其他-Store-的getter\"><a href=\"#访问其他-Store-的getter\" class=\"headerlink\" title=\"访问其他 Store 的getter\"></a>访问其他 Store 的getter</h4><p>要使用其他存储 getter，您可以直接在 better 内部使用它：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useOtherStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./other-store&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">otherGetter</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> otherStore = <span class=\"title function_\">useOtherStore</span>()</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state.<span class=\"property\">localData</span> + otherStore.<span class=\"property\">data</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Actions\"><a href=\"#Actions\" class=\"headerlink\" title=\"Actions\"></a>Actions</h3><p>Actions 相当于组件中的 methods。 它们可以使用 defineStore() 中的 actions 属性定义，并且它们非常适合定义业务逻辑：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">counter</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">increment</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">counter</span>++</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"title function_\">randomizeCounter</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">counter</span> = <span class=\"title class_\">Math</span>.<span class=\"title function_\">round</span>(<span class=\"number\">100</span> * <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>())</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>与 getters 一样，操作可以通过 this 访问 whole store instance 并提供完整类型（和自动完成✨）支持。 与它们不同，actions 可以是异步的，您可以在其中await 任何 API 调用甚至其他操作！ 这是使用 Mande 的示例。 请注意，只要您获得“Promise”，您使用的库并不重要，您甚至可以使用浏览器的“fetch”函数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; mande &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;mande&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> api = <span class=\"title function_\">mande</span>(<span class=\"string\">&#x27;/api/users&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useUsers = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;users&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">userData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">registerUser</span>(<span class=\"params\">login, password</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">userData</span> = <span class=\"keyword\">await</span> api.<span class=\"title function_\">post</span>(&#123; login, password &#125;)</span><br><span class=\"line\">        <span class=\"title function_\">showTooltip</span>(<span class=\"string\">`Welcome back <span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.userData.name&#125;</span>!`</span>)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">showTooltip</span>(error)</span><br><span class=\"line\">        <span class=\"comment\">// 让表单组件显示错误</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> error</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>你也可以完全自由地设置你想要的任何参数并返回任何东西。 调用 Action 时，一切都会自动推断！</p>\n<p>Actions 像 methods 一样被调用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title function_\">defineComponent</span>(&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> main = <span class=\"title function_\">useMainStore</span>()</span><br><span class=\"line\">    <span class=\"comment\">// Actions 像 methods 一样被调用：</span></span><br><span class=\"line\">    main.<span class=\"title function_\">randomizeCounter</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;&#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"访问其他-store-操作\"><a href=\"#访问其他-store-操作\" class=\"headerlink\" title=\"访问其他 store 操作\"></a>访问其他 store 操作</h4><p>要使用另一个 store ，您可以直接在操作内部使用它：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useAuthStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./auth-store&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useSettingsStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;settings&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">fetchUserPreferences</span>(<span class=\"params\">preferences</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> auth = <span class=\"title function_\">useAuthStore</span>()</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (auth.<span class=\"property\">isAuthenticated</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">preferences</span> = <span class=\"keyword\">await</span> <span class=\"title function_\">fetchPreferences</span>()</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&#x27;User must be authenticated&#x27;</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"订阅-Actions\"><a href=\"#订阅-Actions\" class=\"headerlink\" title=\"订阅 Actions\"></a>订阅 Actions</h4><p>可以使用 store.$onAction() 订阅 action 及其结果。 传递给它的回调在 action 之前执行。 after 处理 Promise 并允许您在 action 完成后执行函数。 以类似的方式，onError 允许您在处理中抛出错误。 这些对于在运行时跟踪错误很有用，类似于 Vue 文档中的这个提示。</p>\n<p>这是一个在运行 action 之前和它们 resolve&#x2F;reject 之后记录的示例。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> unsubscribe = someStore.$onAction(</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">&#123;</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    name, // action 的名字</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    store, // store 实例</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    args, // 调用这个 action 的参数</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    after, // 在这个 action 执行完毕之后，执行这个函数</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    onError, // 在这个 action 抛出异常的时候，执行这个函数</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">  &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 记录开始的时间变量</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> startTime = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">    <span class=\"comment\">// 这将在 `store` 上的操作执行之前触发</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`Start &quot;<span class=\"subst\">$&#123;name&#125;</span>&quot; with params [<span class=\"subst\">$&#123;args.join(<span class=\"string\">&#x27;, &#x27;</span>)&#125;</span>].`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 如果 action 成功并且完全运行后，after 将触发。</span></span><br><span class=\"line\">    <span class=\"comment\">// 它将等待任何返回的 promise</span></span><br><span class=\"line\">    <span class=\"title function_\">after</span>(<span class=\"function\">(<span class=\"params\">result</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(</span><br><span class=\"line\">        <span class=\"string\">`Finished &quot;<span class=\"subst\">$&#123;name&#125;</span>&quot; after <span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">          <span class=\"built_in\">Date</span>.now() - startTime</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">        &#125;</span>ms.\\nResult: <span class=\"subst\">$&#123;result&#125;</span>.`</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 如果 action 抛出或返回 Promise.reject ，onError 将触发</span></span><br><span class=\"line\">    <span class=\"title function_\">onError</span>(<span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">warn</span>(</span><br><span class=\"line\">        <span class=\"string\">`Failed &quot;<span class=\"subst\">$&#123;name&#125;</span>&quot; after <span class=\"subst\">$&#123;<span class=\"built_in\">Date</span>.now() - startTime&#125;</span>ms.\\nError: <span class=\"subst\">$&#123;error&#125;</span>.`</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 手动移除订阅</span></span><br><span class=\"line\"><span class=\"title function_\">unsubscribe</span>()</span><br></pre></td></tr></table></figure>\n\n<p>默认情况下，action subscriptions 绑定到添加它们的组件（如果 store 位于组件的 setup() 内）。 意思是，当组件被卸载时，它们将被自动删除。 如果要在卸载组件后保留它们，请将 true 作为第二个参数传递给当前组件的 detach action subscription：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> someStore = <span class=\"title function_\">useSomeStore</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 此订阅将在组件卸载后保留</span></span><br><span class=\"line\">    someStore.$onAction(callback, <span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>Pinia 相较于 Vuex 来说，更简单的API，更少的写法，并且对于TypeScript 支持非常好，可以自动推断类型，可以随意调用，不用局限于 mutations，大大提高了开发效率，并且降低了学习成本。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"pinia\"><a href=\"#pinia\" class=\"headerlink\" title=\"pinia\"></a>pinia</h1><h2 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h2><p>Pinia（发音为&#x2F;piːnjʌ&#x2F;，如英语中的“peenya”）是最接近 piña（西班牙语中的菠萝）的词。 Pinia本质上依然是一个全局状态管理的库，用于跨组件、页面进行状态共享（这点和Vuex、Redux、Mobx一样）。</p>\n<p><strong>什么是store？</strong></p>\n<p>一个 Store （如 Pinia）是一个实体，它持有未绑定到您的组件树的状态和业务逻辑。换句话说，它托管全局状态。它有点像一个始终存在并且每个人都可以读取和写入的组件。它有三个概念，state、getters 和 actions 并且可以安全地假设这些概念等同于组件中的“数据”、“计算”和“方法”。</p>\n<p><strong>我什么时候应该使用store？</strong></p>\n<p>存储应该包含可以在整个应用程序中访问的数据。这包括在许多地方使用的数据，例如导航栏中显示的用户信息，以及需要通过页面保留的数据，例如一个非常复杂的多步骤表格。</p>\n<p>另一方面，您应该避免在存储中包含可以托管在组件中的本地数据，例如页面本地元素的可见性。</p>\n<p>并非所有应用程序都需要访问全局状态，但如果您需要一个，Pania 将使您的生活更轻松。</p>\n<h2 id=\"与-Vuex-3-x-x2F-4-x-的比较\"><a href=\"#与-Vuex-3-x-x2F-4-x-的比较\" class=\"headerlink\" title=\"与 Vuex 3.x&#x2F;4.x 的比较\"></a>与 Vuex 3.x&#x2F;4.x 的比较</h2><blockquote>\n<p>Vuex 3.x 是 Vuex 的 Vue 2 而 Vuex 4.x 是 Vue 3</p>\n</blockquote>\n<p>Pinia API 与 Vuex ≤4 有很大不同，即：</p>\n<ul>\n<li>mutations 不再存在。他们经常被认为是 非常 冗长。他们最初带来了 devtools 集成，但这不再是问题。</li>\n<li>无需创建自定义复杂包装器来支持 TypeScript，所有内容都是类型化的，并且 API 的设计方式尽可能利用 TS 类型推断。</li>\n<li>不再需要注入、导入函数、调用函数、享受自动完成功能！</li>\n<li>无需动态添加 Store，默认情况下它们都是动态的，您甚至都不会注意到。请注意，您仍然可以随时手动使用 Store 进行注册，但因为它是自动的，您无需担心。</li>\n<li>不再有 modules 的嵌套结构。您仍然可以通过在另一个 Store 中导入和 使用 来隐式嵌套 Store，但 Pinia 通过设计提供平面结构，同时仍然支持 Store 之间的交叉组合方式。 您甚至可以拥有 Store 的循环依赖关系。</li>\n<li>没有 命名空间模块。鉴于 Store 的扁平架构，“命名空间” Store 是其定义方式所固有的，您可以说所有 Store 都是命名空间的。</li>\n</ul>\n<h2 id=\"开始使用\"><a href=\"#开始使用\" class=\"headerlink\" title=\"开始使用\"></a>开始使用</h2><p>用你最喜欢的包管理器安装 pinia：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add pinia</span><br><span class=\"line\"><span class=\"comment\"># 或者使用 npm</span></span><br><span class=\"line\">npm install pinia</span><br></pre></td></tr></table></figure>\n\n<p>如果您的应用使用 Vue 2，您还需要安装组合 API：@vue&#x2F;composition-api。 本文将基于 vue3 示范，vue2 具体用法参考 <a href=\"https://pinia.web3doc.top/getting-started.html#%E5%AE%89%E8%A3%85\">pinia官网</a>。</p>\n<p>创建一个 pinia（根存储）并将其传递给应用程序：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createPinia &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;pinia&#x27;</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">createPinia</span>())</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"核心概念\"><a href=\"#核心概念\" class=\"headerlink\" title=\"核心概念\"></a>核心概念</h2><h3 id=\"定义一个store\"><a href=\"#定义一个store\" class=\"headerlink\" title=\"定义一个store\"></a>定义一个store</h3><p>在深入了解核心概念之前，我们需要知道 Store 是使用 defineStore() 定义的，并且它需要一个唯一名称，作为第一个参数传递：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; defineStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;pinia&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// useStore 可以是 useUser、useCart 之类的任何东西</span></span><br><span class=\"line\"><span class=\"comment\">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"comment\">// other options...</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这个 name，也称为 id，是必要的，Pinia 使用它来将 store 连接到 devtools。 将返回的函数命名为 use… 是跨可组合项的约定，以使其符合你的使用习惯。</p>\n<h3 id=\"使用store\"><a href=\"#使用store\" class=\"headerlink\" title=\"使用store\"></a>使用store</h3><p>我们正在 定义 一个 store，因为在 setup() 中调用 useStore() 之前不会创建 store：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/stores/counter&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 您可以返回整个 store 实例以在模板中使用它</span></span><br><span class=\"line\">      store,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>您可以根据需要定义任意数量的 store ，并且**您应该在不同的文件中定义每个 store **以充分利用 pinia（例如自动允许您的包进行代码拆分和 TypeScript 推理）。</p>\n<p>一旦 store 被实例化，你就可以直接在 store 上访问 state、getters 和 actions 中定义的任何属性。 我们将在接下来的页面中详细介绍这些内容，但自动补全会对您有所帮助。</p>\n<p>请注意，store 是一个用reactive 包裹的对象，这意味着不需要在getter 之后写.value，但是，就像setup 中的props 一样，我们不能对其进行解构：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title function_\">defineComponent</span>(&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span><br><span class=\"line\">    <span class=\"comment\">// ❌ 这不起作用，因为它会破坏响应式</span></span><br><span class=\"line\">    <span class=\"comment\">// 这和从 props 解构是一样的</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; name, doubleCount &#125; = store</span><br><span class=\"line\"></span><br><span class=\"line\">    name <span class=\"comment\">// &quot;eduardo&quot;</span></span><br><span class=\"line\">    doubleCount <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 一直会是 &quot;eduardo&quot;</span></span><br><span class=\"line\">      name,</span><br><span class=\"line\">      <span class=\"comment\">// 一直会是 2</span></span><br><span class=\"line\">      doubleCount,</span><br><span class=\"line\">      <span class=\"comment\">// 这将是响应式的</span></span><br><span class=\"line\">      <span class=\"attr\">doubleValue</span>: <span class=\"title function_\">computed</span>(<span class=\"function\">() =&gt;</span> store.<span class=\"property\">doubleCount</span>),</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>为了从 Store 中提取属性同时保持其响应式，您需要使用 <code>storeToRefs()</code>。 它将为任何响应式属性创建 refs。 当您仅使用 store 中的状态但不调用任何操作时，这很有用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; storeToRefs &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;pinia&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title function_\">defineComponent</span>(&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span><br><span class=\"line\">    <span class=\"comment\">// `name` 和 `doubleCount` 是响应式引用</span></span><br><span class=\"line\">    <span class=\"comment\">// 这也会为插件添加的属性创建引用</span></span><br><span class=\"line\">    <span class=\"comment\">// 但跳过任何 action 或 非响应式（不是 ref/reactive）的属性</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; name, doubleCount &#125; = <span class=\"title function_\">storeToRefs</span>(store)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      name,</span><br><span class=\"line\">      doubleCount</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"state\"><a href=\"#state\" class=\"headerlink\" title=\"state\"></a>state</h3><p>大多数时候，state 是 store 的核心部分。 我们通常从定义应用程序的状态开始。 在 Pinia 中，状态被定义为返回初始状态的函数。 Pinia 在服务器端和客户端都可以工作。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; defineStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;pinia&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;storeId&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 推荐使用 完整类型推断的箭头函数</span></span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 所有这些属性都将自动推断其类型</span></span><br><span class=\"line\">      <span class=\"attr\">counter</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&#x27;Eduardo&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">isAdmin</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"访问state\"><a href=\"#访问state\" class=\"headerlink\" title=\"访问state\"></a>访问state</h4><p>默认情况下，您可以通过 store 实例访问状态来直接读取和写入状态：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span><br><span class=\"line\">store.<span class=\"property\">counter</span>++</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"重置状态\"><a href=\"#重置状态\" class=\"headerlink\" title=\"重置状态\"></a>重置状态</h4><p>您可以通过调用 store 上的 <code>$reset()</code> 方法将状态 重置 到其初始值：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span><br><span class=\"line\">store.$reset()</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"改变状态\"><a href=\"#改变状态\" class=\"headerlink\" title=\"改变状态\"></a>改变状态</h4><p>除了直接用 store.counter++ 修改 store，你还可以调用 $patch 方法。 它允许您使用部分“state”对象同时应用多个更改：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store.$patch(&#123;</span><br><span class=\"line\">  <span class=\"attr\">counter</span>: store.<span class=\"property\">counter</span> + <span class=\"number\">1</span>,</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"string\">&#x27;Abalam&#x27;</span>,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>但是，使用这种语法应用某些突变非常困难或代价高昂：任何集合修改（例如，从数组中推送、删除、拼接元素）都需要您创建一个新集合。 正因为如此，$patch 方法也接受一个函数来批量修改集合内部分对象的情况：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cartStore.$patch(<span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  state.<span class=\"property\">items</span>.<span class=\"title function_\">push</span>(&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;shoes&#x27;</span>, <span class=\"attr\">quantity</span>: <span class=\"number\">1</span> &#125;)</span><br><span class=\"line\">  state.<span class=\"property\">hasChanged</span> = <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这里的主要区别是$patch() 允许您将批量更改的日志写入开发工具中的一个条目中。 注意两者，state 和 $patch() 的直接更改都出现在 devtools 中，并且可以进行 time travelled（在 Vue 3 中还没有）。</p>\n<h4 id=\"替换state\"><a href=\"#替换state\" class=\"headerlink\" title=\"替换state\"></a>替换state</h4><p>您可以通过将其 $state 属性设置为新对象来替换 Store 的整个状态：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store.<span class=\"property\">$state</span> = &#123; <span class=\"attr\">counter</span>: <span class=\"number\">666</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;Paimon&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>您还可以通过更改 pinia 实例的 state 来替换应用程序的整个状态。 这在 SSR for hydration 期间使用。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pinia.<span class=\"property\">state</span>.<span class=\"property\">value</span> = &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"订阅状态\"><a href=\"#订阅状态\" class=\"headerlink\" title=\"订阅状态\"></a>订阅状态</h4><p>可以通过 store 的 $subscribe() 方法查看状态及其变化，类似于 Vuex 的 subscribe 方法。 与常规的 watch() 相比，使用 $subscribe() 的优点是 subscriptions 只会在 patches 之后触发一次（例如，当使用上面的函数版本时）。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cartStore.$subscribe(<span class=\"function\">(<span class=\"params\">mutation, state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// import &#123; MutationType &#125; from &#x27;pinia&#x27;</span></span><br><span class=\"line\">  mutation.<span class=\"property\">type</span> <span class=\"comment\">// &#x27;direct&#x27; | &#x27;patch object&#x27; | &#x27;patch function&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\">// 与 cartStore.$id 相同</span></span><br><span class=\"line\">  mutation.<span class=\"property\">storeId</span> <span class=\"comment\">// &#x27;cart&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\">// 仅适用于 mutation.type === &#x27;patch object&#x27;</span></span><br><span class=\"line\">  mutation.<span class=\"property\">payload</span> <span class=\"comment\">// 补丁对象传递给 to cartStore.$patch()</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 每当它发生变化时，将整个状态持久化到本地存储</span></span><br><span class=\"line\">  <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;cart&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(state))</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>默认情况下，state subscriptions 绑定到添加它们的组件（如果 store 位于组件的 setup() 中）。 意思是，当组件被卸载时，它们将被自动删除。 如果要在卸载组件后保留它们，请将 { detached: true } 作为第二个参数传递给 detach 当前组件的 state subscription：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> someStore = <span class=\"title function_\">useSomeStore</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 此订阅将在组件卸载后保留</span></span><br><span class=\"line\">    someStore.$subscribe(callback, &#123; <span class=\"attr\">detached</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>您可以在 pinia 实例上查看整个状态：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">  pinia.<span class=\"property\">state</span>,</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 每当它发生变化时，将整个状态持久化到本地存储</span></span><br><span class=\"line\">    <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;piniaState&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(state))</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">deep</span>: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Getters\"><a href=\"#Getters\" class=\"headerlink\" title=\"Getters\"></a>Getters</h3><p>Getter 完全等同于 Store 状态的 计算值。 它们可以用 defineStore() 中的 getters 属性定义。 他们接收“状态”作为第一个参数以鼓励箭头函数的使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">counter</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">doubleCount</span>: <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> state.<span class=\"property\">counter</span> * <span class=\"number\">2</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>大多数时候，getter 只会依赖状态，但是，他们可能需要使用其他 getter。 正因为如此，我们可以在定义常规函数时通过 this 访问到 整个 store 的实例， 但是需要定义返回类型（在 TypeScript 中）。 这是由于 TypeScript 中的一个已知限制，并且不会影响使用箭头函数定义的 getter，也不会影响不使用 this 的 getter：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">counter</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 自动将返回类型推断为数字</span></span><br><span class=\"line\">    <span class=\"title function_\">doubleCount</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state.<span class=\"property\">counter</span> * <span class=\"number\">2</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 返回类型必须明确设置</span></span><br><span class=\"line\">    <span class=\"title function_\">doublePlusOne</span>(): number &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">counter</span> * <span class=\"number\">2</span> + <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>然后你可以直接在 store 实例上访问 getter。</p>\n<h4 id=\"访问其他-getter\"><a href=\"#访问其他-getter\" class=\"headerlink\" title=\"访问其他 getter\"></a>访问其他 getter</h4><p>与计算属性一样，您可以组合多个 getter。 通过 this 访问任何其他 getter。 即使您不使用 TypeScript，您也可以使用 JSDoc 提示您的 IDE 类型：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">counter</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 类型是自动推断的，因为我们没有使用 `this`</span></span><br><span class=\"line\">    <span class=\"attr\">doubleCount</span>: <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> state.<span class=\"property\">counter</span> * <span class=\"number\">2</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 这里需要我们自己添加类型（在 JS 中使用 JSDoc）。 我们还可以</span></span><br><span class=\"line\">    <span class=\"comment\">// 使用它来记录 getter</span></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回计数器值乘以二加一。</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">number</span>&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"title function_\">doubleCountPlusOne</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 自动完成 ✨</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">doubleCount</span> + <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"将参数传递给-getter\"><a href=\"#将参数传递给-getter\" class=\"headerlink\" title=\"将参数传递给 getter\"></a>将参数传递给 getter</h4><p>Getters 只是幕后的 computed 属性，因此无法向它们传递任何参数。 但是，您可以从 getter 返回一个函数以接受任何参数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">getUserById</span>: <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">userId</span>) =&gt;</span> state.<span class=\"property\">users</span>.<span class=\"title function_\">find</span>(<span class=\"function\">(<span class=\"params\">user</span>) =&gt;</span> user.<span class=\"property\">id</span> === userId)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>并在组件中使用：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">const</span> store = <span class=\"title function_\">useStore</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">return</span> &#123; <span class=\"attr\">getUserById</span>: store.<span class=\"property\">getUserById</span> &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>User 2: &#123;&#123; getUserById(2) &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>请注意，在执行此操作时，getter 不再缓存，它们只是您调用的函数。 但是，您可以在 getter 本身内部缓存一些结果，这并不常见，但应该证明性能更高：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">getActiveUserById</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> activeUsers = state.<span class=\"property\">users</span>.<span class=\"title function_\">filter</span>(<span class=\"function\">(<span class=\"params\">user</span>) =&gt;</span> user.<span class=\"property\">active</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">userId</span>) =&gt;</span> activeUsers.<span class=\"title function_\">find</span>(<span class=\"function\">(<span class=\"params\">user</span>) =&gt;</span> user.<span class=\"property\">id</span> === userId)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"访问其他-Store-的getter\"><a href=\"#访问其他-Store-的getter\" class=\"headerlink\" title=\"访问其他 Store 的getter\"></a>访问其他 Store 的getter</h4><p>要使用其他存储 getter，您可以直接在 better 内部使用它：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useOtherStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./other-store&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">otherGetter</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> otherStore = <span class=\"title function_\">useOtherStore</span>()</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state.<span class=\"property\">localData</span> + otherStore.<span class=\"property\">data</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Actions\"><a href=\"#Actions\" class=\"headerlink\" title=\"Actions\"></a>Actions</h3><p>Actions 相当于组件中的 methods。 它们可以使用 defineStore() 中的 actions 属性定义，并且它们非常适合定义业务逻辑：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;main&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">counter</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">increment</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">counter</span>++</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"title function_\">randomizeCounter</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">counter</span> = <span class=\"title class_\">Math</span>.<span class=\"title function_\">round</span>(<span class=\"number\">100</span> * <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>())</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>与 getters 一样，操作可以通过 this 访问 whole store instance 并提供完整类型（和自动完成✨）支持。 与它们不同，actions 可以是异步的，您可以在其中await 任何 API 调用甚至其他操作！ 这是使用 Mande 的示例。 请注意，只要您获得“Promise”，您使用的库并不重要，您甚至可以使用浏览器的“fetch”函数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; mande &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;mande&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> api = <span class=\"title function_\">mande</span>(<span class=\"string\">&#x27;/api/users&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useUsers = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;users&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">userData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">registerUser</span>(<span class=\"params\">login, password</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">userData</span> = <span class=\"keyword\">await</span> api.<span class=\"title function_\">post</span>(&#123; login, password &#125;)</span><br><span class=\"line\">        <span class=\"title function_\">showTooltip</span>(<span class=\"string\">`Welcome back <span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.userData.name&#125;</span>!`</span>)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">showTooltip</span>(error)</span><br><span class=\"line\">        <span class=\"comment\">// 让表单组件显示错误</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> error</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>你也可以完全自由地设置你想要的任何参数并返回任何东西。 调用 Action 时，一切都会自动推断！</p>\n<p>Actions 像 methods 一样被调用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title function_\">defineComponent</span>(&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> main = <span class=\"title function_\">useMainStore</span>()</span><br><span class=\"line\">    <span class=\"comment\">// Actions 像 methods 一样被调用：</span></span><br><span class=\"line\">    main.<span class=\"title function_\">randomizeCounter</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;&#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"访问其他-store-操作\"><a href=\"#访问其他-store-操作\" class=\"headerlink\" title=\"访问其他 store 操作\"></a>访问其他 store 操作</h4><p>要使用另一个 store ，您可以直接在操作内部使用它：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useAuthStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./auth-store&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useSettingsStore = <span class=\"title function_\">defineStore</span>(<span class=\"string\">&#x27;settings&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">fetchUserPreferences</span>(<span class=\"params\">preferences</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> auth = <span class=\"title function_\">useAuthStore</span>()</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (auth.<span class=\"property\">isAuthenticated</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">preferences</span> = <span class=\"keyword\">await</span> <span class=\"title function_\">fetchPreferences</span>()</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&#x27;User must be authenticated&#x27;</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"订阅-Actions\"><a href=\"#订阅-Actions\" class=\"headerlink\" title=\"订阅 Actions\"></a>订阅 Actions</h4><p>可以使用 store.$onAction() 订阅 action 及其结果。 传递给它的回调在 action 之前执行。 after 处理 Promise 并允许您在 action 完成后执行函数。 以类似的方式，onError 允许您在处理中抛出错误。 这些对于在运行时跟踪错误很有用，类似于 Vue 文档中的这个提示。</p>\n<p>这是一个在运行 action 之前和它们 resolve&#x2F;reject 之后记录的示例。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> unsubscribe = someStore.$onAction(</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">&#123;</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    name, // action 的名字</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    store, // store 实例</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    args, // 调用这个 action 的参数</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    after, // 在这个 action 执行完毕之后，执行这个函数</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    onError, // 在这个 action 抛出异常的时候，执行这个函数</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">  &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 记录开始的时间变量</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> startTime = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">    <span class=\"comment\">// 这将在 `store` 上的操作执行之前触发</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`Start &quot;<span class=\"subst\">$&#123;name&#125;</span>&quot; with params [<span class=\"subst\">$&#123;args.join(<span class=\"string\">&#x27;, &#x27;</span>)&#125;</span>].`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 如果 action 成功并且完全运行后，after 将触发。</span></span><br><span class=\"line\">    <span class=\"comment\">// 它将等待任何返回的 promise</span></span><br><span class=\"line\">    <span class=\"title function_\">after</span>(<span class=\"function\">(<span class=\"params\">result</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(</span><br><span class=\"line\">        <span class=\"string\">`Finished &quot;<span class=\"subst\">$&#123;name&#125;</span>&quot; after <span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">          <span class=\"built_in\">Date</span>.now() - startTime</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">        &#125;</span>ms.\\nResult: <span class=\"subst\">$&#123;result&#125;</span>.`</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 如果 action 抛出或返回 Promise.reject ，onError 将触发</span></span><br><span class=\"line\">    <span class=\"title function_\">onError</span>(<span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">warn</span>(</span><br><span class=\"line\">        <span class=\"string\">`Failed &quot;<span class=\"subst\">$&#123;name&#125;</span>&quot; after <span class=\"subst\">$&#123;<span class=\"built_in\">Date</span>.now() - startTime&#125;</span>ms.\\nError: <span class=\"subst\">$&#123;error&#125;</span>.`</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 手动移除订阅</span></span><br><span class=\"line\"><span class=\"title function_\">unsubscribe</span>()</span><br></pre></td></tr></table></figure>\n\n<p>默认情况下，action subscriptions 绑定到添加它们的组件（如果 store 位于组件的 setup() 内）。 意思是，当组件被卸载时，它们将被自动删除。 如果要在卸载组件后保留它们，请将 true 作为第二个参数传递给当前组件的 detach action subscription：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> someStore = <span class=\"title function_\">useSomeStore</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 此订阅将在组件卸载后保留</span></span><br><span class=\"line\">    someStore.$onAction(callback, <span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>Pinia 相较于 Vuex 来说，更简单的API，更少的写法，并且对于TypeScript 支持非常好，可以自动推断类型，可以随意调用，不用局限于 mutations，大大提高了开发效率，并且降低了学习成本。</p>\n"},{"title":"Git Hooks 简介","date":"2023-03-11T01:07:31.000Z","description":"Git Hooks 是那些在Git执行特定事件（如commit、push、receive等）后触发运行的脚本","_content":"\n## 概念\n\n如同其他许多的版本控制系统一样，Git 也具有在特定事件发生之前或之后执行特定脚本代码功能（从概念上类比，就与监听事件、触发器之类的东西类似）。 **Git Hooks 就是那些在Git执行特定事件（如commit、push、receive等）后触发运行的脚本** ，挂钩是可以放置在挂钩目录中的程序，可在git执行的某些点触发动作。没有设置可执行位的钩子将被忽略。\n\n默认情况下，hooks目录是 `$GIT_DIR/hooks`，但是可以通过 core.hooksPath 配置变量来更改（请参见 [git-config](https://git-scm.com/docs/git-config)）。\n\n\n## Git Hooks 能做什么\n\nGit Hooks是定制化的脚本程序，所以它实现的功能与相应的git动作相关,如下几个简单例子：\n\n1. 多人开发代码语法、规范强制统一\n2. commit message 格式化、是否符合某种规范\n3. 如果有需要，测试用例的检测\n4. 服务器代码有新的更新的时候通知所有开发成员\n5. 代码提交后的项目自动打包（git receive之后） 等等...\n\n更多的功能可以按照生产环境的需求写出来\n\n\n## Git Hooks 是如何工作的\n\n每一个使用了 git 的工程下面都有一个隐藏的 .git 文件夹。\n\n挂钩都被存储在 .git 目录下的 hooks 子目录中，即大部分项目中的 .git/hooks。\n\nGit 默认会放置一些脚本样本在这个目录中，除了可以作为挂钩使用，这些样本本身是可以独立使用的。所有的样本都是shell脚本，其中一些还包含了Perl的脚本。不过，任何正确命名的可执行脚本都可以正常使用 ，也可以用Ruby或Python，或其他脚本语言。\n\n```\n- .git\n    | - hooks\n        | - applypatch-msg.sample\n        | - commit-msg.sapmle\n        | - post-update.sample\n        | - pre-applypatch.sample\n        | - pre-commit.sample\n        | - pre-push.sample\n        | - pre-rebase.sample\n        | - pre-commit-msg.sample\n```\n\n上述文件是 git 初始化的时候生成的默认钩子，已包含了大部分可以使用的钩子，但是 .sample 拓展名防止它们默认被执行。为了安装一个钩子，你只需要去掉 .sample 拓展名。或者你要写一个新的脚本，你只需添加一个文件名和上述匹配的新文件，去掉.sample拓展名。把一个正确命名且可执行的文件放入 Git 目录下的 hooks子目录中，可以激活该挂钩脚本，之后他一直会被 Git 调用。\n\n\n## 一个简单的 Hooks 例子\n\n使用shell 这里尝试写一个简单的钩子，安装一个prepare-commit-msg钩子。去掉脚本的.sample拓展名，在文件中加上下面这两行：\n\n```sh\n#!/bin/sh\n\necho \"# Please include a useful commit message!\" > $1\n```\n\n接下来你每次运行git commit时，你会看到默认的提交信息都被替换了。\n\n内置的样例脚本是非常有用的参考资料，因为每个钩子传入的参数都有非常详细的说明（不同钩子不一样）。\n\n## 常用的钩子\n\n### 客户端钩子\n\n客户端钩子只影响它们所在的本地仓库。有许多客户端挂钩，以下把他们分为：提交工作流挂钩、电子邮件工作流挂钩及其他客户端挂钩。\n\n#### 提交工作流挂钩\n\ncommit操作有 4个挂钩被用来处理提交的过程，他们的触发时间顺序如下：pre-commit、prepare-commit-msg、commit-msg、post-commit\n\n##### pre-commit\n\npre-commit 挂钩在键入提交信息前运行，最先触发运行的脚本。被用来检查即将提交的代码快照。例如，检查是否有东西被遗漏、运行一些自动化测试、以及检查代码规范。当从该挂钩返回非零值时，Git 放弃此次提交，但可以用git commit --no-verify来忽略。该挂钩可以被用来检查代码错误，检查代码格式规范，检查尾部空白（默认挂钩是这么做的），检查新方法（译注：程序的函数）的说明。\n\npre-commit 不需要任何参数，以非零值退出时将放弃整个提交。这里，我们用 “强制代码格式校验” 来说明。\n\n##### prepare-commit-msg\n\nprepare-commit-msg 挂钩在提交信息编辑器显示之前，默认信息被创建之后运行，它和 pre-commit 一样，以非零值退出会放弃提交。因此，可以有机会在提交作者看到默认信息前进行编辑。该挂钩接收一些选项：拥有提交信息的文件路径，提交类型。例如和提交模板配合使用，以编程的方式插入信息。提交信息模板的提示修改在上面已经看到了，现在我们来看一个更有用的脚本。在处理需要单独开来的bug时，我们通常在单独的分支上处理issue。如果你在分支名中包含了issue编号，你可以使用prepare-commit-msg钩子来自动地将它包括在那个分支的每个提交信息中。\n\n```python\n#!/usr/bin/env python\n\nimport sys, os, re\nfrom subprocess import check_output\n\n# 收集参数\ncommit_msg_filepath = sys.argv[1]\nif len(sys.argv) > 2:\n    commit_type = sys.argv[2]\nelse:\n    commit_type = ''\nif len(sys.argv) > 3:\n    commit_hash = sys.argv[3]\nelse:\n    commit_hash = ''\n\nprint \"prepare-commit-msg: File: %s\\nType: %s\\nHash: %s\" % (commit_msg_filepath, commit_type, commit_hash)\n\n# 检测我们所在的分支\nbranch = check_output(['git', 'symbolic-ref', '--short', 'HEAD']).strip()\nprint \"prepare-commit-msg: On branch '%s'\" % branch\n\n# 用issue编号生成提交信息\nif branch.startswith('issue-'):\n    print \"prepare-commit-msg: Oh hey, it's an issue branch.\"\n    result = re.match('issue-(.*)', branch)\n    issue_number = result.group(1)\n\n    with open(commit_msg_filepath, 'r+') as f:\n        content = f.read()\n        f.seek(0, 0)\n        f.write(\"ISSUE-%s %s\" % (issue_number, content))\n```\n\n首先，上面的prepare-commit-msg 钩子告诉你如何收集传入脚本的所有参数。接下来，它调用了git symbolic-ref --short HEAD来获取对应HEAD的分支名。如果分支名以issue-开头，它会重写提交信息文件，在第一行加上issue编号。比如你的分支名issue-224，下面的提交信息将会生成:\n\n```txt\nISSUE-224 \n\n# Please enter the commit message for your changes. Lines starting \n# with '#' will be ignored, and an empty message aborts the commit. \n# On branch issue-224 \n# Changes to be committed: \n# modified:   test.txt\n```\n\n有一点要记住的是即使用户用-m传入提交信息，prepare-commit-msg也会运行。也就是说，上面这个脚本会自动插入ISSUE-[#]字符串，而用户无法更改。你可以检查第二个参数是否是提交类型来处理这个情况。但是，如果没有-m选项，prepare-commit-msg钩子允许用户修改生成后的提交信息。所以这个脚本的目的是为了方便，而不是推行强制的提交信息规范。如果你要这么做，你需要下面所讲的commit-msg钩子。\n\n##### commit-msg\n\ncommit-msg钩子和prepare-commit-msg钩子很像，但它会在用户输入提交信息之后被调用。这适合用来提醒开发者他们的提交信息不符合你团队的规范。传入这个钩子唯一的参数是包含提交信息的文件名。如果它不喜欢用户输入的提交信息，它可以在原地修改这个文件（和prepare-commit-msg一样），或者它会以非零值退出，放弃这个提交。比如说，下面这个脚本确认用户没有删除prepare-commit-msg脚本自动生成的ISSUE-[#]字符串。\n\n```python\n#!/usr/bin/env python\n\nimport sys, os, re\nfrom subprocess import check_output\n\n# 收集参数\ncommit_msg_filepath = sys.argv[1]\n\n# 检测所在的分支\nbranch = check_output(['git', 'symbolic-ref', '--short', 'HEAD']).strip()\nprint \"commit-msg: On branch '%s'\" % branch\n\n# 检测提交信息，判断是否是一个issue提交\nif branch.startswith('issue-'):\n    print \"commit-msg: Oh hey, it's an issue branch.\"\n    result = re.match('issue-(.*)', branch)\n    issue_number = result.group(1)\n    required_message = \"ISSUE-%s\" % issue_number\n\n    with open(commit_msg_filepath, 'r') as f:\n        content = f.read()\n        if not content.startswith(required_message):\n            print \"commit-msg: ERROR! The commit message must start with '%s'\" % required_message\n            sys.exit(1)\n```\n\n##### post-commit\n\npost-commit 挂钩在整个提交过程完成后运行，他不会接收任何参数，但可以运行git log来获得最后的提交信息。总之，该挂钩是作为通知之类使用的。虽然可以用post-commit来触发本地的持续集成系统，但大多数时候你想用的是post-receive这个钩子。它运行在服务端而不是用户的本地机器，它同样在任何开发者推送代码时运行。那里更适合进行持续集成。\n\n提交工作流的客户端挂钩脚本可以在任何工作流中使用，他们经常被用来实施某些策略，但值得注意的是，这些脚本在clone期间不会被传送。可以在服务器端实施策略来拒绝不符合某些策略的推送，但这完全取决于开发者在客户端使用这些脚本的情况。所以，这些脚本对开发者是有用的，由他们自己设置和维护，而且在任何时候都可以覆盖或修改这些脚本，后面讲如何把这部分东西也集成到开发流中。\n\n#### E-mail工作流挂钩\n\n有3个可用的客户端挂钩用于e-mail工作流。当运行 `git am` 命令时，会调用他们，因此，如果你没有在工作流中用到此命令，可以跳过本节。如果你通过e-mail接收由git format-patch 产生的补丁，这些挂钩也许对你有用。\n\n首先运行的是 applypatch-msg 挂钩，他接收一个参数：包含被建议提交信息的临时文件名。如果该脚本非零退出，Git 放弃此补丁。可以使用这个脚本确认提交信息是否被正确格式化，或让脚本编辑信息以达到标准化。\n\n下一个在git am 运行期间调用是 pre-applypatch 挂钩。该挂钩不接收参数，在补丁被运用之后运行，因此，可以被用来在提交前检查快照。你能用此脚本运行测试，检查工作树。如果有些什么遗漏，或测试没通过，脚本会以非零退出，放弃此次git am的运行，补丁不会被提交。\n\n最后在git am运行期间调用的是post-applypatch 挂钩。你可以用他来通知一个小组或获取的补丁的作者，但无法阻止打补丁的过程。\n\n#### 其他客户端挂钩\n\n##### pre-rebase\n\npre-rebase挂钩在衍合前运行，脚本以非零退出可以中止衍合的过程。你可以使用这个挂钩来禁止衍合已经推送的提交对象，pre-rebase挂钩样本就是这么做的。该样本假定next是你定义的分支名，因此，你可能要修改样本，把next改成你定义过且稳定的分支名。\n\n比如说，如果你想彻底禁用rebase操作，你可以使用下面的pre-rebase脚本：\n\n```sh\n#!/bin/sh\n\n# 禁用所有rebase\necho \"pre-rebase: Rebasing is dangerous. Don't do it.\"\nexit 1\n```\n\n每次运行git rebase，你都会看到下面的信息：\n\n```text\npre-rebase: Rebasing is dangerous. Don't do it.\nThe pre-rebase hook refused to rebase.\n```\n\n内置的pre-rebase.sample脚本是一个更复杂的例子。它在何时阻止rebase这方面更加智能。它会检查你当前的分支是否已经合并到了下一个分支中去（也就是主分支）。如果是的话，rebase可能会遇到问题，脚本会放弃这次rebase。\n\n##### post-checkout\n\n由git checkout命令调用，在完成工作区更新之后执行。该脚本由三个参数：之前HEAD指向的引用，新的HEAD指向的引用，一个用于标识此次检出是否是分支检出的值（0表示文件检出，1表示分支检出）。也可以被git clone触发调用，除非在克隆时使用参数--no-checkout。在由clone调用执行时，三个参数分别为null, 1, 1。这个脚本可以用于为自己的项目设置合适的工作区，比如自动生成文档、移动一些大型二进制文件等，也可以用于检查版本库的有效性。\n\n最后，在 merge 命令成功执行后，post-merge 挂钩会被调用。他可以用来在 Git 无法跟踪的工作树中恢复数据，诸如权限数据。该挂钩同样能够验证在 Git 控制之外的文件是否存在，因此，当工作树改变时，你想这些文件可以被复制。\n\n### 服务器端 Hooks\n除了客户端挂钩，作为系统管理员，你还可以使用两个服务器端的挂钩对项目实施各种类型的策略。这些挂钩脚本可以在提交对象推送到服务器前被调用，也可以在推送到服务器后被调用。推送到服务器前调用的挂钩可以在任何时候以非零退出，拒绝推送，返回错误消息给客户端，还可以如你所愿设置足够复杂的推送策略。\n\n#### pre-receive\n\n处理来自客户端的推送（push）操作时最先执行的脚本就是 pre-receive。它从标准输入（stdin）获取被推送引用的列表；如果它退出时的返回值不是0，所有推送内容都不会被接受。利用此挂钩脚本可以实现类似保证最新的索引中不包含非fast-forward 类型的这类效果；抑或检查执行推送操作的用户拥有创建，删除或者推送的权限或者他是否对将要修改的每一个文件都有访问权限。\n\n```python\n#!/usr/bin/env python\n\nimport sys\nimport fileinput\n\n# 读取用户试图更新的所有引用\nfor line in fileinput.input():\n    print \"pre-receive: Trying to push ref: %s\" % line\n\n# 放弃推送\n# sys.exit(1)\n```\n\n#### post-receive\n\npost-receive 挂钩在整个过程完结以后运行，可以用来更新其他系统服务或者通知用户。它接受与 pre-receive相同的标准输入数据。应用实例包括给某邮件列表发信，通知实时整合数据的服务器，或者更新软件项目的问题追踪系统 —— 甚至可以通过分析提交信息来决定某个问题是否应该被开启，修改或者关闭。该脚本无法组织推送进程，不过客户端在它完成运行之前将保持连接状态；所以在用它作一些消耗时间的操作之前请三思。\n\n#### update\n\nupdate脚本和pre-receive脚本十分类似。不同之处在于它会为推送者更新的每一个分支运行一次。假如推送者同时向多个分支推送内容，pre-receive 只运行一次，相比之下update 则会为每一个更新的分支运行一次。它不会从标准输入读取内容，而是接受三个参数：索引的名字（分支），推送前索引指向的内容的 SHA-1 值，以及用户试图推送内容的 SHA-1 值。如果 update 脚本以退出时返回非零值，只有相应的那一个索引会被拒绝；其余的依然会得到更新。\n\n\n\n\n## 最后\n\n参考链接：\n\n- https://www.cnblogs.com/jiaoshou/p/12222665.html\n- https://www.jianshu.com/p/f3f83872a801","source":"_posts/git-hooks.md","raw":"---\ntitle: Git Hooks 简介\ndate: 2023-03-11 09:07:31\ntags: 工具\ncategories: 工具\ndescription:  Git Hooks 是那些在Git执行特定事件（如commit、push、receive等）后触发运行的脚本\n---\n\n## 概念\n\n如同其他许多的版本控制系统一样，Git 也具有在特定事件发生之前或之后执行特定脚本代码功能（从概念上类比，就与监听事件、触发器之类的东西类似）。 **Git Hooks 就是那些在Git执行特定事件（如commit、push、receive等）后触发运行的脚本** ，挂钩是可以放置在挂钩目录中的程序，可在git执行的某些点触发动作。没有设置可执行位的钩子将被忽略。\n\n默认情况下，hooks目录是 `$GIT_DIR/hooks`，但是可以通过 core.hooksPath 配置变量来更改（请参见 [git-config](https://git-scm.com/docs/git-config)）。\n\n\n## Git Hooks 能做什么\n\nGit Hooks是定制化的脚本程序，所以它实现的功能与相应的git动作相关,如下几个简单例子：\n\n1. 多人开发代码语法、规范强制统一\n2. commit message 格式化、是否符合某种规范\n3. 如果有需要，测试用例的检测\n4. 服务器代码有新的更新的时候通知所有开发成员\n5. 代码提交后的项目自动打包（git receive之后） 等等...\n\n更多的功能可以按照生产环境的需求写出来\n\n\n## Git Hooks 是如何工作的\n\n每一个使用了 git 的工程下面都有一个隐藏的 .git 文件夹。\n\n挂钩都被存储在 .git 目录下的 hooks 子目录中，即大部分项目中的 .git/hooks。\n\nGit 默认会放置一些脚本样本在这个目录中，除了可以作为挂钩使用，这些样本本身是可以独立使用的。所有的样本都是shell脚本，其中一些还包含了Perl的脚本。不过，任何正确命名的可执行脚本都可以正常使用 ，也可以用Ruby或Python，或其他脚本语言。\n\n```\n- .git\n    | - hooks\n        | - applypatch-msg.sample\n        | - commit-msg.sapmle\n        | - post-update.sample\n        | - pre-applypatch.sample\n        | - pre-commit.sample\n        | - pre-push.sample\n        | - pre-rebase.sample\n        | - pre-commit-msg.sample\n```\n\n上述文件是 git 初始化的时候生成的默认钩子，已包含了大部分可以使用的钩子，但是 .sample 拓展名防止它们默认被执行。为了安装一个钩子，你只需要去掉 .sample 拓展名。或者你要写一个新的脚本，你只需添加一个文件名和上述匹配的新文件，去掉.sample拓展名。把一个正确命名且可执行的文件放入 Git 目录下的 hooks子目录中，可以激活该挂钩脚本，之后他一直会被 Git 调用。\n\n\n## 一个简单的 Hooks 例子\n\n使用shell 这里尝试写一个简单的钩子，安装一个prepare-commit-msg钩子。去掉脚本的.sample拓展名，在文件中加上下面这两行：\n\n```sh\n#!/bin/sh\n\necho \"# Please include a useful commit message!\" > $1\n```\n\n接下来你每次运行git commit时，你会看到默认的提交信息都被替换了。\n\n内置的样例脚本是非常有用的参考资料，因为每个钩子传入的参数都有非常详细的说明（不同钩子不一样）。\n\n## 常用的钩子\n\n### 客户端钩子\n\n客户端钩子只影响它们所在的本地仓库。有许多客户端挂钩，以下把他们分为：提交工作流挂钩、电子邮件工作流挂钩及其他客户端挂钩。\n\n#### 提交工作流挂钩\n\ncommit操作有 4个挂钩被用来处理提交的过程，他们的触发时间顺序如下：pre-commit、prepare-commit-msg、commit-msg、post-commit\n\n##### pre-commit\n\npre-commit 挂钩在键入提交信息前运行，最先触发运行的脚本。被用来检查即将提交的代码快照。例如，检查是否有东西被遗漏、运行一些自动化测试、以及检查代码规范。当从该挂钩返回非零值时，Git 放弃此次提交，但可以用git commit --no-verify来忽略。该挂钩可以被用来检查代码错误，检查代码格式规范，检查尾部空白（默认挂钩是这么做的），检查新方法（译注：程序的函数）的说明。\n\npre-commit 不需要任何参数，以非零值退出时将放弃整个提交。这里，我们用 “强制代码格式校验” 来说明。\n\n##### prepare-commit-msg\n\nprepare-commit-msg 挂钩在提交信息编辑器显示之前，默认信息被创建之后运行，它和 pre-commit 一样，以非零值退出会放弃提交。因此，可以有机会在提交作者看到默认信息前进行编辑。该挂钩接收一些选项：拥有提交信息的文件路径，提交类型。例如和提交模板配合使用，以编程的方式插入信息。提交信息模板的提示修改在上面已经看到了，现在我们来看一个更有用的脚本。在处理需要单独开来的bug时，我们通常在单独的分支上处理issue。如果你在分支名中包含了issue编号，你可以使用prepare-commit-msg钩子来自动地将它包括在那个分支的每个提交信息中。\n\n```python\n#!/usr/bin/env python\n\nimport sys, os, re\nfrom subprocess import check_output\n\n# 收集参数\ncommit_msg_filepath = sys.argv[1]\nif len(sys.argv) > 2:\n    commit_type = sys.argv[2]\nelse:\n    commit_type = ''\nif len(sys.argv) > 3:\n    commit_hash = sys.argv[3]\nelse:\n    commit_hash = ''\n\nprint \"prepare-commit-msg: File: %s\\nType: %s\\nHash: %s\" % (commit_msg_filepath, commit_type, commit_hash)\n\n# 检测我们所在的分支\nbranch = check_output(['git', 'symbolic-ref', '--short', 'HEAD']).strip()\nprint \"prepare-commit-msg: On branch '%s'\" % branch\n\n# 用issue编号生成提交信息\nif branch.startswith('issue-'):\n    print \"prepare-commit-msg: Oh hey, it's an issue branch.\"\n    result = re.match('issue-(.*)', branch)\n    issue_number = result.group(1)\n\n    with open(commit_msg_filepath, 'r+') as f:\n        content = f.read()\n        f.seek(0, 0)\n        f.write(\"ISSUE-%s %s\" % (issue_number, content))\n```\n\n首先，上面的prepare-commit-msg 钩子告诉你如何收集传入脚本的所有参数。接下来，它调用了git symbolic-ref --short HEAD来获取对应HEAD的分支名。如果分支名以issue-开头，它会重写提交信息文件，在第一行加上issue编号。比如你的分支名issue-224，下面的提交信息将会生成:\n\n```txt\nISSUE-224 \n\n# Please enter the commit message for your changes. Lines starting \n# with '#' will be ignored, and an empty message aborts the commit. \n# On branch issue-224 \n# Changes to be committed: \n# modified:   test.txt\n```\n\n有一点要记住的是即使用户用-m传入提交信息，prepare-commit-msg也会运行。也就是说，上面这个脚本会自动插入ISSUE-[#]字符串，而用户无法更改。你可以检查第二个参数是否是提交类型来处理这个情况。但是，如果没有-m选项，prepare-commit-msg钩子允许用户修改生成后的提交信息。所以这个脚本的目的是为了方便，而不是推行强制的提交信息规范。如果你要这么做，你需要下面所讲的commit-msg钩子。\n\n##### commit-msg\n\ncommit-msg钩子和prepare-commit-msg钩子很像，但它会在用户输入提交信息之后被调用。这适合用来提醒开发者他们的提交信息不符合你团队的规范。传入这个钩子唯一的参数是包含提交信息的文件名。如果它不喜欢用户输入的提交信息，它可以在原地修改这个文件（和prepare-commit-msg一样），或者它会以非零值退出，放弃这个提交。比如说，下面这个脚本确认用户没有删除prepare-commit-msg脚本自动生成的ISSUE-[#]字符串。\n\n```python\n#!/usr/bin/env python\n\nimport sys, os, re\nfrom subprocess import check_output\n\n# 收集参数\ncommit_msg_filepath = sys.argv[1]\n\n# 检测所在的分支\nbranch = check_output(['git', 'symbolic-ref', '--short', 'HEAD']).strip()\nprint \"commit-msg: On branch '%s'\" % branch\n\n# 检测提交信息，判断是否是一个issue提交\nif branch.startswith('issue-'):\n    print \"commit-msg: Oh hey, it's an issue branch.\"\n    result = re.match('issue-(.*)', branch)\n    issue_number = result.group(1)\n    required_message = \"ISSUE-%s\" % issue_number\n\n    with open(commit_msg_filepath, 'r') as f:\n        content = f.read()\n        if not content.startswith(required_message):\n            print \"commit-msg: ERROR! The commit message must start with '%s'\" % required_message\n            sys.exit(1)\n```\n\n##### post-commit\n\npost-commit 挂钩在整个提交过程完成后运行，他不会接收任何参数，但可以运行git log来获得最后的提交信息。总之，该挂钩是作为通知之类使用的。虽然可以用post-commit来触发本地的持续集成系统，但大多数时候你想用的是post-receive这个钩子。它运行在服务端而不是用户的本地机器，它同样在任何开发者推送代码时运行。那里更适合进行持续集成。\n\n提交工作流的客户端挂钩脚本可以在任何工作流中使用，他们经常被用来实施某些策略，但值得注意的是，这些脚本在clone期间不会被传送。可以在服务器端实施策略来拒绝不符合某些策略的推送，但这完全取决于开发者在客户端使用这些脚本的情况。所以，这些脚本对开发者是有用的，由他们自己设置和维护，而且在任何时候都可以覆盖或修改这些脚本，后面讲如何把这部分东西也集成到开发流中。\n\n#### E-mail工作流挂钩\n\n有3个可用的客户端挂钩用于e-mail工作流。当运行 `git am` 命令时，会调用他们，因此，如果你没有在工作流中用到此命令，可以跳过本节。如果你通过e-mail接收由git format-patch 产生的补丁，这些挂钩也许对你有用。\n\n首先运行的是 applypatch-msg 挂钩，他接收一个参数：包含被建议提交信息的临时文件名。如果该脚本非零退出，Git 放弃此补丁。可以使用这个脚本确认提交信息是否被正确格式化，或让脚本编辑信息以达到标准化。\n\n下一个在git am 运行期间调用是 pre-applypatch 挂钩。该挂钩不接收参数，在补丁被运用之后运行，因此，可以被用来在提交前检查快照。你能用此脚本运行测试，检查工作树。如果有些什么遗漏，或测试没通过，脚本会以非零退出，放弃此次git am的运行，补丁不会被提交。\n\n最后在git am运行期间调用的是post-applypatch 挂钩。你可以用他来通知一个小组或获取的补丁的作者，但无法阻止打补丁的过程。\n\n#### 其他客户端挂钩\n\n##### pre-rebase\n\npre-rebase挂钩在衍合前运行，脚本以非零退出可以中止衍合的过程。你可以使用这个挂钩来禁止衍合已经推送的提交对象，pre-rebase挂钩样本就是这么做的。该样本假定next是你定义的分支名，因此，你可能要修改样本，把next改成你定义过且稳定的分支名。\n\n比如说，如果你想彻底禁用rebase操作，你可以使用下面的pre-rebase脚本：\n\n```sh\n#!/bin/sh\n\n# 禁用所有rebase\necho \"pre-rebase: Rebasing is dangerous. Don't do it.\"\nexit 1\n```\n\n每次运行git rebase，你都会看到下面的信息：\n\n```text\npre-rebase: Rebasing is dangerous. Don't do it.\nThe pre-rebase hook refused to rebase.\n```\n\n内置的pre-rebase.sample脚本是一个更复杂的例子。它在何时阻止rebase这方面更加智能。它会检查你当前的分支是否已经合并到了下一个分支中去（也就是主分支）。如果是的话，rebase可能会遇到问题，脚本会放弃这次rebase。\n\n##### post-checkout\n\n由git checkout命令调用，在完成工作区更新之后执行。该脚本由三个参数：之前HEAD指向的引用，新的HEAD指向的引用，一个用于标识此次检出是否是分支检出的值（0表示文件检出，1表示分支检出）。也可以被git clone触发调用，除非在克隆时使用参数--no-checkout。在由clone调用执行时，三个参数分别为null, 1, 1。这个脚本可以用于为自己的项目设置合适的工作区，比如自动生成文档、移动一些大型二进制文件等，也可以用于检查版本库的有效性。\n\n最后，在 merge 命令成功执行后，post-merge 挂钩会被调用。他可以用来在 Git 无法跟踪的工作树中恢复数据，诸如权限数据。该挂钩同样能够验证在 Git 控制之外的文件是否存在，因此，当工作树改变时，你想这些文件可以被复制。\n\n### 服务器端 Hooks\n除了客户端挂钩，作为系统管理员，你还可以使用两个服务器端的挂钩对项目实施各种类型的策略。这些挂钩脚本可以在提交对象推送到服务器前被调用，也可以在推送到服务器后被调用。推送到服务器前调用的挂钩可以在任何时候以非零退出，拒绝推送，返回错误消息给客户端，还可以如你所愿设置足够复杂的推送策略。\n\n#### pre-receive\n\n处理来自客户端的推送（push）操作时最先执行的脚本就是 pre-receive。它从标准输入（stdin）获取被推送引用的列表；如果它退出时的返回值不是0，所有推送内容都不会被接受。利用此挂钩脚本可以实现类似保证最新的索引中不包含非fast-forward 类型的这类效果；抑或检查执行推送操作的用户拥有创建，删除或者推送的权限或者他是否对将要修改的每一个文件都有访问权限。\n\n```python\n#!/usr/bin/env python\n\nimport sys\nimport fileinput\n\n# 读取用户试图更新的所有引用\nfor line in fileinput.input():\n    print \"pre-receive: Trying to push ref: %s\" % line\n\n# 放弃推送\n# sys.exit(1)\n```\n\n#### post-receive\n\npost-receive 挂钩在整个过程完结以后运行，可以用来更新其他系统服务或者通知用户。它接受与 pre-receive相同的标准输入数据。应用实例包括给某邮件列表发信，通知实时整合数据的服务器，或者更新软件项目的问题追踪系统 —— 甚至可以通过分析提交信息来决定某个问题是否应该被开启，修改或者关闭。该脚本无法组织推送进程，不过客户端在它完成运行之前将保持连接状态；所以在用它作一些消耗时间的操作之前请三思。\n\n#### update\n\nupdate脚本和pre-receive脚本十分类似。不同之处在于它会为推送者更新的每一个分支运行一次。假如推送者同时向多个分支推送内容，pre-receive 只运行一次，相比之下update 则会为每一个更新的分支运行一次。它不会从标准输入读取内容，而是接受三个参数：索引的名字（分支），推送前索引指向的内容的 SHA-1 值，以及用户试图推送内容的 SHA-1 值。如果 update 脚本以退出时返回非零值，只有相应的那一个索引会被拒绝；其余的依然会得到更新。\n\n\n\n\n## 最后\n\n参考链接：\n\n- https://www.cnblogs.com/jiaoshou/p/12222665.html\n- https://www.jianshu.com/p/f3f83872a801","slug":"git-hooks","published":1,"updated":"2023-03-11T17:12:50.653Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsi80029yt8w1nlo5wkf","content":"<h2 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h2><p>如同其他许多的版本控制系统一样，Git 也具有在特定事件发生之前或之后执行特定脚本代码功能（从概念上类比，就与监听事件、触发器之类的东西类似）。 <strong>Git Hooks 就是那些在Git执行特定事件（如commit、push、receive等）后触发运行的脚本</strong> ，挂钩是可以放置在挂钩目录中的程序，可在git执行的某些点触发动作。没有设置可执行位的钩子将被忽略。</p>\n<p>默认情况下，hooks目录是 <code>$GIT_DIR/hooks</code>，但是可以通过 core.hooksPath 配置变量来更改（请参见 <a href=\"https://git-scm.com/docs/git-config\">git-config</a>）。</p>\n<h2 id=\"Git-Hooks-能做什么\"><a href=\"#Git-Hooks-能做什么\" class=\"headerlink\" title=\"Git Hooks 能做什么\"></a>Git Hooks 能做什么</h2><p>Git Hooks是定制化的脚本程序，所以它实现的功能与相应的git动作相关,如下几个简单例子：</p>\n<ol>\n<li>多人开发代码语法、规范强制统一</li>\n<li>commit message 格式化、是否符合某种规范</li>\n<li>如果有需要，测试用例的检测</li>\n<li>服务器代码有新的更新的时候通知所有开发成员</li>\n<li>代码提交后的项目自动打包（git receive之后） 等等…</li>\n</ol>\n<p>更多的功能可以按照生产环境的需求写出来</p>\n<h2 id=\"Git-Hooks-是如何工作的\"><a href=\"#Git-Hooks-是如何工作的\" class=\"headerlink\" title=\"Git Hooks 是如何工作的\"></a>Git Hooks 是如何工作的</h2><p>每一个使用了 git 的工程下面都有一个隐藏的 .git 文件夹。</p>\n<p>挂钩都被存储在 .git 目录下的 hooks 子目录中，即大部分项目中的 .git&#x2F;hooks。</p>\n<p>Git 默认会放置一些脚本样本在这个目录中，除了可以作为挂钩使用，这些样本本身是可以独立使用的。所有的样本都是shell脚本，其中一些还包含了Perl的脚本。不过，任何正确命名的可执行脚本都可以正常使用 ，也可以用Ruby或Python，或其他脚本语言。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- .git</span><br><span class=\"line\">    | - hooks</span><br><span class=\"line\">        | - applypatch-msg.sample</span><br><span class=\"line\">        | - commit-msg.sapmle</span><br><span class=\"line\">        | - post-update.sample</span><br><span class=\"line\">        | - pre-applypatch.sample</span><br><span class=\"line\">        | - pre-commit.sample</span><br><span class=\"line\">        | - pre-push.sample</span><br><span class=\"line\">        | - pre-rebase.sample</span><br><span class=\"line\">        | - pre-commit-msg.sample</span><br></pre></td></tr></table></figure>\n\n<p>上述文件是 git 初始化的时候生成的默认钩子，已包含了大部分可以使用的钩子，但是 .sample 拓展名防止它们默认被执行。为了安装一个钩子，你只需要去掉 .sample 拓展名。或者你要写一个新的脚本，你只需添加一个文件名和上述匹配的新文件，去掉.sample拓展名。把一个正确命名且可执行的文件放入 Git 目录下的 hooks子目录中，可以激活该挂钩脚本，之后他一直会被 Git 调用。</p>\n<h2 id=\"一个简单的-Hooks-例子\"><a href=\"#一个简单的-Hooks-例子\" class=\"headerlink\" title=\"一个简单的 Hooks 例子\"></a>一个简单的 Hooks 例子</h2><p>使用shell 这里尝试写一个简单的钩子，安装一个prepare-commit-msg钩子。去掉脚本的.sample拓展名，在文件中加上下面这两行：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;# Please include a useful commit message!&quot;</span> &gt; <span class=\"variable\">$1</span></span><br></pre></td></tr></table></figure>\n\n<p>接下来你每次运行git commit时，你会看到默认的提交信息都被替换了。</p>\n<p>内置的样例脚本是非常有用的参考资料，因为每个钩子传入的参数都有非常详细的说明（不同钩子不一样）。</p>\n<h2 id=\"常用的钩子\"><a href=\"#常用的钩子\" class=\"headerlink\" title=\"常用的钩子\"></a>常用的钩子</h2><h3 id=\"客户端钩子\"><a href=\"#客户端钩子\" class=\"headerlink\" title=\"客户端钩子\"></a>客户端钩子</h3><p>客户端钩子只影响它们所在的本地仓库。有许多客户端挂钩，以下把他们分为：提交工作流挂钩、电子邮件工作流挂钩及其他客户端挂钩。</p>\n<h4 id=\"提交工作流挂钩\"><a href=\"#提交工作流挂钩\" class=\"headerlink\" title=\"提交工作流挂钩\"></a>提交工作流挂钩</h4><p>commit操作有 4个挂钩被用来处理提交的过程，他们的触发时间顺序如下：pre-commit、prepare-commit-msg、commit-msg、post-commit</p>\n<h5 id=\"pre-commit\"><a href=\"#pre-commit\" class=\"headerlink\" title=\"pre-commit\"></a>pre-commit</h5><p>pre-commit 挂钩在键入提交信息前运行，最先触发运行的脚本。被用来检查即将提交的代码快照。例如，检查是否有东西被遗漏、运行一些自动化测试、以及检查代码规范。当从该挂钩返回非零值时，Git 放弃此次提交，但可以用git commit –no-verify来忽略。该挂钩可以被用来检查代码错误，检查代码格式规范，检查尾部空白（默认挂钩是这么做的），检查新方法（译注：程序的函数）的说明。</p>\n<p>pre-commit 不需要任何参数，以非零值退出时将放弃整个提交。这里，我们用 “强制代码格式校验” 来说明。</p>\n<h5 id=\"prepare-commit-msg\"><a href=\"#prepare-commit-msg\" class=\"headerlink\" title=\"prepare-commit-msg\"></a>prepare-commit-msg</h5><p>prepare-commit-msg 挂钩在提交信息编辑器显示之前，默认信息被创建之后运行，它和 pre-commit 一样，以非零值退出会放弃提交。因此，可以有机会在提交作者看到默认信息前进行编辑。该挂钩接收一些选项：拥有提交信息的文件路径，提交类型。例如和提交模板配合使用，以编程的方式插入信息。提交信息模板的提示修改在上面已经看到了，现在我们来看一个更有用的脚本。在处理需要单独开来的bug时，我们通常在单独的分支上处理issue。如果你在分支名中包含了issue编号，你可以使用prepare-commit-msg钩子来自动地将它包括在那个分支的每个提交信息中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys, os, re</span><br><span class=\"line\"><span class=\"keyword\">from</span> subprocess <span class=\"keyword\">import</span> check_output</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 收集参数</span></span><br><span class=\"line\">commit_msg_filepath = sys.argv[<span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) &gt; <span class=\"number\">2</span>:</span><br><span class=\"line\">    commit_type = sys.argv[<span class=\"number\">2</span>]</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    commit_type = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) &gt; <span class=\"number\">3</span>:</span><br><span class=\"line\">    commit_hash = sys.argv[<span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    commit_hash = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span> <span class=\"string\">&quot;prepare-commit-msg: File: %s\\nType: %s\\nHash: %s&quot;</span> % (commit_msg_filepath, commit_type, commit_hash)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测我们所在的分支</span></span><br><span class=\"line\">branch = check_output([<span class=\"string\">&#x27;git&#x27;</span>, <span class=\"string\">&#x27;symbolic-ref&#x27;</span>, <span class=\"string\">&#x27;--short&#x27;</span>, <span class=\"string\">&#x27;HEAD&#x27;</span>]).strip()</span><br><span class=\"line\"><span class=\"built_in\">print</span> <span class=\"string\">&quot;prepare-commit-msg: On branch &#x27;%s&#x27;&quot;</span> % branch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 用issue编号生成提交信息</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> branch.startswith(<span class=\"string\">&#x27;issue-&#x27;</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span> <span class=\"string\">&quot;prepare-commit-msg: Oh hey, it&#x27;s an issue branch.&quot;</span></span><br><span class=\"line\">    result = re.<span class=\"keyword\">match</span>(<span class=\"string\">&#x27;issue-(.*)&#x27;</span>, branch)</span><br><span class=\"line\">    issue_number = result.group(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(commit_msg_filepath, <span class=\"string\">&#x27;r+&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        content = f.read()</span><br><span class=\"line\">        f.seek(<span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">        f.write(<span class=\"string\">&quot;ISSUE-%s %s&quot;</span> % (issue_number, content))</span><br></pre></td></tr></table></figure>\n\n<p>首先，上面的prepare-commit-msg 钩子告诉你如何收集传入脚本的所有参数。接下来，它调用了git symbolic-ref –short HEAD来获取对应HEAD的分支名。如果分支名以issue-开头，它会重写提交信息文件，在第一行加上issue编号。比如你的分支名issue-224，下面的提交信息将会生成:</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ISSUE-224 </span><br><span class=\"line\"></span><br><span class=\"line\"># Please enter the commit message for your changes. Lines starting </span><br><span class=\"line\"># with &#x27;#&#x27; will be ignored, and an empty message aborts the commit. </span><br><span class=\"line\"># On branch issue-224 </span><br><span class=\"line\"># Changes to be committed: </span><br><span class=\"line\"># modified:   test.txt</span><br></pre></td></tr></table></figure>\n\n<p>有一点要记住的是即使用户用-m传入提交信息，prepare-commit-msg也会运行。也就是说，上面这个脚本会自动插入ISSUE-[#]字符串，而用户无法更改。你可以检查第二个参数是否是提交类型来处理这个情况。但是，如果没有-m选项，prepare-commit-msg钩子允许用户修改生成后的提交信息。所以这个脚本的目的是为了方便，而不是推行强制的提交信息规范。如果你要这么做，你需要下面所讲的commit-msg钩子。</p>\n<h5 id=\"commit-msg\"><a href=\"#commit-msg\" class=\"headerlink\" title=\"commit-msg\"></a>commit-msg</h5><p>commit-msg钩子和prepare-commit-msg钩子很像，但它会在用户输入提交信息之后被调用。这适合用来提醒开发者他们的提交信息不符合你团队的规范。传入这个钩子唯一的参数是包含提交信息的文件名。如果它不喜欢用户输入的提交信息，它可以在原地修改这个文件（和prepare-commit-msg一样），或者它会以非零值退出，放弃这个提交。比如说，下面这个脚本确认用户没有删除prepare-commit-msg脚本自动生成的ISSUE-[#]字符串。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys, os, re</span><br><span class=\"line\"><span class=\"keyword\">from</span> subprocess <span class=\"keyword\">import</span> check_output</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 收集参数</span></span><br><span class=\"line\">commit_msg_filepath = sys.argv[<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测所在的分支</span></span><br><span class=\"line\">branch = check_output([<span class=\"string\">&#x27;git&#x27;</span>, <span class=\"string\">&#x27;symbolic-ref&#x27;</span>, <span class=\"string\">&#x27;--short&#x27;</span>, <span class=\"string\">&#x27;HEAD&#x27;</span>]).strip()</span><br><span class=\"line\"><span class=\"built_in\">print</span> <span class=\"string\">&quot;commit-msg: On branch &#x27;%s&#x27;&quot;</span> % branch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测提交信息，判断是否是一个issue提交</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> branch.startswith(<span class=\"string\">&#x27;issue-&#x27;</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span> <span class=\"string\">&quot;commit-msg: Oh hey, it&#x27;s an issue branch.&quot;</span></span><br><span class=\"line\">    result = re.<span class=\"keyword\">match</span>(<span class=\"string\">&#x27;issue-(.*)&#x27;</span>, branch)</span><br><span class=\"line\">    issue_number = result.group(<span class=\"number\">1</span>)</span><br><span class=\"line\">    required_message = <span class=\"string\">&quot;ISSUE-%s&quot;</span> % issue_number</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(commit_msg_filepath, <span class=\"string\">&#x27;r&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        content = f.read()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> content.startswith(required_message):</span><br><span class=\"line\">            <span class=\"built_in\">print</span> <span class=\"string\">&quot;commit-msg: ERROR! The commit message must start with &#x27;%s&#x27;&quot;</span> % required_message</span><br><span class=\"line\">            sys.exit(<span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"post-commit\"><a href=\"#post-commit\" class=\"headerlink\" title=\"post-commit\"></a>post-commit</h5><p>post-commit 挂钩在整个提交过程完成后运行，他不会接收任何参数，但可以运行git log来获得最后的提交信息。总之，该挂钩是作为通知之类使用的。虽然可以用post-commit来触发本地的持续集成系统，但大多数时候你想用的是post-receive这个钩子。它运行在服务端而不是用户的本地机器，它同样在任何开发者推送代码时运行。那里更适合进行持续集成。</p>\n<p>提交工作流的客户端挂钩脚本可以在任何工作流中使用，他们经常被用来实施某些策略，但值得注意的是，这些脚本在clone期间不会被传送。可以在服务器端实施策略来拒绝不符合某些策略的推送，但这完全取决于开发者在客户端使用这些脚本的情况。所以，这些脚本对开发者是有用的，由他们自己设置和维护，而且在任何时候都可以覆盖或修改这些脚本，后面讲如何把这部分东西也集成到开发流中。</p>\n<h4 id=\"E-mail工作流挂钩\"><a href=\"#E-mail工作流挂钩\" class=\"headerlink\" title=\"E-mail工作流挂钩\"></a>E-mail工作流挂钩</h4><p>有3个可用的客户端挂钩用于e-mail工作流。当运行 <code>git am</code> 命令时，会调用他们，因此，如果你没有在工作流中用到此命令，可以跳过本节。如果你通过e-mail接收由git format-patch 产生的补丁，这些挂钩也许对你有用。</p>\n<p>首先运行的是 applypatch-msg 挂钩，他接收一个参数：包含被建议提交信息的临时文件名。如果该脚本非零退出，Git 放弃此补丁。可以使用这个脚本确认提交信息是否被正确格式化，或让脚本编辑信息以达到标准化。</p>\n<p>下一个在git am 运行期间调用是 pre-applypatch 挂钩。该挂钩不接收参数，在补丁被运用之后运行，因此，可以被用来在提交前检查快照。你能用此脚本运行测试，检查工作树。如果有些什么遗漏，或测试没通过，脚本会以非零退出，放弃此次git am的运行，补丁不会被提交。</p>\n<p>最后在git am运行期间调用的是post-applypatch 挂钩。你可以用他来通知一个小组或获取的补丁的作者，但无法阻止打补丁的过程。</p>\n<h4 id=\"其他客户端挂钩\"><a href=\"#其他客户端挂钩\" class=\"headerlink\" title=\"其他客户端挂钩\"></a>其他客户端挂钩</h4><h5 id=\"pre-rebase\"><a href=\"#pre-rebase\" class=\"headerlink\" title=\"pre-rebase\"></a>pre-rebase</h5><p>pre-rebase挂钩在衍合前运行，脚本以非零退出可以中止衍合的过程。你可以使用这个挂钩来禁止衍合已经推送的提交对象，pre-rebase挂钩样本就是这么做的。该样本假定next是你定义的分支名，因此，你可能要修改样本，把next改成你定义过且稳定的分支名。</p>\n<p>比如说，如果你想彻底禁用rebase操作，你可以使用下面的pre-rebase脚本：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 禁用所有rebase</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;pre-rebase: Rebasing is dangerous. Don&#x27;t do it.&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span> 1</span><br></pre></td></tr></table></figure>\n\n<p>每次运行git rebase，你都会看到下面的信息：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pre-rebase: Rebasing is dangerous. Don&#x27;t do it.</span><br><span class=\"line\">The pre-rebase hook refused to rebase.</span><br></pre></td></tr></table></figure>\n\n<p>内置的pre-rebase.sample脚本是一个更复杂的例子。它在何时阻止rebase这方面更加智能。它会检查你当前的分支是否已经合并到了下一个分支中去（也就是主分支）。如果是的话，rebase可能会遇到问题，脚本会放弃这次rebase。</p>\n<h5 id=\"post-checkout\"><a href=\"#post-checkout\" class=\"headerlink\" title=\"post-checkout\"></a>post-checkout</h5><p>由git checkout命令调用，在完成工作区更新之后执行。该脚本由三个参数：之前HEAD指向的引用，新的HEAD指向的引用，一个用于标识此次检出是否是分支检出的值（0表示文件检出，1表示分支检出）。也可以被git clone触发调用，除非在克隆时使用参数–no-checkout。在由clone调用执行时，三个参数分别为null, 1, 1。这个脚本可以用于为自己的项目设置合适的工作区，比如自动生成文档、移动一些大型二进制文件等，也可以用于检查版本库的有效性。</p>\n<p>最后，在 merge 命令成功执行后，post-merge 挂钩会被调用。他可以用来在 Git 无法跟踪的工作树中恢复数据，诸如权限数据。该挂钩同样能够验证在 Git 控制之外的文件是否存在，因此，当工作树改变时，你想这些文件可以被复制。</p>\n<h3 id=\"服务器端-Hooks\"><a href=\"#服务器端-Hooks\" class=\"headerlink\" title=\"服务器端 Hooks\"></a>服务器端 Hooks</h3><p>除了客户端挂钩，作为系统管理员，你还可以使用两个服务器端的挂钩对项目实施各种类型的策略。这些挂钩脚本可以在提交对象推送到服务器前被调用，也可以在推送到服务器后被调用。推送到服务器前调用的挂钩可以在任何时候以非零退出，拒绝推送，返回错误消息给客户端，还可以如你所愿设置足够复杂的推送策略。</p>\n<h4 id=\"pre-receive\"><a href=\"#pre-receive\" class=\"headerlink\" title=\"pre-receive\"></a>pre-receive</h4><p>处理来自客户端的推送（push）操作时最先执行的脚本就是 pre-receive。它从标准输入（stdin）获取被推送引用的列表；如果它退出时的返回值不是0，所有推送内容都不会被接受。利用此挂钩脚本可以实现类似保证最新的索引中不包含非fast-forward 类型的这类效果；抑或检查执行推送操作的用户拥有创建，删除或者推送的权限或者他是否对将要修改的每一个文件都有访问权限。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> fileinput</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取用户试图更新的所有引用</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> fileinput.<span class=\"built_in\">input</span>():</span><br><span class=\"line\">    <span class=\"built_in\">print</span> <span class=\"string\">&quot;pre-receive: Trying to push ref: %s&quot;</span> % line</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 放弃推送</span></span><br><span class=\"line\"><span class=\"comment\"># sys.exit(1)</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"post-receive\"><a href=\"#post-receive\" class=\"headerlink\" title=\"post-receive\"></a>post-receive</h4><p>post-receive 挂钩在整个过程完结以后运行，可以用来更新其他系统服务或者通知用户。它接受与 pre-receive相同的标准输入数据。应用实例包括给某邮件列表发信，通知实时整合数据的服务器，或者更新软件项目的问题追踪系统 —— 甚至可以通过分析提交信息来决定某个问题是否应该被开启，修改或者关闭。该脚本无法组织推送进程，不过客户端在它完成运行之前将保持连接状态；所以在用它作一些消耗时间的操作之前请三思。</p>\n<h4 id=\"update\"><a href=\"#update\" class=\"headerlink\" title=\"update\"></a>update</h4><p>update脚本和pre-receive脚本十分类似。不同之处在于它会为推送者更新的每一个分支运行一次。假如推送者同时向多个分支推送内容，pre-receive 只运行一次，相比之下update 则会为每一个更新的分支运行一次。它不会从标准输入读取内容，而是接受三个参数：索引的名字（分支），推送前索引指向的内容的 SHA-1 值，以及用户试图推送内容的 SHA-1 值。如果 update 脚本以退出时返回非零值，只有相应的那一个索引会被拒绝；其余的依然会得到更新。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>参考链接：</p>\n<ul>\n<li><a href=\"https://www.cnblogs.com/jiaoshou/p/12222665.html\">https://www.cnblogs.com/jiaoshou/p/12222665.html</a></li>\n<li><a href=\"https://www.jianshu.com/p/f3f83872a801\">https://www.jianshu.com/p/f3f83872a801</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h2><p>如同其他许多的版本控制系统一样，Git 也具有在特定事件发生之前或之后执行特定脚本代码功能（从概念上类比，就与监听事件、触发器之类的东西类似）。 <strong>Git Hooks 就是那些在Git执行特定事件（如commit、push、receive等）后触发运行的脚本</strong> ，挂钩是可以放置在挂钩目录中的程序，可在git执行的某些点触发动作。没有设置可执行位的钩子将被忽略。</p>\n<p>默认情况下，hooks目录是 <code>$GIT_DIR/hooks</code>，但是可以通过 core.hooksPath 配置变量来更改（请参见 <a href=\"https://git-scm.com/docs/git-config\">git-config</a>）。</p>\n<h2 id=\"Git-Hooks-能做什么\"><a href=\"#Git-Hooks-能做什么\" class=\"headerlink\" title=\"Git Hooks 能做什么\"></a>Git Hooks 能做什么</h2><p>Git Hooks是定制化的脚本程序，所以它实现的功能与相应的git动作相关,如下几个简单例子：</p>\n<ol>\n<li>多人开发代码语法、规范强制统一</li>\n<li>commit message 格式化、是否符合某种规范</li>\n<li>如果有需要，测试用例的检测</li>\n<li>服务器代码有新的更新的时候通知所有开发成员</li>\n<li>代码提交后的项目自动打包（git receive之后） 等等…</li>\n</ol>\n<p>更多的功能可以按照生产环境的需求写出来</p>\n<h2 id=\"Git-Hooks-是如何工作的\"><a href=\"#Git-Hooks-是如何工作的\" class=\"headerlink\" title=\"Git Hooks 是如何工作的\"></a>Git Hooks 是如何工作的</h2><p>每一个使用了 git 的工程下面都有一个隐藏的 .git 文件夹。</p>\n<p>挂钩都被存储在 .git 目录下的 hooks 子目录中，即大部分项目中的 .git&#x2F;hooks。</p>\n<p>Git 默认会放置一些脚本样本在这个目录中，除了可以作为挂钩使用，这些样本本身是可以独立使用的。所有的样本都是shell脚本，其中一些还包含了Perl的脚本。不过，任何正确命名的可执行脚本都可以正常使用 ，也可以用Ruby或Python，或其他脚本语言。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- .git</span><br><span class=\"line\">    | - hooks</span><br><span class=\"line\">        | - applypatch-msg.sample</span><br><span class=\"line\">        | - commit-msg.sapmle</span><br><span class=\"line\">        | - post-update.sample</span><br><span class=\"line\">        | - pre-applypatch.sample</span><br><span class=\"line\">        | - pre-commit.sample</span><br><span class=\"line\">        | - pre-push.sample</span><br><span class=\"line\">        | - pre-rebase.sample</span><br><span class=\"line\">        | - pre-commit-msg.sample</span><br></pre></td></tr></table></figure>\n\n<p>上述文件是 git 初始化的时候生成的默认钩子，已包含了大部分可以使用的钩子，但是 .sample 拓展名防止它们默认被执行。为了安装一个钩子，你只需要去掉 .sample 拓展名。或者你要写一个新的脚本，你只需添加一个文件名和上述匹配的新文件，去掉.sample拓展名。把一个正确命名且可执行的文件放入 Git 目录下的 hooks子目录中，可以激活该挂钩脚本，之后他一直会被 Git 调用。</p>\n<h2 id=\"一个简单的-Hooks-例子\"><a href=\"#一个简单的-Hooks-例子\" class=\"headerlink\" title=\"一个简单的 Hooks 例子\"></a>一个简单的 Hooks 例子</h2><p>使用shell 这里尝试写一个简单的钩子，安装一个prepare-commit-msg钩子。去掉脚本的.sample拓展名，在文件中加上下面这两行：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;# Please include a useful commit message!&quot;</span> &gt; <span class=\"variable\">$1</span></span><br></pre></td></tr></table></figure>\n\n<p>接下来你每次运行git commit时，你会看到默认的提交信息都被替换了。</p>\n<p>内置的样例脚本是非常有用的参考资料，因为每个钩子传入的参数都有非常详细的说明（不同钩子不一样）。</p>\n<h2 id=\"常用的钩子\"><a href=\"#常用的钩子\" class=\"headerlink\" title=\"常用的钩子\"></a>常用的钩子</h2><h3 id=\"客户端钩子\"><a href=\"#客户端钩子\" class=\"headerlink\" title=\"客户端钩子\"></a>客户端钩子</h3><p>客户端钩子只影响它们所在的本地仓库。有许多客户端挂钩，以下把他们分为：提交工作流挂钩、电子邮件工作流挂钩及其他客户端挂钩。</p>\n<h4 id=\"提交工作流挂钩\"><a href=\"#提交工作流挂钩\" class=\"headerlink\" title=\"提交工作流挂钩\"></a>提交工作流挂钩</h4><p>commit操作有 4个挂钩被用来处理提交的过程，他们的触发时间顺序如下：pre-commit、prepare-commit-msg、commit-msg、post-commit</p>\n<h5 id=\"pre-commit\"><a href=\"#pre-commit\" class=\"headerlink\" title=\"pre-commit\"></a>pre-commit</h5><p>pre-commit 挂钩在键入提交信息前运行，最先触发运行的脚本。被用来检查即将提交的代码快照。例如，检查是否有东西被遗漏、运行一些自动化测试、以及检查代码规范。当从该挂钩返回非零值时，Git 放弃此次提交，但可以用git commit –no-verify来忽略。该挂钩可以被用来检查代码错误，检查代码格式规范，检查尾部空白（默认挂钩是这么做的），检查新方法（译注：程序的函数）的说明。</p>\n<p>pre-commit 不需要任何参数，以非零值退出时将放弃整个提交。这里，我们用 “强制代码格式校验” 来说明。</p>\n<h5 id=\"prepare-commit-msg\"><a href=\"#prepare-commit-msg\" class=\"headerlink\" title=\"prepare-commit-msg\"></a>prepare-commit-msg</h5><p>prepare-commit-msg 挂钩在提交信息编辑器显示之前，默认信息被创建之后运行，它和 pre-commit 一样，以非零值退出会放弃提交。因此，可以有机会在提交作者看到默认信息前进行编辑。该挂钩接收一些选项：拥有提交信息的文件路径，提交类型。例如和提交模板配合使用，以编程的方式插入信息。提交信息模板的提示修改在上面已经看到了，现在我们来看一个更有用的脚本。在处理需要单独开来的bug时，我们通常在单独的分支上处理issue。如果你在分支名中包含了issue编号，你可以使用prepare-commit-msg钩子来自动地将它包括在那个分支的每个提交信息中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys, os, re</span><br><span class=\"line\"><span class=\"keyword\">from</span> subprocess <span class=\"keyword\">import</span> check_output</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 收集参数</span></span><br><span class=\"line\">commit_msg_filepath = sys.argv[<span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) &gt; <span class=\"number\">2</span>:</span><br><span class=\"line\">    commit_type = sys.argv[<span class=\"number\">2</span>]</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    commit_type = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) &gt; <span class=\"number\">3</span>:</span><br><span class=\"line\">    commit_hash = sys.argv[<span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    commit_hash = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span> <span class=\"string\">&quot;prepare-commit-msg: File: %s\\nType: %s\\nHash: %s&quot;</span> % (commit_msg_filepath, commit_type, commit_hash)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测我们所在的分支</span></span><br><span class=\"line\">branch = check_output([<span class=\"string\">&#x27;git&#x27;</span>, <span class=\"string\">&#x27;symbolic-ref&#x27;</span>, <span class=\"string\">&#x27;--short&#x27;</span>, <span class=\"string\">&#x27;HEAD&#x27;</span>]).strip()</span><br><span class=\"line\"><span class=\"built_in\">print</span> <span class=\"string\">&quot;prepare-commit-msg: On branch &#x27;%s&#x27;&quot;</span> % branch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 用issue编号生成提交信息</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> branch.startswith(<span class=\"string\">&#x27;issue-&#x27;</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span> <span class=\"string\">&quot;prepare-commit-msg: Oh hey, it&#x27;s an issue branch.&quot;</span></span><br><span class=\"line\">    result = re.<span class=\"keyword\">match</span>(<span class=\"string\">&#x27;issue-(.*)&#x27;</span>, branch)</span><br><span class=\"line\">    issue_number = result.group(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(commit_msg_filepath, <span class=\"string\">&#x27;r+&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        content = f.read()</span><br><span class=\"line\">        f.seek(<span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">        f.write(<span class=\"string\">&quot;ISSUE-%s %s&quot;</span> % (issue_number, content))</span><br></pre></td></tr></table></figure>\n\n<p>首先，上面的prepare-commit-msg 钩子告诉你如何收集传入脚本的所有参数。接下来，它调用了git symbolic-ref –short HEAD来获取对应HEAD的分支名。如果分支名以issue-开头，它会重写提交信息文件，在第一行加上issue编号。比如你的分支名issue-224，下面的提交信息将会生成:</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ISSUE-224 </span><br><span class=\"line\"></span><br><span class=\"line\"># Please enter the commit message for your changes. Lines starting </span><br><span class=\"line\"># with &#x27;#&#x27; will be ignored, and an empty message aborts the commit. </span><br><span class=\"line\"># On branch issue-224 </span><br><span class=\"line\"># Changes to be committed: </span><br><span class=\"line\"># modified:   test.txt</span><br></pre></td></tr></table></figure>\n\n<p>有一点要记住的是即使用户用-m传入提交信息，prepare-commit-msg也会运行。也就是说，上面这个脚本会自动插入ISSUE-[#]字符串，而用户无法更改。你可以检查第二个参数是否是提交类型来处理这个情况。但是，如果没有-m选项，prepare-commit-msg钩子允许用户修改生成后的提交信息。所以这个脚本的目的是为了方便，而不是推行强制的提交信息规范。如果你要这么做，你需要下面所讲的commit-msg钩子。</p>\n<h5 id=\"commit-msg\"><a href=\"#commit-msg\" class=\"headerlink\" title=\"commit-msg\"></a>commit-msg</h5><p>commit-msg钩子和prepare-commit-msg钩子很像，但它会在用户输入提交信息之后被调用。这适合用来提醒开发者他们的提交信息不符合你团队的规范。传入这个钩子唯一的参数是包含提交信息的文件名。如果它不喜欢用户输入的提交信息，它可以在原地修改这个文件（和prepare-commit-msg一样），或者它会以非零值退出，放弃这个提交。比如说，下面这个脚本确认用户没有删除prepare-commit-msg脚本自动生成的ISSUE-[#]字符串。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys, os, re</span><br><span class=\"line\"><span class=\"keyword\">from</span> subprocess <span class=\"keyword\">import</span> check_output</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 收集参数</span></span><br><span class=\"line\">commit_msg_filepath = sys.argv[<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测所在的分支</span></span><br><span class=\"line\">branch = check_output([<span class=\"string\">&#x27;git&#x27;</span>, <span class=\"string\">&#x27;symbolic-ref&#x27;</span>, <span class=\"string\">&#x27;--short&#x27;</span>, <span class=\"string\">&#x27;HEAD&#x27;</span>]).strip()</span><br><span class=\"line\"><span class=\"built_in\">print</span> <span class=\"string\">&quot;commit-msg: On branch &#x27;%s&#x27;&quot;</span> % branch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测提交信息，判断是否是一个issue提交</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> branch.startswith(<span class=\"string\">&#x27;issue-&#x27;</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span> <span class=\"string\">&quot;commit-msg: Oh hey, it&#x27;s an issue branch.&quot;</span></span><br><span class=\"line\">    result = re.<span class=\"keyword\">match</span>(<span class=\"string\">&#x27;issue-(.*)&#x27;</span>, branch)</span><br><span class=\"line\">    issue_number = result.group(<span class=\"number\">1</span>)</span><br><span class=\"line\">    required_message = <span class=\"string\">&quot;ISSUE-%s&quot;</span> % issue_number</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(commit_msg_filepath, <span class=\"string\">&#x27;r&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        content = f.read()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> content.startswith(required_message):</span><br><span class=\"line\">            <span class=\"built_in\">print</span> <span class=\"string\">&quot;commit-msg: ERROR! The commit message must start with &#x27;%s&#x27;&quot;</span> % required_message</span><br><span class=\"line\">            sys.exit(<span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"post-commit\"><a href=\"#post-commit\" class=\"headerlink\" title=\"post-commit\"></a>post-commit</h5><p>post-commit 挂钩在整个提交过程完成后运行，他不会接收任何参数，但可以运行git log来获得最后的提交信息。总之，该挂钩是作为通知之类使用的。虽然可以用post-commit来触发本地的持续集成系统，但大多数时候你想用的是post-receive这个钩子。它运行在服务端而不是用户的本地机器，它同样在任何开发者推送代码时运行。那里更适合进行持续集成。</p>\n<p>提交工作流的客户端挂钩脚本可以在任何工作流中使用，他们经常被用来实施某些策略，但值得注意的是，这些脚本在clone期间不会被传送。可以在服务器端实施策略来拒绝不符合某些策略的推送，但这完全取决于开发者在客户端使用这些脚本的情况。所以，这些脚本对开发者是有用的，由他们自己设置和维护，而且在任何时候都可以覆盖或修改这些脚本，后面讲如何把这部分东西也集成到开发流中。</p>\n<h4 id=\"E-mail工作流挂钩\"><a href=\"#E-mail工作流挂钩\" class=\"headerlink\" title=\"E-mail工作流挂钩\"></a>E-mail工作流挂钩</h4><p>有3个可用的客户端挂钩用于e-mail工作流。当运行 <code>git am</code> 命令时，会调用他们，因此，如果你没有在工作流中用到此命令，可以跳过本节。如果你通过e-mail接收由git format-patch 产生的补丁，这些挂钩也许对你有用。</p>\n<p>首先运行的是 applypatch-msg 挂钩，他接收一个参数：包含被建议提交信息的临时文件名。如果该脚本非零退出，Git 放弃此补丁。可以使用这个脚本确认提交信息是否被正确格式化，或让脚本编辑信息以达到标准化。</p>\n<p>下一个在git am 运行期间调用是 pre-applypatch 挂钩。该挂钩不接收参数，在补丁被运用之后运行，因此，可以被用来在提交前检查快照。你能用此脚本运行测试，检查工作树。如果有些什么遗漏，或测试没通过，脚本会以非零退出，放弃此次git am的运行，补丁不会被提交。</p>\n<p>最后在git am运行期间调用的是post-applypatch 挂钩。你可以用他来通知一个小组或获取的补丁的作者，但无法阻止打补丁的过程。</p>\n<h4 id=\"其他客户端挂钩\"><a href=\"#其他客户端挂钩\" class=\"headerlink\" title=\"其他客户端挂钩\"></a>其他客户端挂钩</h4><h5 id=\"pre-rebase\"><a href=\"#pre-rebase\" class=\"headerlink\" title=\"pre-rebase\"></a>pre-rebase</h5><p>pre-rebase挂钩在衍合前运行，脚本以非零退出可以中止衍合的过程。你可以使用这个挂钩来禁止衍合已经推送的提交对象，pre-rebase挂钩样本就是这么做的。该样本假定next是你定义的分支名，因此，你可能要修改样本，把next改成你定义过且稳定的分支名。</p>\n<p>比如说，如果你想彻底禁用rebase操作，你可以使用下面的pre-rebase脚本：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 禁用所有rebase</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;pre-rebase: Rebasing is dangerous. Don&#x27;t do it.&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span> 1</span><br></pre></td></tr></table></figure>\n\n<p>每次运行git rebase，你都会看到下面的信息：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pre-rebase: Rebasing is dangerous. Don&#x27;t do it.</span><br><span class=\"line\">The pre-rebase hook refused to rebase.</span><br></pre></td></tr></table></figure>\n\n<p>内置的pre-rebase.sample脚本是一个更复杂的例子。它在何时阻止rebase这方面更加智能。它会检查你当前的分支是否已经合并到了下一个分支中去（也就是主分支）。如果是的话，rebase可能会遇到问题，脚本会放弃这次rebase。</p>\n<h5 id=\"post-checkout\"><a href=\"#post-checkout\" class=\"headerlink\" title=\"post-checkout\"></a>post-checkout</h5><p>由git checkout命令调用，在完成工作区更新之后执行。该脚本由三个参数：之前HEAD指向的引用，新的HEAD指向的引用，一个用于标识此次检出是否是分支检出的值（0表示文件检出，1表示分支检出）。也可以被git clone触发调用，除非在克隆时使用参数–no-checkout。在由clone调用执行时，三个参数分别为null, 1, 1。这个脚本可以用于为自己的项目设置合适的工作区，比如自动生成文档、移动一些大型二进制文件等，也可以用于检查版本库的有效性。</p>\n<p>最后，在 merge 命令成功执行后，post-merge 挂钩会被调用。他可以用来在 Git 无法跟踪的工作树中恢复数据，诸如权限数据。该挂钩同样能够验证在 Git 控制之外的文件是否存在，因此，当工作树改变时，你想这些文件可以被复制。</p>\n<h3 id=\"服务器端-Hooks\"><a href=\"#服务器端-Hooks\" class=\"headerlink\" title=\"服务器端 Hooks\"></a>服务器端 Hooks</h3><p>除了客户端挂钩，作为系统管理员，你还可以使用两个服务器端的挂钩对项目实施各种类型的策略。这些挂钩脚本可以在提交对象推送到服务器前被调用，也可以在推送到服务器后被调用。推送到服务器前调用的挂钩可以在任何时候以非零退出，拒绝推送，返回错误消息给客户端，还可以如你所愿设置足够复杂的推送策略。</p>\n<h4 id=\"pre-receive\"><a href=\"#pre-receive\" class=\"headerlink\" title=\"pre-receive\"></a>pre-receive</h4><p>处理来自客户端的推送（push）操作时最先执行的脚本就是 pre-receive。它从标准输入（stdin）获取被推送引用的列表；如果它退出时的返回值不是0，所有推送内容都不会被接受。利用此挂钩脚本可以实现类似保证最新的索引中不包含非fast-forward 类型的这类效果；抑或检查执行推送操作的用户拥有创建，删除或者推送的权限或者他是否对将要修改的每一个文件都有访问权限。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> fileinput</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取用户试图更新的所有引用</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> fileinput.<span class=\"built_in\">input</span>():</span><br><span class=\"line\">    <span class=\"built_in\">print</span> <span class=\"string\">&quot;pre-receive: Trying to push ref: %s&quot;</span> % line</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 放弃推送</span></span><br><span class=\"line\"><span class=\"comment\"># sys.exit(1)</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"post-receive\"><a href=\"#post-receive\" class=\"headerlink\" title=\"post-receive\"></a>post-receive</h4><p>post-receive 挂钩在整个过程完结以后运行，可以用来更新其他系统服务或者通知用户。它接受与 pre-receive相同的标准输入数据。应用实例包括给某邮件列表发信，通知实时整合数据的服务器，或者更新软件项目的问题追踪系统 —— 甚至可以通过分析提交信息来决定某个问题是否应该被开启，修改或者关闭。该脚本无法组织推送进程，不过客户端在它完成运行之前将保持连接状态；所以在用它作一些消耗时间的操作之前请三思。</p>\n<h4 id=\"update\"><a href=\"#update\" class=\"headerlink\" title=\"update\"></a>update</h4><p>update脚本和pre-receive脚本十分类似。不同之处在于它会为推送者更新的每一个分支运行一次。假如推送者同时向多个分支推送内容，pre-receive 只运行一次，相比之下update 则会为每一个更新的分支运行一次。它不会从标准输入读取内容，而是接受三个参数：索引的名字（分支），推送前索引指向的内容的 SHA-1 值，以及用户试图推送内容的 SHA-1 值。如果 update 脚本以退出时返回非零值，只有相应的那一个索引会被拒绝；其余的依然会得到更新。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>参考链接：</p>\n<ul>\n<li><a href=\"https://www.cnblogs.com/jiaoshou/p/12222665.html\">https://www.cnblogs.com/jiaoshou/p/12222665.html</a></li>\n<li><a href=\"https://www.jianshu.com/p/f3f83872a801\">https://www.jianshu.com/p/f3f83872a801</a></li>\n</ul>\n"},{"title":"react-devtools 简单安装教程","date":"2022-05-14T06:12:55.000Z","description":"在进行React开发的过程中，React提供了官方的浏览器扩展插件React Devtools调试工具。","_content":"\n1. 首先打开官网：https://github.com/facebook/react-devtools；\n2. 进去v3分支，地址：https://github.com/facebook/react-devtools/tree/v3，直接download ZIP格式；\n3. 知道下载位置，解压到自己可以找见的目录下，进入到react-devtools-3目录，cnpm i一下安装一下依赖；\n4. 再进入到react-devtools-3\\shells\\chrome切换到chrome目录下，运行node build.js，当前目录下会生成build目录 这个build目录下的unpacked目录就是chrome中所需react-devtools的工具扩展程序包；\n5. 打开谷歌浏览器，网址输入chrome://extensions/， 选择react-detools-3目录下的shells->chrome中build目录中的unpacked即可。\n\n到此 react-devtools安装成功!\n\n","source":"_posts/react-devtools.md","raw":"---\ntitle: react-devtools 简单安装教程\ndate: 2022-05-14 14:12:55\ntags: react\ncategories: JavaScript\ndescription: 在进行React开发的过程中，React提供了官方的浏览器扩展插件React Devtools调试工具。\n---\n\n1. 首先打开官网：https://github.com/facebook/react-devtools；\n2. 进去v3分支，地址：https://github.com/facebook/react-devtools/tree/v3，直接download ZIP格式；\n3. 知道下载位置，解压到自己可以找见的目录下，进入到react-devtools-3目录，cnpm i一下安装一下依赖；\n4. 再进入到react-devtools-3\\shells\\chrome切换到chrome目录下，运行node build.js，当前目录下会生成build目录 这个build目录下的unpacked目录就是chrome中所需react-devtools的工具扩展程序包；\n5. 打开谷歌浏览器，网址输入chrome://extensions/， 选择react-detools-3目录下的shells->chrome中build目录中的unpacked即可。\n\n到此 react-devtools安装成功!\n\n","slug":"react-devtools","published":1,"updated":"2022-05-14T06:15:57.328Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsi9002dyt8wf6okb2ep","content":"<ol>\n<li>首先打开官网：<a href=\"https://github.com/facebook/react-devtools%EF%BC%9B\">https://github.com/facebook/react-devtools；</a></li>\n<li>进去v3分支，地址：<a href=\"https://github.com/facebook/react-devtools/tree/v3%EF%BC%8C%E7%9B%B4%E6%8E%A5download\">https://github.com/facebook/react-devtools/tree/v3，直接download</a> ZIP格式；</li>\n<li>知道下载位置，解压到自己可以找见的目录下，进入到react-devtools-3目录，cnpm i一下安装一下依赖；</li>\n<li>再进入到react-devtools-3\\shells\\chrome切换到chrome目录下，运行node build.js，当前目录下会生成build目录 这个build目录下的unpacked目录就是chrome中所需react-devtools的工具扩展程序包；</li>\n<li>打开谷歌浏览器，网址输入chrome:&#x2F;&#x2F;extensions&#x2F;， 选择react-detools-3目录下的shells-&gt;chrome中build目录中的unpacked即可。</li>\n</ol>\n<p>到此 react-devtools安装成功!</p>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li>首先打开官网：<a href=\"https://github.com/facebook/react-devtools%EF%BC%9B\">https://github.com/facebook/react-devtools；</a></li>\n<li>进去v3分支，地址：<a href=\"https://github.com/facebook/react-devtools/tree/v3%EF%BC%8C%E7%9B%B4%E6%8E%A5download\">https://github.com/facebook/react-devtools/tree/v3，直接download</a> ZIP格式；</li>\n<li>知道下载位置，解压到自己可以找见的目录下，进入到react-devtools-3目录，cnpm i一下安装一下依赖；</li>\n<li>再进入到react-devtools-3\\shells\\chrome切换到chrome目录下，运行node build.js，当前目录下会生成build目录 这个build目录下的unpacked目录就是chrome中所需react-devtools的工具扩展程序包；</li>\n<li>打开谷歌浏览器，网址输入chrome:&#x2F;&#x2F;extensions&#x2F;， 选择react-detools-3目录下的shells-&gt;chrome中build目录中的unpacked即可。</li>\n</ol>\n<p>到此 react-devtools安装成功!</p>\n"},{"title":"使用 eslint + prettier + husky 打造规范化项目","date":"2023-03-11T16:58:24.000Z","description":"无论项目是个人开发还是多人开发，都应该有一个规范的代码格式。统一规范的代码风格在前端工程化中也是必不可少的一部分，项目初期如果没有定义好的代码规范，后期维护起来会非常难受，而 Husky 可以在项目中通过管理Git Hooks帮助我们检查代码规范。","_content":"\n## 准备\n使用vue-ts模板创建项目，由于该篇文章的重点不是项目的搭建，所以这里就简单带过。\n\n```sh\nnpm create vite my-vue-app --template vue-ts\n```\n\n## 为什么需要eslint和prettier\n\nESLint是一个用来识别 ECMAScript 并且按照规则给出报告的代码检测工具，使用它可以避免低级错误和统一代码的风格。如果每次在代码提交之前都进行一次eslint代码检查，就不会因为某个字段未定义为undefined或null这样的错误而导致服务崩溃，可以有效的控制项目代码的质量。\n\nPrettier 是一个有主见的代码格式化程序。用来批量处理代码的统一，涉及引号，分号，换行，缩进。支持目前大部分语言处理，包括 JavaScript，Flow，TypeScript，CSS，SCSS，Less，JSX，Vue，GraphQL，JSON，Markdown。简而言之，这个工具能够使输出代码保持风格一致。\n\n简单来说，就是eslint可以保证项目的质量，prettier可以保证项目的统一格式、风格。\n\n## 配置eslint\n\n执行安装命令：\n\n```sh\npnpm add eslint -D\n```\n\n执行eslint初始化命令：\n\n```sh\npnpm eslint --init\n```\n\n依次初始化选项（根据项目情况选择）：\n\n```sh\n(1) How would you like to use ESLint?\n选择：To check syntax and find problems\n\n(2) What type of modules does your project use?\n选择：JavaScript modules (import/export)\n\n(3) Which framework does your project use?\n选择：Vue.js\n\n(4) Does your project use TypeScript?\n选择：Yes\n\n(5) Where does your code run?\n选择：Browser\n\n(6) What format do you want your config file to be in?\n选择：JavaScript\n\n(7) Would you like to install them now?\n选择：Yes\n\n(8) Which package manager do you want to use?\n选择：pnpm\n```\n\n依赖安装完成后，会生成.eslintrc.js配置文件：\n\n```js\nmodule.exports = {\n    \"env\": {\n        \"browser\": true,\n        \"es2021\": true\n    },\n    \"extends\": [\n        \"eslint:recommended\",\n        \"plugin:vue/vue3-essential\",\n        \"plugin:@typescript-eslint/recommended\"\n    ],\n    \"parserOptions\": {\n        \"ecmaVersion\": \"latest\",\n        \"parser\": \"@typescript-eslint/parser\",\n        \"sourceType\": \"module\"\n    },\n    \"plugins\": [\n        \"vue\",\n        \"@typescript-eslint\"\n    ],\n    \"rules\": {\n    }\n}\n```\n\n此时打开.eslintrc.js配置文件会出现一个报错，需要再env字段中增加node: true配置以解决eslint找不到module的报错\n\n```diff\n\"env\": {\n    \"browser\": true,\n    \"es2021\": true,\n    // 新增\n+        \"node\": true\n},\n```\n\n在package.json文件中的script中添加lint命令：\n\n```json\n{\n    \"scripts\": {\n        // eslint . 为指定lint当前项目中的文件\n        // --ext 为指定lint哪些后缀的文件\n        // --fix 开启自动修复\n        \"lint\": \"eslint . --ext .vue,.js,.ts,.jsx,.tsx --fix\"\n    }\n}\n```\n\n执行lint命令：\n\n```sh\npnpm lint\n```\n\n这时候命令行中会显示出报错，意思就是在解析.vue后缀的文件时候出现解析错误parsing error。\n\n查阅资料后发现，eslint默认是不会解析.vue后缀文件的。因此，需要一个额外的解析器来解析.vue后缀文件。\n\n但是我们查看.eslintrc.js文件中的extends会发现已经有继承\"plugin:vue/vue3-essential\"的配置。然后在node_modules中可以找到eslint-plugin-vue/lib/cinfigs/essential，里面配置了extends是继承于同级目录下的base.js，在里面会发现parser: require.resolve('vue-eslint-parser')这个配置。因此，按道理来说应该是会解析.vue后缀文件的。\n\n继续往下看.eslintrc.js文件中的extends会发现，extends中还有一个\"plugin:@typescript-eslint/recommended\"，它是来自于/node_modules/@typescript-eslint/eslint-plugin/dist/configs/recommended.js，查看该文件会发现最终继承于同级目录下的base.js文件。从该文件中可以发现parser: '@typescript-eslint/parser',配置。\n\n按照.eslintrc.js文件中的extends配置的顺序可知，最终导致报错的原因就是@typescript-eslint/parser把vue-eslint-parser覆盖了。\n\n```json\n{\n    \"extends\": [\n        \"eslint:recommended\",\n        \"plugin:vue/vue3-essential\",\n        \"plugin:@typescript-eslint/recommended\"\n    ],\n}\n```\n\n查看eslint-plugin-vue官方文档可知。如果已经使用了另外的解析器（例如\"parser\": \"@typescript-eslint/parser\"），则需要将其移至parseOptions，这样才不会与vue-eslint-parser冲突。\n\n修改.eslintrc.js文件：\n\n```js\nmodule.exports = {\n    \"env\": {\n        \"browser\": true,\n        \"es2021\": true,\n        \"node\": true\n    },\n    \"extends\": [\n        \"eslint:recommended\",\n        \"plugin:vue/vue3-essential\",\n        \"plugin:@typescript-eslint/recommended\"\n    ],\n    \"parser\": \"vue-eslint-parser\",\n    \"parserOptions\": {\n        \"ecmaVersion\": \"latest\",\n        \"parser\": \"@typescript-eslint/parser\",\n        \"sourceType\": \"module\"\n    },\n    \"plugins\": [\n        \"vue\",\n        \"@typescript-eslint\"\n    ],\n    \"rules\": {\n    }\n}\n```\n\n两个parser的区别在于，外面的parser用来解析.vue后缀文件，使得eslint能解析 `<template>` 标签中的内容，而parserOptions中的parser，即@typescript-eslint/parser用来解析vue文件中 `<script>` 标签中的代码。\n\n此时，再执行pnpm lint，就会发现校验通过了。\n\n**安装vscode插件ESLint**\n\n如果写一行代码就要执行一遍lint命令，这效率就太低了。所以我们可以配合vscode的ESLint插件，实现每次保存代码时，自动执行lint命令来修复代码的错误。\n在项目中新建.vscode/settings.json文件，然后在其中加入以下配置。\n\n```json\n{\n    // 开启自动修复\n    \"editor.codeActionsOnSave\": {\n        \"source.fixAll\": false,\n        \"source.fixAll.eslint\": true\n    }\n}\n```\n\n安装依赖说明：\n\n- eslint： JavaScript 和 JSX 检查工具\n- eslint-plugin-vue： 使用 ESLint 检查 .vue文件 的 `<template>` 和 `<script>`，以及.js文件中的Vue代码\n\n\n## 配置prettier\n\n执行安装命令：\n\n```sh\npnpm add prettier -D\n```\n\n在根目录下新建.prettierrc.js\n\n添加以下配置，更多配置可查看[官方文档](https://prettier.io/docs/en/options.html)\n\n```js\nmodule.exports = {\n    // 一行的字符数，如果超过会进行换行，默认为80\n    printWidth: 80, \n    // 一个tab代表几个空格数，默认为80\n    tabWidth: 2, \n    // 是否使用tab进行缩进，默认为false，表示用空格进行缩减\n    useTabs: false, \n    // 字符串是否使用单引号，默认为false，使用双引号\n    singleQuote: true, \n    // 行位是否使用分号，默认为true\n    semi: false, \n    // 是否使用尾逗号，有三个可选值\"<none|es5|all>\"\n    trailingComma: \"none\", \n    // 对象大括号直接是否有空格，默认为true，效果：{ foo: bar }\n    bracketSpacing: true\n}\n```\n\n在package.json中的script中添加以下命令：\n\n```json\n{\n    \"scripts\": {\n        \"format\": \"prettier --write \\\"./**/*.{html,vue,ts,js,json,md}\\\"\",\n    }\n}\n```\n\n运行该命令，会将我们项目中的文件都格式化一遍，后续如果添加其他格式的文件，可在该命令中添加，例如：.less后缀的文件\n\n**安装vscode的Prettier - Code formatter插件**\n\n安装该插件的目的是，让该插件在我们保存的时候自动完成格式化\n\n在.vscode/settings.json中添加一下规则\n\n```json\n{\n    // 保存的时候自动格式化\n    \"editor.formatOnSave\": true,\n    // 默认格式化工具选择prettier\n    \"editor.defaultFormatter\": \"esbenp.prettier-vscode\"\n}\n```\n\n## 解决eslint与prettier的冲突\n\n在理想的状态下，eslint与prettier应该各司其职。eslint负责我们的代码质量，prettier负责我们的代码格式。但是在使用的过程中会发现，由于我们开启了自动化的eslint修复与自动化的根据prettier来格式化代码。所以我们已保存代码，会出现屏幕闪一起后又恢复到了报错的状态。\n\n这其中的根本原因就是eslint有部分规则与prettier冲突了，所以保存的时候显示运行了eslint的修复命令，然后再运行prettier格式化，所以就会出现屏幕闪一下然后又恢复到报错的现象。这时候你可以检查一下是否存在冲突的规则。\n\n查阅资料会发现，社区已经为我们提供了一个非常成熟的方案，即eslint-config-prettier + eslint-plugin-prettier。\n\n- eslint-plugin-prettier： 基于 prettier 代码风格的 eslint 规则，即eslint使用pretter规则来格式化代码。\n- eslint-config-prettier： 禁用所有与格式相关的 eslint 规则，解决 prettier 与 eslint 规则冲突，确保将其放在 extends 队列最后，这样它将覆盖其他配置\n\n安装依赖：\n\n```sh\npnpm add eslint-config-prettier eslint-plugin-prettier -D\n```\n\n在 .eslintrc.json中extends的最后添加一个配置：\n\n```diff\n{ \n    extends: [\n    'eslint:recommended',\n    'plugin:vue/vue3-essential',\n    'plugin:@typescript-eslint/recommended',\n+    // 新增，必须放在最后面\n+    'plugin:prettier/recommended' \n  ],\n}\n```\n\n最后重启vscode，你会发现冲突消失了，eslint与prettier也按照我们预想的各司其职了。\n\n\n## 配置styleling\n\nstylelint为css的lint工具。可格式化css代码，检查css语法错误与不合理的写法，指定css书写顺序等...\n\n**安装依赖**\n\n由于我的项目使用的less预处理器，因此配置的为less相关的，项目中使用其他预处理器的可以按照该配置方法改一下就好\n\nstylelint v13版本将css, parse CSS(如SCSS,SASS),html内的css(如*.vue中的style)等编译工具都包含在内。但是v14版本没有包含在内，所以需要安装需要的工具\n\n```sh\npnpm add stylelint postcss postcss-less postcss-html stylelint-config-prettier stylelint-config-recommended-less stylelint-config-standard stylelint-config-standard-vue stylelint-less stylelint-order -D\n```\n\n依赖说明：\n\n- stylelint: css样式lint工具\n- postcss: 转换css代码工具\n- postcss-less: 识别less语法\n- postcss-html: 识别html/vue 中的<style></style>标签中的样式\n- stylelint-config-standard: Stylelint的标准可共享配置规则，详细可查看官方文档\n- stylelint-config-prettier: 关闭所有不必要或可能与Prettier冲突的规则\n- stylelint-config-recommended-less: less的推荐可共享配置规则，详细可查看官方文档\n- stylelint-config-standard-vue: lint.vue文件的样式配置\n- stylelint-less: stylelint-config-recommended-less的依赖，less的stylelint规则集合\n- stylelint-order: 指定样式书写的顺序，在.stylelintrc.js中order/properties-order指定顺序\n\n增加.stylelintrc.js配置文件\n\n```js\nmodule.exports = {\n  extends: [\n    'stylelint-config-standard',\n    'stylelint-config-prettier',\n    'stylelint-config-recommended-less',\n    'stylelint-config-standard-vue'\n  ],\n  plugins: ['stylelint-order'],\n  // 不同格式的文件指定自定义语法\n  overrides: [\n    {\n      files: ['**/*.(less|css|vue|html)'],\n      customSyntax: 'postcss-less'\n    },\n    {\n      files: ['**/*.(html|vue)'],\n      customSyntax: 'postcss-html'\n    }\n  ],\n  ignoreFiles: [\n    '**/*.js',\n    '**/*.jsx',\n    '**/*.tsx',\n    '**/*.ts',\n    '**/*.json',\n    '**/*.md',\n    '**/*.yaml'\n  ],\n  rules: {\n    'no-descending-specificity': null, // 禁止在具有较高优先级的选择器后出现被其覆盖的较低优先级的选择器\n    'selector-pseudo-element-no-unknown': [\n      true,\n      {\n        ignorePseudoElements: ['v-deep']\n      }\n    ],\n    'selector-pseudo-class-no-unknown': [\n      true,\n      {\n        ignorePseudoClasses: ['deep']\n      }\n    ],\n    // 指定样式的排序\n    'order/properties-order': [\n      'position',\n      'top',\n      'right',\n      'bottom',\n      'left',\n      'z-index',\n      'display',\n      'justify-content',\n      'align-items',\n      'float',\n      'clear',\n      'overflow',\n      'overflow-x',\n      'overflow-y',\n      'padding',\n      'padding-top',\n      'padding-right',\n      'padding-bottom',\n      'padding-left',\n      'margin',\n      'margin-top',\n      'margin-right',\n      'margin-bottom',\n      'margin-left',\n      'width',\n      'min-width',\n      'max-width',\n      'height',\n      'min-height',\n      'max-height',\n      'font-size',\n      'font-family',\n      'text-align',\n      'text-justify',\n      'text-indent',\n      'text-overflow',\n      'text-decoration',\n      'white-space',\n      'color',\n      'background',\n      'background-position',\n      'background-repeat',\n      'background-size',\n      'background-color',\n      'background-clip',\n      'border',\n      'border-style',\n      'border-width',\n      'border-color',\n      'border-top-style',\n      'border-top-width',\n      'border-top-color',\n      'border-right-style',\n      'border-right-width',\n      'border-right-color',\n      'border-bottom-style',\n      'border-bottom-width',\n      'border-bottom-color',\n      'border-left-style',\n      'border-left-width',\n      'border-left-color',\n      'border-radius',\n      'opacity',\n      'filter',\n      'list-style',\n      'outline',\n      'visibility',\n      'box-shadow',\n      'text-shadow',\n      'resize',\n      'transition'\n    ]\n  }\n}\n```\n\n安装vscode的Stylelint插件\n\n安装该插件可在我们保存代码时自动执行stylelint\n\n在.vscode/settings.json中添加一下规则\n\n```diff\n{\n  // 开启自动修复\n  \"editor.codeActionsOnSave\": {\n    \"source.fixAll\": false,\n    \"source.fixAll.eslint\": true,\n+   \"source.fixAll.stylelint\": true\n  },\n  // 保存的时候自动格式化\n  \"editor.formatOnSave\": true,\n  // 默认格式化工具选择prettier\n  \"editor.defaultFormatter\": \"esbenp.prettier-vscode\",\n  // 配置该项，新建文件时默认就是space：2\n  \"editor.tabSize\": 2,\n  // stylelint校验的文件格式\n+ \"stylelint.validate\": [\"css\", \"less\", \"vue\", \"html\"]\n}\n```\n\n## 配置husky\n\n> You can use it to **lint your commit messages**, **run tests**, **lint code**, etc... when you commit or push. Husky supports all Git hooks.\n\n虽然上面已经配置好了eslint、preitter与stylelint，但是还是存在以下问题。\n\n对于不使用vscode的，或者没有安装eslint、preitter与stylelint插件的同学来说，就不能实现在保存的时候自动的去修复与和格式化代码。\n\n这样提交到git仓库的代码还是不符合要求的。因此需要引入强制的手段来保证提交到git仓库的代码时符合我们的要求的。\n\nhusky是一个用来管理git hook的工具，git hook即在我们使用git提交代码的过程中会触发的钩子。\n\n\n安装依赖\n\n```sh\npnpm add husky -D\n```\n\n在package.json中的script中添加一条脚本命令\n\n```json\n{\n    \"scripts\": {\n        \"prepare\": \"husky install\"\n    },\n}\n```\n\n该命令会在pnpm install之后运行，这样其他克隆该项目的同学就在装包的时候就会自动执行该命令来安装husky。这里我们就不重新执行pnpm install了，直接执行pnpm prepare，这个时候你会发现多了一个.husky目录。\n\n然后使用husky命令添加pre-commit钩子，运行\n\n```sh\npnpm husky add .husky/pre-commit \"pnpm lint && pnpm format && pnpm lint:style\"\n```\n\n执行完上面的命令后，会在.husky目录下生成一个pre-commit文件\n\n```sh\n#!/usr/bin/env sh\n. \"$(dirname -- \"$0\")/_/husky.sh\"\n\npnpm lint && pnpm format\n```\n\n现在当我们执行git commit的时候就会执行pnpm lint与pnpm format，当这两条命令出现报错，就不会提交成功。以此来保证提交代码的质量和格式。\n\n\n## 最后\n\n本篇文章主要是以一个vue-ts-vite的项目的搭建为基础，在项目中引入eslint + prettier + husky来规范项目。完整的代码上传至github，[点击此处](https://github.com/yusongh/vue3-ts-vite-eslint-prettier)可以查看完整代码。","source":"_posts/project-husky.md","raw":"---\ntitle: 使用 eslint + prettier + husky 打造规范化项目\ndate: 2023-03-12 00:58:24\ntags: 工程化\ncategories: 工程化\ndescription: 无论项目是个人开发还是多人开发，都应该有一个规范的代码格式。统一规范的代码风格在前端工程化中也是必不可少的一部分，项目初期如果没有定义好的代码规范，后期维护起来会非常难受，而 Husky 可以在项目中通过管理Git Hooks帮助我们检查代码规范。\n---\n\n## 准备\n使用vue-ts模板创建项目，由于该篇文章的重点不是项目的搭建，所以这里就简单带过。\n\n```sh\nnpm create vite my-vue-app --template vue-ts\n```\n\n## 为什么需要eslint和prettier\n\nESLint是一个用来识别 ECMAScript 并且按照规则给出报告的代码检测工具，使用它可以避免低级错误和统一代码的风格。如果每次在代码提交之前都进行一次eslint代码检查，就不会因为某个字段未定义为undefined或null这样的错误而导致服务崩溃，可以有效的控制项目代码的质量。\n\nPrettier 是一个有主见的代码格式化程序。用来批量处理代码的统一，涉及引号，分号，换行，缩进。支持目前大部分语言处理，包括 JavaScript，Flow，TypeScript，CSS，SCSS，Less，JSX，Vue，GraphQL，JSON，Markdown。简而言之，这个工具能够使输出代码保持风格一致。\n\n简单来说，就是eslint可以保证项目的质量，prettier可以保证项目的统一格式、风格。\n\n## 配置eslint\n\n执行安装命令：\n\n```sh\npnpm add eslint -D\n```\n\n执行eslint初始化命令：\n\n```sh\npnpm eslint --init\n```\n\n依次初始化选项（根据项目情况选择）：\n\n```sh\n(1) How would you like to use ESLint?\n选择：To check syntax and find problems\n\n(2) What type of modules does your project use?\n选择：JavaScript modules (import/export)\n\n(3) Which framework does your project use?\n选择：Vue.js\n\n(4) Does your project use TypeScript?\n选择：Yes\n\n(5) Where does your code run?\n选择：Browser\n\n(6) What format do you want your config file to be in?\n选择：JavaScript\n\n(7) Would you like to install them now?\n选择：Yes\n\n(8) Which package manager do you want to use?\n选择：pnpm\n```\n\n依赖安装完成后，会生成.eslintrc.js配置文件：\n\n```js\nmodule.exports = {\n    \"env\": {\n        \"browser\": true,\n        \"es2021\": true\n    },\n    \"extends\": [\n        \"eslint:recommended\",\n        \"plugin:vue/vue3-essential\",\n        \"plugin:@typescript-eslint/recommended\"\n    ],\n    \"parserOptions\": {\n        \"ecmaVersion\": \"latest\",\n        \"parser\": \"@typescript-eslint/parser\",\n        \"sourceType\": \"module\"\n    },\n    \"plugins\": [\n        \"vue\",\n        \"@typescript-eslint\"\n    ],\n    \"rules\": {\n    }\n}\n```\n\n此时打开.eslintrc.js配置文件会出现一个报错，需要再env字段中增加node: true配置以解决eslint找不到module的报错\n\n```diff\n\"env\": {\n    \"browser\": true,\n    \"es2021\": true,\n    // 新增\n+        \"node\": true\n},\n```\n\n在package.json文件中的script中添加lint命令：\n\n```json\n{\n    \"scripts\": {\n        // eslint . 为指定lint当前项目中的文件\n        // --ext 为指定lint哪些后缀的文件\n        // --fix 开启自动修复\n        \"lint\": \"eslint . --ext .vue,.js,.ts,.jsx,.tsx --fix\"\n    }\n}\n```\n\n执行lint命令：\n\n```sh\npnpm lint\n```\n\n这时候命令行中会显示出报错，意思就是在解析.vue后缀的文件时候出现解析错误parsing error。\n\n查阅资料后发现，eslint默认是不会解析.vue后缀文件的。因此，需要一个额外的解析器来解析.vue后缀文件。\n\n但是我们查看.eslintrc.js文件中的extends会发现已经有继承\"plugin:vue/vue3-essential\"的配置。然后在node_modules中可以找到eslint-plugin-vue/lib/cinfigs/essential，里面配置了extends是继承于同级目录下的base.js，在里面会发现parser: require.resolve('vue-eslint-parser')这个配置。因此，按道理来说应该是会解析.vue后缀文件的。\n\n继续往下看.eslintrc.js文件中的extends会发现，extends中还有一个\"plugin:@typescript-eslint/recommended\"，它是来自于/node_modules/@typescript-eslint/eslint-plugin/dist/configs/recommended.js，查看该文件会发现最终继承于同级目录下的base.js文件。从该文件中可以发现parser: '@typescript-eslint/parser',配置。\n\n按照.eslintrc.js文件中的extends配置的顺序可知，最终导致报错的原因就是@typescript-eslint/parser把vue-eslint-parser覆盖了。\n\n```json\n{\n    \"extends\": [\n        \"eslint:recommended\",\n        \"plugin:vue/vue3-essential\",\n        \"plugin:@typescript-eslint/recommended\"\n    ],\n}\n```\n\n查看eslint-plugin-vue官方文档可知。如果已经使用了另外的解析器（例如\"parser\": \"@typescript-eslint/parser\"），则需要将其移至parseOptions，这样才不会与vue-eslint-parser冲突。\n\n修改.eslintrc.js文件：\n\n```js\nmodule.exports = {\n    \"env\": {\n        \"browser\": true,\n        \"es2021\": true,\n        \"node\": true\n    },\n    \"extends\": [\n        \"eslint:recommended\",\n        \"plugin:vue/vue3-essential\",\n        \"plugin:@typescript-eslint/recommended\"\n    ],\n    \"parser\": \"vue-eslint-parser\",\n    \"parserOptions\": {\n        \"ecmaVersion\": \"latest\",\n        \"parser\": \"@typescript-eslint/parser\",\n        \"sourceType\": \"module\"\n    },\n    \"plugins\": [\n        \"vue\",\n        \"@typescript-eslint\"\n    ],\n    \"rules\": {\n    }\n}\n```\n\n两个parser的区别在于，外面的parser用来解析.vue后缀文件，使得eslint能解析 `<template>` 标签中的内容，而parserOptions中的parser，即@typescript-eslint/parser用来解析vue文件中 `<script>` 标签中的代码。\n\n此时，再执行pnpm lint，就会发现校验通过了。\n\n**安装vscode插件ESLint**\n\n如果写一行代码就要执行一遍lint命令，这效率就太低了。所以我们可以配合vscode的ESLint插件，实现每次保存代码时，自动执行lint命令来修复代码的错误。\n在项目中新建.vscode/settings.json文件，然后在其中加入以下配置。\n\n```json\n{\n    // 开启自动修复\n    \"editor.codeActionsOnSave\": {\n        \"source.fixAll\": false,\n        \"source.fixAll.eslint\": true\n    }\n}\n```\n\n安装依赖说明：\n\n- eslint： JavaScript 和 JSX 检查工具\n- eslint-plugin-vue： 使用 ESLint 检查 .vue文件 的 `<template>` 和 `<script>`，以及.js文件中的Vue代码\n\n\n## 配置prettier\n\n执行安装命令：\n\n```sh\npnpm add prettier -D\n```\n\n在根目录下新建.prettierrc.js\n\n添加以下配置，更多配置可查看[官方文档](https://prettier.io/docs/en/options.html)\n\n```js\nmodule.exports = {\n    // 一行的字符数，如果超过会进行换行，默认为80\n    printWidth: 80, \n    // 一个tab代表几个空格数，默认为80\n    tabWidth: 2, \n    // 是否使用tab进行缩进，默认为false，表示用空格进行缩减\n    useTabs: false, \n    // 字符串是否使用单引号，默认为false，使用双引号\n    singleQuote: true, \n    // 行位是否使用分号，默认为true\n    semi: false, \n    // 是否使用尾逗号，有三个可选值\"<none|es5|all>\"\n    trailingComma: \"none\", \n    // 对象大括号直接是否有空格，默认为true，效果：{ foo: bar }\n    bracketSpacing: true\n}\n```\n\n在package.json中的script中添加以下命令：\n\n```json\n{\n    \"scripts\": {\n        \"format\": \"prettier --write \\\"./**/*.{html,vue,ts,js,json,md}\\\"\",\n    }\n}\n```\n\n运行该命令，会将我们项目中的文件都格式化一遍，后续如果添加其他格式的文件，可在该命令中添加，例如：.less后缀的文件\n\n**安装vscode的Prettier - Code formatter插件**\n\n安装该插件的目的是，让该插件在我们保存的时候自动完成格式化\n\n在.vscode/settings.json中添加一下规则\n\n```json\n{\n    // 保存的时候自动格式化\n    \"editor.formatOnSave\": true,\n    // 默认格式化工具选择prettier\n    \"editor.defaultFormatter\": \"esbenp.prettier-vscode\"\n}\n```\n\n## 解决eslint与prettier的冲突\n\n在理想的状态下，eslint与prettier应该各司其职。eslint负责我们的代码质量，prettier负责我们的代码格式。但是在使用的过程中会发现，由于我们开启了自动化的eslint修复与自动化的根据prettier来格式化代码。所以我们已保存代码，会出现屏幕闪一起后又恢复到了报错的状态。\n\n这其中的根本原因就是eslint有部分规则与prettier冲突了，所以保存的时候显示运行了eslint的修复命令，然后再运行prettier格式化，所以就会出现屏幕闪一下然后又恢复到报错的现象。这时候你可以检查一下是否存在冲突的规则。\n\n查阅资料会发现，社区已经为我们提供了一个非常成熟的方案，即eslint-config-prettier + eslint-plugin-prettier。\n\n- eslint-plugin-prettier： 基于 prettier 代码风格的 eslint 规则，即eslint使用pretter规则来格式化代码。\n- eslint-config-prettier： 禁用所有与格式相关的 eslint 规则，解决 prettier 与 eslint 规则冲突，确保将其放在 extends 队列最后，这样它将覆盖其他配置\n\n安装依赖：\n\n```sh\npnpm add eslint-config-prettier eslint-plugin-prettier -D\n```\n\n在 .eslintrc.json中extends的最后添加一个配置：\n\n```diff\n{ \n    extends: [\n    'eslint:recommended',\n    'plugin:vue/vue3-essential',\n    'plugin:@typescript-eslint/recommended',\n+    // 新增，必须放在最后面\n+    'plugin:prettier/recommended' \n  ],\n}\n```\n\n最后重启vscode，你会发现冲突消失了，eslint与prettier也按照我们预想的各司其职了。\n\n\n## 配置styleling\n\nstylelint为css的lint工具。可格式化css代码，检查css语法错误与不合理的写法，指定css书写顺序等...\n\n**安装依赖**\n\n由于我的项目使用的less预处理器，因此配置的为less相关的，项目中使用其他预处理器的可以按照该配置方法改一下就好\n\nstylelint v13版本将css, parse CSS(如SCSS,SASS),html内的css(如*.vue中的style)等编译工具都包含在内。但是v14版本没有包含在内，所以需要安装需要的工具\n\n```sh\npnpm add stylelint postcss postcss-less postcss-html stylelint-config-prettier stylelint-config-recommended-less stylelint-config-standard stylelint-config-standard-vue stylelint-less stylelint-order -D\n```\n\n依赖说明：\n\n- stylelint: css样式lint工具\n- postcss: 转换css代码工具\n- postcss-less: 识别less语法\n- postcss-html: 识别html/vue 中的<style></style>标签中的样式\n- stylelint-config-standard: Stylelint的标准可共享配置规则，详细可查看官方文档\n- stylelint-config-prettier: 关闭所有不必要或可能与Prettier冲突的规则\n- stylelint-config-recommended-less: less的推荐可共享配置规则，详细可查看官方文档\n- stylelint-config-standard-vue: lint.vue文件的样式配置\n- stylelint-less: stylelint-config-recommended-less的依赖，less的stylelint规则集合\n- stylelint-order: 指定样式书写的顺序，在.stylelintrc.js中order/properties-order指定顺序\n\n增加.stylelintrc.js配置文件\n\n```js\nmodule.exports = {\n  extends: [\n    'stylelint-config-standard',\n    'stylelint-config-prettier',\n    'stylelint-config-recommended-less',\n    'stylelint-config-standard-vue'\n  ],\n  plugins: ['stylelint-order'],\n  // 不同格式的文件指定自定义语法\n  overrides: [\n    {\n      files: ['**/*.(less|css|vue|html)'],\n      customSyntax: 'postcss-less'\n    },\n    {\n      files: ['**/*.(html|vue)'],\n      customSyntax: 'postcss-html'\n    }\n  ],\n  ignoreFiles: [\n    '**/*.js',\n    '**/*.jsx',\n    '**/*.tsx',\n    '**/*.ts',\n    '**/*.json',\n    '**/*.md',\n    '**/*.yaml'\n  ],\n  rules: {\n    'no-descending-specificity': null, // 禁止在具有较高优先级的选择器后出现被其覆盖的较低优先级的选择器\n    'selector-pseudo-element-no-unknown': [\n      true,\n      {\n        ignorePseudoElements: ['v-deep']\n      }\n    ],\n    'selector-pseudo-class-no-unknown': [\n      true,\n      {\n        ignorePseudoClasses: ['deep']\n      }\n    ],\n    // 指定样式的排序\n    'order/properties-order': [\n      'position',\n      'top',\n      'right',\n      'bottom',\n      'left',\n      'z-index',\n      'display',\n      'justify-content',\n      'align-items',\n      'float',\n      'clear',\n      'overflow',\n      'overflow-x',\n      'overflow-y',\n      'padding',\n      'padding-top',\n      'padding-right',\n      'padding-bottom',\n      'padding-left',\n      'margin',\n      'margin-top',\n      'margin-right',\n      'margin-bottom',\n      'margin-left',\n      'width',\n      'min-width',\n      'max-width',\n      'height',\n      'min-height',\n      'max-height',\n      'font-size',\n      'font-family',\n      'text-align',\n      'text-justify',\n      'text-indent',\n      'text-overflow',\n      'text-decoration',\n      'white-space',\n      'color',\n      'background',\n      'background-position',\n      'background-repeat',\n      'background-size',\n      'background-color',\n      'background-clip',\n      'border',\n      'border-style',\n      'border-width',\n      'border-color',\n      'border-top-style',\n      'border-top-width',\n      'border-top-color',\n      'border-right-style',\n      'border-right-width',\n      'border-right-color',\n      'border-bottom-style',\n      'border-bottom-width',\n      'border-bottom-color',\n      'border-left-style',\n      'border-left-width',\n      'border-left-color',\n      'border-radius',\n      'opacity',\n      'filter',\n      'list-style',\n      'outline',\n      'visibility',\n      'box-shadow',\n      'text-shadow',\n      'resize',\n      'transition'\n    ]\n  }\n}\n```\n\n安装vscode的Stylelint插件\n\n安装该插件可在我们保存代码时自动执行stylelint\n\n在.vscode/settings.json中添加一下规则\n\n```diff\n{\n  // 开启自动修复\n  \"editor.codeActionsOnSave\": {\n    \"source.fixAll\": false,\n    \"source.fixAll.eslint\": true,\n+   \"source.fixAll.stylelint\": true\n  },\n  // 保存的时候自动格式化\n  \"editor.formatOnSave\": true,\n  // 默认格式化工具选择prettier\n  \"editor.defaultFormatter\": \"esbenp.prettier-vscode\",\n  // 配置该项，新建文件时默认就是space：2\n  \"editor.tabSize\": 2,\n  // stylelint校验的文件格式\n+ \"stylelint.validate\": [\"css\", \"less\", \"vue\", \"html\"]\n}\n```\n\n## 配置husky\n\n> You can use it to **lint your commit messages**, **run tests**, **lint code**, etc... when you commit or push. Husky supports all Git hooks.\n\n虽然上面已经配置好了eslint、preitter与stylelint，但是还是存在以下问题。\n\n对于不使用vscode的，或者没有安装eslint、preitter与stylelint插件的同学来说，就不能实现在保存的时候自动的去修复与和格式化代码。\n\n这样提交到git仓库的代码还是不符合要求的。因此需要引入强制的手段来保证提交到git仓库的代码时符合我们的要求的。\n\nhusky是一个用来管理git hook的工具，git hook即在我们使用git提交代码的过程中会触发的钩子。\n\n\n安装依赖\n\n```sh\npnpm add husky -D\n```\n\n在package.json中的script中添加一条脚本命令\n\n```json\n{\n    \"scripts\": {\n        \"prepare\": \"husky install\"\n    },\n}\n```\n\n该命令会在pnpm install之后运行，这样其他克隆该项目的同学就在装包的时候就会自动执行该命令来安装husky。这里我们就不重新执行pnpm install了，直接执行pnpm prepare，这个时候你会发现多了一个.husky目录。\n\n然后使用husky命令添加pre-commit钩子，运行\n\n```sh\npnpm husky add .husky/pre-commit \"pnpm lint && pnpm format && pnpm lint:style\"\n```\n\n执行完上面的命令后，会在.husky目录下生成一个pre-commit文件\n\n```sh\n#!/usr/bin/env sh\n. \"$(dirname -- \"$0\")/_/husky.sh\"\n\npnpm lint && pnpm format\n```\n\n现在当我们执行git commit的时候就会执行pnpm lint与pnpm format，当这两条命令出现报错，就不会提交成功。以此来保证提交代码的质量和格式。\n\n\n## 最后\n\n本篇文章主要是以一个vue-ts-vite的项目的搭建为基础，在项目中引入eslint + prettier + husky来规范项目。完整的代码上传至github，[点击此处](https://github.com/yusongh/vue3-ts-vite-eslint-prettier)可以查看完整代码。","slug":"project-husky","published":1,"updated":"2023-03-11T17:09:13.022Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsia002gyt8w7o02fyp7","content":"<h2 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h2><p>使用vue-ts模板创建项目，由于该篇文章的重点不是项目的搭建，所以这里就简单带过。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm create vite my-vue-app --template vue-ts</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"为什么需要eslint和prettier\"><a href=\"#为什么需要eslint和prettier\" class=\"headerlink\" title=\"为什么需要eslint和prettier\"></a>为什么需要eslint和prettier</h2><p>ESLint是一个用来识别 ECMAScript 并且按照规则给出报告的代码检测工具，使用它可以避免低级错误和统一代码的风格。如果每次在代码提交之前都进行一次eslint代码检查，就不会因为某个字段未定义为undefined或null这样的错误而导致服务崩溃，可以有效的控制项目代码的质量。</p>\n<p>Prettier 是一个有主见的代码格式化程序。用来批量处理代码的统一，涉及引号，分号，换行，缩进。支持目前大部分语言处理，包括 JavaScript，Flow，TypeScript，CSS，SCSS，Less，JSX，Vue，GraphQL，JSON，Markdown。简而言之，这个工具能够使输出代码保持风格一致。</p>\n<p>简单来说，就是eslint可以保证项目的质量，prettier可以保证项目的统一格式、风格。</p>\n<h2 id=\"配置eslint\"><a href=\"#配置eslint\" class=\"headerlink\" title=\"配置eslint\"></a>配置eslint</h2><p>执行安装命令：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm add eslint -D</span><br></pre></td></tr></table></figure>\n\n<p>执行eslint初始化命令：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm eslint --init</span><br></pre></td></tr></table></figure>\n\n<p>依次初始化选项（根据项目情况选择）：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(1) How would you like to use ESLint?</span><br><span class=\"line\">选择：To check syntax and find problems</span><br><span class=\"line\"></span><br><span class=\"line\">(2) What <span class=\"built_in\">type</span> of modules does your project use?</span><br><span class=\"line\">选择：JavaScript modules (import/export)</span><br><span class=\"line\"></span><br><span class=\"line\">(3) Which framework does your project use?</span><br><span class=\"line\">选择：Vue.js</span><br><span class=\"line\"></span><br><span class=\"line\">(4) Does your project use TypeScript?</span><br><span class=\"line\">选择：Yes</span><br><span class=\"line\"></span><br><span class=\"line\">(5) Where does your code run?</span><br><span class=\"line\">选择：Browser</span><br><span class=\"line\"></span><br><span class=\"line\">(6) What format <span class=\"keyword\">do</span> you want your config file to be <span class=\"keyword\">in</span>?</span><br><span class=\"line\">选择：JavaScript</span><br><span class=\"line\"></span><br><span class=\"line\">(7) Would you like to install them now?</span><br><span class=\"line\">选择：Yes</span><br><span class=\"line\"></span><br><span class=\"line\">(8) Which package manager <span class=\"keyword\">do</span> you want to use?</span><br><span class=\"line\">选择：pnpm</span><br></pre></td></tr></table></figure>\n\n<p>依赖安装完成后，会生成.eslintrc.js配置文件：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;env&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;browser&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;es2021&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;extends&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;eslint:recommended&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:vue/vue3-essential&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:@typescript-eslint/recommended&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;parserOptions&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;ecmaVersion&quot;</span>: <span class=\"string\">&quot;latest&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;parser&quot;</span>: <span class=\"string\">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;sourceType&quot;</span>: <span class=\"string\">&quot;module&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;plugins&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;vue&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;@typescript-eslint&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;rules&quot;</span>: &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>此时打开.eslintrc.js配置文件会出现一个报错，需要再env字段中增加node: true配置以解决eslint找不到module的报错</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;env&quot;: &#123;</span><br><span class=\"line\">    &quot;browser&quot;: true,</span><br><span class=\"line\">    &quot;es2021&quot;: true,</span><br><span class=\"line\">    // 新增</span><br><span class=\"line\"><span class=\"addition\">+        &quot;node&quot;: true</span></span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>在package.json文件中的script中添加lint命令：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">// eslint . 为指定lint当前项目中的文件</span></span><br><span class=\"line\">        <span class=\"comment\">// --ext 为指定lint哪些后缀的文件</span></span><br><span class=\"line\">        <span class=\"comment\">// --fix 开启自动修复</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;lint&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;eslint . --ext .vue,.js,.ts,.jsx,.tsx --fix&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>执行lint命令：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm lint</span><br></pre></td></tr></table></figure>\n\n<p>这时候命令行中会显示出报错，意思就是在解析.vue后缀的文件时候出现解析错误parsing error。</p>\n<p>查阅资料后发现，eslint默认是不会解析.vue后缀文件的。因此，需要一个额外的解析器来解析.vue后缀文件。</p>\n<p>但是我们查看.eslintrc.js文件中的extends会发现已经有继承”plugin:vue&#x2F;vue3-essential”的配置。然后在node_modules中可以找到eslint-plugin-vue&#x2F;lib&#x2F;cinfigs&#x2F;essential，里面配置了extends是继承于同级目录下的base.js，在里面会发现parser: require.resolve(‘vue-eslint-parser’)这个配置。因此，按道理来说应该是会解析.vue后缀文件的。</p>\n<p>继续往下看.eslintrc.js文件中的extends会发现，extends中还有一个”plugin:@typescript-eslint&#x2F;recommended”，它是来自于&#x2F;node_modules&#x2F;@typescript-eslint&#x2F;eslint-plugin&#x2F;dist&#x2F;configs&#x2F;recommended.js，查看该文件会发现最终继承于同级目录下的base.js文件。从该文件中可以发现parser: ‘@typescript-eslint&#x2F;parser’,配置。</p>\n<p>按照.eslintrc.js文件中的extends配置的顺序可知，最终导致报错的原因就是@typescript-eslint&#x2F;parser把vue-eslint-parser覆盖了。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;extends&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"string\">&quot;eslint:recommended&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:vue/vue3-essential&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:@typescript-eslint/recommended&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>查看eslint-plugin-vue官方文档可知。如果已经使用了另外的解析器（例如”parser”: “@typescript-eslint&#x2F;parser”），则需要将其移至parseOptions，这样才不会与vue-eslint-parser冲突。</p>\n<p>修改.eslintrc.js文件：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;env&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;browser&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;es2021&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;node&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;extends&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;eslint:recommended&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:vue/vue3-essential&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:@typescript-eslint/recommended&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;parser&quot;</span>: <span class=\"string\">&quot;vue-eslint-parser&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;parserOptions&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;ecmaVersion&quot;</span>: <span class=\"string\">&quot;latest&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;parser&quot;</span>: <span class=\"string\">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;sourceType&quot;</span>: <span class=\"string\">&quot;module&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;plugins&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;vue&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;@typescript-eslint&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;rules&quot;</span>: &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>两个parser的区别在于，外面的parser用来解析.vue后缀文件，使得eslint能解析 <code>&lt;template&gt;</code> 标签中的内容，而parserOptions中的parser，即@typescript-eslint&#x2F;parser用来解析vue文件中 <code>&lt;script&gt;</code> 标签中的代码。</p>\n<p>此时，再执行pnpm lint，就会发现校验通过了。</p>\n<p><strong>安装vscode插件ESLint</strong></p>\n<p>如果写一行代码就要执行一遍lint命令，这效率就太低了。所以我们可以配合vscode的ESLint插件，实现每次保存代码时，自动执行lint命令来修复代码的错误。<br>在项目中新建.vscode&#x2F;settings.json文件，然后在其中加入以下配置。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// 开启自动修复</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;editor.codeActionsOnSave&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;source.fixAll&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;source.fixAll.eslint&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>安装依赖说明：</p>\n<ul>\n<li>eslint： JavaScript 和 JSX 检查工具</li>\n<li>eslint-plugin-vue： 使用 ESLint 检查 .vue文件 的 <code>&lt;template&gt;</code> 和 <code>&lt;script&gt;</code>，以及.js文件中的Vue代码</li>\n</ul>\n<h2 id=\"配置prettier\"><a href=\"#配置prettier\" class=\"headerlink\" title=\"配置prettier\"></a>配置prettier</h2><p>执行安装命令：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm add prettier -D</span><br></pre></td></tr></table></figure>\n\n<p>在根目录下新建.prettierrc.js</p>\n<p>添加以下配置，更多配置可查看<a href=\"https://prettier.io/docs/en/options.html\">官方文档</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 一行的字符数，如果超过会进行换行，默认为80</span></span><br><span class=\"line\">    <span class=\"attr\">printWidth</span>: <span class=\"number\">80</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 一个tab代表几个空格数，默认为80</span></span><br><span class=\"line\">    <span class=\"attr\">tabWidth</span>: <span class=\"number\">2</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 是否使用tab进行缩进，默认为false，表示用空格进行缩减</span></span><br><span class=\"line\">    <span class=\"attr\">useTabs</span>: <span class=\"literal\">false</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 字符串是否使用单引号，默认为false，使用双引号</span></span><br><span class=\"line\">    <span class=\"attr\">singleQuote</span>: <span class=\"literal\">true</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 行位是否使用分号，默认为true</span></span><br><span class=\"line\">    <span class=\"attr\">semi</span>: <span class=\"literal\">false</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 是否使用尾逗号，有三个可选值&quot;&lt;none|es5|all&gt;&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">trailingComma</span>: <span class=\"string\">&quot;none&quot;</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 对象大括号直接是否有空格，默认为true，效果：&#123; foo: bar &#125;</span></span><br><span class=\"line\">    <span class=\"attr\">bracketSpacing</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在package.json中的script中添加以下命令：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;format&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;prettier --write \\&quot;./**/*.&#123;html,vue,ts,js,json,md&#125;\\&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>运行该命令，会将我们项目中的文件都格式化一遍，后续如果添加其他格式的文件，可在该命令中添加，例如：.less后缀的文件</p>\n<p><strong>安装vscode的Prettier - Code formatter插件</strong></p>\n<p>安装该插件的目的是，让该插件在我们保存的时候自动完成格式化</p>\n<p>在.vscode&#x2F;settings.json中添加一下规则</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// 保存的时候自动格式化</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;editor.formatOnSave&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"comment\">// 默认格式化工具选择prettier</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;editor.defaultFormatter&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;esbenp.prettier-vscode&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"解决eslint与prettier的冲突\"><a href=\"#解决eslint与prettier的冲突\" class=\"headerlink\" title=\"解决eslint与prettier的冲突\"></a>解决eslint与prettier的冲突</h2><p>在理想的状态下，eslint与prettier应该各司其职。eslint负责我们的代码质量，prettier负责我们的代码格式。但是在使用的过程中会发现，由于我们开启了自动化的eslint修复与自动化的根据prettier来格式化代码。所以我们已保存代码，会出现屏幕闪一起后又恢复到了报错的状态。</p>\n<p>这其中的根本原因就是eslint有部分规则与prettier冲突了，所以保存的时候显示运行了eslint的修复命令，然后再运行prettier格式化，所以就会出现屏幕闪一下然后又恢复到报错的现象。这时候你可以检查一下是否存在冲突的规则。</p>\n<p>查阅资料会发现，社区已经为我们提供了一个非常成熟的方案，即eslint-config-prettier + eslint-plugin-prettier。</p>\n<ul>\n<li>eslint-plugin-prettier： 基于 prettier 代码风格的 eslint 规则，即eslint使用pretter规则来格式化代码。</li>\n<li>eslint-config-prettier： 禁用所有与格式相关的 eslint 规则，解决 prettier 与 eslint 规则冲突，确保将其放在 extends 队列最后，这样它将覆盖其他配置</li>\n</ul>\n<p>安装依赖：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm add eslint-config-prettier eslint-plugin-prettier -D</span><br></pre></td></tr></table></figure>\n\n<p>在 .eslintrc.json中extends的最后添加一个配置：</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; </span><br><span class=\"line\">    extends: [</span><br><span class=\"line\">    &#x27;eslint:recommended&#x27;,</span><br><span class=\"line\">    &#x27;plugin:vue/vue3-essential&#x27;,</span><br><span class=\"line\">    &#x27;plugin:@typescript-eslint/recommended&#x27;,</span><br><span class=\"line\"><span class=\"addition\">+    // 新增，必须放在最后面</span></span><br><span class=\"line\"><span class=\"addition\">+    &#x27;plugin:prettier/recommended&#x27; </span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>最后重启vscode，你会发现冲突消失了，eslint与prettier也按照我们预想的各司其职了。</p>\n<h2 id=\"配置styleling\"><a href=\"#配置styleling\" class=\"headerlink\" title=\"配置styleling\"></a>配置styleling</h2><p>stylelint为css的lint工具。可格式化css代码，检查css语法错误与不合理的写法，指定css书写顺序等…</p>\n<p><strong>安装依赖</strong></p>\n<p>由于我的项目使用的less预处理器，因此配置的为less相关的，项目中使用其他预处理器的可以按照该配置方法改一下就好</p>\n<p>stylelint v13版本将css, parse CSS(如SCSS,SASS),html内的css(如*.vue中的style)等编译工具都包含在内。但是v14版本没有包含在内，所以需要安装需要的工具</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm add stylelint postcss postcss-less postcss-html stylelint-config-prettier stylelint-config-recommended-less stylelint-config-standard stylelint-config-standard-vue stylelint-less stylelint-order -D</span><br></pre></td></tr></table></figure>\n\n<p>依赖说明：</p>\n<ul>\n<li>stylelint: css样式lint工具</li>\n<li>postcss: 转换css代码工具</li>\n<li>postcss-less: 识别less语法</li>\n<li>postcss-html: 识别html&#x2F;vue 中的<style></style>标签中的样式</li>\n<li>stylelint-config-standard: Stylelint的标准可共享配置规则，详细可查看官方文档</li>\n<li>stylelint-config-prettier: 关闭所有不必要或可能与Prettier冲突的规则</li>\n<li>stylelint-config-recommended-less: less的推荐可共享配置规则，详细可查看官方文档</li>\n<li>stylelint-config-standard-vue: lint.vue文件的样式配置</li>\n<li>stylelint-less: stylelint-config-recommended-less的依赖，less的stylelint规则集合</li>\n<li>stylelint-order: 指定样式书写的顺序，在.stylelintrc.js中order&#x2F;properties-order指定顺序</li>\n</ul>\n<p>增加.stylelintrc.js配置文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">extends</span>: [</span><br><span class=\"line\">    <span class=\"string\">&#x27;stylelint-config-standard&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;stylelint-config-prettier&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;stylelint-config-recommended-less&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;stylelint-config-standard-vue&#x27;</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [<span class=\"string\">&#x27;stylelint-order&#x27;</span>],</span><br><span class=\"line\">  <span class=\"comment\">// 不同格式的文件指定自定义语法</span></span><br><span class=\"line\">  <span class=\"attr\">overrides</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">files</span>: [<span class=\"string\">&#x27;**/*.(less|css|vue|html)&#x27;</span>],</span><br><span class=\"line\">      <span class=\"attr\">customSyntax</span>: <span class=\"string\">&#x27;postcss-less&#x27;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">files</span>: [<span class=\"string\">&#x27;**/*.(html|vue)&#x27;</span>],</span><br><span class=\"line\">      <span class=\"attr\">customSyntax</span>: <span class=\"string\">&#x27;postcss-html&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">ignoreFiles</span>: [</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.jsx&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.tsx&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.ts&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.json&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.md&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.yaml&#x27;</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">rules</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;no-descending-specificity&#x27;</span>: <span class=\"literal\">null</span>, <span class=\"comment\">// 禁止在具有较高优先级的选择器后出现被其覆盖的较低优先级的选择器</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;selector-pseudo-element-no-unknown&#x27;</span>: [</span><br><span class=\"line\">      <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">ignorePseudoElements</span>: [<span class=\"string\">&#x27;v-deep&#x27;</span>]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&#x27;selector-pseudo-class-no-unknown&#x27;</span>: [</span><br><span class=\"line\">      <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">ignorePseudoClasses</span>: [<span class=\"string\">&#x27;deep&#x27;</span>]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"comment\">// 指定样式的排序</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;order/properties-order&#x27;</span>: [</span><br><span class=\"line\">      <span class=\"string\">&#x27;position&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;top&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;right&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;bottom&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;left&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;z-index&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;display&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;justify-content&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;align-items&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;float&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;clear&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;overflow&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;overflow-x&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;overflow-y&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;padding&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;padding-top&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;padding-right&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;padding-bottom&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;padding-left&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;margin&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;margin-top&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;margin-right&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;margin-bottom&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;margin-left&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;min-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;max-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;height&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;min-height&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;max-height&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;font-size&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;font-family&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-align&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-justify&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-indent&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-overflow&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-decoration&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;white-space&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background-position&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background-repeat&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background-size&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background-clip&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-top-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-top-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-top-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-right-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-right-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-right-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-bottom-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-bottom-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-bottom-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-left-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-left-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-left-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-radius&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;opacity&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;filter&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;list-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;outline&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;visibility&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;box-shadow&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-shadow&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;resize&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;transition&#x27;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>安装vscode的Stylelint插件</p>\n<p>安装该插件可在我们保存代码时自动执行stylelint</p>\n<p>在.vscode&#x2F;settings.json中添加一下规则</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  // 开启自动修复</span><br><span class=\"line\">  &quot;editor.codeActionsOnSave&quot;: &#123;</span><br><span class=\"line\">    &quot;source.fixAll&quot;: false,</span><br><span class=\"line\">    &quot;source.fixAll.eslint&quot;: true,</span><br><span class=\"line\"><span class=\"addition\">+   &quot;source.fixAll.stylelint&quot;: true</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  // 保存的时候自动格式化</span><br><span class=\"line\">  &quot;editor.formatOnSave&quot;: true,</span><br><span class=\"line\">  // 默认格式化工具选择prettier</span><br><span class=\"line\">  &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;,</span><br><span class=\"line\">  // 配置该项，新建文件时默认就是space：2</span><br><span class=\"line\">  &quot;editor.tabSize&quot;: 2,</span><br><span class=\"line\">  // stylelint校验的文件格式</span><br><span class=\"line\"><span class=\"addition\">+ &quot;stylelint.validate&quot;: [&quot;css&quot;, &quot;less&quot;, &quot;vue&quot;, &quot;html&quot;]</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置husky\"><a href=\"#配置husky\" class=\"headerlink\" title=\"配置husky\"></a>配置husky</h2><blockquote>\n<p>You can use it to <strong>lint your commit messages</strong>, <strong>run tests</strong>, <strong>lint code</strong>, etc… when you commit or push. Husky supports all Git hooks.</p>\n</blockquote>\n<p>虽然上面已经配置好了eslint、preitter与stylelint，但是还是存在以下问题。</p>\n<p>对于不使用vscode的，或者没有安装eslint、preitter与stylelint插件的同学来说，就不能实现在保存的时候自动的去修复与和格式化代码。</p>\n<p>这样提交到git仓库的代码还是不符合要求的。因此需要引入强制的手段来保证提交到git仓库的代码时符合我们的要求的。</p>\n<p>husky是一个用来管理git hook的工具，git hook即在我们使用git提交代码的过程中会触发的钩子。</p>\n<p>安装依赖</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm add husky -D</span><br></pre></td></tr></table></figure>\n\n<p>在package.json中的script中添加一条脚本命令</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;prepare&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;husky install&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>该命令会在pnpm install之后运行，这样其他克隆该项目的同学就在装包的时候就会自动执行该命令来安装husky。这里我们就不重新执行pnpm install了，直接执行pnpm prepare，这个时候你会发现多了一个.husky目录。</p>\n<p>然后使用husky命令添加pre-commit钩子，运行</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm husky add .husky/pre-commit <span class=\"string\">&quot;pnpm lint &amp;&amp; pnpm format &amp;&amp; pnpm lint:style&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>执行完上面的命令后，会在.husky目录下生成一个pre-commit文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env sh</span></span><br><span class=\"line\">. <span class=\"string\">&quot;<span class=\"subst\">$(dirname -- <span class=\"string\">&quot;<span class=\"variable\">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnpm lint &amp;&amp; pnpm format</span><br></pre></td></tr></table></figure>\n\n<p>现在当我们执行git commit的时候就会执行pnpm lint与pnpm format，当这两条命令出现报错，就不会提交成功。以此来保证提交代码的质量和格式。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>本篇文章主要是以一个vue-ts-vite的项目的搭建为基础，在项目中引入eslint + prettier + husky来规范项目。完整的代码上传至github，<a href=\"https://github.com/yusongh/vue3-ts-vite-eslint-prettier\">点击此处</a>可以查看完整代码。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h2><p>使用vue-ts模板创建项目，由于该篇文章的重点不是项目的搭建，所以这里就简单带过。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm create vite my-vue-app --template vue-ts</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"为什么需要eslint和prettier\"><a href=\"#为什么需要eslint和prettier\" class=\"headerlink\" title=\"为什么需要eslint和prettier\"></a>为什么需要eslint和prettier</h2><p>ESLint是一个用来识别 ECMAScript 并且按照规则给出报告的代码检测工具，使用它可以避免低级错误和统一代码的风格。如果每次在代码提交之前都进行一次eslint代码检查，就不会因为某个字段未定义为undefined或null这样的错误而导致服务崩溃，可以有效的控制项目代码的质量。</p>\n<p>Prettier 是一个有主见的代码格式化程序。用来批量处理代码的统一，涉及引号，分号，换行，缩进。支持目前大部分语言处理，包括 JavaScript，Flow，TypeScript，CSS，SCSS，Less，JSX，Vue，GraphQL，JSON，Markdown。简而言之，这个工具能够使输出代码保持风格一致。</p>\n<p>简单来说，就是eslint可以保证项目的质量，prettier可以保证项目的统一格式、风格。</p>\n<h2 id=\"配置eslint\"><a href=\"#配置eslint\" class=\"headerlink\" title=\"配置eslint\"></a>配置eslint</h2><p>执行安装命令：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm add eslint -D</span><br></pre></td></tr></table></figure>\n\n<p>执行eslint初始化命令：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm eslint --init</span><br></pre></td></tr></table></figure>\n\n<p>依次初始化选项（根据项目情况选择）：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(1) How would you like to use ESLint?</span><br><span class=\"line\">选择：To check syntax and find problems</span><br><span class=\"line\"></span><br><span class=\"line\">(2) What <span class=\"built_in\">type</span> of modules does your project use?</span><br><span class=\"line\">选择：JavaScript modules (import/export)</span><br><span class=\"line\"></span><br><span class=\"line\">(3) Which framework does your project use?</span><br><span class=\"line\">选择：Vue.js</span><br><span class=\"line\"></span><br><span class=\"line\">(4) Does your project use TypeScript?</span><br><span class=\"line\">选择：Yes</span><br><span class=\"line\"></span><br><span class=\"line\">(5) Where does your code run?</span><br><span class=\"line\">选择：Browser</span><br><span class=\"line\"></span><br><span class=\"line\">(6) What format <span class=\"keyword\">do</span> you want your config file to be <span class=\"keyword\">in</span>?</span><br><span class=\"line\">选择：JavaScript</span><br><span class=\"line\"></span><br><span class=\"line\">(7) Would you like to install them now?</span><br><span class=\"line\">选择：Yes</span><br><span class=\"line\"></span><br><span class=\"line\">(8) Which package manager <span class=\"keyword\">do</span> you want to use?</span><br><span class=\"line\">选择：pnpm</span><br></pre></td></tr></table></figure>\n\n<p>依赖安装完成后，会生成.eslintrc.js配置文件：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;env&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;browser&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;es2021&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;extends&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;eslint:recommended&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:vue/vue3-essential&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:@typescript-eslint/recommended&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;parserOptions&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;ecmaVersion&quot;</span>: <span class=\"string\">&quot;latest&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;parser&quot;</span>: <span class=\"string\">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;sourceType&quot;</span>: <span class=\"string\">&quot;module&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;plugins&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;vue&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;@typescript-eslint&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;rules&quot;</span>: &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>此时打开.eslintrc.js配置文件会出现一个报错，需要再env字段中增加node: true配置以解决eslint找不到module的报错</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;env&quot;: &#123;</span><br><span class=\"line\">    &quot;browser&quot;: true,</span><br><span class=\"line\">    &quot;es2021&quot;: true,</span><br><span class=\"line\">    // 新增</span><br><span class=\"line\"><span class=\"addition\">+        &quot;node&quot;: true</span></span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>在package.json文件中的script中添加lint命令：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">// eslint . 为指定lint当前项目中的文件</span></span><br><span class=\"line\">        <span class=\"comment\">// --ext 为指定lint哪些后缀的文件</span></span><br><span class=\"line\">        <span class=\"comment\">// --fix 开启自动修复</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;lint&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;eslint . --ext .vue,.js,.ts,.jsx,.tsx --fix&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>执行lint命令：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm lint</span><br></pre></td></tr></table></figure>\n\n<p>这时候命令行中会显示出报错，意思就是在解析.vue后缀的文件时候出现解析错误parsing error。</p>\n<p>查阅资料后发现，eslint默认是不会解析.vue后缀文件的。因此，需要一个额外的解析器来解析.vue后缀文件。</p>\n<p>但是我们查看.eslintrc.js文件中的extends会发现已经有继承”plugin:vue&#x2F;vue3-essential”的配置。然后在node_modules中可以找到eslint-plugin-vue&#x2F;lib&#x2F;cinfigs&#x2F;essential，里面配置了extends是继承于同级目录下的base.js，在里面会发现parser: require.resolve(‘vue-eslint-parser’)这个配置。因此，按道理来说应该是会解析.vue后缀文件的。</p>\n<p>继续往下看.eslintrc.js文件中的extends会发现，extends中还有一个”plugin:@typescript-eslint&#x2F;recommended”，它是来自于&#x2F;node_modules&#x2F;@typescript-eslint&#x2F;eslint-plugin&#x2F;dist&#x2F;configs&#x2F;recommended.js，查看该文件会发现最终继承于同级目录下的base.js文件。从该文件中可以发现parser: ‘@typescript-eslint&#x2F;parser’,配置。</p>\n<p>按照.eslintrc.js文件中的extends配置的顺序可知，最终导致报错的原因就是@typescript-eslint&#x2F;parser把vue-eslint-parser覆盖了。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;extends&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"string\">&quot;eslint:recommended&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:vue/vue3-essential&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:@typescript-eslint/recommended&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>查看eslint-plugin-vue官方文档可知。如果已经使用了另外的解析器（例如”parser”: “@typescript-eslint&#x2F;parser”），则需要将其移至parseOptions，这样才不会与vue-eslint-parser冲突。</p>\n<p>修改.eslintrc.js文件：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;env&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;browser&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;es2021&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;node&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;extends&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;eslint:recommended&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:vue/vue3-essential&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;plugin:@typescript-eslint/recommended&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;parser&quot;</span>: <span class=\"string\">&quot;vue-eslint-parser&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;parserOptions&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;ecmaVersion&quot;</span>: <span class=\"string\">&quot;latest&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;parser&quot;</span>: <span class=\"string\">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;sourceType&quot;</span>: <span class=\"string\">&quot;module&quot;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;plugins&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;vue&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;@typescript-eslint&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;rules&quot;</span>: &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>两个parser的区别在于，外面的parser用来解析.vue后缀文件，使得eslint能解析 <code>&lt;template&gt;</code> 标签中的内容，而parserOptions中的parser，即@typescript-eslint&#x2F;parser用来解析vue文件中 <code>&lt;script&gt;</code> 标签中的代码。</p>\n<p>此时，再执行pnpm lint，就会发现校验通过了。</p>\n<p><strong>安装vscode插件ESLint</strong></p>\n<p>如果写一行代码就要执行一遍lint命令，这效率就太低了。所以我们可以配合vscode的ESLint插件，实现每次保存代码时，自动执行lint命令来修复代码的错误。<br>在项目中新建.vscode&#x2F;settings.json文件，然后在其中加入以下配置。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// 开启自动修复</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;editor.codeActionsOnSave&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;source.fixAll&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;source.fixAll.eslint&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>安装依赖说明：</p>\n<ul>\n<li>eslint： JavaScript 和 JSX 检查工具</li>\n<li>eslint-plugin-vue： 使用 ESLint 检查 .vue文件 的 <code>&lt;template&gt;</code> 和 <code>&lt;script&gt;</code>，以及.js文件中的Vue代码</li>\n</ul>\n<h2 id=\"配置prettier\"><a href=\"#配置prettier\" class=\"headerlink\" title=\"配置prettier\"></a>配置prettier</h2><p>执行安装命令：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm add prettier -D</span><br></pre></td></tr></table></figure>\n\n<p>在根目录下新建.prettierrc.js</p>\n<p>添加以下配置，更多配置可查看<a href=\"https://prettier.io/docs/en/options.html\">官方文档</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 一行的字符数，如果超过会进行换行，默认为80</span></span><br><span class=\"line\">    <span class=\"attr\">printWidth</span>: <span class=\"number\">80</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 一个tab代表几个空格数，默认为80</span></span><br><span class=\"line\">    <span class=\"attr\">tabWidth</span>: <span class=\"number\">2</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 是否使用tab进行缩进，默认为false，表示用空格进行缩减</span></span><br><span class=\"line\">    <span class=\"attr\">useTabs</span>: <span class=\"literal\">false</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 字符串是否使用单引号，默认为false，使用双引号</span></span><br><span class=\"line\">    <span class=\"attr\">singleQuote</span>: <span class=\"literal\">true</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 行位是否使用分号，默认为true</span></span><br><span class=\"line\">    <span class=\"attr\">semi</span>: <span class=\"literal\">false</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 是否使用尾逗号，有三个可选值&quot;&lt;none|es5|all&gt;&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">trailingComma</span>: <span class=\"string\">&quot;none&quot;</span>, </span><br><span class=\"line\">    <span class=\"comment\">// 对象大括号直接是否有空格，默认为true，效果：&#123; foo: bar &#125;</span></span><br><span class=\"line\">    <span class=\"attr\">bracketSpacing</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在package.json中的script中添加以下命令：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;format&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;prettier --write \\&quot;./**/*.&#123;html,vue,ts,js,json,md&#125;\\&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>运行该命令，会将我们项目中的文件都格式化一遍，后续如果添加其他格式的文件，可在该命令中添加，例如：.less后缀的文件</p>\n<p><strong>安装vscode的Prettier - Code formatter插件</strong></p>\n<p>安装该插件的目的是，让该插件在我们保存的时候自动完成格式化</p>\n<p>在.vscode&#x2F;settings.json中添加一下规则</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// 保存的时候自动格式化</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;editor.formatOnSave&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"comment\">// 默认格式化工具选择prettier</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;editor.defaultFormatter&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;esbenp.prettier-vscode&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"解决eslint与prettier的冲突\"><a href=\"#解决eslint与prettier的冲突\" class=\"headerlink\" title=\"解决eslint与prettier的冲突\"></a>解决eslint与prettier的冲突</h2><p>在理想的状态下，eslint与prettier应该各司其职。eslint负责我们的代码质量，prettier负责我们的代码格式。但是在使用的过程中会发现，由于我们开启了自动化的eslint修复与自动化的根据prettier来格式化代码。所以我们已保存代码，会出现屏幕闪一起后又恢复到了报错的状态。</p>\n<p>这其中的根本原因就是eslint有部分规则与prettier冲突了，所以保存的时候显示运行了eslint的修复命令，然后再运行prettier格式化，所以就会出现屏幕闪一下然后又恢复到报错的现象。这时候你可以检查一下是否存在冲突的规则。</p>\n<p>查阅资料会发现，社区已经为我们提供了一个非常成熟的方案，即eslint-config-prettier + eslint-plugin-prettier。</p>\n<ul>\n<li>eslint-plugin-prettier： 基于 prettier 代码风格的 eslint 规则，即eslint使用pretter规则来格式化代码。</li>\n<li>eslint-config-prettier： 禁用所有与格式相关的 eslint 规则，解决 prettier 与 eslint 规则冲突，确保将其放在 extends 队列最后，这样它将覆盖其他配置</li>\n</ul>\n<p>安装依赖：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm add eslint-config-prettier eslint-plugin-prettier -D</span><br></pre></td></tr></table></figure>\n\n<p>在 .eslintrc.json中extends的最后添加一个配置：</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; </span><br><span class=\"line\">    extends: [</span><br><span class=\"line\">    &#x27;eslint:recommended&#x27;,</span><br><span class=\"line\">    &#x27;plugin:vue/vue3-essential&#x27;,</span><br><span class=\"line\">    &#x27;plugin:@typescript-eslint/recommended&#x27;,</span><br><span class=\"line\"><span class=\"addition\">+    // 新增，必须放在最后面</span></span><br><span class=\"line\"><span class=\"addition\">+    &#x27;plugin:prettier/recommended&#x27; </span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>最后重启vscode，你会发现冲突消失了，eslint与prettier也按照我们预想的各司其职了。</p>\n<h2 id=\"配置styleling\"><a href=\"#配置styleling\" class=\"headerlink\" title=\"配置styleling\"></a>配置styleling</h2><p>stylelint为css的lint工具。可格式化css代码，检查css语法错误与不合理的写法，指定css书写顺序等…</p>\n<p><strong>安装依赖</strong></p>\n<p>由于我的项目使用的less预处理器，因此配置的为less相关的，项目中使用其他预处理器的可以按照该配置方法改一下就好</p>\n<p>stylelint v13版本将css, parse CSS(如SCSS,SASS),html内的css(如*.vue中的style)等编译工具都包含在内。但是v14版本没有包含在内，所以需要安装需要的工具</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm add stylelint postcss postcss-less postcss-html stylelint-config-prettier stylelint-config-recommended-less stylelint-config-standard stylelint-config-standard-vue stylelint-less stylelint-order -D</span><br></pre></td></tr></table></figure>\n\n<p>依赖说明：</p>\n<ul>\n<li>stylelint: css样式lint工具</li>\n<li>postcss: 转换css代码工具</li>\n<li>postcss-less: 识别less语法</li>\n<li>postcss-html: 识别html&#x2F;vue 中的<style></style>标签中的样式</li>\n<li>stylelint-config-standard: Stylelint的标准可共享配置规则，详细可查看官方文档</li>\n<li>stylelint-config-prettier: 关闭所有不必要或可能与Prettier冲突的规则</li>\n<li>stylelint-config-recommended-less: less的推荐可共享配置规则，详细可查看官方文档</li>\n<li>stylelint-config-standard-vue: lint.vue文件的样式配置</li>\n<li>stylelint-less: stylelint-config-recommended-less的依赖，less的stylelint规则集合</li>\n<li>stylelint-order: 指定样式书写的顺序，在.stylelintrc.js中order&#x2F;properties-order指定顺序</li>\n</ul>\n<p>增加.stylelintrc.js配置文件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">extends</span>: [</span><br><span class=\"line\">    <span class=\"string\">&#x27;stylelint-config-standard&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;stylelint-config-prettier&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;stylelint-config-recommended-less&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;stylelint-config-standard-vue&#x27;</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [<span class=\"string\">&#x27;stylelint-order&#x27;</span>],</span><br><span class=\"line\">  <span class=\"comment\">// 不同格式的文件指定自定义语法</span></span><br><span class=\"line\">  <span class=\"attr\">overrides</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">files</span>: [<span class=\"string\">&#x27;**/*.(less|css|vue|html)&#x27;</span>],</span><br><span class=\"line\">      <span class=\"attr\">customSyntax</span>: <span class=\"string\">&#x27;postcss-less&#x27;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">files</span>: [<span class=\"string\">&#x27;**/*.(html|vue)&#x27;</span>],</span><br><span class=\"line\">      <span class=\"attr\">customSyntax</span>: <span class=\"string\">&#x27;postcss-html&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">ignoreFiles</span>: [</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.jsx&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.tsx&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.ts&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.json&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.md&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;**/*.yaml&#x27;</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">rules</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;no-descending-specificity&#x27;</span>: <span class=\"literal\">null</span>, <span class=\"comment\">// 禁止在具有较高优先级的选择器后出现被其覆盖的较低优先级的选择器</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;selector-pseudo-element-no-unknown&#x27;</span>: [</span><br><span class=\"line\">      <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">ignorePseudoElements</span>: [<span class=\"string\">&#x27;v-deep&#x27;</span>]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&#x27;selector-pseudo-class-no-unknown&#x27;</span>: [</span><br><span class=\"line\">      <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">ignorePseudoClasses</span>: [<span class=\"string\">&#x27;deep&#x27;</span>]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"comment\">// 指定样式的排序</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;order/properties-order&#x27;</span>: [</span><br><span class=\"line\">      <span class=\"string\">&#x27;position&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;top&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;right&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;bottom&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;left&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;z-index&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;display&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;justify-content&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;align-items&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;float&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;clear&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;overflow&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;overflow-x&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;overflow-y&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;padding&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;padding-top&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;padding-right&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;padding-bottom&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;padding-left&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;margin&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;margin-top&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;margin-right&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;margin-bottom&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;margin-left&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;min-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;max-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;height&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;min-height&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;max-height&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;font-size&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;font-family&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-align&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-justify&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-indent&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-overflow&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-decoration&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;white-space&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background-position&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background-repeat&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background-size&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;background-clip&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-top-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-top-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-top-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-right-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-right-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-right-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-bottom-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-bottom-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-bottom-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-left-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-left-width&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-left-color&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;border-radius&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;opacity&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;filter&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;list-style&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;outline&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;visibility&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;box-shadow&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;text-shadow&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;resize&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;transition&#x27;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>安装vscode的Stylelint插件</p>\n<p>安装该插件可在我们保存代码时自动执行stylelint</p>\n<p>在.vscode&#x2F;settings.json中添加一下规则</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  // 开启自动修复</span><br><span class=\"line\">  &quot;editor.codeActionsOnSave&quot;: &#123;</span><br><span class=\"line\">    &quot;source.fixAll&quot;: false,</span><br><span class=\"line\">    &quot;source.fixAll.eslint&quot;: true,</span><br><span class=\"line\"><span class=\"addition\">+   &quot;source.fixAll.stylelint&quot;: true</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  // 保存的时候自动格式化</span><br><span class=\"line\">  &quot;editor.formatOnSave&quot;: true,</span><br><span class=\"line\">  // 默认格式化工具选择prettier</span><br><span class=\"line\">  &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;,</span><br><span class=\"line\">  // 配置该项，新建文件时默认就是space：2</span><br><span class=\"line\">  &quot;editor.tabSize&quot;: 2,</span><br><span class=\"line\">  // stylelint校验的文件格式</span><br><span class=\"line\"><span class=\"addition\">+ &quot;stylelint.validate&quot;: [&quot;css&quot;, &quot;less&quot;, &quot;vue&quot;, &quot;html&quot;]</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置husky\"><a href=\"#配置husky\" class=\"headerlink\" title=\"配置husky\"></a>配置husky</h2><blockquote>\n<p>You can use it to <strong>lint your commit messages</strong>, <strong>run tests</strong>, <strong>lint code</strong>, etc… when you commit or push. Husky supports all Git hooks.</p>\n</blockquote>\n<p>虽然上面已经配置好了eslint、preitter与stylelint，但是还是存在以下问题。</p>\n<p>对于不使用vscode的，或者没有安装eslint、preitter与stylelint插件的同学来说，就不能实现在保存的时候自动的去修复与和格式化代码。</p>\n<p>这样提交到git仓库的代码还是不符合要求的。因此需要引入强制的手段来保证提交到git仓库的代码时符合我们的要求的。</p>\n<p>husky是一个用来管理git hook的工具，git hook即在我们使用git提交代码的过程中会触发的钩子。</p>\n<p>安装依赖</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm add husky -D</span><br></pre></td></tr></table></figure>\n\n<p>在package.json中的script中添加一条脚本命令</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;prepare&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;husky install&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>该命令会在pnpm install之后运行，这样其他克隆该项目的同学就在装包的时候就会自动执行该命令来安装husky。这里我们就不重新执行pnpm install了，直接执行pnpm prepare，这个时候你会发现多了一个.husky目录。</p>\n<p>然后使用husky命令添加pre-commit钩子，运行</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pnpm husky add .husky/pre-commit <span class=\"string\">&quot;pnpm lint &amp;&amp; pnpm format &amp;&amp; pnpm lint:style&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>执行完上面的命令后，会在.husky目录下生成一个pre-commit文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env sh</span></span><br><span class=\"line\">. <span class=\"string\">&quot;<span class=\"subst\">$(dirname -- <span class=\"string\">&quot;<span class=\"variable\">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnpm lint &amp;&amp; pnpm format</span><br></pre></td></tr></table></figure>\n\n<p>现在当我们执行git commit的时候就会执行pnpm lint与pnpm format，当这两条命令出现报错，就不会提交成功。以此来保证提交代码的质量和格式。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>本篇文章主要是以一个vue-ts-vite的项目的搭建为基础，在项目中引入eslint + prettier + husky来规范项目。完整的代码上传至github，<a href=\"https://github.com/yusongh/vue3-ts-vite-eslint-prettier\">点击此处</a>可以查看完整代码。</p>\n"},{"title":"一个基于GO的局域网文件互传工具","date":"2022-05-14T06:31:27.000Z","description":"一个基于GO语言的「局域网PC与手机互传文件，且不想借助微信/QQ等骚扰软件」的软件","_content":"\n## 前言\n\n最近在学习 Go 语言，语法看得差不多了，想着找点什么项目做做，正好我一直想做一个「局域网PC与手机互传文件，且不想借助微信/QQ等骚扰软件」的软件，于是就用 Go 来做了，最终截图如下：\n\n![闪电传](http://blogpic.at15cm.com/flash_files_1.png)\n\n![闪电传](http://blogpic.at15cm.com/flash_files_1.png)\n\n![闪电传](http://blogpic.at15cm.com/flash_files_3.png)\n\n功能很简单：\n\n1. PC 上传文字或文件后创建二维码，提供给手机浏览器扫码下载\n2. 手机在浏览器上传文字或文件后自动用 websocket 通知给 PC 端，弹出下载提示\n\n[源码在此](https://github.com/ArthurWangCN/flash-files)，这里主要说一下实现思路。\n\n\n\n## 工具\n\n+ VSCode或者GoLand\n\n+ zserge/lorca：一个制作桌面应用的库\n\n+ React\n\n+ gin-gonic/gin：提供服务器接口\n\n+ gorilla/websocket：实现websocket通知\n\n+ skip2/go-qrcode：生成二维码\n\n+ go\n\n  版本：1.17或以上。\n\n  需要做的配置：\n\n  ```shell\n  go env -w GO111MODULE=on\n  go env -w GOPROXY=https://goproxy.cn,direct\n  ```\n\n  安装gowatch\n\n  ```shell\n  go get github.com/silenceper/gowatch\n  ```\n\n\n\n## 整体思路\n\n![闪电传](http://blogpic.at15cm.com/flash_files_4.png)\n\n1. 用 Lorca 搞出一个窗口\n2. 用 HTML 制作界面，用 JS 调用后台接口\n3. 用 Gin 实现后台接口\n4. 上传的文件都放到 uploads 文件夹中\n\n\n\n## 用 Lorca 创建窗口\n\n我了解到 Go 的如下库可以实现窗口：\n\n1. [lorca](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzserge%2Florca) - 调用系统现有的 Chrome/Edge 实现简单的窗口，UI 通过 HTML/CSS/JS 实现\n2. [webview](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwebview%2Fwebview) - 比 lorca 功能更强，实现 UI 的思路差不多\n3. [fyne](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffyne-io%2Ffyne) - 使用 Canvas 绘制的 UI 框架，性能不错\n4. [qt](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftherecipe%2Fqt) - 更复杂更强大的 UI 框架\n\n我随便挑了个最简单的 Lorca 就开始了。\n\n示例代码：\n\n```go\nvar ui lorca.UI\nui, _ = lorca.New(\"http://www.baidu.com\", \"\", 800, 600, \"--disable-sync\", \"--disable-translate\")\n```\n\n\n\n## 前端制作 UI\n\n我用 React + ReactRouter 来实现页面结构，文件上传和对话框是自己用原生 JS 写的，UI 细节用 CSS3 来做，没有依赖其他 UI 组件库。\n\nLorca 的主要功能就是展示我写的 index.html。\n\n\n\n## 用 gin 实现后台接口\n\n前端项目用到了五个接口，我使用 gin 来实现：\n\n```go\nrouter.GET(\"/uploads/:path\", controllers.UploadsController)              \nrouter.GET(\"/api/v1/addresses\", controllers.AddressesController) \nrouter.GET(\"/api/v1/qrcodes\", controllers.QrcodesController)   \nrouter.POST(\"/api/v1/files\", controllers.FilesController)      \nrouter.POST(\"/api/v1/texts\", controllers.TextsController)\n```\n\n其中的二维码生成我用的是 [go-qrcode](https://github.com/skip2/go-qrcode)。\n\n\n\n## 用 [gorilla/websocket](https://github.com/gorilla/websocket) 实现手机通知 PC\n\n\n\n## 给exe文件添加图标\n\n正常 `go build` 后exe文件是默认图标，但可以设置自己想要的图标。\n\n网上找了一些文章，花里胡哨的，这里简单粗暴。需要一个名为 **rsrc** 工具：\n\n1. 克隆rsrc源代码，并打包生成exe文件\n\n   ```bash\n   git clone https://github.com/akavel/rsrc.git\n   ```\n\n   ```bash\n   cd rsrc\n   go build\n   ```\n\n   生成 **rsrc.exe**，并拷贝到当前项目根目录。\n\n2. 根目录创建配置文件main.manifest：\n\n   ```xml\n   <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n   <assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\">\n   <assemblyIdentity\n       version=\"1.0.0.0\"\n       processorArchitecture=\"x86\"\n       name=\"controls\"\n       type=\"win32\"\n   ></assemblyIdentity>\n   <dependency>\n       <dependentAssembly>\n           <assemblyIdentity\n               type=\"win32\"\n               name=\"Microsoft.Windows.Common-Controls\"\n               version=\"6.0.0.0\"\n               processorArchitecture=\"*\"\n               publicKeyToken=\"6595b64144ccf1df\"\n               language=\"*\"\n           ></assemblyIdentity>\n       </dependentAssembly>\n   </dependency>\n   </assembly>\n   ```\n\n3. 制作你想要的图标favicon.ico，并放到根目录；\n\n4. 生成syso文件（我们最终只需要这个文件）：\n\n   ```bash\n   ./rsrc.exe -manifest main.manifest -ico favicon.ico -o main.syso\n   ```\n\n5. `go build -ldflags=\"-H windowsgui\"` 得到exe文件，此时生成的exe文件图标就是自己设置的。\n","source":"_posts/project-flash-files.md","raw":"---\ntitle: 一个基于GO的局域网文件互传工具\ndate: 2022-05-14 14:31:27\ntags: golang\ncategories: 项目\ndescription: 一个基于GO语言的「局域网PC与手机互传文件，且不想借助微信/QQ等骚扰软件」的软件\n---\n\n## 前言\n\n最近在学习 Go 语言，语法看得差不多了，想着找点什么项目做做，正好我一直想做一个「局域网PC与手机互传文件，且不想借助微信/QQ等骚扰软件」的软件，于是就用 Go 来做了，最终截图如下：\n\n![闪电传](http://blogpic.at15cm.com/flash_files_1.png)\n\n![闪电传](http://blogpic.at15cm.com/flash_files_1.png)\n\n![闪电传](http://blogpic.at15cm.com/flash_files_3.png)\n\n功能很简单：\n\n1. PC 上传文字或文件后创建二维码，提供给手机浏览器扫码下载\n2. 手机在浏览器上传文字或文件后自动用 websocket 通知给 PC 端，弹出下载提示\n\n[源码在此](https://github.com/ArthurWangCN/flash-files)，这里主要说一下实现思路。\n\n\n\n## 工具\n\n+ VSCode或者GoLand\n\n+ zserge/lorca：一个制作桌面应用的库\n\n+ React\n\n+ gin-gonic/gin：提供服务器接口\n\n+ gorilla/websocket：实现websocket通知\n\n+ skip2/go-qrcode：生成二维码\n\n+ go\n\n  版本：1.17或以上。\n\n  需要做的配置：\n\n  ```shell\n  go env -w GO111MODULE=on\n  go env -w GOPROXY=https://goproxy.cn,direct\n  ```\n\n  安装gowatch\n\n  ```shell\n  go get github.com/silenceper/gowatch\n  ```\n\n\n\n## 整体思路\n\n![闪电传](http://blogpic.at15cm.com/flash_files_4.png)\n\n1. 用 Lorca 搞出一个窗口\n2. 用 HTML 制作界面，用 JS 调用后台接口\n3. 用 Gin 实现后台接口\n4. 上传的文件都放到 uploads 文件夹中\n\n\n\n## 用 Lorca 创建窗口\n\n我了解到 Go 的如下库可以实现窗口：\n\n1. [lorca](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzserge%2Florca) - 调用系统现有的 Chrome/Edge 实现简单的窗口，UI 通过 HTML/CSS/JS 实现\n2. [webview](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwebview%2Fwebview) - 比 lorca 功能更强，实现 UI 的思路差不多\n3. [fyne](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffyne-io%2Ffyne) - 使用 Canvas 绘制的 UI 框架，性能不错\n4. [qt](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftherecipe%2Fqt) - 更复杂更强大的 UI 框架\n\n我随便挑了个最简单的 Lorca 就开始了。\n\n示例代码：\n\n```go\nvar ui lorca.UI\nui, _ = lorca.New(\"http://www.baidu.com\", \"\", 800, 600, \"--disable-sync\", \"--disable-translate\")\n```\n\n\n\n## 前端制作 UI\n\n我用 React + ReactRouter 来实现页面结构，文件上传和对话框是自己用原生 JS 写的，UI 细节用 CSS3 来做，没有依赖其他 UI 组件库。\n\nLorca 的主要功能就是展示我写的 index.html。\n\n\n\n## 用 gin 实现后台接口\n\n前端项目用到了五个接口，我使用 gin 来实现：\n\n```go\nrouter.GET(\"/uploads/:path\", controllers.UploadsController)              \nrouter.GET(\"/api/v1/addresses\", controllers.AddressesController) \nrouter.GET(\"/api/v1/qrcodes\", controllers.QrcodesController)   \nrouter.POST(\"/api/v1/files\", controllers.FilesController)      \nrouter.POST(\"/api/v1/texts\", controllers.TextsController)\n```\n\n其中的二维码生成我用的是 [go-qrcode](https://github.com/skip2/go-qrcode)。\n\n\n\n## 用 [gorilla/websocket](https://github.com/gorilla/websocket) 实现手机通知 PC\n\n\n\n## 给exe文件添加图标\n\n正常 `go build` 后exe文件是默认图标，但可以设置自己想要的图标。\n\n网上找了一些文章，花里胡哨的，这里简单粗暴。需要一个名为 **rsrc** 工具：\n\n1. 克隆rsrc源代码，并打包生成exe文件\n\n   ```bash\n   git clone https://github.com/akavel/rsrc.git\n   ```\n\n   ```bash\n   cd rsrc\n   go build\n   ```\n\n   生成 **rsrc.exe**，并拷贝到当前项目根目录。\n\n2. 根目录创建配置文件main.manifest：\n\n   ```xml\n   <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n   <assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\">\n   <assemblyIdentity\n       version=\"1.0.0.0\"\n       processorArchitecture=\"x86\"\n       name=\"controls\"\n       type=\"win32\"\n   ></assemblyIdentity>\n   <dependency>\n       <dependentAssembly>\n           <assemblyIdentity\n               type=\"win32\"\n               name=\"Microsoft.Windows.Common-Controls\"\n               version=\"6.0.0.0\"\n               processorArchitecture=\"*\"\n               publicKeyToken=\"6595b64144ccf1df\"\n               language=\"*\"\n           ></assemblyIdentity>\n       </dependentAssembly>\n   </dependency>\n   </assembly>\n   ```\n\n3. 制作你想要的图标favicon.ico，并放到根目录；\n\n4. 生成syso文件（我们最终只需要这个文件）：\n\n   ```bash\n   ./rsrc.exe -manifest main.manifest -ico favicon.ico -o main.syso\n   ```\n\n5. `go build -ldflags=\"-H windowsgui\"` 得到exe文件，此时生成的exe文件图标就是自己设置的。\n","slug":"project-flash-files","published":1,"updated":"2022-05-14T06:33:53.360Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsib002jyt8wc4ne1x81","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>最近在学习 Go 语言，语法看得差不多了，想着找点什么项目做做，正好我一直想做一个「局域网PC与手机互传文件，且不想借助微信&#x2F;QQ等骚扰软件」的软件，于是就用 Go 来做了，最终截图如下：</p>\n<p><img src=\"http://blogpic.at15cm.com/flash_files_1.png\" alt=\"闪电传\"></p>\n<p><img src=\"http://blogpic.at15cm.com/flash_files_1.png\" alt=\"闪电传\"></p>\n<p><img src=\"http://blogpic.at15cm.com/flash_files_3.png\" alt=\"闪电传\"></p>\n<p>功能很简单：</p>\n<ol>\n<li>PC 上传文字或文件后创建二维码，提供给手机浏览器扫码下载</li>\n<li>手机在浏览器上传文字或文件后自动用 websocket 通知给 PC 端，弹出下载提示</li>\n</ol>\n<p><a href=\"https://github.com/ArthurWangCN/flash-files\">源码在此</a>，这里主要说一下实现思路。</p>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><ul>\n<li><p>VSCode或者GoLand</p>\n</li>\n<li><p>zserge&#x2F;lorca：一个制作桌面应用的库</p>\n</li>\n<li><p>React</p>\n</li>\n<li><p>gin-gonic&#x2F;gin：提供服务器接口</p>\n</li>\n<li><p>gorilla&#x2F;websocket：实现websocket通知</p>\n</li>\n<li><p>skip2&#x2F;go-qrcode：生成二维码</p>\n</li>\n<li><p>go</p>\n<p>版本：1.17或以上。</p>\n<p>需要做的配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go env -w GO111MODULE=on</span><br><span class=\"line\">go env -w GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure>\n\n<p>安装gowatch</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get github.com/silenceper/gowatch</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"整体思路\"><a href=\"#整体思路\" class=\"headerlink\" title=\"整体思路\"></a>整体思路</h2><p><img src=\"http://blogpic.at15cm.com/flash_files_4.png\" alt=\"闪电传\"></p>\n<ol>\n<li>用 Lorca 搞出一个窗口</li>\n<li>用 HTML 制作界面，用 JS 调用后台接口</li>\n<li>用 Gin 实现后台接口</li>\n<li>上传的文件都放到 uploads 文件夹中</li>\n</ol>\n<h2 id=\"用-Lorca-创建窗口\"><a href=\"#用-Lorca-创建窗口\" class=\"headerlink\" title=\"用 Lorca 创建窗口\"></a>用 Lorca 创建窗口</h2><p>我了解到 Go 的如下库可以实现窗口：</p>\n<ol>\n<li><a href=\"https://link.juejin.cn/?target=https://github.com/zserge/lorca\">lorca</a> - 调用系统现有的 Chrome&#x2F;Edge 实现简单的窗口，UI 通过 HTML&#x2F;CSS&#x2F;JS 实现</li>\n<li><a href=\"https://link.juejin.cn/?target=https://github.com/webview/webview\">webview</a> - 比 lorca 功能更强，实现 UI 的思路差不多</li>\n<li><a href=\"https://link.juejin.cn/?target=https://github.com/fyne-io/fyne\">fyne</a> - 使用 Canvas 绘制的 UI 框架，性能不错</li>\n<li><a href=\"https://link.juejin.cn/?target=https://github.com/therecipe/qt\">qt</a> - 更复杂更强大的 UI 框架</li>\n</ol>\n<p>我随便挑了个最简单的 Lorca 就开始了。</p>\n<p>示例代码：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ui lorca.UI</span><br><span class=\"line\">ui, _ = lorca.New(<span class=\"string\">&quot;http://www.baidu.com&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">800</span>, <span class=\"number\">600</span>, <span class=\"string\">&quot;--disable-sync&quot;</span>, <span class=\"string\">&quot;--disable-translate&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"前端制作-UI\"><a href=\"#前端制作-UI\" class=\"headerlink\" title=\"前端制作 UI\"></a>前端制作 UI</h2><p>我用 React + ReactRouter 来实现页面结构，文件上传和对话框是自己用原生 JS 写的，UI 细节用 CSS3 来做，没有依赖其他 UI 组件库。</p>\n<p>Lorca 的主要功能就是展示我写的 index.html。</p>\n<h2 id=\"用-gin-实现后台接口\"><a href=\"#用-gin-实现后台接口\" class=\"headerlink\" title=\"用 gin 实现后台接口\"></a>用 gin 实现后台接口</h2><p>前端项目用到了五个接口，我使用 gin 来实现：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.GET(<span class=\"string\">&quot;/uploads/:path&quot;</span>, controllers.UploadsController)              </span><br><span class=\"line\">router.GET(<span class=\"string\">&quot;/api/v1/addresses&quot;</span>, controllers.AddressesController) </span><br><span class=\"line\">router.GET(<span class=\"string\">&quot;/api/v1/qrcodes&quot;</span>, controllers.QrcodesController)   </span><br><span class=\"line\">router.POST(<span class=\"string\">&quot;/api/v1/files&quot;</span>, controllers.FilesController)      </span><br><span class=\"line\">router.POST(<span class=\"string\">&quot;/api/v1/texts&quot;</span>, controllers.TextsController)</span><br></pre></td></tr></table></figure>\n\n<p>其中的二维码生成我用的是 <a href=\"https://github.com/skip2/go-qrcode\">go-qrcode</a>。</p>\n<h2 id=\"用-gorilla-x2F-websocket-实现手机通知-PC\"><a href=\"#用-gorilla-x2F-websocket-实现手机通知-PC\" class=\"headerlink\" title=\"用 gorilla&#x2F;websocket 实现手机通知 PC\"></a>用 <a href=\"https://github.com/gorilla/websocket\">gorilla&#x2F;websocket</a> 实现手机通知 PC</h2><h2 id=\"给exe文件添加图标\"><a href=\"#给exe文件添加图标\" class=\"headerlink\" title=\"给exe文件添加图标\"></a>给exe文件添加图标</h2><p>正常 <code>go build</code> 后exe文件是默认图标，但可以设置自己想要的图标。</p>\n<p>网上找了一些文章，花里胡哨的，这里简单粗暴。需要一个名为 <strong>rsrc</strong> 工具：</p>\n<ol>\n<li><p>克隆rsrc源代码，并打包生成exe文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/akavel/rsrc.git</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> rsrc</span><br><span class=\"line\">go build</span><br></pre></td></tr></table></figure>\n\n<p>生成 <strong>rsrc.exe</strong>，并拷贝到当前项目根目录。</p>\n</li>\n<li><p>根目录创建配置文件main.manifest：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span> standalone=<span class=\"string\">&quot;yes&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">assembly</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span> <span class=\"attr\">manifestVersion</span>=<span class=\"string\">&quot;1.0&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">assemblyIdentity</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">version</span>=<span class=\"string\">&quot;1.0.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">processorArchitecture</span>=<span class=\"string\">&quot;x86&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">name</span>=<span class=\"string\">&quot;controls&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">type</span>=<span class=\"string\">&quot;win32&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">assemblyIdentity</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependentAssembly</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">assemblyIdentity</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">type</span>=<span class=\"string\">&quot;win32&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">name</span>=<span class=\"string\">&quot;Microsoft.Windows.Common-Controls&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">version</span>=<span class=\"string\">&quot;6.0.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">processorArchitecture</span>=<span class=\"string\">&quot;*&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">publicKeyToken</span>=<span class=\"string\">&quot;6595b64144ccf1df&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">language</span>=<span class=\"string\">&quot;*&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        &gt;</span><span class=\"tag\">&lt;/<span class=\"name\">assemblyIdentity</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependentAssembly</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">assembly</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>制作你想要的图标favicon.ico，并放到根目录；</p>\n</li>\n<li><p>生成syso文件（我们最终只需要这个文件）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./rsrc.exe -manifest main.manifest -ico favicon.ico -o main.syso</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>go build -ldflags=&quot;-H windowsgui&quot;</code> 得到exe文件，此时生成的exe文件图标就是自己设置的。</p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>最近在学习 Go 语言，语法看得差不多了，想着找点什么项目做做，正好我一直想做一个「局域网PC与手机互传文件，且不想借助微信&#x2F;QQ等骚扰软件」的软件，于是就用 Go 来做了，最终截图如下：</p>\n<p><img src=\"http://blogpic.at15cm.com/flash_files_1.png\" alt=\"闪电传\"></p>\n<p><img src=\"http://blogpic.at15cm.com/flash_files_1.png\" alt=\"闪电传\"></p>\n<p><img src=\"http://blogpic.at15cm.com/flash_files_3.png\" alt=\"闪电传\"></p>\n<p>功能很简单：</p>\n<ol>\n<li>PC 上传文字或文件后创建二维码，提供给手机浏览器扫码下载</li>\n<li>手机在浏览器上传文字或文件后自动用 websocket 通知给 PC 端，弹出下载提示</li>\n</ol>\n<p><a href=\"https://github.com/ArthurWangCN/flash-files\">源码在此</a>，这里主要说一下实现思路。</p>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><ul>\n<li><p>VSCode或者GoLand</p>\n</li>\n<li><p>zserge&#x2F;lorca：一个制作桌面应用的库</p>\n</li>\n<li><p>React</p>\n</li>\n<li><p>gin-gonic&#x2F;gin：提供服务器接口</p>\n</li>\n<li><p>gorilla&#x2F;websocket：实现websocket通知</p>\n</li>\n<li><p>skip2&#x2F;go-qrcode：生成二维码</p>\n</li>\n<li><p>go</p>\n<p>版本：1.17或以上。</p>\n<p>需要做的配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go env -w GO111MODULE=on</span><br><span class=\"line\">go env -w GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure>\n\n<p>安装gowatch</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get github.com/silenceper/gowatch</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"整体思路\"><a href=\"#整体思路\" class=\"headerlink\" title=\"整体思路\"></a>整体思路</h2><p><img src=\"http://blogpic.at15cm.com/flash_files_4.png\" alt=\"闪电传\"></p>\n<ol>\n<li>用 Lorca 搞出一个窗口</li>\n<li>用 HTML 制作界面，用 JS 调用后台接口</li>\n<li>用 Gin 实现后台接口</li>\n<li>上传的文件都放到 uploads 文件夹中</li>\n</ol>\n<h2 id=\"用-Lorca-创建窗口\"><a href=\"#用-Lorca-创建窗口\" class=\"headerlink\" title=\"用 Lorca 创建窗口\"></a>用 Lorca 创建窗口</h2><p>我了解到 Go 的如下库可以实现窗口：</p>\n<ol>\n<li><a href=\"https://link.juejin.cn/?target=https://github.com/zserge/lorca\">lorca</a> - 调用系统现有的 Chrome&#x2F;Edge 实现简单的窗口，UI 通过 HTML&#x2F;CSS&#x2F;JS 实现</li>\n<li><a href=\"https://link.juejin.cn/?target=https://github.com/webview/webview\">webview</a> - 比 lorca 功能更强，实现 UI 的思路差不多</li>\n<li><a href=\"https://link.juejin.cn/?target=https://github.com/fyne-io/fyne\">fyne</a> - 使用 Canvas 绘制的 UI 框架，性能不错</li>\n<li><a href=\"https://link.juejin.cn/?target=https://github.com/therecipe/qt\">qt</a> - 更复杂更强大的 UI 框架</li>\n</ol>\n<p>我随便挑了个最简单的 Lorca 就开始了。</p>\n<p>示例代码：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ui lorca.UI</span><br><span class=\"line\">ui, _ = lorca.New(<span class=\"string\">&quot;http://www.baidu.com&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">800</span>, <span class=\"number\">600</span>, <span class=\"string\">&quot;--disable-sync&quot;</span>, <span class=\"string\">&quot;--disable-translate&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"前端制作-UI\"><a href=\"#前端制作-UI\" class=\"headerlink\" title=\"前端制作 UI\"></a>前端制作 UI</h2><p>我用 React + ReactRouter 来实现页面结构，文件上传和对话框是自己用原生 JS 写的，UI 细节用 CSS3 来做，没有依赖其他 UI 组件库。</p>\n<p>Lorca 的主要功能就是展示我写的 index.html。</p>\n<h2 id=\"用-gin-实现后台接口\"><a href=\"#用-gin-实现后台接口\" class=\"headerlink\" title=\"用 gin 实现后台接口\"></a>用 gin 实现后台接口</h2><p>前端项目用到了五个接口，我使用 gin 来实现：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.GET(<span class=\"string\">&quot;/uploads/:path&quot;</span>, controllers.UploadsController)              </span><br><span class=\"line\">router.GET(<span class=\"string\">&quot;/api/v1/addresses&quot;</span>, controllers.AddressesController) </span><br><span class=\"line\">router.GET(<span class=\"string\">&quot;/api/v1/qrcodes&quot;</span>, controllers.QrcodesController)   </span><br><span class=\"line\">router.POST(<span class=\"string\">&quot;/api/v1/files&quot;</span>, controllers.FilesController)      </span><br><span class=\"line\">router.POST(<span class=\"string\">&quot;/api/v1/texts&quot;</span>, controllers.TextsController)</span><br></pre></td></tr></table></figure>\n\n<p>其中的二维码生成我用的是 <a href=\"https://github.com/skip2/go-qrcode\">go-qrcode</a>。</p>\n<h2 id=\"用-gorilla-x2F-websocket-实现手机通知-PC\"><a href=\"#用-gorilla-x2F-websocket-实现手机通知-PC\" class=\"headerlink\" title=\"用 gorilla&#x2F;websocket 实现手机通知 PC\"></a>用 <a href=\"https://github.com/gorilla/websocket\">gorilla&#x2F;websocket</a> 实现手机通知 PC</h2><h2 id=\"给exe文件添加图标\"><a href=\"#给exe文件添加图标\" class=\"headerlink\" title=\"给exe文件添加图标\"></a>给exe文件添加图标</h2><p>正常 <code>go build</code> 后exe文件是默认图标，但可以设置自己想要的图标。</p>\n<p>网上找了一些文章，花里胡哨的，这里简单粗暴。需要一个名为 <strong>rsrc</strong> 工具：</p>\n<ol>\n<li><p>克隆rsrc源代码，并打包生成exe文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/akavel/rsrc.git</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> rsrc</span><br><span class=\"line\">go build</span><br></pre></td></tr></table></figure>\n\n<p>生成 <strong>rsrc.exe</strong>，并拷贝到当前项目根目录。</p>\n</li>\n<li><p>根目录创建配置文件main.manifest：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span> standalone=<span class=\"string\">&quot;yes&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">assembly</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span> <span class=\"attr\">manifestVersion</span>=<span class=\"string\">&quot;1.0&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">assemblyIdentity</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">version</span>=<span class=\"string\">&quot;1.0.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">processorArchitecture</span>=<span class=\"string\">&quot;x86&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">name</span>=<span class=\"string\">&quot;controls&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">type</span>=<span class=\"string\">&quot;win32&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">assemblyIdentity</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependentAssembly</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">assemblyIdentity</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">type</span>=<span class=\"string\">&quot;win32&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">name</span>=<span class=\"string\">&quot;Microsoft.Windows.Common-Controls&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">version</span>=<span class=\"string\">&quot;6.0.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">processorArchitecture</span>=<span class=\"string\">&quot;*&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">publicKeyToken</span>=<span class=\"string\">&quot;6595b64144ccf1df&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">language</span>=<span class=\"string\">&quot;*&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        &gt;</span><span class=\"tag\">&lt;/<span class=\"name\">assemblyIdentity</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependentAssembly</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">assembly</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>制作你想要的图标favicon.ico，并放到根目录；</p>\n</li>\n<li><p>生成syso文件（我们最终只需要这个文件）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./rsrc.exe -manifest main.manifest -ico favicon.ico -o main.syso</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>go build -ldflags=&quot;-H windowsgui&quot;</code> 得到exe文件，此时生成的exe文件图标就是自己设置的。</p>\n</li>\n</ol>\n"},{"title":"reduce 简介","date":"2022-06-07T14:15:44.000Z","description":"对于新手来说， reduce 没有 map、 forEach、 filter 等数组方法那么友好。但是不得不说，它们能干的事情， reduce 一个不落下。","_content":"\n## 前言\n\n对于新手来说， `reduce` 没有 `map`、 `forEach`、 `filter` 等数组方法那么友好。但是不得不说，它们能干的事情， `reduce` 一个不落下。\n\n\n\n## 语法\n\n`reduce` 接收 2 个参数： 第一个参数是回调函数（必选），第二个参数是初始值 `initialValue`（可选） 。\n\n而第一个参数（回调函数），接收下面四个参数：\n\n- Accumulator (acc) (累计器)\n- Current Value (cur) (当前值)\n- Current Index (idx) (当前索引)\n- Source Array (src) (源数组)\n\n我们平时在业务中多数使用到的是前两个参数，并且有以下两种情况。\n\n**浏览器支持情况**\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a64ce496d4884780820b94dcefd75480~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)\n\n**不带初始值**\n\n```js\n[1,2,3,4].reduce((acc, cur) => {\n  return acc + cur\n})\n// 1 + 2 + 3 + 4\n// 10\n\n```\n\n**带初始值**\n\n```js\n[1,2,3,4].reduce((acc, cur) => {\n  return acc + cur\n}, 10)\n// 10 + 1 + 2 + 3 + 4\n// 20\n```\n\n> **初始值 `initialValue` 可以是任意类型。如果没有提供 `initialValue`，`reduce` 会从索引 1 的地方开始执行 `callback` 方法，跳过第一个索引。如果提供 `initialValue`，从索引 0 开始。**\n\n它的执行就像一个贪吃蛇，蛇每吃一个豆子，豆子将会变成蛇身的一部分，蛇再去吃下一个豆子。\n\n\n\n## reduce实现数组API\n\n**1. reduce -> map**\n\n`map` 方法接收一个回调函数，函数内接收三个参数，当前项、索引、原数组，返回一个新的数组，并且数组长度不变。 知道了这些特征之后，我们用 `reduce` 重塑 `map` 。\n\n```js\nconst testArr = [1, 2, 3, 4]\nArray.prototype.reduceMap = function(callback) {\n  return this.reduce((acc, cur, index, array) => {\n    const item = callback(cur, index, array)\n    acc.push(item)\n    return acc\n  }, [])\n}\ntestArr.reduceMap((item, index) => {\n  return item + index\n})\n// [1, 3, 5, 7]\n```\n\n在 `Array` 的原型链上添加 `reduceMap` 方法，接收一个回调函数 `callback` 作为参数（就是 `map` 传入的回调函数），内部通过 `this` 拿到当前需要操作的数组，这里 `reduce` 方法的第二个参数初始值很关键，需要设置成一个 `[]` ，这样便于后面把操作完的单项塞入 `acc` 。我们需要给 `callback` 方法传入三个值，当前项、索引、原数组，也就是原生 `map` 回调函数能拿到的值。返回 `item` 塞进 `acc`，并且返回 `acc` ，作为下一个循环的 `acc`（贪吃蛇原理）。最终 `this.reduce` 返回了新的数组，并且长度不变。\n\n\n\n**2. reduce -> forEach**\n\n`forEach` 接收一个回调函数作为参数，函数内接收四个参数当前项、索引、原函数、当执行回调函数 `callback` 时，用作 `this` 的值，并且不返回值。\n\n```js\nconst testArr = [1, 2, 3, 4]\nArray.prototype.reduceForEach = function(callback) {\n  this.reduce((acc, cur, index, array) => {\n    callback(cur, index, array)\n  }, [])\n}\n\ntestArr.reduceForEach((item, index, array) => {\n  console.log(item, index)\n})\n// 1234\n// 0123\n```\n\n只要看得懂 `reduce` -> `map` ，转 `forEach` 只是改改结构的问题。\n\n\n\n**3. reduce -> filter**\n\n`filter` 同样接收一个回调函数，回调函数返回 `true` 则返回当前项，反之则不返回。回调函数接收的参数同 `forEach` 。\n\n```js\nconst testArr = [1, 2, 3, 4]\nArray.prototype.reduceFilter = function (callback) {\n   return this.reduce((acc, cur, index, array) => {\n    if (callback(cur, index, array)) {\n      acc.push(cur)\n    }\n    return acc\n  }, [])\n}\ntestArr.reduceFilter(item => item % 2 == 0) // 过滤出偶数项。\n// [2, 4]\n```\n\n`filter` 方法中 `callback` 返回的是 `Boolean` 类型，所以通过 `if` 判断是否要塞入累计器 `acc` ，并且返回 `acc` 给下一次对比。最终返回整个过滤后的数组。\n\n\n\n**4. reduce -> find**\n\n`find` 方法中 `callback` 同样也是返回 `Boolean` 类型，返回你要找的第一个符合要求的项。\n\n```js\nconst testArr = [1, 2, 3, 4]\nconst testObj = [{ a: 1 }, { a: 2 }, { a: 3 }, { a: 4 }]\nArray.prototype.reduceFind = function (callback) {\n  return this.reduce((acc, cur, index, array) => {\n    if (callback(cur, index, array)) {\n      if (acc instanceof Array && acc.length == 0) {\n      \tacc = cur\n      }\n    }\n    // 循环到最后若 acc 还是数组，且长度为 0，代表没有找到想要的项，则 acc = undefined\n    if ((index == array.length - 1) && acc instanceof Array && acc.length == 0) {\n      acc = undefined\n    }\n    return acc\n  }, [])\n}\ntestArr.reduceFind(item => item % 2 == 0) // 2\ntestObj.reduceFind(item => item.a % 2 == 0) // {a: 2}\ntestObj.reduceFind(item => item.a % 9 == 0) // undefined\n```\n\n你不知道操作的数组是对象数组还是普通数组，所以这里只能直接覆盖 `acc` 的值，找到第一个符合判断标准的值就不再进行赋值操作。\n\n\n\n## reduce实战\n\n也许在业务中对 `reduce` 使用频率并不高，那是因为你没有很好的去理解它。在很多业务场景下，你用了更麻烦、更冗余的代码完成了你的需求。接下带大家学习一些用 `reduce` 能解决的问题。\n\n**1. 将二维数组转为一维数组**\n\n```js\nconst testArr = [[1,2], [3,4], [5,6]]\ntestArr.reduce((acc, cur) => {\n  return acc.concat(cur)\n}, [])\n// [1,2,3,4,5,6]\n```\n\n\n\n**2. 计算数组中每个元素出现的个数**\n\n```js\nconst testArr = [1, 3, 4, 1, 3, 2, 9, 8, 5, 3, 2, 0, 12, 10]\ntestArr.reduce((acc, cur) => {\n  if (!(cur in acc)) {\n    acc[cur] = 1\n  } else {\n    acc[cur] += 1\n  }\n  return acc\n}, {})\n\n// {0: 1, 1: 2, 2: 2, 3: 3, 4: 1, 5: 1, 8: 1, 9: 1, 10: 1, 12: 1}\n```\n\n这里注意，我初始化的值变成了 `{}` ,这个需求需要键值对的形式，利用 `cur in acc` 判断累计器 `acc` 中是否含有 `cur` 属性，如果没有默认赋值 1，如果已经存在 `+= 1` 累加一次。 在实际的开发业务中，这个方法非常常用，变种也很多。比如给你一个账单列表（项与项之间的消费类型有相同情况），让你统计账单列表中各个消费类型的支出情况，如 `购物` 、 `学习` 、 `转账` 等消费类型的支出情况。这就用到了上述方法，去通过归类。\n\n\n\n**3. 按属性给数组分类**\n\n什么叫按照属性给数组分类，其实就是给定一个依据，把符合条件的归并到一起。再拿账单举例，就是按各个消费类型归为一类。\n\n```js\nconst bills = [\n  { type: 'shop', momey: 223 },\n  { type: 'study', momey: 341 },\n  { type: 'shop', momey: 821 },\n  { type: 'transfer', momey: 821 },\n  { type: 'study', momey: 821 }\n];\nbills.reduce((acc, cur) => {\n  // 如果不存在这个键，则设置它赋值 [] 空数组\n  if (!acc[cur.type]) {\n    acc[cur.type] = [];\n  }\n  acc[cur.type].push(cur)\n  return acc\n}, {})\n```\n\n结果：\n\n```js\n{\n    \"shop\": [\n        {\n            \"type\": \"shop\",\n            \"momey\": 223\n        },\n        {\n            \"type\": \"shop\",\n            \"momey\": 821\n        }\n    ],\n    \"study\": [\n        {\n            \"type\": \"study\",\n            \"momey\": 341\n        },\n        {\n            \"type\": \"study\",\n            \"momey\": 821\n        }\n    ],\n    \"transfer\": [\n        {\n            \"type\": \"transfer\",\n            \"momey\": 821\n        }\n    ]\n}\n```\n\n\n\n**4. 数组去重**\n\n```js\nconst testArr = [1,2,2,3,4,4,5,5,5,6,7]\ntestArr.reduce((acc, cur) => {\n  if (!(acc.includes(cur))) {\n    acc.push(cur)\n  }\n  return acc\n}, [])\n// [1, 2, 3, 4, 5, 6, 7]\n```\n\n上述代码逻辑，就是逐一对比，通过 `includes` 方法检查累计器里是否已经有当前项。\n\n\n\n**5. 求最大值或最小值**\n\n一个对象数组内，我想拿到某一项里某个属性最大或者最小的那一项。\n\n```js\nconst testArr = [\n  { age: 20 },\n  { age: 21 },\n  { age: 22 }\n]\ntestArr.reduce((acc, cur) => {\n  if (!acc) {\n    acc = cur\n    return acc\n  }\n  if (acc.age < cur.age) {\n    acc = cur\n    return acc\n  }\n  return acc\n}, 0)\n// {age: 22}\n```\n\n第一次没有对比直接 `acc` 赋值 `cur` ，后面进入对比判断，如果 `acc` 的 `age` 属性小于 `cur` 的 `age` 属性，重制 `acc` 。相等的话默认返回 `acc` 。\n\n\n\n## 总结\n\n`reduce` 的使用场景还有非常多，当你遇到数组复杂操作的时候，就是它大显身手的时候。深入研究它，对你今后的业务开发及面试都有很大的帮助。\n","source":"_posts/reduce.md","raw":"---\ntitle: reduce 简介\ndate: 2022-06-07 22:15:44\ntags:\ncategories: JavaScript\ndescription: 对于新手来说， reduce 没有 map、 forEach、 filter 等数组方法那么友好。但是不得不说，它们能干的事情， reduce 一个不落下。\n---\n\n## 前言\n\n对于新手来说， `reduce` 没有 `map`、 `forEach`、 `filter` 等数组方法那么友好。但是不得不说，它们能干的事情， `reduce` 一个不落下。\n\n\n\n## 语法\n\n`reduce` 接收 2 个参数： 第一个参数是回调函数（必选），第二个参数是初始值 `initialValue`（可选） 。\n\n而第一个参数（回调函数），接收下面四个参数：\n\n- Accumulator (acc) (累计器)\n- Current Value (cur) (当前值)\n- Current Index (idx) (当前索引)\n- Source Array (src) (源数组)\n\n我们平时在业务中多数使用到的是前两个参数，并且有以下两种情况。\n\n**浏览器支持情况**\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a64ce496d4884780820b94dcefd75480~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)\n\n**不带初始值**\n\n```js\n[1,2,3,4].reduce((acc, cur) => {\n  return acc + cur\n})\n// 1 + 2 + 3 + 4\n// 10\n\n```\n\n**带初始值**\n\n```js\n[1,2,3,4].reduce((acc, cur) => {\n  return acc + cur\n}, 10)\n// 10 + 1 + 2 + 3 + 4\n// 20\n```\n\n> **初始值 `initialValue` 可以是任意类型。如果没有提供 `initialValue`，`reduce` 会从索引 1 的地方开始执行 `callback` 方法，跳过第一个索引。如果提供 `initialValue`，从索引 0 开始。**\n\n它的执行就像一个贪吃蛇，蛇每吃一个豆子，豆子将会变成蛇身的一部分，蛇再去吃下一个豆子。\n\n\n\n## reduce实现数组API\n\n**1. reduce -> map**\n\n`map` 方法接收一个回调函数，函数内接收三个参数，当前项、索引、原数组，返回一个新的数组，并且数组长度不变。 知道了这些特征之后，我们用 `reduce` 重塑 `map` 。\n\n```js\nconst testArr = [1, 2, 3, 4]\nArray.prototype.reduceMap = function(callback) {\n  return this.reduce((acc, cur, index, array) => {\n    const item = callback(cur, index, array)\n    acc.push(item)\n    return acc\n  }, [])\n}\ntestArr.reduceMap((item, index) => {\n  return item + index\n})\n// [1, 3, 5, 7]\n```\n\n在 `Array` 的原型链上添加 `reduceMap` 方法，接收一个回调函数 `callback` 作为参数（就是 `map` 传入的回调函数），内部通过 `this` 拿到当前需要操作的数组，这里 `reduce` 方法的第二个参数初始值很关键，需要设置成一个 `[]` ，这样便于后面把操作完的单项塞入 `acc` 。我们需要给 `callback` 方法传入三个值，当前项、索引、原数组，也就是原生 `map` 回调函数能拿到的值。返回 `item` 塞进 `acc`，并且返回 `acc` ，作为下一个循环的 `acc`（贪吃蛇原理）。最终 `this.reduce` 返回了新的数组，并且长度不变。\n\n\n\n**2. reduce -> forEach**\n\n`forEach` 接收一个回调函数作为参数，函数内接收四个参数当前项、索引、原函数、当执行回调函数 `callback` 时，用作 `this` 的值，并且不返回值。\n\n```js\nconst testArr = [1, 2, 3, 4]\nArray.prototype.reduceForEach = function(callback) {\n  this.reduce((acc, cur, index, array) => {\n    callback(cur, index, array)\n  }, [])\n}\n\ntestArr.reduceForEach((item, index, array) => {\n  console.log(item, index)\n})\n// 1234\n// 0123\n```\n\n只要看得懂 `reduce` -> `map` ，转 `forEach` 只是改改结构的问题。\n\n\n\n**3. reduce -> filter**\n\n`filter` 同样接收一个回调函数，回调函数返回 `true` 则返回当前项，反之则不返回。回调函数接收的参数同 `forEach` 。\n\n```js\nconst testArr = [1, 2, 3, 4]\nArray.prototype.reduceFilter = function (callback) {\n   return this.reduce((acc, cur, index, array) => {\n    if (callback(cur, index, array)) {\n      acc.push(cur)\n    }\n    return acc\n  }, [])\n}\ntestArr.reduceFilter(item => item % 2 == 0) // 过滤出偶数项。\n// [2, 4]\n```\n\n`filter` 方法中 `callback` 返回的是 `Boolean` 类型，所以通过 `if` 判断是否要塞入累计器 `acc` ，并且返回 `acc` 给下一次对比。最终返回整个过滤后的数组。\n\n\n\n**4. reduce -> find**\n\n`find` 方法中 `callback` 同样也是返回 `Boolean` 类型，返回你要找的第一个符合要求的项。\n\n```js\nconst testArr = [1, 2, 3, 4]\nconst testObj = [{ a: 1 }, { a: 2 }, { a: 3 }, { a: 4 }]\nArray.prototype.reduceFind = function (callback) {\n  return this.reduce((acc, cur, index, array) => {\n    if (callback(cur, index, array)) {\n      if (acc instanceof Array && acc.length == 0) {\n      \tacc = cur\n      }\n    }\n    // 循环到最后若 acc 还是数组，且长度为 0，代表没有找到想要的项，则 acc = undefined\n    if ((index == array.length - 1) && acc instanceof Array && acc.length == 0) {\n      acc = undefined\n    }\n    return acc\n  }, [])\n}\ntestArr.reduceFind(item => item % 2 == 0) // 2\ntestObj.reduceFind(item => item.a % 2 == 0) // {a: 2}\ntestObj.reduceFind(item => item.a % 9 == 0) // undefined\n```\n\n你不知道操作的数组是对象数组还是普通数组，所以这里只能直接覆盖 `acc` 的值，找到第一个符合判断标准的值就不再进行赋值操作。\n\n\n\n## reduce实战\n\n也许在业务中对 `reduce` 使用频率并不高，那是因为你没有很好的去理解它。在很多业务场景下，你用了更麻烦、更冗余的代码完成了你的需求。接下带大家学习一些用 `reduce` 能解决的问题。\n\n**1. 将二维数组转为一维数组**\n\n```js\nconst testArr = [[1,2], [3,4], [5,6]]\ntestArr.reduce((acc, cur) => {\n  return acc.concat(cur)\n}, [])\n// [1,2,3,4,5,6]\n```\n\n\n\n**2. 计算数组中每个元素出现的个数**\n\n```js\nconst testArr = [1, 3, 4, 1, 3, 2, 9, 8, 5, 3, 2, 0, 12, 10]\ntestArr.reduce((acc, cur) => {\n  if (!(cur in acc)) {\n    acc[cur] = 1\n  } else {\n    acc[cur] += 1\n  }\n  return acc\n}, {})\n\n// {0: 1, 1: 2, 2: 2, 3: 3, 4: 1, 5: 1, 8: 1, 9: 1, 10: 1, 12: 1}\n```\n\n这里注意，我初始化的值变成了 `{}` ,这个需求需要键值对的形式，利用 `cur in acc` 判断累计器 `acc` 中是否含有 `cur` 属性，如果没有默认赋值 1，如果已经存在 `+= 1` 累加一次。 在实际的开发业务中，这个方法非常常用，变种也很多。比如给你一个账单列表（项与项之间的消费类型有相同情况），让你统计账单列表中各个消费类型的支出情况，如 `购物` 、 `学习` 、 `转账` 等消费类型的支出情况。这就用到了上述方法，去通过归类。\n\n\n\n**3. 按属性给数组分类**\n\n什么叫按照属性给数组分类，其实就是给定一个依据，把符合条件的归并到一起。再拿账单举例，就是按各个消费类型归为一类。\n\n```js\nconst bills = [\n  { type: 'shop', momey: 223 },\n  { type: 'study', momey: 341 },\n  { type: 'shop', momey: 821 },\n  { type: 'transfer', momey: 821 },\n  { type: 'study', momey: 821 }\n];\nbills.reduce((acc, cur) => {\n  // 如果不存在这个键，则设置它赋值 [] 空数组\n  if (!acc[cur.type]) {\n    acc[cur.type] = [];\n  }\n  acc[cur.type].push(cur)\n  return acc\n}, {})\n```\n\n结果：\n\n```js\n{\n    \"shop\": [\n        {\n            \"type\": \"shop\",\n            \"momey\": 223\n        },\n        {\n            \"type\": \"shop\",\n            \"momey\": 821\n        }\n    ],\n    \"study\": [\n        {\n            \"type\": \"study\",\n            \"momey\": 341\n        },\n        {\n            \"type\": \"study\",\n            \"momey\": 821\n        }\n    ],\n    \"transfer\": [\n        {\n            \"type\": \"transfer\",\n            \"momey\": 821\n        }\n    ]\n}\n```\n\n\n\n**4. 数组去重**\n\n```js\nconst testArr = [1,2,2,3,4,4,5,5,5,6,7]\ntestArr.reduce((acc, cur) => {\n  if (!(acc.includes(cur))) {\n    acc.push(cur)\n  }\n  return acc\n}, [])\n// [1, 2, 3, 4, 5, 6, 7]\n```\n\n上述代码逻辑，就是逐一对比，通过 `includes` 方法检查累计器里是否已经有当前项。\n\n\n\n**5. 求最大值或最小值**\n\n一个对象数组内，我想拿到某一项里某个属性最大或者最小的那一项。\n\n```js\nconst testArr = [\n  { age: 20 },\n  { age: 21 },\n  { age: 22 }\n]\ntestArr.reduce((acc, cur) => {\n  if (!acc) {\n    acc = cur\n    return acc\n  }\n  if (acc.age < cur.age) {\n    acc = cur\n    return acc\n  }\n  return acc\n}, 0)\n// {age: 22}\n```\n\n第一次没有对比直接 `acc` 赋值 `cur` ，后面进入对比判断，如果 `acc` 的 `age` 属性小于 `cur` 的 `age` 属性，重制 `acc` 。相等的话默认返回 `acc` 。\n\n\n\n## 总结\n\n`reduce` 的使用场景还有非常多，当你遇到数组复杂操作的时候，就是它大显身手的时候。深入研究它，对你今后的业务开发及面试都有很大的帮助。\n","slug":"reduce","published":1,"updated":"2022-06-07T14:17:49.318Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsic002nyt8wg51zgd4q","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>对于新手来说， <code>reduce</code> 没有 <code>map</code>、 <code>forEach</code>、 <code>filter</code> 等数组方法那么友好。但是不得不说，它们能干的事情， <code>reduce</code> 一个不落下。</p>\n<h2 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h2><p><code>reduce</code> 接收 2 个参数： 第一个参数是回调函数（必选），第二个参数是初始值 <code>initialValue</code>（可选） 。</p>\n<p>而第一个参数（回调函数），接收下面四个参数：</p>\n<ul>\n<li>Accumulator (acc) (累计器)</li>\n<li>Current Value (cur) (当前值)</li>\n<li>Current Index (idx) (当前索引)</li>\n<li>Source Array (src) (源数组)</li>\n</ul>\n<p>我们平时在业务中多数使用到的是前两个参数，并且有以下两种情况。</p>\n<p><strong>浏览器支持情况</strong></p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a64ce496d4884780820b94dcefd75480~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<p><strong>不带初始值</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>].<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc + cur</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 1 + 2 + 3 + 4</span></span><br><span class=\"line\"><span class=\"comment\">// 10</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>带初始值</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>].<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc + cur</span><br><span class=\"line\">&#125;, <span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"comment\">// 10 + 1 + 2 + 3 + 4</span></span><br><span class=\"line\"><span class=\"comment\">// 20</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><strong>初始值 <code>initialValue</code> 可以是任意类型。如果没有提供 <code>initialValue</code>，<code>reduce</code> 会从索引 1 的地方开始执行 <code>callback</code> 方法，跳过第一个索引。如果提供 <code>initialValue</code>，从索引 0 开始。</strong></p>\n</blockquote>\n<p>它的执行就像一个贪吃蛇，蛇每吃一个豆子，豆子将会变成蛇身的一部分，蛇再去吃下一个豆子。</p>\n<h2 id=\"reduce实现数组API\"><a href=\"#reduce实现数组API\" class=\"headerlink\" title=\"reduce实现数组API\"></a>reduce实现数组API</h2><p><strong>1. reduce -&gt; map</strong></p>\n<p><code>map</code> 方法接收一个回调函数，函数内接收三个参数，当前项、索引、原数组，返回一个新的数组，并且数组长度不变。 知道了这些特征之后，我们用 <code>reduce</code> 重塑 <code>map</code> 。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"title class_\">Array</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">reduceMap</span> = <span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur, index, array</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> item = <span class=\"title function_\">callback</span>(cur, index, array)</span><br><span class=\"line\">    acc.<span class=\"title function_\">push</span>(item)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">  &#125;, [])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduceMap</span>(<span class=\"function\">(<span class=\"params\">item, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item + index</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// [1, 3, 5, 7]</span></span><br></pre></td></tr></table></figure>\n\n<p>在 <code>Array</code> 的原型链上添加 <code>reduceMap</code> 方法，接收一个回调函数 <code>callback</code> 作为参数（就是 <code>map</code> 传入的回调函数），内部通过 <code>this</code> 拿到当前需要操作的数组，这里 <code>reduce</code> 方法的第二个参数初始值很关键，需要设置成一个 <code>[]</code> ，这样便于后面把操作完的单项塞入 <code>acc</code> 。我们需要给 <code>callback</code> 方法传入三个值，当前项、索引、原数组，也就是原生 <code>map</code> 回调函数能拿到的值。返回 <code>item</code> 塞进 <code>acc</code>，并且返回 <code>acc</code> ，作为下一个循环的 <code>acc</code>（贪吃蛇原理）。最终 <code>this.reduce</code> 返回了新的数组，并且长度不变。</p>\n<p><strong>2. reduce -&gt; forEach</strong></p>\n<p><code>forEach</code> 接收一个回调函数作为参数，函数内接收四个参数当前项、索引、原函数、当执行回调函数 <code>callback</code> 时，用作 <code>this</code> 的值，并且不返回值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"title class_\">Array</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">reduceForEach</span> = <span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur, index, array</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">callback</span>(cur, index, array)</span><br><span class=\"line\">  &#125;, [])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">testArr.<span class=\"title function_\">reduceForEach</span>(<span class=\"function\">(<span class=\"params\">item, index, array</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(item, index)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 1234</span></span><br><span class=\"line\"><span class=\"comment\">// 0123</span></span><br></pre></td></tr></table></figure>\n\n<p>只要看得懂 <code>reduce</code> -&gt; <code>map</code> ，转 <code>forEach</code> 只是改改结构的问题。</p>\n<p><strong>3. reduce -&gt; filter</strong></p>\n<p><code>filter</code> 同样接收一个回调函数，回调函数返回 <code>true</code> 则返回当前项，反之则不返回。回调函数接收的参数同 <code>forEach</code> 。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"title class_\">Array</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">reduceFilter</span> = <span class=\"keyword\">function</span> (<span class=\"params\">callback</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur, index, array</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_\">callback</span>(cur, index, array)) &#123;</span><br><span class=\"line\">      acc.<span class=\"title function_\">push</span>(cur)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">  &#125;, [])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduceFilter</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item % <span class=\"number\">2</span> == <span class=\"number\">0</span>) <span class=\"comment\">// 过滤出偶数项。</span></span><br><span class=\"line\"><span class=\"comment\">// [2, 4]</span></span><br></pre></td></tr></table></figure>\n\n<p><code>filter</code> 方法中 <code>callback</code> 返回的是 <code>Boolean</code> 类型，所以通过 <code>if</code> 判断是否要塞入累计器 <code>acc</code> ，并且返回 <code>acc</code> 给下一次对比。最终返回整个过滤后的数组。</p>\n<p><strong>4. reduce -&gt; find</strong></p>\n<p><code>find</code> 方法中 <code>callback</code> 同样也是返回 <code>Boolean</code> 类型，返回你要找的第一个符合要求的项。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"keyword\">const</span> testObj = [&#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span> &#125;, &#123; <span class=\"attr\">a</span>: <span class=\"number\">2</span> &#125;, &#123; <span class=\"attr\">a</span>: <span class=\"number\">3</span> &#125;, &#123; <span class=\"attr\">a</span>: <span class=\"number\">4</span> &#125;]</span><br><span class=\"line\"><span class=\"title class_\">Array</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">reduceFind</span> = <span class=\"keyword\">function</span> (<span class=\"params\">callback</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur, index, array</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_\">callback</span>(cur, index, array)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (acc <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Array</span> &amp;&amp; acc.<span class=\"property\">length</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      \tacc = cur</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 循环到最后若 acc 还是数组，且长度为 0，代表没有找到想要的项，则 acc = undefined</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((index == array.<span class=\"property\">length</span> - <span class=\"number\">1</span>) &amp;&amp; acc <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Array</span> &amp;&amp; acc.<span class=\"property\">length</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      acc = <span class=\"literal\">undefined</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">  &#125;, [])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduceFind</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item % <span class=\"number\">2</span> == <span class=\"number\">0</span>) <span class=\"comment\">// 2</span></span><br><span class=\"line\">testObj.<span class=\"title function_\">reduceFind</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.<span class=\"property\">a</span> % <span class=\"number\">2</span> == <span class=\"number\">0</span>) <span class=\"comment\">// &#123;a: 2&#125;</span></span><br><span class=\"line\">testObj.<span class=\"title function_\">reduceFind</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.<span class=\"property\">a</span> % <span class=\"number\">9</span> == <span class=\"number\">0</span>) <span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure>\n\n<p>你不知道操作的数组是对象数组还是普通数组，所以这里只能直接覆盖 <code>acc</code> 的值，找到第一个符合判断标准的值就不再进行赋值操作。</p>\n<h2 id=\"reduce实战\"><a href=\"#reduce实战\" class=\"headerlink\" title=\"reduce实战\"></a>reduce实战</h2><p>也许在业务中对 <code>reduce</code> 使用频率并不高，那是因为你没有很好的去理解它。在很多业务场景下，你用了更麻烦、更冗余的代码完成了你的需求。接下带大家学习一些用 <code>reduce</code> 能解决的问题。</p>\n<p><strong>1. 将二维数组转为一维数组</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [[<span class=\"number\">1</span>,<span class=\"number\">2</span>], [<span class=\"number\">3</span>,<span class=\"number\">4</span>], [<span class=\"number\">5</span>,<span class=\"number\">6</span>]]</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc.<span class=\"title function_\">concat</span>(cur)</span><br><span class=\"line\">&#125;, [])</span><br><span class=\"line\"><span class=\"comment\">// [1,2,3,4,5,6]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>2. 计算数组中每个元素出现的个数</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"number\">9</span>, <span class=\"number\">8</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"number\">0</span>, <span class=\"number\">12</span>, <span class=\"number\">10</span>]</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!(cur <span class=\"keyword\">in</span> acc)) &#123;</span><br><span class=\"line\">    acc[cur] = <span class=\"number\">1</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    acc[cur] += <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">&#125;, &#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// &#123;0: 1, 1: 2, 2: 2, 3: 3, 4: 1, 5: 1, 8: 1, 9: 1, 10: 1, 12: 1&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>这里注意，我初始化的值变成了 <code>&#123;&#125;</code> ,这个需求需要键值对的形式，利用 <code>cur in acc</code> 判断累计器 <code>acc</code> 中是否含有 <code>cur</code> 属性，如果没有默认赋值 1，如果已经存在 <code>+= 1</code> 累加一次。 在实际的开发业务中，这个方法非常常用，变种也很多。比如给你一个账单列表（项与项之间的消费类型有相同情况），让你统计账单列表中各个消费类型的支出情况，如 <code>购物</code> 、 <code>学习</code> 、 <code>转账</code> 等消费类型的支出情况。这就用到了上述方法，去通过归类。</p>\n<p><strong>3. 按属性给数组分类</strong></p>\n<p>什么叫按照属性给数组分类，其实就是给定一个依据，把符合条件的归并到一起。再拿账单举例，就是按各个消费类型归为一类。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> bills = [</span><br><span class=\"line\">  &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;shop&#x27;</span>, <span class=\"attr\">momey</span>: <span class=\"number\">223</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;study&#x27;</span>, <span class=\"attr\">momey</span>: <span class=\"number\">341</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;shop&#x27;</span>, <span class=\"attr\">momey</span>: <span class=\"number\">821</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;transfer&#x27;</span>, <span class=\"attr\">momey</span>: <span class=\"number\">821</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;study&#x27;</span>, <span class=\"attr\">momey</span>: <span class=\"number\">821</span> &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\">bills.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 如果不存在这个键，则设置它赋值 [] 空数组</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!acc[cur.<span class=\"property\">type</span>]) &#123;</span><br><span class=\"line\">    acc[cur.<span class=\"property\">type</span>] = [];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  acc[cur.<span class=\"property\">type</span>].<span class=\"title function_\">push</span>(cur)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">&#125;, &#123;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>结果：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;shop&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;shop&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;momey&quot;</span>: <span class=\"number\">223</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;shop&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;momey&quot;</span>: <span class=\"number\">821</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;study&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;study&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;momey&quot;</span>: <span class=\"number\">341</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;study&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;momey&quot;</span>: <span class=\"number\">821</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;transfer&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;transfer&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;momey&quot;</span>: <span class=\"number\">821</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>4. 数组去重</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">5</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>]</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!(acc.<span class=\"title function_\">includes</span>(cur))) &#123;</span><br><span class=\"line\">    acc.<span class=\"title function_\">push</span>(cur)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">&#125;, [])</span><br><span class=\"line\"><span class=\"comment\">// [1, 2, 3, 4, 5, 6, 7]</span></span><br></pre></td></tr></table></figure>\n\n<p>上述代码逻辑，就是逐一对比，通过 <code>includes</code> 方法检查累计器里是否已经有当前项。</p>\n<p><strong>5. 求最大值或最小值</strong></p>\n<p>一个对象数组内，我想拿到某一项里某个属性最大或者最小的那一项。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [</span><br><span class=\"line\">  &#123; <span class=\"attr\">age</span>: <span class=\"number\">20</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">age</span>: <span class=\"number\">21</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">age</span>: <span class=\"number\">22</span> &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!acc) &#123;</span><br><span class=\"line\">    acc = cur</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (acc.<span class=\"property\">age</span> &lt; cur.<span class=\"property\">age</span>) &#123;</span><br><span class=\"line\">    acc = cur</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"comment\">// &#123;age: 22&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>第一次没有对比直接 <code>acc</code> 赋值 <code>cur</code> ，后面进入对比判断，如果 <code>acc</code> 的 <code>age</code> 属性小于 <code>cur</code> 的 <code>age</code> 属性，重制 <code>acc</code> 。相等的话默认返回 <code>acc</code> 。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p><code>reduce</code> 的使用场景还有非常多，当你遇到数组复杂操作的时候，就是它大显身手的时候。深入研究它，对你今后的业务开发及面试都有很大的帮助。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>对于新手来说， <code>reduce</code> 没有 <code>map</code>、 <code>forEach</code>、 <code>filter</code> 等数组方法那么友好。但是不得不说，它们能干的事情， <code>reduce</code> 一个不落下。</p>\n<h2 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h2><p><code>reduce</code> 接收 2 个参数： 第一个参数是回调函数（必选），第二个参数是初始值 <code>initialValue</code>（可选） 。</p>\n<p>而第一个参数（回调函数），接收下面四个参数：</p>\n<ul>\n<li>Accumulator (acc) (累计器)</li>\n<li>Current Value (cur) (当前值)</li>\n<li>Current Index (idx) (当前索引)</li>\n<li>Source Array (src) (源数组)</li>\n</ul>\n<p>我们平时在业务中多数使用到的是前两个参数，并且有以下两种情况。</p>\n<p><strong>浏览器支持情况</strong></p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a64ce496d4884780820b94dcefd75480~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<p><strong>不带初始值</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>].<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc + cur</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 1 + 2 + 3 + 4</span></span><br><span class=\"line\"><span class=\"comment\">// 10</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>带初始值</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>].<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc + cur</span><br><span class=\"line\">&#125;, <span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"comment\">// 10 + 1 + 2 + 3 + 4</span></span><br><span class=\"line\"><span class=\"comment\">// 20</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><strong>初始值 <code>initialValue</code> 可以是任意类型。如果没有提供 <code>initialValue</code>，<code>reduce</code> 会从索引 1 的地方开始执行 <code>callback</code> 方法，跳过第一个索引。如果提供 <code>initialValue</code>，从索引 0 开始。</strong></p>\n</blockquote>\n<p>它的执行就像一个贪吃蛇，蛇每吃一个豆子，豆子将会变成蛇身的一部分，蛇再去吃下一个豆子。</p>\n<h2 id=\"reduce实现数组API\"><a href=\"#reduce实现数组API\" class=\"headerlink\" title=\"reduce实现数组API\"></a>reduce实现数组API</h2><p><strong>1. reduce -&gt; map</strong></p>\n<p><code>map</code> 方法接收一个回调函数，函数内接收三个参数，当前项、索引、原数组，返回一个新的数组，并且数组长度不变。 知道了这些特征之后，我们用 <code>reduce</code> 重塑 <code>map</code> 。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"title class_\">Array</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">reduceMap</span> = <span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur, index, array</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> item = <span class=\"title function_\">callback</span>(cur, index, array)</span><br><span class=\"line\">    acc.<span class=\"title function_\">push</span>(item)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">  &#125;, [])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduceMap</span>(<span class=\"function\">(<span class=\"params\">item, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item + index</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// [1, 3, 5, 7]</span></span><br></pre></td></tr></table></figure>\n\n<p>在 <code>Array</code> 的原型链上添加 <code>reduceMap</code> 方法，接收一个回调函数 <code>callback</code> 作为参数（就是 <code>map</code> 传入的回调函数），内部通过 <code>this</code> 拿到当前需要操作的数组，这里 <code>reduce</code> 方法的第二个参数初始值很关键，需要设置成一个 <code>[]</code> ，这样便于后面把操作完的单项塞入 <code>acc</code> 。我们需要给 <code>callback</code> 方法传入三个值，当前项、索引、原数组，也就是原生 <code>map</code> 回调函数能拿到的值。返回 <code>item</code> 塞进 <code>acc</code>，并且返回 <code>acc</code> ，作为下一个循环的 <code>acc</code>（贪吃蛇原理）。最终 <code>this.reduce</code> 返回了新的数组，并且长度不变。</p>\n<p><strong>2. reduce -&gt; forEach</strong></p>\n<p><code>forEach</code> 接收一个回调函数作为参数，函数内接收四个参数当前项、索引、原函数、当执行回调函数 <code>callback</code> 时，用作 <code>this</code> 的值，并且不返回值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"title class_\">Array</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">reduceForEach</span> = <span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur, index, array</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">callback</span>(cur, index, array)</span><br><span class=\"line\">  &#125;, [])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">testArr.<span class=\"title function_\">reduceForEach</span>(<span class=\"function\">(<span class=\"params\">item, index, array</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(item, index)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 1234</span></span><br><span class=\"line\"><span class=\"comment\">// 0123</span></span><br></pre></td></tr></table></figure>\n\n<p>只要看得懂 <code>reduce</code> -&gt; <code>map</code> ，转 <code>forEach</code> 只是改改结构的问题。</p>\n<p><strong>3. reduce -&gt; filter</strong></p>\n<p><code>filter</code> 同样接收一个回调函数，回调函数返回 <code>true</code> 则返回当前项，反之则不返回。回调函数接收的参数同 <code>forEach</code> 。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"title class_\">Array</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">reduceFilter</span> = <span class=\"keyword\">function</span> (<span class=\"params\">callback</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur, index, array</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_\">callback</span>(cur, index, array)) &#123;</span><br><span class=\"line\">      acc.<span class=\"title function_\">push</span>(cur)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">  &#125;, [])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduceFilter</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item % <span class=\"number\">2</span> == <span class=\"number\">0</span>) <span class=\"comment\">// 过滤出偶数项。</span></span><br><span class=\"line\"><span class=\"comment\">// [2, 4]</span></span><br></pre></td></tr></table></figure>\n\n<p><code>filter</code> 方法中 <code>callback</code> 返回的是 <code>Boolean</code> 类型，所以通过 <code>if</code> 判断是否要塞入累计器 <code>acc</code> ，并且返回 <code>acc</code> 给下一次对比。最终返回整个过滤后的数组。</p>\n<p><strong>4. reduce -&gt; find</strong></p>\n<p><code>find</code> 方法中 <code>callback</code> 同样也是返回 <code>Boolean</code> 类型，返回你要找的第一个符合要求的项。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"keyword\">const</span> testObj = [&#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span> &#125;, &#123; <span class=\"attr\">a</span>: <span class=\"number\">2</span> &#125;, &#123; <span class=\"attr\">a</span>: <span class=\"number\">3</span> &#125;, &#123; <span class=\"attr\">a</span>: <span class=\"number\">4</span> &#125;]</span><br><span class=\"line\"><span class=\"title class_\">Array</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">reduceFind</span> = <span class=\"keyword\">function</span> (<span class=\"params\">callback</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur, index, array</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_\">callback</span>(cur, index, array)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (acc <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Array</span> &amp;&amp; acc.<span class=\"property\">length</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      \tacc = cur</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 循环到最后若 acc 还是数组，且长度为 0，代表没有找到想要的项，则 acc = undefined</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((index == array.<span class=\"property\">length</span> - <span class=\"number\">1</span>) &amp;&amp; acc <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Array</span> &amp;&amp; acc.<span class=\"property\">length</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      acc = <span class=\"literal\">undefined</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">  &#125;, [])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduceFind</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item % <span class=\"number\">2</span> == <span class=\"number\">0</span>) <span class=\"comment\">// 2</span></span><br><span class=\"line\">testObj.<span class=\"title function_\">reduceFind</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.<span class=\"property\">a</span> % <span class=\"number\">2</span> == <span class=\"number\">0</span>) <span class=\"comment\">// &#123;a: 2&#125;</span></span><br><span class=\"line\">testObj.<span class=\"title function_\">reduceFind</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.<span class=\"property\">a</span> % <span class=\"number\">9</span> == <span class=\"number\">0</span>) <span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure>\n\n<p>你不知道操作的数组是对象数组还是普通数组，所以这里只能直接覆盖 <code>acc</code> 的值，找到第一个符合判断标准的值就不再进行赋值操作。</p>\n<h2 id=\"reduce实战\"><a href=\"#reduce实战\" class=\"headerlink\" title=\"reduce实战\"></a>reduce实战</h2><p>也许在业务中对 <code>reduce</code> 使用频率并不高，那是因为你没有很好的去理解它。在很多业务场景下，你用了更麻烦、更冗余的代码完成了你的需求。接下带大家学习一些用 <code>reduce</code> 能解决的问题。</p>\n<p><strong>1. 将二维数组转为一维数组</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [[<span class=\"number\">1</span>,<span class=\"number\">2</span>], [<span class=\"number\">3</span>,<span class=\"number\">4</span>], [<span class=\"number\">5</span>,<span class=\"number\">6</span>]]</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc.<span class=\"title function_\">concat</span>(cur)</span><br><span class=\"line\">&#125;, [])</span><br><span class=\"line\"><span class=\"comment\">// [1,2,3,4,5,6]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>2. 计算数组中每个元素出现的个数</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"number\">9</span>, <span class=\"number\">8</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"number\">0</span>, <span class=\"number\">12</span>, <span class=\"number\">10</span>]</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!(cur <span class=\"keyword\">in</span> acc)) &#123;</span><br><span class=\"line\">    acc[cur] = <span class=\"number\">1</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    acc[cur] += <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">&#125;, &#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// &#123;0: 1, 1: 2, 2: 2, 3: 3, 4: 1, 5: 1, 8: 1, 9: 1, 10: 1, 12: 1&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>这里注意，我初始化的值变成了 <code>&#123;&#125;</code> ,这个需求需要键值对的形式，利用 <code>cur in acc</code> 判断累计器 <code>acc</code> 中是否含有 <code>cur</code> 属性，如果没有默认赋值 1，如果已经存在 <code>+= 1</code> 累加一次。 在实际的开发业务中，这个方法非常常用，变种也很多。比如给你一个账单列表（项与项之间的消费类型有相同情况），让你统计账单列表中各个消费类型的支出情况，如 <code>购物</code> 、 <code>学习</code> 、 <code>转账</code> 等消费类型的支出情况。这就用到了上述方法，去通过归类。</p>\n<p><strong>3. 按属性给数组分类</strong></p>\n<p>什么叫按照属性给数组分类，其实就是给定一个依据，把符合条件的归并到一起。再拿账单举例，就是按各个消费类型归为一类。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> bills = [</span><br><span class=\"line\">  &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;shop&#x27;</span>, <span class=\"attr\">momey</span>: <span class=\"number\">223</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;study&#x27;</span>, <span class=\"attr\">momey</span>: <span class=\"number\">341</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;shop&#x27;</span>, <span class=\"attr\">momey</span>: <span class=\"number\">821</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;transfer&#x27;</span>, <span class=\"attr\">momey</span>: <span class=\"number\">821</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;study&#x27;</span>, <span class=\"attr\">momey</span>: <span class=\"number\">821</span> &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\">bills.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 如果不存在这个键，则设置它赋值 [] 空数组</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!acc[cur.<span class=\"property\">type</span>]) &#123;</span><br><span class=\"line\">    acc[cur.<span class=\"property\">type</span>] = [];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  acc[cur.<span class=\"property\">type</span>].<span class=\"title function_\">push</span>(cur)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">&#125;, &#123;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>结果：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;shop&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;shop&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;momey&quot;</span>: <span class=\"number\">223</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;shop&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;momey&quot;</span>: <span class=\"number\">821</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;study&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;study&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;momey&quot;</span>: <span class=\"number\">341</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;study&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;momey&quot;</span>: <span class=\"number\">821</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;transfer&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;transfer&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;momey&quot;</span>: <span class=\"number\">821</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>4. 数组去重</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">5</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>]</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!(acc.<span class=\"title function_\">includes</span>(cur))) &#123;</span><br><span class=\"line\">    acc.<span class=\"title function_\">push</span>(cur)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">&#125;, [])</span><br><span class=\"line\"><span class=\"comment\">// [1, 2, 3, 4, 5, 6, 7]</span></span><br></pre></td></tr></table></figure>\n\n<p>上述代码逻辑，就是逐一对比，通过 <code>includes</code> 方法检查累计器里是否已经有当前项。</p>\n<p><strong>5. 求最大值或最小值</strong></p>\n<p>一个对象数组内，我想拿到某一项里某个属性最大或者最小的那一项。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testArr = [</span><br><span class=\"line\">  &#123; <span class=\"attr\">age</span>: <span class=\"number\">20</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">age</span>: <span class=\"number\">21</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">age</span>: <span class=\"number\">22</span> &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\">testArr.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!acc) &#123;</span><br><span class=\"line\">    acc = cur</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (acc.<span class=\"property\">age</span> &lt; cur.<span class=\"property\">age</span>) &#123;</span><br><span class=\"line\">    acc = cur</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> acc</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"comment\">// &#123;age: 22&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>第一次没有对比直接 <code>acc</code> 赋值 <code>cur</code> ，后面进入对比判断，如果 <code>acc</code> 的 <code>age</code> 属性小于 <code>cur</code> 的 <code>age</code> 属性，重制 <code>acc</code> 。相等的话默认返回 <code>acc</code> 。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p><code>reduce</code> 的使用场景还有非常多，当你遇到数组复杂操作的时候，就是它大显身手的时候。深入研究它，对你今后的业务开发及面试都有很大的帮助。</p>\n"},{"title":"回流和重绘","date":"2022-05-05T14:50:19.000Z","description":"当浏览器发现某个部分发生了点变化影响了布局，需要倒回去重新渲染，内行称这个回退的过程叫 reflow。","_content":"\n在搞清楚回流和重绘的概念之前，我们要清楚浏览器的渲染过程。\n\n## 渲染主流程\n\n渲染引擎首先通过网络获得所请求文档的内容，通常以8K分块的方式完成。下面是渲染引擎在取得内容之后的基本流程：\n\n> 解析html以构建dom树 -> 构建render树 -> 布局render树 -> 绘制render树\n\n\n\n![渲染引擎基本流程](https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/2011110316263715.png)\n\n\n\nwebkit渲染引擎主流程：\n\n![webkit渲染引擎主流程](https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/2221918-20210110190201533-478320795.png)\n\n+ DOM Tree：浏览器将HTML解析成树形的数据结构；\n+ CSS Rule Tree：浏览器将CSS解析成树形的数据结构；\n+ Render Tree: DOM和CSSOM合并后生成Render Tree；\n+ Layout: 有了Render Tree，浏览器已经能知道网页中有哪些节点、各个节点的CSS定义以及他们的从属关系，从而去计算出每个节点在屏幕中的位置；\n+ painting: 按照算出来的规则，通过显卡，把内容画到屏幕上。\n\n\n\n**更详细一点来说：**\n\n 1. 浏览器会**将 HTML 解析成一个 DOM 树**，DOM 树的构建过程是一个深度遍历过程：当前节点的所有子节点都构建好后才会去构建当前节点的下一个兄弟节点。\n\n　　2. 将 CSS 解析成 **CSS Rule Tree** 。\n\n　　3. 根据 DOM 树和 CSSOM 来**构造 Rendering Tree**。*注意：Rendering Tree 渲染树并不等同于 DOM 树，因为一些像 Header 或 display:none 的东西就没必要放在渲染树中了。*\n\n　　4. 有了 Render Tree，浏览器已经能知道网页中有哪些节点、各个节点的 CSS 定义以及他们的从属关系。下一步操作称之为 **layout**，顾名思义就是计算出每个节点在屏幕中的位置。\n\n　　5. 再下一步就是**绘制**，即遍历render树，并使用UI后端层绘制每个节点。\n\n注意：上述这个过程是逐步完成的，为了更好的用户体验，渲染引擎将会尽可能早的将内容呈现到屏幕上，并不会等到所有的html都解析完成之后再去构建和布局render树。它是解析完一部分内容就显示一部分内容，同时，可能还在通过网络下载其余内容。\n\n\n\n## 回流和重绘\n\n**reflow（回流）：**\n\n+ 当浏览器发现某个部分发生了点变化影响了布局，需要倒回去重新渲染，内行称这个回退的过程叫 reflow。\n+ reflow 会从 `<html>` 这个 root frame 开始递归往下，依次计算所有的结点几何尺寸和位置。\n+ reflow 几乎是无法避免的。现在界面上流行的一些效果，比如树状目录的折叠、展开（实质上是元素的显 示与隐藏）等，都将引起浏览器的 reflow。鼠标滑过、点击……只要这些行为引起了页面上某些元素的占位面积、定位方式、边距等属性的变化，都会引起它内部、周围甚至整个页面的重新渲染。\n+ 通常我们都无法预估浏览器到底会 reflow 哪一部分的代码，它们都彼此相互影响着。\n\n\n\n**repaint（重绘）：**\n\n改变某个元素的背景色、文字颜色、边框颜色等等不影响它周围或内部布局的属性时，屏幕的一部分要重画，但是元素的几何尺寸没有变。\n\n\n\n通过上诉我们知道：**回流必定引发重绘，重绘不一定引发回流。回流的代价比重绘高**。\n\n\n\n## 哪些会引起回流和重绘\n\n**回流：**\n\n- DOM的添加和删除；\n- 页面的加载；\n- 元素尺寸改变——边距、填充、边框、宽度和高度；\n- 元素位置的改变；\n- 内容变化，比如用户在input框中输入文字；\n- 浏览器窗口尺寸改变——resize事件发生时；\n\n\n\n**重绘：**\n\ncolor、border-style、visibility、background、text-decoration、outline、border-radius、box-shadow等\n\n\n\n## 如何减少回流和重绘\n\n- 使用 transform 替代 top\n- 使用 visibility 替换 display: none ，因为前者只会引起重绘，后者会引发回流（改变了布局）\n- 不要把节点的属性值放在一个循环里当成循环里的变量。\n- 不要使用 table 布局，可能很小的一个小改动会造成整个 table 的重新布局\n- 动画实现的速度的选择，动画速度越快，回流次数越多，也可以选择使用 requestAnimationFrame\n- CSS 选择符从右往左匹配查找，避免节点层级过多\n- 将频繁重绘或者回流的节点设置为图层，图层能够阻止该节点的渲染行为影响别的节点。比如对于 video 标签来说，浏览器会自动将该节点变为图层。\n\n\n\n浏览器的回流优化机制：浏览器会维护1个队列，把所有会引起重排、重绘的操作放入这个队列，等队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会flush队列，进行一个批处理。这样就会让多次的重排、重绘变成一次重排重绘。\n\n\n\n但是，有些时候你可能会（经常是不知不觉）强制刷新队列并要求计划任务立即执行。获取布局信息的操作会导致队列刷新。因此，尽量不要在修改样式或者布局信息时查询样式，因为查询的时候会强制重排，导致浏览器无法优化多次重排。\n\n\n\n使用绝对位置定位页面上的动画元素，将其脱离文档流，可以有效的防止重排。比如有时候做动画特效时，我们通过设置 `position:absolute` 可以有效的减少重排。\n\n\n\n\n\n## transform是否可以避免重排重绘问题\n\n> CSS的最终表现分为以下四步：`Recalculate Style` -> `Layout` -> `Paint Setup and Paint` -> `Composite Layers`\n\n按照中文的意思大致是 `查找并计算样式 -> 排布 -> 绘制 -> 组合层`。\n\n这上面的几个步骤有点类似于上文说到的重排必定导致重绘，而查询属性会强制发生重排。所以上文提到的重排重绘内容可以结合这里进行理解。\n\n由于 transform 是位于 Composite Layers 层，而 width、left、margin 等则是位于 Layout 层，在 Layout 层发生的改变必定导致 Paint Setup and Paint -> Composite Layers，所以相对而言使用 transform 实现的动画效果肯定比left这些更加流畅。\n\n而且就算抛开这一角度，在另一方面浏览器也会针对 transform 等开启 GPU 加速。\n","source":"_posts/reflow-repaint.md","raw":"---\ntitle: 回流和重绘\ndate: 2022-05-05 22:50:19\ntags: 浏览器\ncategories: 前端\ndescription: 当浏览器发现某个部分发生了点变化影响了布局，需要倒回去重新渲染，内行称这个回退的过程叫 reflow。\n---\n\n在搞清楚回流和重绘的概念之前，我们要清楚浏览器的渲染过程。\n\n## 渲染主流程\n\n渲染引擎首先通过网络获得所请求文档的内容，通常以8K分块的方式完成。下面是渲染引擎在取得内容之后的基本流程：\n\n> 解析html以构建dom树 -> 构建render树 -> 布局render树 -> 绘制render树\n\n\n\n![渲染引擎基本流程](https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/2011110316263715.png)\n\n\n\nwebkit渲染引擎主流程：\n\n![webkit渲染引擎主流程](https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/2221918-20210110190201533-478320795.png)\n\n+ DOM Tree：浏览器将HTML解析成树形的数据结构；\n+ CSS Rule Tree：浏览器将CSS解析成树形的数据结构；\n+ Render Tree: DOM和CSSOM合并后生成Render Tree；\n+ Layout: 有了Render Tree，浏览器已经能知道网页中有哪些节点、各个节点的CSS定义以及他们的从属关系，从而去计算出每个节点在屏幕中的位置；\n+ painting: 按照算出来的规则，通过显卡，把内容画到屏幕上。\n\n\n\n**更详细一点来说：**\n\n 1. 浏览器会**将 HTML 解析成一个 DOM 树**，DOM 树的构建过程是一个深度遍历过程：当前节点的所有子节点都构建好后才会去构建当前节点的下一个兄弟节点。\n\n　　2. 将 CSS 解析成 **CSS Rule Tree** 。\n\n　　3. 根据 DOM 树和 CSSOM 来**构造 Rendering Tree**。*注意：Rendering Tree 渲染树并不等同于 DOM 树，因为一些像 Header 或 display:none 的东西就没必要放在渲染树中了。*\n\n　　4. 有了 Render Tree，浏览器已经能知道网页中有哪些节点、各个节点的 CSS 定义以及他们的从属关系。下一步操作称之为 **layout**，顾名思义就是计算出每个节点在屏幕中的位置。\n\n　　5. 再下一步就是**绘制**，即遍历render树，并使用UI后端层绘制每个节点。\n\n注意：上述这个过程是逐步完成的，为了更好的用户体验，渲染引擎将会尽可能早的将内容呈现到屏幕上，并不会等到所有的html都解析完成之后再去构建和布局render树。它是解析完一部分内容就显示一部分内容，同时，可能还在通过网络下载其余内容。\n\n\n\n## 回流和重绘\n\n**reflow（回流）：**\n\n+ 当浏览器发现某个部分发生了点变化影响了布局，需要倒回去重新渲染，内行称这个回退的过程叫 reflow。\n+ reflow 会从 `<html>` 这个 root frame 开始递归往下，依次计算所有的结点几何尺寸和位置。\n+ reflow 几乎是无法避免的。现在界面上流行的一些效果，比如树状目录的折叠、展开（实质上是元素的显 示与隐藏）等，都将引起浏览器的 reflow。鼠标滑过、点击……只要这些行为引起了页面上某些元素的占位面积、定位方式、边距等属性的变化，都会引起它内部、周围甚至整个页面的重新渲染。\n+ 通常我们都无法预估浏览器到底会 reflow 哪一部分的代码，它们都彼此相互影响着。\n\n\n\n**repaint（重绘）：**\n\n改变某个元素的背景色、文字颜色、边框颜色等等不影响它周围或内部布局的属性时，屏幕的一部分要重画，但是元素的几何尺寸没有变。\n\n\n\n通过上诉我们知道：**回流必定引发重绘，重绘不一定引发回流。回流的代价比重绘高**。\n\n\n\n## 哪些会引起回流和重绘\n\n**回流：**\n\n- DOM的添加和删除；\n- 页面的加载；\n- 元素尺寸改变——边距、填充、边框、宽度和高度；\n- 元素位置的改变；\n- 内容变化，比如用户在input框中输入文字；\n- 浏览器窗口尺寸改变——resize事件发生时；\n\n\n\n**重绘：**\n\ncolor、border-style、visibility、background、text-decoration、outline、border-radius、box-shadow等\n\n\n\n## 如何减少回流和重绘\n\n- 使用 transform 替代 top\n- 使用 visibility 替换 display: none ，因为前者只会引起重绘，后者会引发回流（改变了布局）\n- 不要把节点的属性值放在一个循环里当成循环里的变量。\n- 不要使用 table 布局，可能很小的一个小改动会造成整个 table 的重新布局\n- 动画实现的速度的选择，动画速度越快，回流次数越多，也可以选择使用 requestAnimationFrame\n- CSS 选择符从右往左匹配查找，避免节点层级过多\n- 将频繁重绘或者回流的节点设置为图层，图层能够阻止该节点的渲染行为影响别的节点。比如对于 video 标签来说，浏览器会自动将该节点变为图层。\n\n\n\n浏览器的回流优化机制：浏览器会维护1个队列，把所有会引起重排、重绘的操作放入这个队列，等队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会flush队列，进行一个批处理。这样就会让多次的重排、重绘变成一次重排重绘。\n\n\n\n但是，有些时候你可能会（经常是不知不觉）强制刷新队列并要求计划任务立即执行。获取布局信息的操作会导致队列刷新。因此，尽量不要在修改样式或者布局信息时查询样式，因为查询的时候会强制重排，导致浏览器无法优化多次重排。\n\n\n\n使用绝对位置定位页面上的动画元素，将其脱离文档流，可以有效的防止重排。比如有时候做动画特效时，我们通过设置 `position:absolute` 可以有效的减少重排。\n\n\n\n\n\n## transform是否可以避免重排重绘问题\n\n> CSS的最终表现分为以下四步：`Recalculate Style` -> `Layout` -> `Paint Setup and Paint` -> `Composite Layers`\n\n按照中文的意思大致是 `查找并计算样式 -> 排布 -> 绘制 -> 组合层`。\n\n这上面的几个步骤有点类似于上文说到的重排必定导致重绘，而查询属性会强制发生重排。所以上文提到的重排重绘内容可以结合这里进行理解。\n\n由于 transform 是位于 Composite Layers 层，而 width、left、margin 等则是位于 Layout 层，在 Layout 层发生的改变必定导致 Paint Setup and Paint -> Composite Layers，所以相对而言使用 transform 实现的动画效果肯定比left这些更加流畅。\n\n而且就算抛开这一角度，在另一方面浏览器也会针对 transform 等开启 GPU 加速。\n","slug":"reflow-repaint","published":1,"updated":"2022-05-10T13:38:03.253Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsid002pyt8wely54sbo","content":"<p>在搞清楚回流和重绘的概念之前，我们要清楚浏览器的渲染过程。</p>\n<h2 id=\"渲染主流程\"><a href=\"#渲染主流程\" class=\"headerlink\" title=\"渲染主流程\"></a>渲染主流程</h2><p>渲染引擎首先通过网络获得所请求文档的内容，通常以8K分块的方式完成。下面是渲染引擎在取得内容之后的基本流程：</p>\n<blockquote>\n<p>解析html以构建dom树 -&gt; 构建render树 -&gt; 布局render树 -&gt; 绘制render树</p>\n</blockquote>\n<p><img src=\"https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/2011110316263715.png\" alt=\"渲染引擎基本流程\"></p>\n<p>webkit渲染引擎主流程：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/2221918-20210110190201533-478320795.png\" alt=\"webkit渲染引擎主流程\"></p>\n<ul>\n<li>DOM Tree：浏览器将HTML解析成树形的数据结构；</li>\n<li>CSS Rule Tree：浏览器将CSS解析成树形的数据结构；</li>\n<li>Render Tree: DOM和CSSOM合并后生成Render Tree；</li>\n<li>Layout: 有了Render Tree，浏览器已经能知道网页中有哪些节点、各个节点的CSS定义以及他们的从属关系，从而去计算出每个节点在屏幕中的位置；</li>\n<li>painting: 按照算出来的规则，通过显卡，把内容画到屏幕上。</li>\n</ul>\n<p><strong>更详细一点来说：</strong></p>\n<ol>\n<li>浏览器会<strong>将 HTML 解析成一个 DOM 树</strong>，DOM 树的构建过程是一个深度遍历过程：当前节点的所有子节点都构建好后才会去构建当前节点的下一个兄弟节点。</li>\n</ol>\n<p>　　2. 将 CSS 解析成 <strong>CSS Rule Tree</strong> 。</p>\n<p>　　3. 根据 DOM 树和 CSSOM 来<strong>构造 Rendering Tree</strong>。<em>注意：Rendering Tree 渲染树并不等同于 DOM 树，因为一些像 Header 或 display:none 的东西就没必要放在渲染树中了。</em></p>\n<p>　　4. 有了 Render Tree，浏览器已经能知道网页中有哪些节点、各个节点的 CSS 定义以及他们的从属关系。下一步操作称之为 <strong>layout</strong>，顾名思义就是计算出每个节点在屏幕中的位置。</p>\n<p>　　5. 再下一步就是<strong>绘制</strong>，即遍历render树，并使用UI后端层绘制每个节点。</p>\n<p>注意：上述这个过程是逐步完成的，为了更好的用户体验，渲染引擎将会尽可能早的将内容呈现到屏幕上，并不会等到所有的html都解析完成之后再去构建和布局render树。它是解析完一部分内容就显示一部分内容，同时，可能还在通过网络下载其余内容。</p>\n<h2 id=\"回流和重绘\"><a href=\"#回流和重绘\" class=\"headerlink\" title=\"回流和重绘\"></a>回流和重绘</h2><p><strong>reflow（回流）：</strong></p>\n<ul>\n<li>当浏览器发现某个部分发生了点变化影响了布局，需要倒回去重新渲染，内行称这个回退的过程叫 reflow。</li>\n<li>reflow 会从 <code>&lt;html&gt;</code> 这个 root frame 开始递归往下，依次计算所有的结点几何尺寸和位置。</li>\n<li>reflow 几乎是无法避免的。现在界面上流行的一些效果，比如树状目录的折叠、展开（实质上是元素的显 示与隐藏）等，都将引起浏览器的 reflow。鼠标滑过、点击……只要这些行为引起了页面上某些元素的占位面积、定位方式、边距等属性的变化，都会引起它内部、周围甚至整个页面的重新渲染。</li>\n<li>通常我们都无法预估浏览器到底会 reflow 哪一部分的代码，它们都彼此相互影响着。</li>\n</ul>\n<p><strong>repaint（重绘）：</strong></p>\n<p>改变某个元素的背景色、文字颜色、边框颜色等等不影响它周围或内部布局的属性时，屏幕的一部分要重画，但是元素的几何尺寸没有变。</p>\n<p>通过上诉我们知道：<strong>回流必定引发重绘，重绘不一定引发回流。回流的代价比重绘高</strong>。</p>\n<h2 id=\"哪些会引起回流和重绘\"><a href=\"#哪些会引起回流和重绘\" class=\"headerlink\" title=\"哪些会引起回流和重绘\"></a>哪些会引起回流和重绘</h2><p><strong>回流：</strong></p>\n<ul>\n<li>DOM的添加和删除；</li>\n<li>页面的加载；</li>\n<li>元素尺寸改变——边距、填充、边框、宽度和高度；</li>\n<li>元素位置的改变；</li>\n<li>内容变化，比如用户在input框中输入文字；</li>\n<li>浏览器窗口尺寸改变——resize事件发生时；</li>\n</ul>\n<p><strong>重绘：</strong></p>\n<p>color、border-style、visibility、background、text-decoration、outline、border-radius、box-shadow等</p>\n<h2 id=\"如何减少回流和重绘\"><a href=\"#如何减少回流和重绘\" class=\"headerlink\" title=\"如何减少回流和重绘\"></a>如何减少回流和重绘</h2><ul>\n<li>使用 transform 替代 top</li>\n<li>使用 visibility 替换 display: none ，因为前者只会引起重绘，后者会引发回流（改变了布局）</li>\n<li>不要把节点的属性值放在一个循环里当成循环里的变量。</li>\n<li>不要使用 table 布局，可能很小的一个小改动会造成整个 table 的重新布局</li>\n<li>动画实现的速度的选择，动画速度越快，回流次数越多，也可以选择使用 requestAnimationFrame</li>\n<li>CSS 选择符从右往左匹配查找，避免节点层级过多</li>\n<li>将频繁重绘或者回流的节点设置为图层，图层能够阻止该节点的渲染行为影响别的节点。比如对于 video 标签来说，浏览器会自动将该节点变为图层。</li>\n</ul>\n<p>浏览器的回流优化机制：浏览器会维护1个队列，把所有会引起重排、重绘的操作放入这个队列，等队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会flush队列，进行一个批处理。这样就会让多次的重排、重绘变成一次重排重绘。</p>\n<p>但是，有些时候你可能会（经常是不知不觉）强制刷新队列并要求计划任务立即执行。获取布局信息的操作会导致队列刷新。因此，尽量不要在修改样式或者布局信息时查询样式，因为查询的时候会强制重排，导致浏览器无法优化多次重排。</p>\n<p>使用绝对位置定位页面上的动画元素，将其脱离文档流，可以有效的防止重排。比如有时候做动画特效时，我们通过设置 <code>position:absolute</code> 可以有效的减少重排。</p>\n<h2 id=\"transform是否可以避免重排重绘问题\"><a href=\"#transform是否可以避免重排重绘问题\" class=\"headerlink\" title=\"transform是否可以避免重排重绘问题\"></a>transform是否可以避免重排重绘问题</h2><blockquote>\n<p>CSS的最终表现分为以下四步：<code>Recalculate Style</code> -&gt; <code>Layout</code> -&gt; <code>Paint Setup and Paint</code> -&gt; <code>Composite Layers</code></p>\n</blockquote>\n<p>按照中文的意思大致是 <code>查找并计算样式 -&gt; 排布 -&gt; 绘制 -&gt; 组合层</code>。</p>\n<p>这上面的几个步骤有点类似于上文说到的重排必定导致重绘，而查询属性会强制发生重排。所以上文提到的重排重绘内容可以结合这里进行理解。</p>\n<p>由于 transform 是位于 Composite Layers 层，而 width、left、margin 等则是位于 Layout 层，在 Layout 层发生的改变必定导致 Paint Setup and Paint -&gt; Composite Layers，所以相对而言使用 transform 实现的动画效果肯定比left这些更加流畅。</p>\n<p>而且就算抛开这一角度，在另一方面浏览器也会针对 transform 等开启 GPU 加速。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>在搞清楚回流和重绘的概念之前，我们要清楚浏览器的渲染过程。</p>\n<h2 id=\"渲染主流程\"><a href=\"#渲染主流程\" class=\"headerlink\" title=\"渲染主流程\"></a>渲染主流程</h2><p>渲染引擎首先通过网络获得所请求文档的内容，通常以8K分块的方式完成。下面是渲染引擎在取得内容之后的基本流程：</p>\n<blockquote>\n<p>解析html以构建dom树 -&gt; 构建render树 -&gt; 布局render树 -&gt; 绘制render树</p>\n</blockquote>\n<p><img src=\"https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/2011110316263715.png\" alt=\"渲染引擎基本流程\"></p>\n<p>webkit渲染引擎主流程：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/ArthurWangCN/PictureBed/2221918-20210110190201533-478320795.png\" alt=\"webkit渲染引擎主流程\"></p>\n<ul>\n<li>DOM Tree：浏览器将HTML解析成树形的数据结构；</li>\n<li>CSS Rule Tree：浏览器将CSS解析成树形的数据结构；</li>\n<li>Render Tree: DOM和CSSOM合并后生成Render Tree；</li>\n<li>Layout: 有了Render Tree，浏览器已经能知道网页中有哪些节点、各个节点的CSS定义以及他们的从属关系，从而去计算出每个节点在屏幕中的位置；</li>\n<li>painting: 按照算出来的规则，通过显卡，把内容画到屏幕上。</li>\n</ul>\n<p><strong>更详细一点来说：</strong></p>\n<ol>\n<li>浏览器会<strong>将 HTML 解析成一个 DOM 树</strong>，DOM 树的构建过程是一个深度遍历过程：当前节点的所有子节点都构建好后才会去构建当前节点的下一个兄弟节点。</li>\n</ol>\n<p>　　2. 将 CSS 解析成 <strong>CSS Rule Tree</strong> 。</p>\n<p>　　3. 根据 DOM 树和 CSSOM 来<strong>构造 Rendering Tree</strong>。<em>注意：Rendering Tree 渲染树并不等同于 DOM 树，因为一些像 Header 或 display:none 的东西就没必要放在渲染树中了。</em></p>\n<p>　　4. 有了 Render Tree，浏览器已经能知道网页中有哪些节点、各个节点的 CSS 定义以及他们的从属关系。下一步操作称之为 <strong>layout</strong>，顾名思义就是计算出每个节点在屏幕中的位置。</p>\n<p>　　5. 再下一步就是<strong>绘制</strong>，即遍历render树，并使用UI后端层绘制每个节点。</p>\n<p>注意：上述这个过程是逐步完成的，为了更好的用户体验，渲染引擎将会尽可能早的将内容呈现到屏幕上，并不会等到所有的html都解析完成之后再去构建和布局render树。它是解析完一部分内容就显示一部分内容，同时，可能还在通过网络下载其余内容。</p>\n<h2 id=\"回流和重绘\"><a href=\"#回流和重绘\" class=\"headerlink\" title=\"回流和重绘\"></a>回流和重绘</h2><p><strong>reflow（回流）：</strong></p>\n<ul>\n<li>当浏览器发现某个部分发生了点变化影响了布局，需要倒回去重新渲染，内行称这个回退的过程叫 reflow。</li>\n<li>reflow 会从 <code>&lt;html&gt;</code> 这个 root frame 开始递归往下，依次计算所有的结点几何尺寸和位置。</li>\n<li>reflow 几乎是无法避免的。现在界面上流行的一些效果，比如树状目录的折叠、展开（实质上是元素的显 示与隐藏）等，都将引起浏览器的 reflow。鼠标滑过、点击……只要这些行为引起了页面上某些元素的占位面积、定位方式、边距等属性的变化，都会引起它内部、周围甚至整个页面的重新渲染。</li>\n<li>通常我们都无法预估浏览器到底会 reflow 哪一部分的代码，它们都彼此相互影响着。</li>\n</ul>\n<p><strong>repaint（重绘）：</strong></p>\n<p>改变某个元素的背景色、文字颜色、边框颜色等等不影响它周围或内部布局的属性时，屏幕的一部分要重画，但是元素的几何尺寸没有变。</p>\n<p>通过上诉我们知道：<strong>回流必定引发重绘，重绘不一定引发回流。回流的代价比重绘高</strong>。</p>\n<h2 id=\"哪些会引起回流和重绘\"><a href=\"#哪些会引起回流和重绘\" class=\"headerlink\" title=\"哪些会引起回流和重绘\"></a>哪些会引起回流和重绘</h2><p><strong>回流：</strong></p>\n<ul>\n<li>DOM的添加和删除；</li>\n<li>页面的加载；</li>\n<li>元素尺寸改变——边距、填充、边框、宽度和高度；</li>\n<li>元素位置的改变；</li>\n<li>内容变化，比如用户在input框中输入文字；</li>\n<li>浏览器窗口尺寸改变——resize事件发生时；</li>\n</ul>\n<p><strong>重绘：</strong></p>\n<p>color、border-style、visibility、background、text-decoration、outline、border-radius、box-shadow等</p>\n<h2 id=\"如何减少回流和重绘\"><a href=\"#如何减少回流和重绘\" class=\"headerlink\" title=\"如何减少回流和重绘\"></a>如何减少回流和重绘</h2><ul>\n<li>使用 transform 替代 top</li>\n<li>使用 visibility 替换 display: none ，因为前者只会引起重绘，后者会引发回流（改变了布局）</li>\n<li>不要把节点的属性值放在一个循环里当成循环里的变量。</li>\n<li>不要使用 table 布局，可能很小的一个小改动会造成整个 table 的重新布局</li>\n<li>动画实现的速度的选择，动画速度越快，回流次数越多，也可以选择使用 requestAnimationFrame</li>\n<li>CSS 选择符从右往左匹配查找，避免节点层级过多</li>\n<li>将频繁重绘或者回流的节点设置为图层，图层能够阻止该节点的渲染行为影响别的节点。比如对于 video 标签来说，浏览器会自动将该节点变为图层。</li>\n</ul>\n<p>浏览器的回流优化机制：浏览器会维护1个队列，把所有会引起重排、重绘的操作放入这个队列，等队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会flush队列，进行一个批处理。这样就会让多次的重排、重绘变成一次重排重绘。</p>\n<p>但是，有些时候你可能会（经常是不知不觉）强制刷新队列并要求计划任务立即执行。获取布局信息的操作会导致队列刷新。因此，尽量不要在修改样式或者布局信息时查询样式，因为查询的时候会强制重排，导致浏览器无法优化多次重排。</p>\n<p>使用绝对位置定位页面上的动画元素，将其脱离文档流，可以有效的防止重排。比如有时候做动画特效时，我们通过设置 <code>position:absolute</code> 可以有效的减少重排。</p>\n<h2 id=\"transform是否可以避免重排重绘问题\"><a href=\"#transform是否可以避免重排重绘问题\" class=\"headerlink\" title=\"transform是否可以避免重排重绘问题\"></a>transform是否可以避免重排重绘问题</h2><blockquote>\n<p>CSS的最终表现分为以下四步：<code>Recalculate Style</code> -&gt; <code>Layout</code> -&gt; <code>Paint Setup and Paint</code> -&gt; <code>Composite Layers</code></p>\n</blockquote>\n<p>按照中文的意思大致是 <code>查找并计算样式 -&gt; 排布 -&gt; 绘制 -&gt; 组合层</code>。</p>\n<p>这上面的几个步骤有点类似于上文说到的重排必定导致重绘，而查询属性会强制发生重排。所以上文提到的重排重绘内容可以结合这里进行理解。</p>\n<p>由于 transform 是位于 Composite Layers 层，而 width、left、margin 等则是位于 Layout 层，在 Layout 层发生的改变必定导致 Paint Setup and Paint -&gt; Composite Layers，所以相对而言使用 transform 实现的动画效果肯定比left这些更加流畅。</p>\n<p>而且就算抛开这一角度，在另一方面浏览器也会针对 transform 等开启 GPU 加速。</p>\n"},{"title":"scss 快速入门","date":"2023-03-06T14:38:12.000Z","description":"CSS预处理器用一种专门的编程语言，进行Web页面样式设计，然后再编译成正常的CSS文件，以供项目使用。CSS预处理器为CSS增加一些编程的特性，无需考虑浏览器的兼容性问题。","_content":"\n# scss 快速入门\n\n## 简介\n\nCSS预处理器用一种专门的编程语言，进行Web页面样式设计，然后再编译成正常的CSS文件，以供项目使用。CSS预处理器为CSS增加一些编程的特性，无需考虑浏览器的兼容性问题。 比如说：Sass（SCSS）、LESS、Stylus、Turbine、Swithch CSS、CSS Cacheer、DT CSS等。都属于css预处理器。其中比较优秀的： Sass、LESS，Stylus。\n\nsass 和 scss 的区别？\n\nSass的缩排语法，对于写惯css前端的web开发者来说很不直观，也不能将css代码加入到Sass里面，因此sass语法进行了改良，Sass 3就变成了Scss(sassy css)。与原来的语法兼容，只是用{}取代了原来的缩进。\n\n## 准备工作\n\nscss需要经过编译为css才能被浏览器识别，我这里只做一个小demo所以不上vue-cli，直接使用webpack进行编译。\n\n首先安装css-loader、style-loader、node-sass、sass-loader：\n\n```bash\nnpm install css-loader style-loader --save-dev\nnpm install node-sass sass-loader --save-dev\n```\n\n然后在webpack.config.js配置文件中添加对应的loader,完整的配置图如下：\n\n```js\nconst path = require(\"path\");\nconst {VueLoaderPlugin} = require('vue-loader');\nmodule.exports = {\n    entry: './webapp/App.js',\n    output: {\n        filename: 'App.js',\n        path: path.resolve(__dirname, './dist')\n    },\n\tmodule: {\n\t\trules: [\n            {\n                test: /\\.scss/,\n                use: ['style-loader', 'css-loader','sass-loader']\n            },\n\t\t\t{\n\t\t\t\ttest: /\\.vue$/,\n\t\t\t\tuse: 'vue-loader'\n\t\t\t}\n\t\t]\n\t},\n\tplugins: [\n\t\tnew VueLoaderPlugin()\n\t],\n\tmode: \"production\"\n}\n```\n\n创建一个App.scss文件，接着在入口文件中引入：\n\n```js\nimport './App.scss';\n```\n\n后面我们将在App.scss中编写scss代码。\n\n注意：vite提供了对 .scss, .sass, .less, .styl 和 .stylus 文件的内置支持。没有必要为它们安装特定的 Vite 插件，但必须安装相应的预处理器依赖。\n\n```bash\n# .scss and .sass\nnpm add -D sass\n# .less\nnpm add -D less\n# .styl and .stylus\nnpm add -D stylus\n```\n\n如果使用的是单文件组件，可以通过 `<style lang=\"sass\">`（或其他预处理器）自动开启。\n\n\n## 正式开始\n\n### 使用变量\n\nSCSS中的变量以$开头。\n\n```scss\n$border-color:#aaa; //声明变量\n.container {\n$border-width:1px;\n  border:$border-width solid $border-color; //使用变量\n}\n```\n\n上述例子中定义了两个变量，其中$border-color在大括号之外称为全局变量，顾名思义任何地方都可以使用，$border-width是在.container之内声明的，是一个局部变量，只有.container内部才能使用。\n\n编译后的CSS\n\n```css\n.container {\n  border:1px solid #aaa; //使用变量\n}\n```\n\n我们可以把SCSS看做一个模板引擎，编译的过程中用变量的值去替代变量所占据的位置。\n\ntips:SCSS中变量名使用中划线或下划线都是指向同一变量的，上文中定义了一个变量$border-color，这时再定义一个变量 `$border_color:#ccc`,他们指向同一个变量，.container的值会被第二次定义的变量覆盖。\n\n```scss\n$border-color:#aaa; //声明变量\n$border_color:#ccc;\n.container {\n  $border-width:1px;\n  border:$border-width solid $border-color; //使用变量\n}\n编译后的CSS\n.container {\n  border:1px solid #ccc; //使用变量\n}\n```\n\n这个例子中我们要知道\n\n1. 变量名使用中划线或下划线都是指向同一变量的。\n2. 后定义的变量声明会被忽略，但赋值会被执行，这一点和ES5中var声明变量是一样的。\n\n### 嵌套规则\n我们先来看一个例子：\n\n```css\n/*css*/\n.container ul {\n  border:1px solid #aaa;\n  list-style:none;\n}\n.container ul:after {\n  display:block;\n  content:\"\";\n  clear:both;\n}\n.container ul li {\n  float:left;\n}\n.container ul li>a {\n  display:inline-block;\n  padding:6px 12px;\n}\n```\n\n这是一个让列表元素横向排列的例子，我们在这个例子中写了很多重复的代码，.container写了很多遍，下面我将用SCSS简写上面的例子：\n\n```scss\n.container ul {\n  border:1px solid #aaa;\n  list-style:none;\n  \n  li {\n    float:left;\n    \n    >a {\n      display:inline-block;\n      padding:6px 12px;\n    }\n  }\n  \n  &:after {\n    display:block;\n    content:\"\";\n    clear:both;\n  }\n}\n```\n\n当然也可以嵌套属性：\n\n```css\n/*css*/\nli {\n  border:1px solid #aaa;\n  border-left:0;\n  border-right:0;\n}\n```\n\nscss识别一个属性以分号结尾时则判断为一个属性，以大括号结尾时则判断为一个嵌套属性，规则是将外部的属性以及内部的属性通过中划线连接起来形成一个新的属性。\n\n```scss\n/*scss*/\nli {\n  border:1px solid #aaa {\n    left:0;\n    right:0;\n  }\n}\n```\n\n### 导入SCSS文件\n大型项目中css文件往往不止一个，css提供了@import命令在css内部引入另一个css文件，浏览器只有在执行到@import语句后才会去加载对应的css文件，导致页面性能变差，故基本不使用。\n\n#### 导入变量的优先级问题-变量默认值\n\n```scss\n/*App1.scss*/\n$border-color:#aaa; //声明变量\n@import App2.scss;  //引入另一个SCSS文件\n.container {\n  border:1px solid $border-color; //使用变量\n}\n/*App2.scss*/\n$border-color:#ccc; //声明变量\n\n/*生成的css文件*/\n.container {\n  border:1px solid #ccc; //使用变量\n}\n```\n\n这可能并不是我们想要的，有时候我们希望引入的某些样式不更改原有的样式，这时我们可以使用变量默认值。\n\n```scss\n/*App1.scss*/\n$border-color:#aaa; //声明变量\n@import App2.scss;  //引入另一个SCSS文件\n.container {\n  border:1px solid $border-color; //使用变量\n}\n/*App2.scss*/\n$border-color:#ccc !default; //声明变量\n\n/*生成的css文件*/\n.container {\n  border:1px solid #aaa; //使用变量\n}\n```\n\n导入的文件App2.scss只在文件中不存在$border-color时起作用，若App1.scss中已经存在了$border-color变量，则App2.scss中的$border-color不生效。\n\n!default只能使用与变量中。\n\n#### 嵌套导入\n上一个例子中我们是在全局中导入的App2.scss，现在我们在为App2.scss添加一些内容，并在局部中导入。\n\n```scss\n/*App1.scss*/\n$border-color:#aaa; //声明变量\n.container {\n  @import App2.scss;  //引入另一个SCSS文件\n  border:1px solid $border-color; //使用变量\n}\n/*App2.scss*/\n$border-color:#ccc !default; //声明变量\np {\n  margin:0;\n}\n\n/*生成的css文件*/\n.container {\n  border:1px solid #aaa; //使用变量\n}\n.container p {\n  margin:0;\n}\n```\n\n可以看得出来，就是将App2.scss中的所有内容直接写入到App1.scss的.container选择器中。\n\n#### 使用原生@import\n前面我们说到基本不使用原生@import，但某些情况下我们不得不使用原生@import时了，SCSS也为我们处理了这种情况，直接导入css文件即可。\n\n```scss\n@import 'App.css';\n```\n\n### 注释\nSCSS中的注释有两种：\n\n1. `/*注释*/` 这种注释会被保留到编译后的css文件中。\n2. `//注释` 这种注释不会被保留到编译后生成的css文件中。\n\n\n### 混合器（函数）\n\n#### 声明一个函数\n\n使用@mixin指令声明一个函数，看一下自己的css文件，有重复的代码片段都可以考虑使用混合器将他们提取出来复用。\n\n```scss\n@mixin border-radius{\n  -moz-border-radius: 5px;\n  -webkit-border-radius: 5px;\n  border-radius: 5px;\n  color:red;\n}\n```\n\n混合器作用域内的属性都是return的值，除此之外，还可以为函数传参数。\n\n```scss\n@mixin get-border-radius($border-radius,$color){\n  -moz-border-radius: $border-radius;\n  -webkit-border-radius: $border-radius;\n  border-radius: $border-radius;\n  color:$color;\n}\n```\n\n也可以设置混合器的默认值。\n\n```scss\n@mixin get-border-radius($border-radius:5px,$color:red){\n  -moz-border-radius: $border-radius;\n  -webkit-border-radius: $border-radius;\n  border-radius: $border-radius;\n  color:$color;\n}\n```\n\n#### 使用函数\n\n使用函数的关键字为@include\n\n```scss\n.container {\n  border:1px solid #aaa;\n  @include get-border-radius;         //不传参则为默认值5px\n  @include get-border-radius(10px,blue);   //传参\n}\n/*多个参数时，传参指定参数的名字，可以不用考虑传入的顺序*/\n.container {\n  border:1px solid #aaa;\n  @include get-border-radius;         //不传参则为默认值5px\n  @include get-border-radius($color:blue,$border-radius:10px);   //传参\n}\n```\n\n我们可能会想到，直接将混合器写成一个class不就行了，但是写成一个class的时候是需要在html文件中使用的，而使用混合器并不需要在html文件中使用class既可达到复用的效果。\n\ntips:混合器中可以写一切scss代码。\n\n### 继承\n\n继承是面向对象语言的一大特点，可以大大降低代码量。\n\n使用%定义一个被继承的样式，类似静态语言中的抽象类，他本身不起作用，只用于被其他人继承。\n\n```scss\n%border-style {\n  border:1px solid #aaa;\n  -moz-border-radius: 5px;\n  -webkit-border-radius: 5px;\n  border-radius: 5px;\n}\n```\n\n通过关键字@extend即可完成继承。\n\n```scss\n.container {\n\t@extend %border-style;\n}\n```\n\n上述例子中看不出混合器与继承之间的区别，那么下一个例子可以看出继承与混合器之间的区别。\n\n```scss\n.container {\n\t@extend %border-style;\n\tcolor:red;\n}\n.container1 {   //继承另一个选择器\n\t@extend .container;\n}\n```\n\n### 其他\n\n#### 操作符\nSCSS提供了标准的算术运算符，例如+、-、*、/、%。\n\n```scss\n/*SCSS*/\nwidth: 600px / 960px * 100%;\n/*编译后的CSS*/\nwidth: 62.5%;\n```","source":"_posts/scss101.md","raw":"---\ntitle: scss 快速入门\ndate: 2023-03-06 22:38:12\ntags: CSS\ncategories: CSS\ndescription: CSS预处理器用一种专门的编程语言，进行Web页面样式设计，然后再编译成正常的CSS文件，以供项目使用。CSS预处理器为CSS增加一些编程的特性，无需考虑浏览器的兼容性问题。\n---\n\n# scss 快速入门\n\n## 简介\n\nCSS预处理器用一种专门的编程语言，进行Web页面样式设计，然后再编译成正常的CSS文件，以供项目使用。CSS预处理器为CSS增加一些编程的特性，无需考虑浏览器的兼容性问题。 比如说：Sass（SCSS）、LESS、Stylus、Turbine、Swithch CSS、CSS Cacheer、DT CSS等。都属于css预处理器。其中比较优秀的： Sass、LESS，Stylus。\n\nsass 和 scss 的区别？\n\nSass的缩排语法，对于写惯css前端的web开发者来说很不直观，也不能将css代码加入到Sass里面，因此sass语法进行了改良，Sass 3就变成了Scss(sassy css)。与原来的语法兼容，只是用{}取代了原来的缩进。\n\n## 准备工作\n\nscss需要经过编译为css才能被浏览器识别，我这里只做一个小demo所以不上vue-cli，直接使用webpack进行编译。\n\n首先安装css-loader、style-loader、node-sass、sass-loader：\n\n```bash\nnpm install css-loader style-loader --save-dev\nnpm install node-sass sass-loader --save-dev\n```\n\n然后在webpack.config.js配置文件中添加对应的loader,完整的配置图如下：\n\n```js\nconst path = require(\"path\");\nconst {VueLoaderPlugin} = require('vue-loader');\nmodule.exports = {\n    entry: './webapp/App.js',\n    output: {\n        filename: 'App.js',\n        path: path.resolve(__dirname, './dist')\n    },\n\tmodule: {\n\t\trules: [\n            {\n                test: /\\.scss/,\n                use: ['style-loader', 'css-loader','sass-loader']\n            },\n\t\t\t{\n\t\t\t\ttest: /\\.vue$/,\n\t\t\t\tuse: 'vue-loader'\n\t\t\t}\n\t\t]\n\t},\n\tplugins: [\n\t\tnew VueLoaderPlugin()\n\t],\n\tmode: \"production\"\n}\n```\n\n创建一个App.scss文件，接着在入口文件中引入：\n\n```js\nimport './App.scss';\n```\n\n后面我们将在App.scss中编写scss代码。\n\n注意：vite提供了对 .scss, .sass, .less, .styl 和 .stylus 文件的内置支持。没有必要为它们安装特定的 Vite 插件，但必须安装相应的预处理器依赖。\n\n```bash\n# .scss and .sass\nnpm add -D sass\n# .less\nnpm add -D less\n# .styl and .stylus\nnpm add -D stylus\n```\n\n如果使用的是单文件组件，可以通过 `<style lang=\"sass\">`（或其他预处理器）自动开启。\n\n\n## 正式开始\n\n### 使用变量\n\nSCSS中的变量以$开头。\n\n```scss\n$border-color:#aaa; //声明变量\n.container {\n$border-width:1px;\n  border:$border-width solid $border-color; //使用变量\n}\n```\n\n上述例子中定义了两个变量，其中$border-color在大括号之外称为全局变量，顾名思义任何地方都可以使用，$border-width是在.container之内声明的，是一个局部变量，只有.container内部才能使用。\n\n编译后的CSS\n\n```css\n.container {\n  border:1px solid #aaa; //使用变量\n}\n```\n\n我们可以把SCSS看做一个模板引擎，编译的过程中用变量的值去替代变量所占据的位置。\n\ntips:SCSS中变量名使用中划线或下划线都是指向同一变量的，上文中定义了一个变量$border-color，这时再定义一个变量 `$border_color:#ccc`,他们指向同一个变量，.container的值会被第二次定义的变量覆盖。\n\n```scss\n$border-color:#aaa; //声明变量\n$border_color:#ccc;\n.container {\n  $border-width:1px;\n  border:$border-width solid $border-color; //使用变量\n}\n编译后的CSS\n.container {\n  border:1px solid #ccc; //使用变量\n}\n```\n\n这个例子中我们要知道\n\n1. 变量名使用中划线或下划线都是指向同一变量的。\n2. 后定义的变量声明会被忽略，但赋值会被执行，这一点和ES5中var声明变量是一样的。\n\n### 嵌套规则\n我们先来看一个例子：\n\n```css\n/*css*/\n.container ul {\n  border:1px solid #aaa;\n  list-style:none;\n}\n.container ul:after {\n  display:block;\n  content:\"\";\n  clear:both;\n}\n.container ul li {\n  float:left;\n}\n.container ul li>a {\n  display:inline-block;\n  padding:6px 12px;\n}\n```\n\n这是一个让列表元素横向排列的例子，我们在这个例子中写了很多重复的代码，.container写了很多遍，下面我将用SCSS简写上面的例子：\n\n```scss\n.container ul {\n  border:1px solid #aaa;\n  list-style:none;\n  \n  li {\n    float:left;\n    \n    >a {\n      display:inline-block;\n      padding:6px 12px;\n    }\n  }\n  \n  &:after {\n    display:block;\n    content:\"\";\n    clear:both;\n  }\n}\n```\n\n当然也可以嵌套属性：\n\n```css\n/*css*/\nli {\n  border:1px solid #aaa;\n  border-left:0;\n  border-right:0;\n}\n```\n\nscss识别一个属性以分号结尾时则判断为一个属性，以大括号结尾时则判断为一个嵌套属性，规则是将外部的属性以及内部的属性通过中划线连接起来形成一个新的属性。\n\n```scss\n/*scss*/\nli {\n  border:1px solid #aaa {\n    left:0;\n    right:0;\n  }\n}\n```\n\n### 导入SCSS文件\n大型项目中css文件往往不止一个，css提供了@import命令在css内部引入另一个css文件，浏览器只有在执行到@import语句后才会去加载对应的css文件，导致页面性能变差，故基本不使用。\n\n#### 导入变量的优先级问题-变量默认值\n\n```scss\n/*App1.scss*/\n$border-color:#aaa; //声明变量\n@import App2.scss;  //引入另一个SCSS文件\n.container {\n  border:1px solid $border-color; //使用变量\n}\n/*App2.scss*/\n$border-color:#ccc; //声明变量\n\n/*生成的css文件*/\n.container {\n  border:1px solid #ccc; //使用变量\n}\n```\n\n这可能并不是我们想要的，有时候我们希望引入的某些样式不更改原有的样式，这时我们可以使用变量默认值。\n\n```scss\n/*App1.scss*/\n$border-color:#aaa; //声明变量\n@import App2.scss;  //引入另一个SCSS文件\n.container {\n  border:1px solid $border-color; //使用变量\n}\n/*App2.scss*/\n$border-color:#ccc !default; //声明变量\n\n/*生成的css文件*/\n.container {\n  border:1px solid #aaa; //使用变量\n}\n```\n\n导入的文件App2.scss只在文件中不存在$border-color时起作用，若App1.scss中已经存在了$border-color变量，则App2.scss中的$border-color不生效。\n\n!default只能使用与变量中。\n\n#### 嵌套导入\n上一个例子中我们是在全局中导入的App2.scss，现在我们在为App2.scss添加一些内容，并在局部中导入。\n\n```scss\n/*App1.scss*/\n$border-color:#aaa; //声明变量\n.container {\n  @import App2.scss;  //引入另一个SCSS文件\n  border:1px solid $border-color; //使用变量\n}\n/*App2.scss*/\n$border-color:#ccc !default; //声明变量\np {\n  margin:0;\n}\n\n/*生成的css文件*/\n.container {\n  border:1px solid #aaa; //使用变量\n}\n.container p {\n  margin:0;\n}\n```\n\n可以看得出来，就是将App2.scss中的所有内容直接写入到App1.scss的.container选择器中。\n\n#### 使用原生@import\n前面我们说到基本不使用原生@import，但某些情况下我们不得不使用原生@import时了，SCSS也为我们处理了这种情况，直接导入css文件即可。\n\n```scss\n@import 'App.css';\n```\n\n### 注释\nSCSS中的注释有两种：\n\n1. `/*注释*/` 这种注释会被保留到编译后的css文件中。\n2. `//注释` 这种注释不会被保留到编译后生成的css文件中。\n\n\n### 混合器（函数）\n\n#### 声明一个函数\n\n使用@mixin指令声明一个函数，看一下自己的css文件，有重复的代码片段都可以考虑使用混合器将他们提取出来复用。\n\n```scss\n@mixin border-radius{\n  -moz-border-radius: 5px;\n  -webkit-border-radius: 5px;\n  border-radius: 5px;\n  color:red;\n}\n```\n\n混合器作用域内的属性都是return的值，除此之外，还可以为函数传参数。\n\n```scss\n@mixin get-border-radius($border-radius,$color){\n  -moz-border-radius: $border-radius;\n  -webkit-border-radius: $border-radius;\n  border-radius: $border-radius;\n  color:$color;\n}\n```\n\n也可以设置混合器的默认值。\n\n```scss\n@mixin get-border-radius($border-radius:5px,$color:red){\n  -moz-border-radius: $border-radius;\n  -webkit-border-radius: $border-radius;\n  border-radius: $border-radius;\n  color:$color;\n}\n```\n\n#### 使用函数\n\n使用函数的关键字为@include\n\n```scss\n.container {\n  border:1px solid #aaa;\n  @include get-border-radius;         //不传参则为默认值5px\n  @include get-border-radius(10px,blue);   //传参\n}\n/*多个参数时，传参指定参数的名字，可以不用考虑传入的顺序*/\n.container {\n  border:1px solid #aaa;\n  @include get-border-radius;         //不传参则为默认值5px\n  @include get-border-radius($color:blue,$border-radius:10px);   //传参\n}\n```\n\n我们可能会想到，直接将混合器写成一个class不就行了，但是写成一个class的时候是需要在html文件中使用的，而使用混合器并不需要在html文件中使用class既可达到复用的效果。\n\ntips:混合器中可以写一切scss代码。\n\n### 继承\n\n继承是面向对象语言的一大特点，可以大大降低代码量。\n\n使用%定义一个被继承的样式，类似静态语言中的抽象类，他本身不起作用，只用于被其他人继承。\n\n```scss\n%border-style {\n  border:1px solid #aaa;\n  -moz-border-radius: 5px;\n  -webkit-border-radius: 5px;\n  border-radius: 5px;\n}\n```\n\n通过关键字@extend即可完成继承。\n\n```scss\n.container {\n\t@extend %border-style;\n}\n```\n\n上述例子中看不出混合器与继承之间的区别，那么下一个例子可以看出继承与混合器之间的区别。\n\n```scss\n.container {\n\t@extend %border-style;\n\tcolor:red;\n}\n.container1 {   //继承另一个选择器\n\t@extend .container;\n}\n```\n\n### 其他\n\n#### 操作符\nSCSS提供了标准的算术运算符，例如+、-、*、/、%。\n\n```scss\n/*SCSS*/\nwidth: 600px / 960px * 100%;\n/*编译后的CSS*/\nwidth: 62.5%;\n```","slug":"scss101","published":1,"updated":"2023-03-07T14:45:29.647Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsie002uyt8w1pqh4ztg","content":"<h1 id=\"scss-快速入门\"><a href=\"#scss-快速入门\" class=\"headerlink\" title=\"scss 快速入门\"></a>scss 快速入门</h1><h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>CSS预处理器用一种专门的编程语言，进行Web页面样式设计，然后再编译成正常的CSS文件，以供项目使用。CSS预处理器为CSS增加一些编程的特性，无需考虑浏览器的兼容性问题。 比如说：Sass（SCSS）、LESS、Stylus、Turbine、Swithch CSS、CSS Cacheer、DT CSS等。都属于css预处理器。其中比较优秀的： Sass、LESS，Stylus。</p>\n<p>sass 和 scss 的区别？</p>\n<p>Sass的缩排语法，对于写惯css前端的web开发者来说很不直观，也不能将css代码加入到Sass里面，因此sass语法进行了改良，Sass 3就变成了Scss(sassy css)。与原来的语法兼容，只是用{}取代了原来的缩进。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>scss需要经过编译为css才能被浏览器识别，我这里只做一个小demo所以不上vue-cli，直接使用webpack进行编译。</p>\n<p>首先安装css-loader、style-loader、node-sass、sass-loader：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install css-loader style-loader --save-dev</span><br><span class=\"line\">npm install node-sass sass-loader --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>然后在webpack.config.js配置文件中添加对应的loader,完整的配置图如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;path&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123;<span class=\"title class_\">VueLoaderPlugin</span>&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;vue-loader&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./webapp/App.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;App.js&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">path</span>: path.<span class=\"title function_\">resolve</span>(__dirname, <span class=\"string\">&#x27;./dist&#x27;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">\t<span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">rules</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.scss/</span>,</span><br><span class=\"line\">                <span class=\"attr\">use</span>: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>,<span class=\"string\">&#x27;sass-loader&#x27;</span>]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">test</span>: <span class=\"regexp\">/\\.vue$/</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">use</span>: <span class=\"string\">&#x27;vue-loader&#x27;</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t]</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">VueLoaderPlugin</span>()</span><br><span class=\"line\">\t],</span><br><span class=\"line\">\t<span class=\"attr\">mode</span>: <span class=\"string\">&quot;production&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建一个App.scss文件，接着在入口文件中引入：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./App.scss&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>后面我们将在App.scss中编写scss代码。</p>\n<p>注意：vite提供了对 .scss, .sass, .less, .styl 和 .stylus 文件的内置支持。没有必要为它们安装特定的 Vite 插件，但必须安装相应的预处理器依赖。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># .scss and .sass</span></span><br><span class=\"line\">npm add -D sass</span><br><span class=\"line\"><span class=\"comment\"># .less</span></span><br><span class=\"line\">npm add -D less</span><br><span class=\"line\"><span class=\"comment\"># .styl and .stylus</span></span><br><span class=\"line\">npm add -D stylus</span><br></pre></td></tr></table></figure>\n\n<p>如果使用的是单文件组件，可以通过 <code>&lt;style lang=&quot;sass&quot;&gt;</code>（或其他预处理器）自动开启。</p>\n<h2 id=\"正式开始\"><a href=\"#正式开始\" class=\"headerlink\" title=\"正式开始\"></a>正式开始</h2><h3 id=\"使用变量\"><a href=\"#使用变量\" class=\"headerlink\" title=\"使用变量\"></a>使用变量</h3><p>SCSS中的变量以$开头。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#aaa</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\"><span class=\"variable\">$border-width</span>:<span class=\"number\">1px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"variable\">$border-width</span> solid <span class=\"variable\">$border-color</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上述例子中定义了两个变量，其中$border-color在大括号之外称为全局变量，顾名思义任何地方都可以使用，$border-width是在.container之内声明的，是一个局部变量，只有.container内部才能使用。</p>\n<p>编译后的CSS</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>; //使用变量</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们可以把SCSS看做一个模板引擎，编译的过程中用变量的值去替代变量所占据的位置。</p>\n<p>tips:SCSS中变量名使用中划线或下划线都是指向同一变量的，上文中定义了一个变量$border-color，这时再定义一个变量 <code>$border_color:#ccc</code>,他们指向同一个变量，.container的值会被第二次定义的变量覆盖。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#aaa</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"variable\">$border_color</span>:<span class=\"number\">#ccc</span>;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"variable\">$border-width</span>:<span class=\"number\">1px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"variable\">$border-width</span> solid <span class=\"variable\">$border-color</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">编译后的CSS</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这个例子中我们要知道</p>\n<ol>\n<li>变量名使用中划线或下划线都是指向同一变量的。</li>\n<li>后定义的变量声明会被忽略，但赋值会被执行，这一点和ES5中var声明变量是一样的。</li>\n</ol>\n<h3 id=\"嵌套规则\"><a href=\"#嵌套规则\" class=\"headerlink\" title=\"嵌套规则\"></a>嵌套规则</h3><p>我们先来看一个例子：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*css*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">ul</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  <span class=\"attribute\">list-style</span>:none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">ul</span><span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:block;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>:<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">  <span class=\"attribute\">clear</span>:both;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">ul</span> <span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">float</span><span class=\"selector-pseudo\">:left</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">ul</span> <span class=\"selector-tag\">li</span>&gt;<span class=\"selector-tag\">a</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>:<span class=\"number\">6px</span> <span class=\"number\">12px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这是一个让列表元素横向排列的例子，我们在这个例子中写了很多重复的代码，.container写了很多遍，下面我将用SCSS简写上面的例子：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">ul</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  <span class=\"attribute\">list-style</span>:none;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span><span class=\"selector-pseudo\">:left</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &gt;<span class=\"selector-tag\">a</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">display</span>:inline-block;</span><br><span class=\"line\">      <span class=\"attribute\">padding</span>:<span class=\"number\">6px</span> <span class=\"number\">12px</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  &amp;<span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>:block;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>:<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    <span class=\"attribute\">clear</span>:both;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当然也可以嵌套属性：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*css*/</span></span><br><span class=\"line\"><span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-left</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-right</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>scss识别一个属性以分号结尾时则判断为一个属性，以大括号结尾时则判断为一个嵌套属性，规则是将外部的属性以及内部的属性通过中划线连接起来形成一个新的属性。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*scss*/</span></span><br><span class=\"line\"><span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"导入SCSS文件\"><a href=\"#导入SCSS文件\" class=\"headerlink\" title=\"导入SCSS文件\"></a>导入SCSS文件</h3><p>大型项目中css文件往往不止一个，css提供了@import命令在css内部引入另一个css文件，浏览器只有在执行到@import语句后才会去加载对应的css文件，导致页面性能变差，故基本不使用。</p>\n<h4 id=\"导入变量的优先级问题-变量默认值\"><a href=\"#导入变量的优先级问题-变量默认值\" class=\"headerlink\" title=\"导入变量的优先级问题-变量默认值\"></a>导入变量的优先级问题-变量默认值</h4><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*App1.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#aaa</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"keyword\">@import</span> App2.scss;  <span class=\"comment\">//引入另一个SCSS文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"variable\">$border-color</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*App2.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#ccc</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*生成的css文件*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这可能并不是我们想要的，有时候我们希望引入的某些样式不更改原有的样式，这时我们可以使用变量默认值。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*App1.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#aaa</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"keyword\">@import</span> App2.scss;  <span class=\"comment\">//引入另一个SCSS文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"variable\">$border-color</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*App2.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#ccc</span> !default; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*生成的css文件*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>导入的文件App2.scss只在文件中不存在$border-color时起作用，若App1.scss中已经存在了$border-color变量，则App2.scss中的$border-color不生效。</p>\n<p>!default只能使用与变量中。</p>\n<h4 id=\"嵌套导入\"><a href=\"#嵌套导入\" class=\"headerlink\" title=\"嵌套导入\"></a>嵌套导入</h4><p>上一个例子中我们是在全局中导入的App2.scss，现在我们在为App2.scss添加一些内容，并在局部中导入。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*App1.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#aaa</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">@import</span> App2.scss;  <span class=\"comment\">//引入另一个SCSS文件</span></span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"variable\">$border-color</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*App2.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#ccc</span> !default; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*生成的css文件*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以看得出来，就是将App2.scss中的所有内容直接写入到App1.scss的.container选择器中。</p>\n<h4 id=\"使用原生-import\"><a href=\"#使用原生-import\" class=\"headerlink\" title=\"使用原生@import\"></a>使用原生@import</h4><p>前面我们说到基本不使用原生@import，但某些情况下我们不得不使用原生@import时了，SCSS也为我们处理了这种情况，直接导入css文件即可。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@import</span> <span class=\"string\">&#x27;App.css&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h3><p>SCSS中的注释有两种：</p>\n<ol>\n<li><code>/*注释*/</code> 这种注释会被保留到编译后的css文件中。</li>\n<li><code>//注释</code> 这种注释不会被保留到编译后生成的css文件中。</li>\n</ol>\n<h3 id=\"混合器（函数）\"><a href=\"#混合器（函数）\" class=\"headerlink\" title=\"混合器（函数）\"></a>混合器（函数）</h3><h4 id=\"声明一个函数\"><a href=\"#声明一个函数\" class=\"headerlink\" title=\"声明一个函数\"></a>声明一个函数</h4><p>使用@mixin指令声明一个函数，看一下自己的css文件，有重复的代码片段都可以考虑使用混合器将他们提取出来复用。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@mixin</span> border-radius&#123;</span><br><span class=\"line\">  -moz-<span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>:red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>混合器作用域内的属性都是return的值，除此之外，还可以为函数传参数。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@mixin</span> get-border-radius(<span class=\"variable\">$border-radius</span>,<span class=\"variable\">$color</span>)&#123;</span><br><span class=\"line\">  -moz-<span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>:<span class=\"variable\">$color</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>也可以设置混合器的默认值。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@mixin</span> get-border-radius(<span class=\"variable\">$border-radius</span>:<span class=\"number\">5px</span>,<span class=\"variable\">$color</span>:red)&#123;</span><br><span class=\"line\">  -moz-<span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>:<span class=\"variable\">$color</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用函数\"><a href=\"#使用函数\" class=\"headerlink\" title=\"使用函数\"></a>使用函数</h4><p>使用函数的关键字为@include</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  <span class=\"keyword\">@include</span> get-border-radius;         <span class=\"comment\">//不传参则为默认值5px</span></span><br><span class=\"line\">  <span class=\"keyword\">@include</span> get-border-radius(<span class=\"number\">10px</span>,blue);   <span class=\"comment\">//传参</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*多个参数时，传参指定参数的名字，可以不用考虑传入的顺序*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  <span class=\"keyword\">@include</span> get-border-radius;         <span class=\"comment\">//不传参则为默认值5px</span></span><br><span class=\"line\">  <span class=\"keyword\">@include</span> get-border-radius(<span class=\"variable\">$color</span>:blue,<span class=\"variable\">$border-radius</span>:<span class=\"number\">10px</span>);   <span class=\"comment\">//传参</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们可能会想到，直接将混合器写成一个class不就行了，但是写成一个class的时候是需要在html文件中使用的，而使用混合器并不需要在html文件中使用class既可达到复用的效果。</p>\n<p>tips:混合器中可以写一切scss代码。</p>\n<h3 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h3><p>继承是面向对象语言的一大特点，可以大大降低代码量。</p>\n<p>使用%定义一个被继承的样式，类似静态语言中的抽象类，他本身不起作用，只用于被其他人继承。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%<span class=\"attribute\">border-style</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  -moz-<span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通过关键字@extend即可完成继承。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">@extend</span> %border-style;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上述例子中看不出混合器与继承之间的区别，那么下一个例子可以看出继承与混合器之间的区别。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">@extend</span> %border-style;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>:red;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container1</span> &#123;   <span class=\"comment\">//继承另一个选择器</span></span><br><span class=\"line\">\t<span class=\"keyword\">@extend</span> .container;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><h4 id=\"操作符\"><a href=\"#操作符\" class=\"headerlink\" title=\"操作符\"></a>操作符</h4><p>SCSS提供了标准的算术运算符，例如+、-、*、&#x2F;、%。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*SCSS*/</span></span><br><span class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">600px</span> / <span class=\"number\">960px</span> * <span class=\"number\">100%</span>;</span><br><span class=\"line\"><span class=\"comment\">/*编译后的CSS*/</span></span><br><span class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">62.5%</span>;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"scss-快速入门\"><a href=\"#scss-快速入门\" class=\"headerlink\" title=\"scss 快速入门\"></a>scss 快速入门</h1><h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>CSS预处理器用一种专门的编程语言，进行Web页面样式设计，然后再编译成正常的CSS文件，以供项目使用。CSS预处理器为CSS增加一些编程的特性，无需考虑浏览器的兼容性问题。 比如说：Sass（SCSS）、LESS、Stylus、Turbine、Swithch CSS、CSS Cacheer、DT CSS等。都属于css预处理器。其中比较优秀的： Sass、LESS，Stylus。</p>\n<p>sass 和 scss 的区别？</p>\n<p>Sass的缩排语法，对于写惯css前端的web开发者来说很不直观，也不能将css代码加入到Sass里面，因此sass语法进行了改良，Sass 3就变成了Scss(sassy css)。与原来的语法兼容，只是用{}取代了原来的缩进。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>scss需要经过编译为css才能被浏览器识别，我这里只做一个小demo所以不上vue-cli，直接使用webpack进行编译。</p>\n<p>首先安装css-loader、style-loader、node-sass、sass-loader：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install css-loader style-loader --save-dev</span><br><span class=\"line\">npm install node-sass sass-loader --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>然后在webpack.config.js配置文件中添加对应的loader,完整的配置图如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;path&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123;<span class=\"title class_\">VueLoaderPlugin</span>&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;vue-loader&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./webapp/App.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;App.js&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">path</span>: path.<span class=\"title function_\">resolve</span>(__dirname, <span class=\"string\">&#x27;./dist&#x27;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">\t<span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">rules</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.scss/</span>,</span><br><span class=\"line\">                <span class=\"attr\">use</span>: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>,<span class=\"string\">&#x27;sass-loader&#x27;</span>]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">test</span>: <span class=\"regexp\">/\\.vue$/</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">use</span>: <span class=\"string\">&#x27;vue-loader&#x27;</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t]</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">VueLoaderPlugin</span>()</span><br><span class=\"line\">\t],</span><br><span class=\"line\">\t<span class=\"attr\">mode</span>: <span class=\"string\">&quot;production&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建一个App.scss文件，接着在入口文件中引入：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./App.scss&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>后面我们将在App.scss中编写scss代码。</p>\n<p>注意：vite提供了对 .scss, .sass, .less, .styl 和 .stylus 文件的内置支持。没有必要为它们安装特定的 Vite 插件，但必须安装相应的预处理器依赖。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># .scss and .sass</span></span><br><span class=\"line\">npm add -D sass</span><br><span class=\"line\"><span class=\"comment\"># .less</span></span><br><span class=\"line\">npm add -D less</span><br><span class=\"line\"><span class=\"comment\"># .styl and .stylus</span></span><br><span class=\"line\">npm add -D stylus</span><br></pre></td></tr></table></figure>\n\n<p>如果使用的是单文件组件，可以通过 <code>&lt;style lang=&quot;sass&quot;&gt;</code>（或其他预处理器）自动开启。</p>\n<h2 id=\"正式开始\"><a href=\"#正式开始\" class=\"headerlink\" title=\"正式开始\"></a>正式开始</h2><h3 id=\"使用变量\"><a href=\"#使用变量\" class=\"headerlink\" title=\"使用变量\"></a>使用变量</h3><p>SCSS中的变量以$开头。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#aaa</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\"><span class=\"variable\">$border-width</span>:<span class=\"number\">1px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"variable\">$border-width</span> solid <span class=\"variable\">$border-color</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上述例子中定义了两个变量，其中$border-color在大括号之外称为全局变量，顾名思义任何地方都可以使用，$border-width是在.container之内声明的，是一个局部变量，只有.container内部才能使用。</p>\n<p>编译后的CSS</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>; //使用变量</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们可以把SCSS看做一个模板引擎，编译的过程中用变量的值去替代变量所占据的位置。</p>\n<p>tips:SCSS中变量名使用中划线或下划线都是指向同一变量的，上文中定义了一个变量$border-color，这时再定义一个变量 <code>$border_color:#ccc</code>,他们指向同一个变量，.container的值会被第二次定义的变量覆盖。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#aaa</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"variable\">$border_color</span>:<span class=\"number\">#ccc</span>;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"variable\">$border-width</span>:<span class=\"number\">1px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"variable\">$border-width</span> solid <span class=\"variable\">$border-color</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">编译后的CSS</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这个例子中我们要知道</p>\n<ol>\n<li>变量名使用中划线或下划线都是指向同一变量的。</li>\n<li>后定义的变量声明会被忽略，但赋值会被执行，这一点和ES5中var声明变量是一样的。</li>\n</ol>\n<h3 id=\"嵌套规则\"><a href=\"#嵌套规则\" class=\"headerlink\" title=\"嵌套规则\"></a>嵌套规则</h3><p>我们先来看一个例子：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*css*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">ul</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  <span class=\"attribute\">list-style</span>:none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">ul</span><span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:block;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>:<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">  <span class=\"attribute\">clear</span>:both;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">ul</span> <span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">float</span><span class=\"selector-pseudo\">:left</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">ul</span> <span class=\"selector-tag\">li</span>&gt;<span class=\"selector-tag\">a</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>:<span class=\"number\">6px</span> <span class=\"number\">12px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这是一个让列表元素横向排列的例子，我们在这个例子中写了很多重复的代码，.container写了很多遍，下面我将用SCSS简写上面的例子：</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">ul</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  <span class=\"attribute\">list-style</span>:none;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">float</span><span class=\"selector-pseudo\">:left</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &gt;<span class=\"selector-tag\">a</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">display</span>:inline-block;</span><br><span class=\"line\">      <span class=\"attribute\">padding</span>:<span class=\"number\">6px</span> <span class=\"number\">12px</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  &amp;<span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>:block;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>:<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    <span class=\"attribute\">clear</span>:both;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当然也可以嵌套属性：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*css*/</span></span><br><span class=\"line\"><span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-left</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-right</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>scss识别一个属性以分号结尾时则判断为一个属性，以大括号结尾时则判断为一个嵌套属性，规则是将外部的属性以及内部的属性通过中划线连接起来形成一个新的属性。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*scss*/</span></span><br><span class=\"line\"><span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"导入SCSS文件\"><a href=\"#导入SCSS文件\" class=\"headerlink\" title=\"导入SCSS文件\"></a>导入SCSS文件</h3><p>大型项目中css文件往往不止一个，css提供了@import命令在css内部引入另一个css文件，浏览器只有在执行到@import语句后才会去加载对应的css文件，导致页面性能变差，故基本不使用。</p>\n<h4 id=\"导入变量的优先级问题-变量默认值\"><a href=\"#导入变量的优先级问题-变量默认值\" class=\"headerlink\" title=\"导入变量的优先级问题-变量默认值\"></a>导入变量的优先级问题-变量默认值</h4><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*App1.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#aaa</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"keyword\">@import</span> App2.scss;  <span class=\"comment\">//引入另一个SCSS文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"variable\">$border-color</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*App2.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#ccc</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*生成的css文件*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这可能并不是我们想要的，有时候我们希望引入的某些样式不更改原有的样式，这时我们可以使用变量默认值。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*App1.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#aaa</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"keyword\">@import</span> App2.scss;  <span class=\"comment\">//引入另一个SCSS文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"variable\">$border-color</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*App2.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#ccc</span> !default; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*生成的css文件*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>导入的文件App2.scss只在文件中不存在$border-color时起作用，若App1.scss中已经存在了$border-color变量，则App2.scss中的$border-color不生效。</p>\n<p>!default只能使用与变量中。</p>\n<h4 id=\"嵌套导入\"><a href=\"#嵌套导入\" class=\"headerlink\" title=\"嵌套导入\"></a>嵌套导入</h4><p>上一个例子中我们是在全局中导入的App2.scss，现在我们在为App2.scss添加一些内容，并在局部中导入。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*App1.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#aaa</span>; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">@import</span> App2.scss;  <span class=\"comment\">//引入另一个SCSS文件</span></span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"variable\">$border-color</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*App2.scss*/</span></span><br><span class=\"line\"><span class=\"variable\">$border-color</span>:<span class=\"number\">#ccc</span> !default; <span class=\"comment\">//声明变量</span></span><br><span class=\"line\"><span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*生成的css文件*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>; <span class=\"comment\">//使用变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container</span> <span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以看得出来，就是将App2.scss中的所有内容直接写入到App1.scss的.container选择器中。</p>\n<h4 id=\"使用原生-import\"><a href=\"#使用原生-import\" class=\"headerlink\" title=\"使用原生@import\"></a>使用原生@import</h4><p>前面我们说到基本不使用原生@import，但某些情况下我们不得不使用原生@import时了，SCSS也为我们处理了这种情况，直接导入css文件即可。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@import</span> <span class=\"string\">&#x27;App.css&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h3><p>SCSS中的注释有两种：</p>\n<ol>\n<li><code>/*注释*/</code> 这种注释会被保留到编译后的css文件中。</li>\n<li><code>//注释</code> 这种注释不会被保留到编译后生成的css文件中。</li>\n</ol>\n<h3 id=\"混合器（函数）\"><a href=\"#混合器（函数）\" class=\"headerlink\" title=\"混合器（函数）\"></a>混合器（函数）</h3><h4 id=\"声明一个函数\"><a href=\"#声明一个函数\" class=\"headerlink\" title=\"声明一个函数\"></a>声明一个函数</h4><p>使用@mixin指令声明一个函数，看一下自己的css文件，有重复的代码片段都可以考虑使用混合器将他们提取出来复用。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@mixin</span> border-radius&#123;</span><br><span class=\"line\">  -moz-<span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>:red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>混合器作用域内的属性都是return的值，除此之外，还可以为函数传参数。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@mixin</span> get-border-radius(<span class=\"variable\">$border-radius</span>,<span class=\"variable\">$color</span>)&#123;</span><br><span class=\"line\">  -moz-<span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>:<span class=\"variable\">$color</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>也可以设置混合器的默认值。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@mixin</span> get-border-radius(<span class=\"variable\">$border-radius</span>:<span class=\"number\">5px</span>,<span class=\"variable\">$color</span>:red)&#123;</span><br><span class=\"line\">  -moz-<span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"variable\">$border-radius</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>:<span class=\"variable\">$color</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用函数\"><a href=\"#使用函数\" class=\"headerlink\" title=\"使用函数\"></a>使用函数</h4><p>使用函数的关键字为@include</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  <span class=\"keyword\">@include</span> get-border-radius;         <span class=\"comment\">//不传参则为默认值5px</span></span><br><span class=\"line\">  <span class=\"keyword\">@include</span> get-border-radius(<span class=\"number\">10px</span>,blue);   <span class=\"comment\">//传参</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*多个参数时，传参指定参数的名字，可以不用考虑传入的顺序*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  <span class=\"keyword\">@include</span> get-border-radius;         <span class=\"comment\">//不传参则为默认值5px</span></span><br><span class=\"line\">  <span class=\"keyword\">@include</span> get-border-radius(<span class=\"variable\">$color</span>:blue,<span class=\"variable\">$border-radius</span>:<span class=\"number\">10px</span>);   <span class=\"comment\">//传参</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们可能会想到，直接将混合器写成一个class不就行了，但是写成一个class的时候是需要在html文件中使用的，而使用混合器并不需要在html文件中使用class既可达到复用的效果。</p>\n<p>tips:混合器中可以写一切scss代码。</p>\n<h3 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h3><p>继承是面向对象语言的一大特点，可以大大降低代码量。</p>\n<p>使用%定义一个被继承的样式，类似静态语言中的抽象类，他本身不起作用，只用于被其他人继承。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%<span class=\"attribute\">border-style</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>:<span class=\"number\">1px</span> solid <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">  -moz-<span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通过关键字@extend即可完成继承。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">@extend</span> %border-style;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上述例子中看不出混合器与继承之间的区别，那么下一个例子可以看出继承与混合器之间的区别。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">@extend</span> %border-style;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>:red;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.container1</span> &#123;   <span class=\"comment\">//继承另一个选择器</span></span><br><span class=\"line\">\t<span class=\"keyword\">@extend</span> .container;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><h4 id=\"操作符\"><a href=\"#操作符\" class=\"headerlink\" title=\"操作符\"></a>操作符</h4><p>SCSS提供了标准的算术运算符，例如+、-、*、&#x2F;、%。</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*SCSS*/</span></span><br><span class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">600px</span> / <span class=\"number\">960px</span> * <span class=\"number\">100%</span>;</span><br><span class=\"line\"><span class=\"comment\">/*编译后的CSS*/</span></span><br><span class=\"line\"><span class=\"attribute\">width</span>: <span class=\"number\">62.5%</span>;</span><br></pre></td></tr></table></figure>"},{"title":"Tailwind CSS 快速入门","date":"2023-03-21T13:26:23.000Z","description":"Tailwind CSS 是一个利用公用程序类（Utilize Class）的 CSS 框架。","_content":"\n## 什么是 Tailwind CSS \n\nTailwind CSS 是一个利用公用程序类（Utilize Class，下文皆称Utilize Class）的 CSS 框架。许多人会想到 CSS 框架，有很多，例如 Bootstrap、Bulma 和 Material UI。Bootstrap 和 Bulma 等框架利用预先准备好的组件（例如按钮、菜单和面包屑）进行设计。在 Tailwind CSS 中，没有准备任何组件，而是使用Utilize Class来创建和设计自己的组件。\n\n\n## 为什么需要 Tailwind CSS \n\n传统情况下，当您需要在网页上设置样式时，都需要编写 CSS。使用传统方式时，定制的设计需要定制的 CSS：\n\n```html\n<div class=\"chat-notification\">\n  <div class=\"chat-notification-logo-wrapper\">\n    <img class=\"chat-notification-logo\" src=\"/img/logo.svg\" alt=\"ChitChat Logo\">\n  </div>\n  <div class=\"chat-notification-content\">\n    <h4 class=\"chat-notification-title\">ChitChat</h4>\n    <p class=\"chat-notification-message\">You have a new message!</p>\n  </div>\n</div>\n\n<style>\n  .chat-notification {\n    display: flex;\n    max-width: 24rem;\n    margin: 0 auto;\n    padding: 1.5rem;\n    border-radius: 0.5rem;\n    background-color: #fff;\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n  }\n  .chat-notification-logo-wrapper {\n    flex-shrink: 0;\n  }\n  .chat-notification-logo {\n    height: 3rem;\n    width: 3rem;\n  }\n  .chat-notification-content {\n    margin-left: 1.5rem;\n    padding-top: 0.25rem;\n  }\n  .chat-notification-title {\n    color: #1a202c;\n    font-size: 1.25rem;\n    line-height: 1.25;\n  }\n  .chat-notification-message {\n    color: #718096;\n    font-size: 1rem;\n    line-height: 1.5;\n  }\n</style>\n```\n\n使用 Tailwind，可以通过直接在 HTML 中应用预先存在的类来设置元素的样式。使用功能类构建自定义设计而无需编写 CSS：\n\n```html\n<div class=\"p-6 max-w-sm mx-auto bg-white rounded-xl shadow-md flex items-center space-x-4\">\n  <div class=\"flex-shrink-0\">\n    <img class=\"h-12 w-12\" src=\"/img/logo.svg\" alt=\"ChitChat Logo\">\n  </div>\n  <div>\n    <div class=\"text-xl font-medium text-black\">ChitChat</div>\n    <p class=\"text-gray-500\">You have a new message!</p>\n  </div>\n</div>\n```\n\n在上面的示例中，我们使用了：\n\n- 使用 Tailwind 的 flexbox 和 padding 功能类 (flex, flex-shrink-0, 和 p-6) 来控制整体的卡片布局\n- 使用 max-width 和 margin 功能类 (max-w-sm 和 mx-auto) 来设置卡片的宽度和水平居中\n- 使用 background color, border radius, 和 box-shadow 功能类 (bg-white, rounded-xl, 和 shadow-md) 设置卡片的外观样式\n- 使用 width 和 height 功能类 (w-12 and h-12) 来设置 logo 图片的大小\n- 使用 space-between 功能类 (space-x-4) 来处理 logo 和文本之间的间距\n- 使用 font size，text color，和 font-weight 功能类 (text-xl，text-black，font-medium 等等) 给卡片文字设置样式\n\n这种方法使我们无需编写一行自定义的 CSS 即可实现一个完全定制的组件设计。\n\n你可能觉得这样比较乱，写法丑陋，但是他也有很多优点：\n\n- **您没有为了给类命名而浪费精力**。 不需要仅仅为了设置一些样式而额外添加一些像 sidebar-inner-wrapper 这样愚蠢的类名，不必再为了一个 flex 容器的完美抽象命名而倍受折磨。\n- **您的 CSS 停止增长**。 使用传统方法，每次添加新功能时 CSS 文件都会变大。使用功能类，所有内容都是可重用的，因此您几乎不需要编写新的CSS。\n- **更改会更安全**。 CSS 是全局性的，您永远不知道当您进行更改时会破坏掉什么。您 HTML 中的类是本地的，因此您可以更改它们而不必担心其他问题。\n\n\n## 快速开始\n\n创建 vite + vue-ts 项目：\n\n```bash\nyarn create vite\n```\n\n安装 Tailwind CSS 依赖：\n\n```bash\nnpm install -D tailwindcss@latest postcss@latest autoprefixer@latest\n```\n\n生成 tailwind 和 postcss 配置文件：\n\n```bash\nnpx tailwindcss init -p\n```\n\ntailwindcss 3.x 版本的配置文件：\n\n```js\n/** @type {import('tailwindcss').Config} */\nmodule.exports = {\n  content: [\n    \"./index.html\",\n    \"./src/**/*.{vue,js,ts,jsx,tsx}\",\n  ],\n  darkMode: 'media',\n  theme: {\n    extend: {},\n    container: {\n      center: true,\n    }\n  },\n  plugins: [],\n}\n```\n\n在全局样式文件中导入tailwind：\n\nsrc\\styles\\index.css\n\n```css\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n```\n\nsrc\\styles\\index.scss\n\n```scss\n@import \"tailwindcss/base\";\n@import \"tailwindcss/components\";\n@import \"tailwindcss/utilities\";\n```\n\n全局样式文件在main.ts中导入：\n\n```js\nimport { createApp } from 'vue'\nimport App from './App.vue'\n\n// 导入全局样式文件\nimport './styles/index.scss'\n\ncreateApp(App).mount('#app')\n```\n\n安装VSCode插件：\n\n- Tailwind CSS IntelliSense支持自动完成、语法高亮、悬停预览、语法分析功能。\n- PostCSS Language Support支持css未知规则如tailwind中的 @tailwind、@apply、@screen。\n- 在.vue、.html文件中使用@apply仍提示未知规则，建议在已安装以上插件后再添加工作区配置禁止掉这个提示：`{ \"css.lint.unknownAtRules\": \"ignore\" }`。 \n\n\n## 具体使用及API\n\n详见 [tailwindcss官网](https://www.tailwindcss.cn/docs/utility-first)。\n\n## 最后\n\n个人感觉 Tailwind CSS 并没有太多让人「惊讶」的特性，但是在打造一个完整的设计系统这件事情上，Tailwind CSS 在每个方面都做了精心的设计，所以让人用起来很「舒服」。如果你还没有使用过 Tailwind CSS，建议可以尝试一下，相信会给你带来耳目一新的感受！\n\n提高可维护性的方法：\n\n从上面的例子可以看出，使用 Tailwind 后代码的风格趋于内联样式的编写，也带来的阅读的烦恼，解决这样的问题提供了下面两个常用的方法：\n\n1. 抽取相同、类似的布局为公共组件、模板，提高复用性；\n2. 对于没有必要或不应该提取为组件的简单元素，可以使用@apply抽象CSS类，就跟我们以前编写 class 一样来组合 Tailwind 功能类；","source":"_posts/tailwindcss101.md","raw":"---\ntitle: Tailwind CSS 快速入门\ndate: 2023-03-21 21:26:23\ntags: CSS\ncategories: CSS\ndescription: Tailwind CSS 是一个利用公用程序类（Utilize Class）的 CSS 框架。\n---\n\n## 什么是 Tailwind CSS \n\nTailwind CSS 是一个利用公用程序类（Utilize Class，下文皆称Utilize Class）的 CSS 框架。许多人会想到 CSS 框架，有很多，例如 Bootstrap、Bulma 和 Material UI。Bootstrap 和 Bulma 等框架利用预先准备好的组件（例如按钮、菜单和面包屑）进行设计。在 Tailwind CSS 中，没有准备任何组件，而是使用Utilize Class来创建和设计自己的组件。\n\n\n## 为什么需要 Tailwind CSS \n\n传统情况下，当您需要在网页上设置样式时，都需要编写 CSS。使用传统方式时，定制的设计需要定制的 CSS：\n\n```html\n<div class=\"chat-notification\">\n  <div class=\"chat-notification-logo-wrapper\">\n    <img class=\"chat-notification-logo\" src=\"/img/logo.svg\" alt=\"ChitChat Logo\">\n  </div>\n  <div class=\"chat-notification-content\">\n    <h4 class=\"chat-notification-title\">ChitChat</h4>\n    <p class=\"chat-notification-message\">You have a new message!</p>\n  </div>\n</div>\n\n<style>\n  .chat-notification {\n    display: flex;\n    max-width: 24rem;\n    margin: 0 auto;\n    padding: 1.5rem;\n    border-radius: 0.5rem;\n    background-color: #fff;\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n  }\n  .chat-notification-logo-wrapper {\n    flex-shrink: 0;\n  }\n  .chat-notification-logo {\n    height: 3rem;\n    width: 3rem;\n  }\n  .chat-notification-content {\n    margin-left: 1.5rem;\n    padding-top: 0.25rem;\n  }\n  .chat-notification-title {\n    color: #1a202c;\n    font-size: 1.25rem;\n    line-height: 1.25;\n  }\n  .chat-notification-message {\n    color: #718096;\n    font-size: 1rem;\n    line-height: 1.5;\n  }\n</style>\n```\n\n使用 Tailwind，可以通过直接在 HTML 中应用预先存在的类来设置元素的样式。使用功能类构建自定义设计而无需编写 CSS：\n\n```html\n<div class=\"p-6 max-w-sm mx-auto bg-white rounded-xl shadow-md flex items-center space-x-4\">\n  <div class=\"flex-shrink-0\">\n    <img class=\"h-12 w-12\" src=\"/img/logo.svg\" alt=\"ChitChat Logo\">\n  </div>\n  <div>\n    <div class=\"text-xl font-medium text-black\">ChitChat</div>\n    <p class=\"text-gray-500\">You have a new message!</p>\n  </div>\n</div>\n```\n\n在上面的示例中，我们使用了：\n\n- 使用 Tailwind 的 flexbox 和 padding 功能类 (flex, flex-shrink-0, 和 p-6) 来控制整体的卡片布局\n- 使用 max-width 和 margin 功能类 (max-w-sm 和 mx-auto) 来设置卡片的宽度和水平居中\n- 使用 background color, border radius, 和 box-shadow 功能类 (bg-white, rounded-xl, 和 shadow-md) 设置卡片的外观样式\n- 使用 width 和 height 功能类 (w-12 and h-12) 来设置 logo 图片的大小\n- 使用 space-between 功能类 (space-x-4) 来处理 logo 和文本之间的间距\n- 使用 font size，text color，和 font-weight 功能类 (text-xl，text-black，font-medium 等等) 给卡片文字设置样式\n\n这种方法使我们无需编写一行自定义的 CSS 即可实现一个完全定制的组件设计。\n\n你可能觉得这样比较乱，写法丑陋，但是他也有很多优点：\n\n- **您没有为了给类命名而浪费精力**。 不需要仅仅为了设置一些样式而额外添加一些像 sidebar-inner-wrapper 这样愚蠢的类名，不必再为了一个 flex 容器的完美抽象命名而倍受折磨。\n- **您的 CSS 停止增长**。 使用传统方法，每次添加新功能时 CSS 文件都会变大。使用功能类，所有内容都是可重用的，因此您几乎不需要编写新的CSS。\n- **更改会更安全**。 CSS 是全局性的，您永远不知道当您进行更改时会破坏掉什么。您 HTML 中的类是本地的，因此您可以更改它们而不必担心其他问题。\n\n\n## 快速开始\n\n创建 vite + vue-ts 项目：\n\n```bash\nyarn create vite\n```\n\n安装 Tailwind CSS 依赖：\n\n```bash\nnpm install -D tailwindcss@latest postcss@latest autoprefixer@latest\n```\n\n生成 tailwind 和 postcss 配置文件：\n\n```bash\nnpx tailwindcss init -p\n```\n\ntailwindcss 3.x 版本的配置文件：\n\n```js\n/** @type {import('tailwindcss').Config} */\nmodule.exports = {\n  content: [\n    \"./index.html\",\n    \"./src/**/*.{vue,js,ts,jsx,tsx}\",\n  ],\n  darkMode: 'media',\n  theme: {\n    extend: {},\n    container: {\n      center: true,\n    }\n  },\n  plugins: [],\n}\n```\n\n在全局样式文件中导入tailwind：\n\nsrc\\styles\\index.css\n\n```css\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n```\n\nsrc\\styles\\index.scss\n\n```scss\n@import \"tailwindcss/base\";\n@import \"tailwindcss/components\";\n@import \"tailwindcss/utilities\";\n```\n\n全局样式文件在main.ts中导入：\n\n```js\nimport { createApp } from 'vue'\nimport App from './App.vue'\n\n// 导入全局样式文件\nimport './styles/index.scss'\n\ncreateApp(App).mount('#app')\n```\n\n安装VSCode插件：\n\n- Tailwind CSS IntelliSense支持自动完成、语法高亮、悬停预览、语法分析功能。\n- PostCSS Language Support支持css未知规则如tailwind中的 @tailwind、@apply、@screen。\n- 在.vue、.html文件中使用@apply仍提示未知规则，建议在已安装以上插件后再添加工作区配置禁止掉这个提示：`{ \"css.lint.unknownAtRules\": \"ignore\" }`。 \n\n\n## 具体使用及API\n\n详见 [tailwindcss官网](https://www.tailwindcss.cn/docs/utility-first)。\n\n## 最后\n\n个人感觉 Tailwind CSS 并没有太多让人「惊讶」的特性，但是在打造一个完整的设计系统这件事情上，Tailwind CSS 在每个方面都做了精心的设计，所以让人用起来很「舒服」。如果你还没有使用过 Tailwind CSS，建议可以尝试一下，相信会给你带来耳目一新的感受！\n\n提高可维护性的方法：\n\n从上面的例子可以看出，使用 Tailwind 后代码的风格趋于内联样式的编写，也带来的阅读的烦恼，解决这样的问题提供了下面两个常用的方法：\n\n1. 抽取相同、类似的布局为公共组件、模板，提高复用性；\n2. 对于没有必要或不应该提取为组件的简单元素，可以使用@apply抽象CSS类，就跟我们以前编写 class 一样来组合 Tailwind 功能类；","slug":"tailwindcss101","published":1,"updated":"2023-04-13T13:45:32.902Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsig002xyt8whvdn948f","content":"<h2 id=\"什么是-Tailwind-CSS\"><a href=\"#什么是-Tailwind-CSS\" class=\"headerlink\" title=\"什么是 Tailwind CSS\"></a>什么是 Tailwind CSS</h2><p>Tailwind CSS 是一个利用公用程序类（Utilize Class，下文皆称Utilize Class）的 CSS 框架。许多人会想到 CSS 框架，有很多，例如 Bootstrap、Bulma 和 Material UI。Bootstrap 和 Bulma 等框架利用预先准备好的组件（例如按钮、菜单和面包屑）进行设计。在 Tailwind CSS 中，没有准备任何组件，而是使用Utilize Class来创建和设计自己的组件。</p>\n<h2 id=\"为什么需要-Tailwind-CSS\"><a href=\"#为什么需要-Tailwind-CSS\" class=\"headerlink\" title=\"为什么需要 Tailwind CSS\"></a>为什么需要 Tailwind CSS</h2><p>传统情况下，当您需要在网页上设置样式时，都需要编写 CSS。使用传统方式时，定制的设计需要定制的 CSS：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification-logo-wrapper&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification-logo&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/img/logo.svg&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;ChitChat Logo&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification-content&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification-title&quot;</span>&gt;</span>ChitChat<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification-message&quot;</span>&gt;</span>You have a new message!<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">display</span>: flex;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">max-width</span>: <span class=\"number\">24rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">padding</span>: <span class=\"number\">1.5rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">0.5rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">20px</span> <span class=\"number\">25px</span> -<span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>.), <span class=\"number\">0</span> <span class=\"number\">10px</span> <span class=\"number\">10px</span> -<span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.04</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification-logo-wrapper</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">flex-shrink</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification-logo</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">height</span>: <span class=\"number\">3rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">width</span>: <span class=\"number\">3rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification-content</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">1.5rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">padding-top</span>: <span class=\"number\">0.25rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification-title</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">color</span>: <span class=\"number\">#1a202c</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1.25rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1.25</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">color</span>: <span class=\"number\">#718096</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1.5</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用 Tailwind，可以通过直接在 HTML 中应用预先存在的类来设置元素的样式。使用功能类构建自定义设计而无需编写 CSS：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;p-6 max-w-sm mx-auto bg-white rounded-xl shadow-md flex items-center space-x-4&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;flex-shrink-0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;h-12 w-12&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/img/logo.svg&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;ChitChat Logo&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text-xl font-medium text-black&quot;</span>&gt;</span>ChitChat<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text-gray-500&quot;</span>&gt;</span>You have a new message!<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在上面的示例中，我们使用了：</p>\n<ul>\n<li>使用 Tailwind 的 flexbox 和 padding 功能类 (flex, flex-shrink-0, 和 p-6) 来控制整体的卡片布局</li>\n<li>使用 max-width 和 margin 功能类 (max-w-sm 和 mx-auto) 来设置卡片的宽度和水平居中</li>\n<li>使用 background color, border radius, 和 box-shadow 功能类 (bg-white, rounded-xl, 和 shadow-md) 设置卡片的外观样式</li>\n<li>使用 width 和 height 功能类 (w-12 and h-12) 来设置 logo 图片的大小</li>\n<li>使用 space-between 功能类 (space-x-4) 来处理 logo 和文本之间的间距</li>\n<li>使用 font size，text color，和 font-weight 功能类 (text-xl，text-black，font-medium 等等) 给卡片文字设置样式</li>\n</ul>\n<p>这种方法使我们无需编写一行自定义的 CSS 即可实现一个完全定制的组件设计。</p>\n<p>你可能觉得这样比较乱，写法丑陋，但是他也有很多优点：</p>\n<ul>\n<li><strong>您没有为了给类命名而浪费精力</strong>。 不需要仅仅为了设置一些样式而额外添加一些像 sidebar-inner-wrapper 这样愚蠢的类名，不必再为了一个 flex 容器的完美抽象命名而倍受折磨。</li>\n<li><strong>您的 CSS 停止增长</strong>。 使用传统方法，每次添加新功能时 CSS 文件都会变大。使用功能类，所有内容都是可重用的，因此您几乎不需要编写新的CSS。</li>\n<li><strong>更改会更安全</strong>。 CSS 是全局性的，您永远不知道当您进行更改时会破坏掉什么。您 HTML 中的类是本地的，因此您可以更改它们而不必担心其他问题。</li>\n</ul>\n<h2 id=\"快速开始\"><a href=\"#快速开始\" class=\"headerlink\" title=\"快速开始\"></a>快速开始</h2><p>创建 vite + vue-ts 项目：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn create vite</span><br></pre></td></tr></table></figure>\n\n<p>安装 Tailwind CSS 依赖：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -D tailwindcss@latest postcss@latest autoprefixer@latest</span><br></pre></td></tr></table></figure>\n\n<p>生成 tailwind 和 postcss 配置文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npx tailwindcss init -p</span><br></pre></td></tr></table></figure>\n\n<p>tailwindcss 3.x 版本的配置文件：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/** <span class=\"doctag\">@type</span> &#123;<span class=\"type\">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">content</span>: [</span><br><span class=\"line\">    <span class=\"string\">&quot;./index.html&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;./src/**/*.&#123;vue,js,ts,jsx,tsx&#125;&quot;</span>,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">darkMode</span>: <span class=\"string\">&#x27;media&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">theme</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">extend</span>: &#123;&#125;,</span><br><span class=\"line\">    <span class=\"attr\">container</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">center</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在全局样式文件中导入tailwind：</p>\n<p>src\\styles\\index.css</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@tailwind</span> base;</span><br><span class=\"line\"><span class=\"keyword\">@tailwind</span> components;</span><br><span class=\"line\"><span class=\"keyword\">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure>\n\n<p>src\\styles\\index.scss</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@import</span> <span class=\"string\">&quot;tailwindcss/base&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">@import</span> <span class=\"string\">&quot;tailwindcss/components&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">@import</span> <span class=\"string\">&quot;tailwindcss/utilities&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>全局样式文件在main.ts中导入：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./App.vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 导入全局样式文件</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./styles/index.scss&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">createApp</span>(<span class=\"title class_\">App</span>).<span class=\"title function_\">mount</span>(<span class=\"string\">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>安装VSCode插件：</p>\n<ul>\n<li>Tailwind CSS IntelliSense支持自动完成、语法高亮、悬停预览、语法分析功能。</li>\n<li>PostCSS Language Support支持css未知规则如tailwind中的 @tailwind、@apply、@screen。</li>\n<li>在.vue、.html文件中使用@apply仍提示未知规则，建议在已安装以上插件后再添加工作区配置禁止掉这个提示：<code>&#123; &quot;css.lint.unknownAtRules&quot;: &quot;ignore&quot; &#125;</code>。</li>\n</ul>\n<h2 id=\"具体使用及API\"><a href=\"#具体使用及API\" class=\"headerlink\" title=\"具体使用及API\"></a>具体使用及API</h2><p>详见 <a href=\"https://www.tailwindcss.cn/docs/utility-first\">tailwindcss官网</a>。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>个人感觉 Tailwind CSS 并没有太多让人「惊讶」的特性，但是在打造一个完整的设计系统这件事情上，Tailwind CSS 在每个方面都做了精心的设计，所以让人用起来很「舒服」。如果你还没有使用过 Tailwind CSS，建议可以尝试一下，相信会给你带来耳目一新的感受！</p>\n<p>提高可维护性的方法：</p>\n<p>从上面的例子可以看出，使用 Tailwind 后代码的风格趋于内联样式的编写，也带来的阅读的烦恼，解决这样的问题提供了下面两个常用的方法：</p>\n<ol>\n<li>抽取相同、类似的布局为公共组件、模板，提高复用性；</li>\n<li>对于没有必要或不应该提取为组件的简单元素，可以使用@apply抽象CSS类，就跟我们以前编写 class 一样来组合 Tailwind 功能类；</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"什么是-Tailwind-CSS\"><a href=\"#什么是-Tailwind-CSS\" class=\"headerlink\" title=\"什么是 Tailwind CSS\"></a>什么是 Tailwind CSS</h2><p>Tailwind CSS 是一个利用公用程序类（Utilize Class，下文皆称Utilize Class）的 CSS 框架。许多人会想到 CSS 框架，有很多，例如 Bootstrap、Bulma 和 Material UI。Bootstrap 和 Bulma 等框架利用预先准备好的组件（例如按钮、菜单和面包屑）进行设计。在 Tailwind CSS 中，没有准备任何组件，而是使用Utilize Class来创建和设计自己的组件。</p>\n<h2 id=\"为什么需要-Tailwind-CSS\"><a href=\"#为什么需要-Tailwind-CSS\" class=\"headerlink\" title=\"为什么需要 Tailwind CSS\"></a>为什么需要 Tailwind CSS</h2><p>传统情况下，当您需要在网页上设置样式时，都需要编写 CSS。使用传统方式时，定制的设计需要定制的 CSS：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification-logo-wrapper&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification-logo&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/img/logo.svg&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;ChitChat Logo&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification-content&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification-title&quot;</span>&gt;</span>ChitChat<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-notification-message&quot;</span>&gt;</span>You have a new message!<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">display</span>: flex;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">max-width</span>: <span class=\"number\">24rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">padding</span>: <span class=\"number\">1.5rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">0.5rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">20px</span> <span class=\"number\">25px</span> -<span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>.), <span class=\"number\">0</span> <span class=\"number\">10px</span> <span class=\"number\">10px</span> -<span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.04</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification-logo-wrapper</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">flex-shrink</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification-logo</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">height</span>: <span class=\"number\">3rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">width</span>: <span class=\"number\">3rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification-content</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">1.5rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">padding-top</span>: <span class=\"number\">0.25rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification-title</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">color</span>: <span class=\"number\">#1a202c</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1.25rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1.25</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"selector-class\">.chat-notification-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">color</span>: <span class=\"number\">#718096</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1.5</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用 Tailwind，可以通过直接在 HTML 中应用预先存在的类来设置元素的样式。使用功能类构建自定义设计而无需编写 CSS：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;p-6 max-w-sm mx-auto bg-white rounded-xl shadow-md flex items-center space-x-4&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;flex-shrink-0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;h-12 w-12&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/img/logo.svg&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;ChitChat Logo&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text-xl font-medium text-black&quot;</span>&gt;</span>ChitChat<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text-gray-500&quot;</span>&gt;</span>You have a new message!<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在上面的示例中，我们使用了：</p>\n<ul>\n<li>使用 Tailwind 的 flexbox 和 padding 功能类 (flex, flex-shrink-0, 和 p-6) 来控制整体的卡片布局</li>\n<li>使用 max-width 和 margin 功能类 (max-w-sm 和 mx-auto) 来设置卡片的宽度和水平居中</li>\n<li>使用 background color, border radius, 和 box-shadow 功能类 (bg-white, rounded-xl, 和 shadow-md) 设置卡片的外观样式</li>\n<li>使用 width 和 height 功能类 (w-12 and h-12) 来设置 logo 图片的大小</li>\n<li>使用 space-between 功能类 (space-x-4) 来处理 logo 和文本之间的间距</li>\n<li>使用 font size，text color，和 font-weight 功能类 (text-xl，text-black，font-medium 等等) 给卡片文字设置样式</li>\n</ul>\n<p>这种方法使我们无需编写一行自定义的 CSS 即可实现一个完全定制的组件设计。</p>\n<p>你可能觉得这样比较乱，写法丑陋，但是他也有很多优点：</p>\n<ul>\n<li><strong>您没有为了给类命名而浪费精力</strong>。 不需要仅仅为了设置一些样式而额外添加一些像 sidebar-inner-wrapper 这样愚蠢的类名，不必再为了一个 flex 容器的完美抽象命名而倍受折磨。</li>\n<li><strong>您的 CSS 停止增长</strong>。 使用传统方法，每次添加新功能时 CSS 文件都会变大。使用功能类，所有内容都是可重用的，因此您几乎不需要编写新的CSS。</li>\n<li><strong>更改会更安全</strong>。 CSS 是全局性的，您永远不知道当您进行更改时会破坏掉什么。您 HTML 中的类是本地的，因此您可以更改它们而不必担心其他问题。</li>\n</ul>\n<h2 id=\"快速开始\"><a href=\"#快速开始\" class=\"headerlink\" title=\"快速开始\"></a>快速开始</h2><p>创建 vite + vue-ts 项目：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn create vite</span><br></pre></td></tr></table></figure>\n\n<p>安装 Tailwind CSS 依赖：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -D tailwindcss@latest postcss@latest autoprefixer@latest</span><br></pre></td></tr></table></figure>\n\n<p>生成 tailwind 和 postcss 配置文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npx tailwindcss init -p</span><br></pre></td></tr></table></figure>\n\n<p>tailwindcss 3.x 版本的配置文件：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/** <span class=\"doctag\">@type</span> &#123;<span class=\"type\">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">content</span>: [</span><br><span class=\"line\">    <span class=\"string\">&quot;./index.html&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;./src/**/*.&#123;vue,js,ts,jsx,tsx&#125;&quot;</span>,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">darkMode</span>: <span class=\"string\">&#x27;media&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">theme</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">extend</span>: &#123;&#125;,</span><br><span class=\"line\">    <span class=\"attr\">container</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">center</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在全局样式文件中导入tailwind：</p>\n<p>src\\styles\\index.css</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@tailwind</span> base;</span><br><span class=\"line\"><span class=\"keyword\">@tailwind</span> components;</span><br><span class=\"line\"><span class=\"keyword\">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure>\n\n<p>src\\styles\\index.scss</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@import</span> <span class=\"string\">&quot;tailwindcss/base&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">@import</span> <span class=\"string\">&quot;tailwindcss/components&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">@import</span> <span class=\"string\">&quot;tailwindcss/utilities&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>全局样式文件在main.ts中导入：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./App.vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 导入全局样式文件</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./styles/index.scss&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">createApp</span>(<span class=\"title class_\">App</span>).<span class=\"title function_\">mount</span>(<span class=\"string\">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>安装VSCode插件：</p>\n<ul>\n<li>Tailwind CSS IntelliSense支持自动完成、语法高亮、悬停预览、语法分析功能。</li>\n<li>PostCSS Language Support支持css未知规则如tailwind中的 @tailwind、@apply、@screen。</li>\n<li>在.vue、.html文件中使用@apply仍提示未知规则，建议在已安装以上插件后再添加工作区配置禁止掉这个提示：<code>&#123; &quot;css.lint.unknownAtRules&quot;: &quot;ignore&quot; &#125;</code>。</li>\n</ul>\n<h2 id=\"具体使用及API\"><a href=\"#具体使用及API\" class=\"headerlink\" title=\"具体使用及API\"></a>具体使用及API</h2><p>详见 <a href=\"https://www.tailwindcss.cn/docs/utility-first\">tailwindcss官网</a>。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>个人感觉 Tailwind CSS 并没有太多让人「惊讶」的特性，但是在打造一个完整的设计系统这件事情上，Tailwind CSS 在每个方面都做了精心的设计，所以让人用起来很「舒服」。如果你还没有使用过 Tailwind CSS，建议可以尝试一下，相信会给你带来耳目一新的感受！</p>\n<p>提高可维护性的方法：</p>\n<p>从上面的例子可以看出，使用 Tailwind 后代码的风格趋于内联样式的编写，也带来的阅读的烦恼，解决这样的问题提供了下面两个常用的方法：</p>\n<ol>\n<li>抽取相同、类似的布局为公共组件、模板，提高复用性；</li>\n<li>对于没有必要或不应该提取为组件的简单元素，可以使用@apply抽象CSS类，就跟我们以前编写 class 一样来组合 Tailwind 功能类；</li>\n</ol>\n"},{"title":"tsconfig.json 文件","date":"2023-03-07T14:46:40.000Z","description":"tsconfig.json 是 TypeScript 项目的配置文件。tsconfig.json 包含 TypeScript 编译的相关配置，通过更改编译配置项，我们可以让 TypeScript 编译出 ES6、ES5、node 的代码。","_content":"\n在文章开头环境安装部分，记得我们有生成一个 tsconfig.json 文件，那么这个文件究竟有什么用呢？\n\ntsconfig.json 是 TypeScript 项目的配置文件。\n\ntsconfig.json 包含 TypeScript 编译的相关配置，通过更改编译配置项，我们可以让 TypeScript 编译出 ES6、ES5、node 的代码。\n\n### 重要字段\n- files - 设置要编译的文件的名称；\n- include - 设置需要进行编译的文件，支持路径模式匹配；\n- exclude - 设置无需进行编译的文件，支持路径模式匹配；\n- compilerOptions - 设置与编译流程相关的选项。\n\n### compilerOptions 选项\n\n```json\n{\n  \"compilerOptions\": {\n\n    /* 基本选项 */\n    \"target\": \"es5\",                       // 指定 ECMAScript 目标版本: 'ES3' (default), 'ES5', 'ES6'/'ES2015', 'ES2016', 'ES2017', or 'ESNEXT'\n    \"module\": \"commonjs\",                  // 指定使用模块: 'commonjs', 'amd', 'system', 'umd' or 'es2015'\n    \"lib\": [],                             // 指定要包含在编译中的库文件\n    \"allowJs\": true,                       // 允许编译 javascript 文件\n    \"checkJs\": true,                       // 报告 javascript 文件中的错误\n    \"jsx\": \"preserve\",                     // 指定 jsx 代码的生成: 'preserve', 'react-native', or 'react'\n    \"declaration\": true,                   // 生成相应的 '.d.ts' 文件\n    \"sourceMap\": true,                     // 生成相应的 '.map' 文件\n    \"outFile\": \"./\",                       // 将输出文件合并为一个文件\n    \"outDir\": \"./\",                        // 指定输出目录\n    \"rootDir\": \"./\",                       // 用来控制输出目录结构 --outDir.\n    \"removeComments\": true,                // 删除编译后的所有的注释\n    \"noEmit\": true,                        // 不生成输出文件\n    \"importHelpers\": true,                 // 从 tslib 导入辅助工具函数\n    \"isolatedModules\": true,               // 将每个文件做为单独的模块 （与 'ts.transpileModule' 类似）.\n\n    /* 严格的类型检查选项 */\n    \"strict\": true,                        // 启用所有严格类型检查选项\n    \"noImplicitAny\": true,                 // 在表达式和声明上有隐含的 any类型时报错\n    \"strictNullChecks\": true,              // 启用严格的 null 检查\n    \"noImplicitThis\": true,                // 当 this 表达式值为 any 类型的时候，生成一个错误\n    \"alwaysStrict\": true,                  // 以严格模式检查每个模块，并在每个文件里加入 'use strict'\n\n    /* 额外的检查 */\n    \"noUnusedLocals\": true,                // 有未使用的变量时，抛出错误\n    \"noUnusedParameters\": true,            // 有未使用的参数时，抛出错误\n    \"noImplicitReturns\": true,             // 并不是所有函数里的代码都有返回值时，抛出错误\n    \"noFallthroughCasesInSwitch\": true,    // 报告 switch 语句的 fallthrough 错误。（即，不允许 switch 的 case 语句贯穿）\n\n    /* 模块解析选项 */\n    \"moduleResolution\": \"node\",            // 选择模块解析策略： 'node' (Node.js) or 'classic' (TypeScript pre-1.6)\n    \"baseUrl\": \"./\",                       // 用于解析非相对模块名称的基目录\n    \"paths\": {},                           // 模块名到基于 baseUrl 的路径映射的列表\n    \"rootDirs\": [],                        // 根文件夹列表，其组合内容表示项目运行时的结构内容\n    \"typeRoots\": [],                       // 包含类型声明的文件列表\n    \"types\": [],                           // 需要包含的类型声明文件名列表\n    \"allowSyntheticDefaultImports\": true,  // 允许从没有设置默认导出的模块中默认导入。\n\n    /* Source Map Options */\n    \"sourceRoot\": \"./\",                    // 指定调试器应该找到 TypeScript 文件而不是源文件的位置\n    \"mapRoot\": \"./\",                       // 指定调试器应该找到映射文件而不是生成文件的位置\n    \"inlineSourceMap\": true,               // 生成单个 soucemaps 文件，而不是将 sourcemaps 生成不同的文件\n    \"inlineSources\": true,                 // 将代码与 sourcemaps 生成到一个文件中，要求同时设置了 --inlineSourceMap 或 --sourceMap 属性\n\n    /* 其他选项 */\n    \"experimentalDecorators\": true,        // 启用装饰器\n    \"emitDecoratorMetadata\": true          // 为装饰器提供元数据的支持\n  }\n}\n```","source":"_posts/tsconfig-json.md","raw":"---\ntitle: tsconfig.json 文件\ndate: 2023-03-07 22:46:40\ntags: TypeScript\ncategories: JavaScript\ndescription: tsconfig.json 是 TypeScript 项目的配置文件。tsconfig.json 包含 TypeScript 编译的相关配置，通过更改编译配置项，我们可以让 TypeScript 编译出 ES6、ES5、node 的代码。\n---\n\n在文章开头环境安装部分，记得我们有生成一个 tsconfig.json 文件，那么这个文件究竟有什么用呢？\n\ntsconfig.json 是 TypeScript 项目的配置文件。\n\ntsconfig.json 包含 TypeScript 编译的相关配置，通过更改编译配置项，我们可以让 TypeScript 编译出 ES6、ES5、node 的代码。\n\n### 重要字段\n- files - 设置要编译的文件的名称；\n- include - 设置需要进行编译的文件，支持路径模式匹配；\n- exclude - 设置无需进行编译的文件，支持路径模式匹配；\n- compilerOptions - 设置与编译流程相关的选项。\n\n### compilerOptions 选项\n\n```json\n{\n  \"compilerOptions\": {\n\n    /* 基本选项 */\n    \"target\": \"es5\",                       // 指定 ECMAScript 目标版本: 'ES3' (default), 'ES5', 'ES6'/'ES2015', 'ES2016', 'ES2017', or 'ESNEXT'\n    \"module\": \"commonjs\",                  // 指定使用模块: 'commonjs', 'amd', 'system', 'umd' or 'es2015'\n    \"lib\": [],                             // 指定要包含在编译中的库文件\n    \"allowJs\": true,                       // 允许编译 javascript 文件\n    \"checkJs\": true,                       // 报告 javascript 文件中的错误\n    \"jsx\": \"preserve\",                     // 指定 jsx 代码的生成: 'preserve', 'react-native', or 'react'\n    \"declaration\": true,                   // 生成相应的 '.d.ts' 文件\n    \"sourceMap\": true,                     // 生成相应的 '.map' 文件\n    \"outFile\": \"./\",                       // 将输出文件合并为一个文件\n    \"outDir\": \"./\",                        // 指定输出目录\n    \"rootDir\": \"./\",                       // 用来控制输出目录结构 --outDir.\n    \"removeComments\": true,                // 删除编译后的所有的注释\n    \"noEmit\": true,                        // 不生成输出文件\n    \"importHelpers\": true,                 // 从 tslib 导入辅助工具函数\n    \"isolatedModules\": true,               // 将每个文件做为单独的模块 （与 'ts.transpileModule' 类似）.\n\n    /* 严格的类型检查选项 */\n    \"strict\": true,                        // 启用所有严格类型检查选项\n    \"noImplicitAny\": true,                 // 在表达式和声明上有隐含的 any类型时报错\n    \"strictNullChecks\": true,              // 启用严格的 null 检查\n    \"noImplicitThis\": true,                // 当 this 表达式值为 any 类型的时候，生成一个错误\n    \"alwaysStrict\": true,                  // 以严格模式检查每个模块，并在每个文件里加入 'use strict'\n\n    /* 额外的检查 */\n    \"noUnusedLocals\": true,                // 有未使用的变量时，抛出错误\n    \"noUnusedParameters\": true,            // 有未使用的参数时，抛出错误\n    \"noImplicitReturns\": true,             // 并不是所有函数里的代码都有返回值时，抛出错误\n    \"noFallthroughCasesInSwitch\": true,    // 报告 switch 语句的 fallthrough 错误。（即，不允许 switch 的 case 语句贯穿）\n\n    /* 模块解析选项 */\n    \"moduleResolution\": \"node\",            // 选择模块解析策略： 'node' (Node.js) or 'classic' (TypeScript pre-1.6)\n    \"baseUrl\": \"./\",                       // 用于解析非相对模块名称的基目录\n    \"paths\": {},                           // 模块名到基于 baseUrl 的路径映射的列表\n    \"rootDirs\": [],                        // 根文件夹列表，其组合内容表示项目运行时的结构内容\n    \"typeRoots\": [],                       // 包含类型声明的文件列表\n    \"types\": [],                           // 需要包含的类型声明文件名列表\n    \"allowSyntheticDefaultImports\": true,  // 允许从没有设置默认导出的模块中默认导入。\n\n    /* Source Map Options */\n    \"sourceRoot\": \"./\",                    // 指定调试器应该找到 TypeScript 文件而不是源文件的位置\n    \"mapRoot\": \"./\",                       // 指定调试器应该找到映射文件而不是生成文件的位置\n    \"inlineSourceMap\": true,               // 生成单个 soucemaps 文件，而不是将 sourcemaps 生成不同的文件\n    \"inlineSources\": true,                 // 将代码与 sourcemaps 生成到一个文件中，要求同时设置了 --inlineSourceMap 或 --sourceMap 属性\n\n    /* 其他选项 */\n    \"experimentalDecorators\": true,        // 启用装饰器\n    \"emitDecoratorMetadata\": true          // 为装饰器提供元数据的支持\n  }\n}\n```","slug":"tsconfig-json","published":1,"updated":"2023-03-08T13:50:12.517Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsih0030yt8w3uqi1c63","content":"<p>在文章开头环境安装部分，记得我们有生成一个 tsconfig.json 文件，那么这个文件究竟有什么用呢？</p>\n<p>tsconfig.json 是 TypeScript 项目的配置文件。</p>\n<p>tsconfig.json 包含 TypeScript 编译的相关配置，通过更改编译配置项，我们可以让 TypeScript 编译出 ES6、ES5、node 的代码。</p>\n<h3 id=\"重要字段\"><a href=\"#重要字段\" class=\"headerlink\" title=\"重要字段\"></a>重要字段</h3><ul>\n<li>files - 设置要编译的文件的名称；</li>\n<li>include - 设置需要进行编译的文件，支持路径模式匹配；</li>\n<li>exclude - 设置无需进行编译的文件，支持路径模式匹配；</li>\n<li>compilerOptions - 设置与编译流程相关的选项。</li>\n</ul>\n<h3 id=\"compilerOptions-选项\"><a href=\"#compilerOptions-选项\" class=\"headerlink\" title=\"compilerOptions 选项\"></a>compilerOptions 选项</h3><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;compilerOptions&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 基本选项 */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;target&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;es5&quot;</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 指定 ECMAScript 目标版本: &#x27;ES3&#x27; (default), &#x27;ES5&#x27;, &#x27;ES6&#x27;/&#x27;ES2015&#x27;, &#x27;ES2016&#x27;, &#x27;ES2017&#x27;, or &#x27;ESNEXT&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;module&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;commonjs&quot;</span><span class=\"punctuation\">,</span>                  <span class=\"comment\">// 指定使用模块: &#x27;commonjs&#x27;, &#x27;amd&#x27;, &#x27;system&#x27;, &#x27;umd&#x27; or &#x27;es2015&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;lib&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>                             <span class=\"comment\">// 指定要包含在编译中的库文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;allowJs&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 允许编译 javascript 文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;checkJs&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 报告 javascript 文件中的错误</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;jsx&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;preserve&quot;</span><span class=\"punctuation\">,</span>                     <span class=\"comment\">// 指定 jsx 代码的生成: &#x27;preserve&#x27;, &#x27;react-native&#x27;, or &#x27;react&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;declaration&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                   <span class=\"comment\">// 生成相应的 &#x27;.d.ts&#x27; 文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;sourceMap&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                     <span class=\"comment\">// 生成相应的 &#x27;.map&#x27; 文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;outFile&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 将输出文件合并为一个文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;outDir&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                        <span class=\"comment\">// 指定输出目录</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;rootDir&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 用来控制输出目录结构 --outDir.</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;removeComments&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                <span class=\"comment\">// 删除编译后的所有的注释</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noEmit&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                        <span class=\"comment\">// 不生成输出文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;importHelpers&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                 <span class=\"comment\">// 从 tslib 导入辅助工具函数</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;isolatedModules&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>               <span class=\"comment\">// 将每个文件做为单独的模块 （与 &#x27;ts.transpileModule&#x27; 类似）.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 严格的类型检查选项 */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;strict&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                        <span class=\"comment\">// 启用所有严格类型检查选项</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noImplicitAny&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                 <span class=\"comment\">// 在表达式和声明上有隐含的 any类型时报错</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;strictNullChecks&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>              <span class=\"comment\">// 启用严格的 null 检查</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noImplicitThis&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                <span class=\"comment\">// 当 this 表达式值为 any 类型的时候，生成一个错误</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;alwaysStrict&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                  <span class=\"comment\">// 以严格模式检查每个模块，并在每个文件里加入 &#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 额外的检查 */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noUnusedLocals&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                <span class=\"comment\">// 有未使用的变量时，抛出错误</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noUnusedParameters&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>            <span class=\"comment\">// 有未使用的参数时，抛出错误</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noImplicitReturns&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>             <span class=\"comment\">// 并不是所有函数里的代码都有返回值时，抛出错误</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noFallthroughCasesInSwitch&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>    <span class=\"comment\">// 报告 switch 语句的 fallthrough 错误。（即，不允许 switch 的 case 语句贯穿）</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 模块解析选项 */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;moduleResolution&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;node&quot;</span><span class=\"punctuation\">,</span>            <span class=\"comment\">// 选择模块解析策略： &#x27;node&#x27; (Node.js) or &#x27;classic&#x27; (TypeScript pre-1.6)</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;baseUrl&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 用于解析非相对模块名称的基目录</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;paths&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span>                           <span class=\"comment\">// 模块名到基于 baseUrl 的路径映射的列表</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;rootDirs&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>                        <span class=\"comment\">// 根文件夹列表，其组合内容表示项目运行时的结构内容</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;typeRoots&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 包含类型声明的文件列表</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;types&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>                           <span class=\"comment\">// 需要包含的类型声明文件名列表</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;allowSyntheticDefaultImports&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>  <span class=\"comment\">// 允许从没有设置默认导出的模块中默认导入。</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* Source Map Options */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;sourceRoot&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                    <span class=\"comment\">// 指定调试器应该找到 TypeScript 文件而不是源文件的位置</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mapRoot&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 指定调试器应该找到映射文件而不是生成文件的位置</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;inlineSourceMap&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>               <span class=\"comment\">// 生成单个 soucemaps 文件，而不是将 sourcemaps 生成不同的文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;inlineSources&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                 <span class=\"comment\">// 将代码与 sourcemaps 生成到一个文件中，要求同时设置了 --inlineSourceMap 或 --sourceMap 属性</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 其他选项 */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;experimentalDecorators&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>        <span class=\"comment\">// 启用装饰器</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;emitDecoratorMetadata&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span>          <span class=\"comment\">// 为装饰器提供元数据的支持</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>在文章开头环境安装部分，记得我们有生成一个 tsconfig.json 文件，那么这个文件究竟有什么用呢？</p>\n<p>tsconfig.json 是 TypeScript 项目的配置文件。</p>\n<p>tsconfig.json 包含 TypeScript 编译的相关配置，通过更改编译配置项，我们可以让 TypeScript 编译出 ES6、ES5、node 的代码。</p>\n<h3 id=\"重要字段\"><a href=\"#重要字段\" class=\"headerlink\" title=\"重要字段\"></a>重要字段</h3><ul>\n<li>files - 设置要编译的文件的名称；</li>\n<li>include - 设置需要进行编译的文件，支持路径模式匹配；</li>\n<li>exclude - 设置无需进行编译的文件，支持路径模式匹配；</li>\n<li>compilerOptions - 设置与编译流程相关的选项。</li>\n</ul>\n<h3 id=\"compilerOptions-选项\"><a href=\"#compilerOptions-选项\" class=\"headerlink\" title=\"compilerOptions 选项\"></a>compilerOptions 选项</h3><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;compilerOptions&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 基本选项 */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;target&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;es5&quot;</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 指定 ECMAScript 目标版本: &#x27;ES3&#x27; (default), &#x27;ES5&#x27;, &#x27;ES6&#x27;/&#x27;ES2015&#x27;, &#x27;ES2016&#x27;, &#x27;ES2017&#x27;, or &#x27;ESNEXT&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;module&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;commonjs&quot;</span><span class=\"punctuation\">,</span>                  <span class=\"comment\">// 指定使用模块: &#x27;commonjs&#x27;, &#x27;amd&#x27;, &#x27;system&#x27;, &#x27;umd&#x27; or &#x27;es2015&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;lib&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>                             <span class=\"comment\">// 指定要包含在编译中的库文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;allowJs&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 允许编译 javascript 文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;checkJs&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 报告 javascript 文件中的错误</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;jsx&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;preserve&quot;</span><span class=\"punctuation\">,</span>                     <span class=\"comment\">// 指定 jsx 代码的生成: &#x27;preserve&#x27;, &#x27;react-native&#x27;, or &#x27;react&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;declaration&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                   <span class=\"comment\">// 生成相应的 &#x27;.d.ts&#x27; 文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;sourceMap&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                     <span class=\"comment\">// 生成相应的 &#x27;.map&#x27; 文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;outFile&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 将输出文件合并为一个文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;outDir&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                        <span class=\"comment\">// 指定输出目录</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;rootDir&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 用来控制输出目录结构 --outDir.</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;removeComments&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                <span class=\"comment\">// 删除编译后的所有的注释</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noEmit&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                        <span class=\"comment\">// 不生成输出文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;importHelpers&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                 <span class=\"comment\">// 从 tslib 导入辅助工具函数</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;isolatedModules&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>               <span class=\"comment\">// 将每个文件做为单独的模块 （与 &#x27;ts.transpileModule&#x27; 类似）.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 严格的类型检查选项 */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;strict&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                        <span class=\"comment\">// 启用所有严格类型检查选项</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noImplicitAny&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                 <span class=\"comment\">// 在表达式和声明上有隐含的 any类型时报错</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;strictNullChecks&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>              <span class=\"comment\">// 启用严格的 null 检查</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noImplicitThis&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                <span class=\"comment\">// 当 this 表达式值为 any 类型的时候，生成一个错误</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;alwaysStrict&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                  <span class=\"comment\">// 以严格模式检查每个模块，并在每个文件里加入 &#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 额外的检查 */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noUnusedLocals&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                <span class=\"comment\">// 有未使用的变量时，抛出错误</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noUnusedParameters&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>            <span class=\"comment\">// 有未使用的参数时，抛出错误</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noImplicitReturns&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>             <span class=\"comment\">// 并不是所有函数里的代码都有返回值时，抛出错误</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;noFallthroughCasesInSwitch&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>    <span class=\"comment\">// 报告 switch 语句的 fallthrough 错误。（即，不允许 switch 的 case 语句贯穿）</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 模块解析选项 */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;moduleResolution&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;node&quot;</span><span class=\"punctuation\">,</span>            <span class=\"comment\">// 选择模块解析策略： &#x27;node&#x27; (Node.js) or &#x27;classic&#x27; (TypeScript pre-1.6)</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;baseUrl&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 用于解析非相对模块名称的基目录</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;paths&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span>                           <span class=\"comment\">// 模块名到基于 baseUrl 的路径映射的列表</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;rootDirs&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>                        <span class=\"comment\">// 根文件夹列表，其组合内容表示项目运行时的结构内容</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;typeRoots&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 包含类型声明的文件列表</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;types&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>                           <span class=\"comment\">// 需要包含的类型声明文件名列表</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;allowSyntheticDefaultImports&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>  <span class=\"comment\">// 允许从没有设置默认导出的模块中默认导入。</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* Source Map Options */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;sourceRoot&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                    <span class=\"comment\">// 指定调试器应该找到 TypeScript 文件而不是源文件的位置</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mapRoot&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span>                       <span class=\"comment\">// 指定调试器应该找到映射文件而不是生成文件的位置</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;inlineSourceMap&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>               <span class=\"comment\">// 生成单个 soucemaps 文件，而不是将 sourcemaps 生成不同的文件</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;inlineSources&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>                 <span class=\"comment\">// 将代码与 sourcemaps 生成到一个文件中，要求同时设置了 --inlineSourceMap 或 --sourceMap 属性</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* 其他选项 */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;experimentalDecorators&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span>        <span class=\"comment\">// 启用装饰器</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;emitDecoratorMetadata&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span>          <span class=\"comment\">// 为装饰器提供元数据的支持</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>"},{"title":"快速掌握 TypeScript 基础","date":"2022-06-07T14:21:38.000Z","description":"TS 是 TypeScript 的简称，是一种由微软开发的自由和开源的编程语言。对比于JS，TS是JS的超集，简单的说就是在 JavaScript 的基础上加入了类型系统，让每个参数都有明确的意义，从而带来了更加智能的提示。","_content":"\n\n## TS 是什么 ？\n\n**TS**：是 **TypeScript** 的简称，是一种由微软开发的自由和开源的编程语言。\n\n**TS和JS的关系**\n\n对比于JS，TS是JS的 **超集**，简单的说就是在 JavaScript 的基础上加入了 **类型系统**，让每个参数都有明确的意义，从而带来了更加 **智能** 的提示。\n\n相对于JS而言，TS属于 **强类型** 语言，所以对于项目而言，会使代码更加规范，从而解决了大型项目代码的复杂性，其次，浏览器是不识别TS的，所以在编译的时候，TS文件会先编译为JS文件。\n\n**安装TS**\n\n执行命令：\n\n```bash\nnpm install -g typescript \n// 或\nyarn global add typescript\n```\n\n**查看版本**\n\n```bash\ntsc -v\n```\n\n**编译**\n\n```bash\ntsc test.ts\n# test.ts => test.js\n```\n\n**在线编译**\n\n我们为了方便起见，可以使用线上的编辑器：[TypeScript Playground](https://www.typescriptlang.org/zh/play)\n\n并且你还可以看看生成对应的`ts`转化`ES5`，`ES6`之后的代码，也有相关的例子供你查看\n\n\n\n## TS数据类型\n\n这里将TS的数据类型简单的进行下归类：\n\n+ 基本类型：string、number、boolean、symbol、bigint、null、undefined\n+ 引用类型：array、 Tuple(元组)、 object(包含Object和{})、function\n+ 特殊类型：any、unknow、void、never、Enum(枚举)\n+ 其他类型：类型推理、字面量类型、交叉类型\n\n注：案例中有可能用到type和interface，在下面会详细讲解，有比较模糊的可以先看看\n\n### 基本类型\n\n```typescript\n//字符串\nlet str: string = \"Domesy\"\n\n// 数字\nlet num: number = 7\n\n//布尔\nlet bool: boolean = true\n\n//symbol\nlet sym: symbol = Symbol();\n\n//bigint\nlet big: bigint = 10n\n\n//null\nlet nu: null = null\n\n//undefined\nlet un: undefined = undefined\n\n```\n\n需要注意：\n\n+ null 和 undefined 两个类型一旦赋值上，就不能在赋值给任何其他类型\n+ symbol是独一无二的，假设再定义一个 sym1，那么 `sym === sym1` 为 false\n\n### 引用类型\n\n#### Array\n\n两种方式：\n\n- 类型名称 + []\n- Array<数据类型>\n\n```typescript\nlet arr1: number[] = [1, 2, 3]\n\nlet arr2: Array<number> = [1, 2, 3]\n\nlet arr2: Array<number> = [1, 2, '3'] // error\n\n//要想是数字类型或字符串类型，需要使用 ｜\nlet arr3: Array<number | string> = [1, 2, '3'] //ok\n```\n\n#### Tuple(元组)\n\nTuple 可以说是 Array 的一种特殊情况,针对上面的 arr3,我们看他的类型可以是string也可以是number，但对每个元素没有作出具体的限制。\n\n那么 Tuple 的作用就是限制元素的类型并且限制个数的数组,同时 Tuple这个概念值存在于TS，在JS上是不存在的\n这里存在一个问题：在TS中,是允许对 Tuple 扩增的（也就是允许使用 push方法），但在访问上不允许\n\n```typescript\nlet t: [number, string] = [1, '2'] // ok\nlet t1: [number, string] = [1, 3] // error\nlet t2: [number, string] = [1] // error\nlet t3: [number, string] = [1, '1', true] // error\n\nlet t5: [number, string] = [1, '2'] // ok\nt.push(2)\nconsole.log(t) // [1, '2', 2]\n\nlet a =  t[0] // ok\nlet b = t[1] // ok\nlet c = t[2] // error\n```\n\n#### object\n\n`object` 非原始类型，在定义上直接使用 object 是可以的，但你要更改对象的属性就会报错，原因是并没有使对象的内部具体的属性做限制，所以需要使用 **{}** 来定义内部类型\n\n```typescript\nlet obj1: object = { a: 1, b: 2}\nobj1.a = 3 // error\n\nlet obj2: { a: number, b: number } = {a: 1, b: 2}\nobj2.a = 3 // ok\n```\n`Object`(大写的O）,代表所有的原始类型或非原始类型都可以进行赋值,除了`null`和`undefined`\n\n```typescript\nlet obj: Object;\nobj = 1; // ok\nobj = \"a\"; // ok\nobj = true; // ok\nobj = {}; // ok\nobj = Symbol() //ok\nobj = 10n //ok\nobj = null; // error\nobj = undefined; // error\n```\n#### function\n\n**定义函数**\n\n- 有两种方式，一种为 `function`， 另一种为`箭头函数`\n- 在书写的时候，也可以写入返回值的类型，如果写入，则必须要有对应类型的返回值，**但通常情况下是省略**，因为`TS`的类型推断功能够正确推断出返回值类型\n\n```typescript\nfunction setName1(name: string) { //ok\n  console.log(\"hello\", name);\n}\nsetName1(\"Domesy\"); // \"hello\",  \"Domesy\"\n\nfunction setName2(name: string):string { //error\n  console.log(\"hello\", name);\n}\nsetName2(\"Domesy\");\n\nfunction setName3(name: string):string { //error\n  console.log(\"hello\", name);\n  return 1\n}\nsetName3(\"Domesy\");\n\nfunction setName4(name: string): string { //ok\n  console.log(\"hello\", name);\n  return name\n}\nsetName4(\"Domesy\"); // \"hello\",  \"Domesy\"\n\n//箭头函数与上述同理\nconst setName5 = (name:string) => console.log(\"hello\", name);\nsetName5(\"Domesy\") // \"hello\",  \"Domesy\"\n```\n**参数类型**\n\n- 可选参数： 如果函数要配置可有可无的参数时，可以通过 **?** 实现，切可选参数一定要在最后面\n- 默认参数：函数内可以自己设定其默认参数，用 **=** 实现\n- 剩余参数：仍可以使用扩展运算符 **...**\n\n```typescript\n// 可选参数\nconst setInfo1 = (name: string, age?: number) => console.log(name, age)\nsetInfo1('Domesy') //\"Domesy\",  undefined\nsetInfo1('Domesy', 7) //\"Domesy\",  7\n\n// 默认参数\nconst setInfo2 = (name: string, age: number = 11) => console.log(name, age)\nsetInfo2('Domesy') //\"Domesy\",  11\nsetInfo2('Domesy', 7) //\"Domesy\",  7\n\n// 剩余参数\nconst allCount = (...numbers: number[]) => console.log(`数字总和为：${numbers.reduce((val, item) => (val += item), 0)}`)\nallCount(1, 2, 3) //\"数字总和为：6\"\n```\n**函数重载**\n\n**函数重载**：是使用相同名称和不同参数数量或类型创建多个方法的一种能力。 在 TypeScript 中，表现为给同一个函数提供多个函数类型定义。 简单的说：**可以在同一个函数下定义多种类型值，最后汇总到一块**\n\n```typescript\nlet obj: any = {};\nfunction setInfo(val: string): void;\nfunction setInfo(val: number): void;\nfunction setInfo(val: boolean): void;\nfunction setInfo(val: string | number | boolean): void {\n  if (typeof val === \"string\") {\n    obj.name = val;\n  } else {\n    obj.age = val;\n  }\n}\nsetInfo(\"Domesy\");\nsetInfo(7);\nsetInfo(true);\nconsole.log(obj); // { name: 'Domesy', age: 7 }\n```\n\n\n\n### 特殊类型\n\n#### any\n\n在 TS 中，任何类型都可以归于 `any` 类型，所以`any`类型也就成了所有类型的**顶级类型**，同时，**如果不指定变量的类型，则默认为any类型**, 当然不推荐使用该类型，因为这样丧失了TS的作用。\n\n```typescript\nlet d:any; //等价于 let d \nd = '1';\nd = 2;\nd = true;\nd = [1, 2, 3];\nd = {}\n```\n#### unknow\n\n与any一样，都可以作为所有类型的**顶级类型**，但 unknow更加**严格**，那么可以说除了any 之下的第二大类型，接下来对比下any，主要严格于一下两点：\n\n+ unknow会对值进行检测，而类型any不会做检测操作，说白了，any类型可以赋值给任何类型，但unknow只能赋值给unknow类型和any类型\n+ unknow不允许定义的值有任何操作（如 方法，new等），但any可以\n\n```typescript\nlet u:unknown;\nlet a: any;\n\nu = '1'; //ok\nu = 2; //ok\nu = true; //ok\nu = [1, 2, 3]; //ok\nu = {}; //ok\n\nlet value:any = u //ok\nlet value1:any = a //ok\nlet value2:unknown = u //ok\nlet value3:unknown = a //ok\nlet value4:string = u //error\nlet value5:string = a //ok\nlet value6:number = u //error\nlet value7:number = a //ok\nlet value8:boolean = u //error\nlet value9:boolean = a //ok\n\nu.set() // error\na.set() //ok\nu() // error\na() //ok\nnew u() // error\nnew a() //ok\n```\n#### void\n\n当一个函数，没有返回值时，TS会默认他的返回值为  `void`  类型\n\n```typescript\nconst setInfo = ():void => {} // 等价于 const setInfo = () => {}\n\nconst setInfo1 = ():void => { return '1' }  // error\nconst setInfo2 = ():void => { return 2 } // error\nconst setInfo3 = ():void => { return true } // error\nconst setInfo4 = ():void => { return  } // ok\nconst setInfo5 = ():void => { return undefined } //ok \n```\n#### never\n\n表示一个函数永远不存在返回值，TS会认为类型为 never，那么与 void 相比, never应该是 void子集， 因为 void实际上的返回值为 undefined，而 never 连 undefined也不行\n\n符合never的情况有：当抛出异常的情况和无限死循环\n\n```typescript\nlet error = ():never => { // 等价约 let error = () => {}\n        throw new Error(\"error\");\n};\n\nlet error1 = ():never => {\n    while(true){}\n}\n```\n#### Enum(枚举)\n\n可以定义一些带名字的常量，这样可以 **清晰表达意图** 或 **创建一组有区别的用例**\n\n注意：\n\n- 枚举的类型只能是 `string` 或 `number`\n- 定义的名称不能为 **关键字**\n\n同时我们可以看看翻译为ES5是何样子\n\n#### 数字枚举\n\n- 枚组的类型默认为**数字类型**，默认从0开始以此累加，如果有设置默认值，则**只会对下面的值产生影响**\n- 同时支持**反向映射**（及从成员值到成员名的映射），但智能映射无默认值的情况，并且只能是默认值的前面\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7559b8e5b7b94f8fbafc95fd37eeffbd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n#### 字符串枚举\n\n字符串枚举要注意的是必须要有**默认值**，不支持**反向映射**\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0df3876ecc6a474085e468cbd3f1929f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n#### 常量枚举\n\n除了数字类型和字符串类型之外，还有一种特殊的类型，那就是常量枚举，也就是通过const去定义enum，但这种类型不会编译成任何 JS,只会编译对应的值\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/160ac2e75cab457d99093ce48c34756a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n#### 异构枚举\n\n包含了 `数字类型` 和 `字符串类型` 的混合，反向映射一样的道理\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d5f1433ab2c48bebc65ca5f8ace0da4~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n### 类型推论\n\n我们在学完这些基础类型，我们是不是每个类型都要去写字段是什么类型呢？其实不是，在TS中如果不设置类型，并且不进行赋值时，将会推论为any类型，如果进行赋值就会默认为类型\n\n```typescript\nlet a; // 推断为any\nlet str = '小杜杜'; // 推断为string\nlet num = 13; // 推断为number\nlet flag = false; // 推断为boolean\n\nstr = true // error Type 'boolean' is not assignable to type 'string'.(2322)\nnum = 'Domesy' // error\nflag = 7 // error\n```\n### 字面量类型\n\n字面量类型：在TS中，我们可以指定参数的类型是什么，目前支持字符串、数字、布尔三种类型。比如说我定义了 str 的类型是 '小杜杜'， 那么str的值只能是小杜杜\n\n```typescript\nlet str:'小杜杜' \nlet num: 1 | 2 | 3 = 1\nlet flag:true\n\nstr = '小杜杜' //ok\nstr = 'Donmesy' // error\n\nnum = 2 //ok\nnum = 7 // error\n\nflag = true // ok\nflag = false // error\n```\n### 交叉类型（&）\n\n交叉类型：将多个类型合并为一个类型，使用&符号连接，如：\n\n```typescript\ntype AProps = { a: string }\ntype BProps = { b: number }\n\ntype allProps = AProps & BProps\n\nconst Info: allProps = {\n    a: '小杜杜',\n    b: 7\n}\n```\n#### 同名基础属性合并\n\n我们可以看到交叉类型是结合两个属性的属性值，那么我们现在有个问题，要是两个属性都有相同的属性值，那么此时总的类型会怎么样，先看看下面的案列：\n\n```typescript\ntype AProps = { a: string, c: number }\ntype BProps = { b: number, c: string }\n\ntype allProps = AProps & BProps\n\nconst Info: allProps = {\n    a: '小杜杜',\n    b: 7,\n    c:  1, // error (property) c: never\n    c:  'Domesy', // error (property) c: never\n}\n```\n如果是相同的类型，合并后的类型也是此类型，那如果是不同的类型会如何：\n\n我们在Aprops和BProps中同时加入c属性，并且c属性的类型不同，一个是number类型，另一个是string类型\n现在结合为 allProps 后呢? 是不是c属性是 number 或 string 类型都可以，还是其中的一种？\n\n然而在实际中， c 传入数字类型和字符串类型都不行，我么看到报错，现实的是 c的类型是 never。\n\n这是因为对应 c属性而言是 string & number，然而这种属性明显是不存在的，所以c的属性是never\n\n#### 同名非基础属性合并\n\n```typescript\ninterface A { a: number }\ninterface B { b: string }\n\ninterface C {\n    x: A\n}\ninterface D {\n    x: B\n}\ntype allProps = C & D\n\nconst Info: allProps = {\n  x: {\n    a: 7,\n    b: '小杜杜'\n  }\n}\n\nconsole.log(Info) // { x: { \"a\": 7, \"b\": \"小杜杜\" }}\n```\n我们来看看案例，对于混入多个类型时，若存在相同的成员，且成员类型为非基本数据类型，那么是可以成功合。\n\n如果 接口A 中的 也是 b，类型为number，就会跟**同名基础属性合并**一样\n\n\n\n## Class（类）\n\n在ES6中推出了一个叫 class（类） 的玩意，具体定义就不说了，相信用过React的小伙伴一定不陌生。\n\n### 基本方法\n\n在基本方法中有：静态属性，静态方法、成员属性、成员方法、构造器、get set方法，接下来逐个看看：\n\n需要注意的是： 在成员属性中，如果不给默认值,并且不使用是会报错的，如果不想报错就给如` !`，如：`name4!:string`\n\n```typescript\nclass Info {\n  //静态属性\n  static name1: string = 'Domesy'\n\n  //成员属性，实际上是通过public上进行修饰，只是省略了\n  nmae2:string = 'Hello' //ok \n  name3:string //error\n  name4!:string //ok 不设置默认值的时候必须加入 !\n\n  //构造方法\n  constructor(_name:string){\n    this.name4 = _name\n  }\n\n  //静态方法\n  static getName = () => {\n    return '我是静态方法'\n  }\n\n  //成员方法\n  getName4 = () => {\n    return `我是成员方法:${this.name4}`\n  }\n\n  //get 方法\n  get name5(){\n    return this.name4\n  }\n\n  //set 方法\n  set name5(name5){\n    this.name4 = name5\n  }\n}\n\nconst setName = new Info('你好')\nconsole.log(Info.name1) //  \"Domesy\" \nconsole.log(Info.getName()) // \"我是静态方法\" \nconsole.log(setName.getName4()) // \"我是成员方法:你好\" \n```\n让我们看看上述代码翻译成ES5是什么样：\n\n```js\n\"use strict\";\nvar Info = /** @class */ (function () {\n    //构造方法\n    function Info(_name) {\n        var _this = this;\n        //成员属性\n        this.nmae2 = 'Hello'; //ok\n        //成员方法\n        this.getName4 = function () {\n            return \"\\u6211\\u662F\\u6210\\u5458\\u65B9\\u6CD5:\".concat(_this.name4);\n        };\n        this.name4 = _name;\n    }\n    Object.defineProperty(Info.prototype, \"name5\", {\n        //get 方法\n        get: function () {\n            return this.name4;\n        },\n        //set 方法\n        set: function (name5) {\n            this.name4 = name5;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    //静态属性\n    Info.name1 = 'Domesy';\n    //静态方法\n    Info.getName = function () {\n        return '我是静态方法';\n    };\n    return Info;\n}());\nvar setName = new Info('你好');\nconsole.log(Info.name1); //  \"Domesy\" \nconsole.log(Info.getName()); // \"我是静态方法\" \nconsole.log(setName.getName4()); // \"我是成员方法:你好\" \n```\n### 私有字段(#)\n\n在 TS 3.8版本便开始支持 ECMACMAScript 的私有字段。\n\n需要注意的是私有字段与常规字段不同，主要的区别是：\n\n- 私有字段以 `#` 字符开头，也叫私有名称；\n- 每个私有字段名称都**唯一**地限定于其包含的类；\n- 不能在私有字段上使用 TypeScript 可访问性修饰符（如 public 或 private）；\n- 私有字段不能在包含的类之外访问，甚至不能被检测到。\n\n```typescript\nclass Info {\n  #name: string; //私有字段\n  getName: string;\n\n  constructor(name: string) {\n    this.#name = name;\n    this.getName = name\n  }\n\n  setName() {\n    return `我的名字是${this.#name}`\n  }\n}\n\nlet myName = new Info(\"Domesy\");\n\nconsole.log(myName.setName()) // \"我的名字是Domesy\" \nconsole.log(myName.getName) // ok \"Domesy\" \nconsole.log(myName.#name) // error \n// Property '#name' is not accessible outside class 'Info' \n// because it has a private identifier.(18013)\n```\n\n### 只读属性（readonly）\n\n只读属性：用 readonly修饰，只能在构造函数中初始化，并且在TS中，只允许将interface、type、class上的属性标识为readonly\n\n- `readonly`实际上只是在 `编译阶段` 进行代码检查\n- 被`radonly`修饰的词只能在 `constructor` 阶段修改，其他时刻不允许修改\n\n```typescript\nclass Info {\n  public readonly name: string; // 只读属性\n  name1:string\n\n  constructor(name: string) {\n    this.name = name;\n    this.name1 = name;\n  }\n\n  setName(name:string) {\n    this.name = name // error\n    this.name1 = name; // ok\n  }\n}\n```\n### 继承（extends）\n\n继承：是个比较重要的点，指的是子可以继承父的思想，也就是说 子类 通过继承父类后，就拥有了父类的属性和方法，这点与HOC有点类似。\n\n这里有个`super`字段，给不知道的小伙伴说说，其作用是**调用父类上的属性和方法**\n\n```typescript\n// 父类\nclass Person {\n  name: string\n  age: number\n\n  constructor(name: string, age:number){\n    this.name = name\n    this.age = age\n  }\n\n  getName(){\n    console.log(`我的姓名是：${this.name}`)\n    return this.name\n  }\n\n  setName(name: string){\n    console.log(`设置姓名为：${name}`)\n    this.name = name\n  }\n}\n\n// 子类\nclass Child extends Person {\n  tel: number\n  constructor(name: string, age: number, tel:number){\n    super(name, age)\n    this.tel = tel\n  }\n\n  getTel(){\n    console.log(`电话号码是${this.tel}`)\n    return this.tel\n  }\n}\n\nlet res = new Child(\"Domesy\", 7 , 123456)\nconsole.log(res) // Child {.\"name\": \"Domesy\", \"age\": 7, \"no\": 1 }\nconsole.log(res.age) // 7\nres.setName('小杜杜') // \"设置姓名为：小杜杜\" \nres.getName() //   \"我的姓名是：小杜杜\"\nres.getTel() //  \"电话号码是123456\" \n```\n### 修饰符\n\n主要有三种修饰符：\n\n- **public**：类中、子类内的任何地方、外部**都能调用**\n- **protected**：类中、子类内的任何地方都能调用,但**外部不能调用**\n- **private**：类中可以调用，子类内的任何地方、外部**均不可调用**\n\n```typescript\nclass Person {\n  public name: string\n  protected age: number\n  private tel: number\n\n  constructor(name: string, age:number, tel: number){\n    this.name = name\n    this.age = age\n    this.tel = tel\n  }\n}\n\nclass Child extends Person {\n  constructor(name: string, age: number, tel: number) {\n    super(name, age, tel);\n  }\n\n  getName(){\n    console.log(`我的名字叫${this.name},年龄是${this.age}`) // ok name 和 age可以\n    console.log(`电话是${this.tel}`) // error 报错 原因是 tel 拿不出来\n  }\n}\n\nconst res = new Child('Domesy', 7, 123456)\nconsole.log(res.name) // ok Domesy\nconsole.log(res.age) // error\nconsole.log(res.tel) // error\n```\n\n### abstract\n\nabstract: 用abstract关键字声明的类叫做**抽象类**，声明的方法叫做**抽象方法**。\n\n- **抽象类**：指不能被实例化，因为它里面包含一个或多个抽象方法。\n- **抽象方法**：是指不包含具体实现的方法；\n\n注：抽象类是不能直接实例化，只能实例化实现了所有抽象方法的子类\n\n```typescript\nabstract class Person {\n  constructor(public name: string){}\n\n  // 抽象方法\n  abstract setAge(age: number) :void;\n}\n\nclass Child extends Person {\n  constructor(name: string) {\n    super(name);\n  }\n\n  setAge(age: number): void {\n    console.log(`我的名字是${this.name},年龄是${age}`);\n  }\n}\n\nlet res = new Person(\"小杜杜\") //error\nlet res1 = new Child(\"小杜杜\");\n\nres1.setAge(7) // \"我的名字是小杜杜,年龄是7\"\n```\n### 重写和重载\n\n- **重写**：子类重写继承自父类中的方法\n- **重载**：指为同一个函数提供多个类型定义，与上述函数的重载类似\n\n```typescript\n// 重写\nclass Person{\n  setName(name: string){\n    return `我的名字叫${name}`\n  }\n}\n\nclass Child extends Person{\n  setName(name: string){\n    return `你的名字叫${name}`\n  }\n}\n\nconst yourName = new Child()\nconsole.log(yourName.setName('小杜杜')) // \"你的名字叫小杜杜\" \n\n// 重载\nclass Person1{\n  setNameAge(name: string):void;\n  setNameAge(name: number):void;\n  setNameAge(name:string | number){\n    if(typeof name === 'string'){\n      console.log(`我的名字是${name}`)\n    }else{\n      console.log(`我的年龄是${name}`)\n    }\n  };\n}\n\nconst res = new Person1()\nres.setNameAge('小杜杜') // \"我的名字是小杜杜\" \nres.setNameAge(7) // \"我的年龄是7\"\n```\n\n\n\n\n## TS断言和类型守卫\n\n### TS断言\n\n分为三种：`类型断言`、`非空断言`、`确定赋值断言`\n\n当断言失效后，可能使用到：**双重断言**\n\n#### 类型断言\n\n在特定的环境中，我们会比TS知道这个值具体是什么类型，不需要TS去判断，简单的理解就是，**类型断言会告诉编译器，你不用给我进行检查，相信我，他就是这个类型**\n\n共有两种方式：\n\n- **尖括号**\n- **as**：推荐\n\n```typescript\n//尖括号\nlet num:any = '小杜杜'\nlet res1: number = (<string>num).length; // React中会 error\n\n// as 语法\nlet str: any = 'Domesy';\nlet res: number = (str as string).length;\n```\n\n但需要注意的是：尖括号语法在React中会报错，原因是与JSX语法会产生冲突，所以只能使用as语法。\n\n#### 非空断言\n\n在上下文中当类型检查器无法断定类型时，一个新的后缀表达式操作符 `!` 可以用于断言操作对象是**非 null 和非 undefined 类型。**\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fa80b9ac2a54614a129c5724678254a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n我们可以看出来 !可以帮助我们过滤 null和 undefined类型，也就是说，编译器会默认我们只会传来string类型的数据，所以可以赋值为str1。\n\n但变成ES5后 !会被移除，所以当传入 null 的时候，还是会打出 null。\n\n#### 确定赋值断言\n\n在TS 2.7版本中引入了确定赋值断言，即允许在实例属性和变量声明后面放置一个 ! 号，以告诉TS该属性会被明确赋值。\n\n```typescript\nlet num: number;\nlet num1!: number;\n\nconst setNumber = () => num = 7\nconst setNumber1 = () => num1 = 7\n\nsetNumber()\nsetNumber1()\n\nconsole.log(num) // error \nconsole.log(num1) // ok\n```\n#### 双重断言\n\n断言失效后，可能会用到，但一般情况下不会使用。\n\n失效的情况：基础类型不能断言为接口。\n\n```typescript\ninterface Info{\n  name: string;\n  age: number;\n}\n\nconst name = '小杜杜' as Info; // error, 原因是不能把 string 类型断言为 一个接口\nconst name1 = '小杜杜' as any as Info; //ok\n```\n\n\n### 类型守卫\n\n**类型守卫**：是**可执行运行时检查的**一种表达式，用于确保**该类型在一定的范围内**。\n\n个人的感觉是，类型守卫就是你可以设置多种类型，但我默认你是什么类型的意思\n\n目前，常有的类型守卫共有4种：**in关键字**、**typeof关键字**、**instanceof**和**类型谓词（is)**\n\n#### in关键字\n\n用于判断这个属性是哪个里面的\n\n```typescript\ninterface Info {\n  name: string\n  age: number\n}\n\ninterface Info1{\n  name: string\n  flage: true\n}\n\nconst setInfo = (data: Info | Info1) => {\n  if(\"age\" in data){\n    console.log(`我的名字是：${data.name}，年龄是：${data.age}`)\n  }\n\n   if(\"flage\" in data){\n    console.log(`我的名字是：${data.name}，性别是：${data.flage}`)\n  }\n}\n\nsetInfo({name: '小杜杜', age: 7}) // \"我的名字是：小杜杜，年龄是：7\" \nsetInfo({name: '小杜杜', flage: true}) // \"我的名字是：小杜杜，性别是：true\"\n```\n#### typeof关键字\n\n用于判断基本类型，如string ｜ number等。\n\n```typescript\nconst setInfo = (data: number | string | undefined) => {\n  if(typeof data === \"string\"){\n    console.log(`我的名字是：${data}`)\n  }\n\n  if(typeof data === \"number\"){\n    console.log(`我的年龄是：${data}`)\n  }\n\n  if(typeof data === \"undefined\"){\n    console.log(data)\n  }\n}\n\nsetInfo('小杜杜') // \"我的名字是：小杜杜\"  \nsetInfo(7) // \"我的年龄是：7\" \nsetInfo(undefined) // undefined\" \n```\n#### instanceof关键字\n\n用于判断一个实例是不是构造函数，或使用类的时候\n\n```typescript\nclass Name {\n  name: string = '小杜杜'\n}\n\nclass Age extends Name{\n  age: number = 7\n}\n\nconst setInfo = (data: Name) => {\n  if (data instanceof Age) {\n    console.log(`我的年龄是${data.age}`);\n  } else {\n    console.log(`我的名字是${data.name}`);\n  }\n} \n\nsetInfo(new Name()) // \"我的名字是小杜杜\"\nsetInfo(new Age()) // \"我的年龄是7\" \n```\n#### 类型谓词（is)\n\n```typescript\nfunction isNumber(x: any): x is number { //默认传入的是number类型\n  return typeof x === \"number\"; \n}\n\nconsole.log(isNumber(7)) // true\nconsole.log(isNumber('7')) //false\nconsole.log(isNumber(true)) //false\n```\n\n\n\n### 两者的区别\n\n通过上面的介绍，我们可以发现`断言`与`类型守卫`的概念非常相似，都是确定参数的类型，但`断言`更加**霸道**，它是直接告诉编辑器，这个参数就是这个类型，而类型守卫更像确定这个参数具体是什么类型。\n\n\n\n\n\n## 类型别名、接口\n\n### 类型别名（type）\n\n类型别名：也就是type，用来给一个类型起个新名字。\n\n```typescript\ntype InfoProps = string | number\n\nconst setInfo = (data: InfoProps) => {}\n```\n### 接口（interface）\n\n接口：在面向对象语言中表示行为抽象，也可以用来描述对象的形状。\n\n使用interface关键字来定义接口：\n\n#### 对象的形状\n\n接口可以用来描述对象，主要可以包括以下数据：可读属性、只读属性、任意属性\n\n+ **可读属性**：当我们定义一个接口时，我们的属性可能不需要全都要，这是就需要 **?** 来解决\n+ **只读属性**：用 **readonly**修饰的属性为只读属性，意思是指允许定义，不允许之后进行更改\n+ **任意属性**：这个属性极为重要，它是可以用作就算没有定义，也可以使用，比如 **[data: string]: any**。比如说我们对组件进行封装，而封装的那个组件并没有导出对应的类型，然而又想让他不报错，这时就可以使用任意属性\n\n```typescript\ninterface Props {\n    a: string;\n    b: number;\n    c: boolean;\n    d?: number; // 可选属性\n    readonly e: string; //只读属性\n    [f: string]: any //任意属性\n}\nlet res: Props = {\n    a: '小杜杜',\n    b: 7,\n    c: true,\n    e: 'Domesy',\n    d: 1, // 有没有d都可以\n    h: 2 // 任意属性，之前为定义过h\n}\n\nlet res.e = 'hi' // error, 原因是可读属性不允许更改\n```\n#### 继承\n\n继承：与类一样，接口也存在继承属性，也是使用 **extends** 字段\n\n```typescript\ninterface nameProps {\n    name: string\n}\n\ninterface Props extends nameProps{\n    age: number\n}\n\nconst res: Props = {\n    name: '小杜杜',\n    age: 7\n}\n```\n#### 函数类型接口\n\n同时，可以定义函数和类，**加new修饰的是类，不加new的是函数**\n\n```typescript\ninterface Props {\n    (data: number): number\n}\n\nconst info: Props = (number:number) => number  //可定义函数\n\n// 定义函数\nclass A {\n    name:string\n    constructor(name: string){\n        this.name = name\n    }\n}\n\ninterface PropsClass{\n    new (name: string): A\n}\n\nconst info1 = (fun: PropsClass, name: string) => new fun(name)\n\nconst res = info1(A, \"小杜杜\")\nconsole.log(res.name) // \"小杜杜\" \n```\n\n\n### type 和 interface 的区别\n\n类型别名和接口非常相似，可以说在大多数情况下，type与interface是等价的。\n\n但在一些特定的场景差距还是比较大的，接下来逐个来看看：\n\n#### 基础数据类型\n\n+ type 和 interface 都可以定义 对象 和 函数\n+ type 可以定义其他数据类型，如字符串、数字、元祖、联合类型等，而 interface不行\n\n```typescript\ntype A = string // 基本类型\n\ntype B = string | number // 联合类型\n\ntype C = [number, string] // 元祖\n\nconst dom = document.createElement(\"div\");  // dom元素\ntype D = typeof dom\n```\n#### 扩展\n\ninterface 可以扩展 type，type 也可以扩展为 interface，但两者实现扩展的方式不同。\n\n+ interface 是通过 **extends** 来实现\n+ type 是通过 **&** 来实现\n\n```typescript\n// interface 扩展 interface\ninterface A {\n    a: string\n}\ninterface B extends  A {\n    b: number\n}\nconst obj:B = { a: `小杜杜`, b: 7 }\n\n// type 扩展 type\ntype C = { a: string }\ntype D = C & { b: number }\nconst obj1:D = { a: `小杜杜`, b: 7 }\n\n// interface 扩展为 Type\ntype E = { a: string }\ninterface F extends E { b: number }\nconst obj2:F = { a: `小杜杜`, b: 7 }\n\n// type 扩展为 interface\ninterface G { a: string }\ntype H = G & {b: number}\nconst obj3:H = { a: `小杜杜`, b: 7 }\n```\n#### 重复定义\n\ninterface 可以多次被定义，并且会进行合并，但type不行\n\n```typescript\ninterface A {\n    a: string\n}\ninterface A {\n    b: number\n}\nconst obj:A = { a: `小杜杜`, b: 7 }\n\ntype B = { a: string }\ntype B = { b: number } // error\n```\n\n\n\n\n## 联合类型(Union Types)\n\n联合类型(Union Types): 表示取值可以为多种类型中的一种，未赋值时联合类型上只能访问两个类型共有的属性和方法，如：\n\n```typescript\nconst setInfo = (name: string | number) => {}\n\nsetInfo('小杜杜')\nsetInfo(7)\n```\n从上面看 setInfo接收一个name，而 name 可以接收 string或number类型，那么这个参数便是联合类型。\n\n### 可辨识联合\n\n可辨识联合：包含三个特点，分别是可辨识、联合类型、类型守卫,\n\n这种类型的本质是：结合**联合类型**和**字面量类型**的一种类型保护方法。\n\n如果一个类型是多个类型的联合类型，且多个类型含有一个公共属性，那么就可以利用这个公共属性，来创建不同的类型保护区块。\n\n也就是上面一起结合使用，这里写个小例子：\n\n```typescript\ninterface A {\n  type: 1,\n  name: string\n}\n\ninterface B {\n  type: 2\n  age: number\n}\n\ninterface C {\n  type: 3,\n  sex: boolean\n}\n\n// const setInfo = (data: A | B | C) => {\n//   return data.type // ok 原因是 A 、B、C 都有 type属性\n//   return data.age // error，  原因是没有判断具体是哪个类型，不能确定是A，还是B，或者是C\n// }\n\nconst setInfo1 = (data: A | B | C) => {\n  if (data.type === 1 ) {\n    console.log(`我的名字是${data.name}`);\n  } else if (data.type === 2 ){\n    console.log(`我的年龄是${data.age}`);\n  } else if (data.type === 3 ){\n    console.log(`我的性别是${data.sex}`);\n  }\n}\n\nsetInfo1({type: 1, name: '小杜杜'}) // \"我的名字是小杜杜\"\nsetInfo1({type: 2, age: 7}) // \"我的年龄是7\" \nsetInfo1({type: 3, sex: true}) // \"我的性别是true\" \n```\n定义了 A、B、C 三次接口，但这三个接口都包含type属性，那么type就是可辨识的属性,而其他属性只跟特性的接口相关。\n\n然后通过可辨识属性type，才能使用其相关的属性。\n\n\n\n\n\n## 泛型\n\n泛型：Generics，是指在定义函数、接口或类的时候，不预先指定具体的类型，而在使用的时候再指定类型的一种特性。\n\n也就是说，泛型是**允许同一个函数接受不同类型参数的一种模版**，与`any`相比，使用泛型来创建可服用的组件要更好，因为**泛型会保留参数类型**（PS：泛型是整个TS的重点，也是难点，请多多注意～）\n\n### 为什么需要泛型\n\n我们先看看一个例子：\n\n```typescript\nconst calcArray = (data:any):any[] => {\n    let list = []\n    for(let i = 0; i < 3; i++){\n        list.push(data)\n    }\n    return list\n}\n\nconsole.log(calcArray('d')) // [\"d\", \"d\", \"d\"]\n```\n上述的例子我们发现，在calcArray中传任何类型的参数，返回的数组都是any类型。\n\n由于我们不知道传入的数据是什么，所以返回的数据也为any的数组。\n\n但我们现在想要的效果是：**无论我们传什么类型，都能返回对应的类型**，针对这种情况怎么办？所以此时 `泛型` 就登场了。\n\n### 泛型语法\n\n我们先用泛型对上面的例子进行改造下，\n\n```typescript\nconst calcArray = <T,>(data:T):T[] => {\n    let list:T[] = []\n    for(let i = 0; i < 3; i++){\n        list.push(data)\n    }\n    return list\n}\n\nconst res:string[] = calcArray<string>('d') // ok\nconst res1:number[] = calcArray<number>(7) // ok\n\ntype Props = {\n    name: string,\n    age: number\n}\nconst res3: Props[] = calcArray<Props>({name: '小杜杜', age: 7}) //ok\n```\n经过上面的案例，我们发现传入的字符串、数字、对象，都能返回对应的类型，从而达到我们的目的，接下来我们再看看泛型语法：\n\n```typescript\nfunction identity <T>(value:T) : T {\n    return value\n}\n```\n第一次看到这个 `<T>` 我们是不是很懵，实际上这个T就是传递的类型,从上述的例子来看，这个 `<T>` 就是 `<string>` ，要注意一点，这个 `<string>` 实际上是可以省略的，因为 TS 具有类型推论，可以自己推断类型。\n\n### 多类型传参\n\n我们有多个未知的类型占位，我们可以定义任何的字母来表示不同的参数类型\n\n```typescript\nconst calcArray = <T,U>(name:T, age:U): {name:T, age:U} => {\n    const res: {name:T, age:U} = {name, age}\n    return res\n}\n\nconst res = calcArray<string, number>('小杜杜', 7)\nconsole.log(res) // {\"name\": \"小杜杜\", \"age\": 7}\n```\n### 泛型接口\n\n定义接口的时候，我们也可以使用泛型\n\n```typescript\ninterface A<T> {\n    data: T\n}\n\nconst Info: A<string> = {data: '1'}\nconsole.log(Info.data) // \"1\"\n```\n### 泛型类\n\n同样泛型也可以定义类\n\n```typescript\nclass clacArray<T>{\n    private arr: T[] = [];\n\n    add(value: T) {\n        this.arr.push(value)\n    }\n    getValue(): T {\n        let res = this.arr[0];\n        console.log(this.arr)\n        return res;\n    }\n}\n\nconst res = new clacArray()\n\nres.add(1)\nres.add(2)\nres.add(3)\n\nres.getValue() //[1, 2, 3] \nconsole.log(res.getValue) // 1\n```\n### 泛型类型别名\n\n```typescript\ntype Info<T> = {\n    name?: T\n    age?: T\n}\n\nconst res:Info<string> = { name: '小杜杜'}\nconst res1:Info<number> = { age: 7}\n```\n### 泛型默认参数\n\n所谓默认参数，是指定类型，如默认值一样，从实际值参数中也无法推断出类型时，这个默认类型就会起作用。\n\n```typescript\nconst calcArray = <T = string,>(data:T):T[] => {\n    let list:T[] = []\n    for(let i = 0; i < 3; i++){\n        list.push(data)\n    }\n    return list\n}\n```\n### 泛型常用字母\n\n用常用的字母来表示一些变量的代表：\n\n- **T**：代表 **Type**，定义泛型时通常用作第一个类型变量名称\n- **K**：代表 **Key**，表示对象中的**键类型**；\n- **V**：代表 **Value**，表示对象中的**值类型**；\n- **E**：代表 **Element**，表示的**元素类型**；\n\n\n\n\n\n## 常用技巧\n\n在 TS 中有许多关键字和工具类型，在使用上，需要注意**泛型**上的应用，有的时候结合起来可能就有一定的问题。\n\n在此特别需要注意 `extends`、`typeof`、`Partial`、`Record`、`Exclude`、`Omit`这几个工具类型。\n\n### extends\n\nextends：检验是否拥有其属性 在这里，举个例子，我们知道字符串和数组拥有length属性，但number没有这个属性。\n\n```typescript\nconst calcArray = <T,>(data:T): number => {\n  return data.length // error \n}\n```\n上述的 calcArray的作用只是获取data的数量,但此时在TS中会报错，这是因为TS不确定传来的属性是否具备length这个属性，毕竟每个属性都不可能完全相同。\n\n那么这时该怎么解决呢？\n\n我们已经确定，要拿到传过来数据的 length，也就是说传过来的属性必须具备length这个属性，如果没有，则不让他调用这个方法。\n\n换句话说，calcArray需要具备检验属性的功能，对于上述例子就是检验是否有length的功能，这是我们就需要extends这个属性帮我们去鉴定：\n\n```typescript\ninterface Props {\n    length: number\n}\n\nconst calcArray = <T extends Props,>(data:T): number => {\n  return data.length\n}\n\ncalcArray('12') // ok\ncalcArray([1,3]) //ok\ncalcArray(2) //error \n```\n可以看出 calcArray(2) 会报错，这是因为number类型并不具备length这个属性\n\n### typeof\n\ntypeof关键字：我们在类型保护的时候讲解了typeof的作用，除此之外，这个关键字还可以实现推出类型，如下图，可以推断中 Props 包含的类型。\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c01f7f01bc449d78530bc5e38ee2a5a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n### keyof\n\nkeyof关键字: 可以获取一个对象接口的所有key值,可以检查对象上的键是否存在：\n\n```typescript\ninterface Props {\n    name: string;\n    age: number;\n    sex: boolean\n}\n\ntype PropsKey = keyof Props; //包含 name， age， sex\n\nconst res:PropsKey = 'name' // ok\nconst res1:PropsKey = 'tel' // error\n\n// 泛型中的应用\nconst getInfo = <T, K extends keyof T>(data: T, key: K): T[K] => {\n    return data[key]\n}\n\nconst info = {\n    name: '小杜杜',\n    age: 7,\n    sex: true\n}\n\ngetInfo(info, 'name'); //ok\ngetInfo(info, 'tel'); //error\n```\n### 索引访问操作符\n\n索引访问操作符：通过 `[]` 操作符可进行索引访问,可以访问其中一个属性\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39784ee772554968b70a7274924e2f11~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n### in\n\nin：映射类型, 用来映射遍历枚举类型\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/717b932d27054e7bba535c606b5910a9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n### infer\n\ninfer：可以是使用为条件语句，可以用 infer 声明一个类型变量并且对它进行使用。如\n\n```typescript\ntype Info<T> = T extends { a: infer U; b: infer U } ? U : never;\n\ntype Props = Info<{ a: string; b: number }>; // Props类： string | number\n\ntype Props1 = Info<number> // Props类型： never\n```\n### Partial\n\nPartial语法：`Partial<T>` 作用：将所有属性变为可选的 `?`\n\n```typescript\ninterface Props {\n    name: string,\n    age: number\n}\n\nconst info: Props = {\n    name: '小杜杜',\n    age: 7\n}\n\nconst info1: Partial<Props> = { \n    name: '小杜杜'\n}\n```\n从上述代码上来看，name 和 age 属于必填，对于 info 来说必须要设置 name 和 age 属性才行，但对于 info1来说，只要是个对象就可以，至于是否有name、 age属性并不重要。\n\n### Required\n\nRequired语法：`Required<T>` 作用：将所有属性变为必选的，与 Partial相反\n\n```typescript\ninterface Props {\n    name: string,\n    age: number,\n    sex?: boolean\n}\n\nconst info: Props = {\n    name: '小杜杜',\n    age: 7\n}\n\nconst info1: Required<Props> = { \n    name: '小杜杜',\n    age: 7,\n    sex: true\n}\n```\n### Readonly\n\nReadonly语法：`Readonly<T>` 作用：将所有属性都加上 readonly 修饰符来实现。也就是说无法修改\n\n```typescript\ninterface Props {\n    name: string\n    age: number\n}\n\nlet info: Readonly<Props> = {\n    name: '小杜杜',\n    age: 7\n}\n\ninfo.age = 1 //error read-only 只读属性\n```\n### Record\n\nRecord语法：`Record<K extends keyof any, T>`\n\n作用：将 `K` 中所有的属性的值转化为 `T` 类型。\n\n```typescript\ninterface Props {\n    name: string,\n    age: number\n}\n\ntype InfoProps = 'JS' | 'TS'\n\nconst Info: Record<InfoProps, Props> = {\n    JS: {\n        name: '小杜杜',\n        age: 7\n    },\n    TS: {\n        name: 'TypeScript',\n        age: 11\n    }\n}\n```\n从上述代码上来看, InfoProps的属性分别包含Props的属性。\n\n需要注意的一点是：K extends keyof any其类型可以是:string、number、symbol。\n\n### Pick\n\nPick语法：`Pick<T, K extends keyof T>`\n\n作用：将某个类型中的子属性挑出来，变成包含这个类型部分属性的子类型。\n\n```typescript\ninterface Props {\n    name: string,\n    age: number,\n    sex: boolean\n}\n\ntype nameProps = Pick<Props, 'name' | 'age'>\n\nconst info: nameProps = {\n    name: '小杜杜',\n    age: 7\n}\n```\n从上述代码上来看, Props原本属性包括name、age、sex三个属性，通过 Pick我们吧name和age挑了出来，所以不需要sex属性。\n\n### Exclude\n\nExclude语法：`Exclude<T, U>`\n\n作用：将T类型中的U类型剔除。\n\n```typescript\n// 数字类型\ntype numProps = Exclude<1 | 2 | 3, 1 | 2> // 3\ntype numProps1 = Exclude<1, 1 | 2> // nerver\ntype numProps2 = Exclude<1, 1> // nerver\ntype numProps3 = Exclude<1 | 2, 7> // 1 2\n\n// 字符串类型\ntype info = \"name\" | \"age\" | \"sex\"\ntype info1 = \"name\" | \"age\" \ntype infoProps = Exclude<info, info1> //  \"sex\"\n\n// 类型\ntype typeProps = Exclude<string | number | (() => void), Function> // string | number\n\n// 对象\ntype obj = { name: 1, sex: true }\ntype obj1 = { name: 1 }\ntype objProps = Exclude<obj, obj1> // nerver\n```\n从上述代码上来看,我们比较了下类型上的，当 T 中有 U 就会剔除对应的属性，如果 U 中又的属性 T 中没有，或 T 和 U 刚好一样的情况都会返回 **nerver**，且对象永远返回`nerver`。\n\n### Extra\n\nExtra语法：`Extra<T, U>`\n\n作用：将 T 可分配给的类型中提取 U。与 **Exclude**相反\n\n```typescript\ntype numProps = Extract<1 | 2 | 3, 1 | 2> // 1 | 2\n```\n\n### Omit\n\nOmit语法：`Omit<T, U>`\n\n作用：将已经声明的类型进行属性剔除获得新类型\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7afb178ecc2b4427b82b7a5ebe3ab035~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n与 Exclude的区别：Omit 返回的是新的类型，原理上是在 Exclude之上进行的，Exclude是根据自类型返回的。\n\n### NonNullable\n\nNonNullable语法：`NonNullable<T>` 作用：从 T 中排除 null 和 undefined\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/825ae5b2e0704d4aba9b143fdf6c6835~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n### ReturnType\n\nReturnType语法：`ReturnType<T>`\n\n作用：用于获取 **函数T的返回类型。**\n\n```typescript\ntype Props = ReturnType<() => string> // string\ntype Props1 = ReturnType<<T extends U, U extends number>() => T>; // number\ntype Props2 = ReturnType<any>; // any\ntype Props3 = ReturnType<never>; // any\n```\n从上述代码上来看， ReturnType可以接受 any 和 never 类型，原因是这两个类型属于顶级类型，包含函数。\n\n### Parameters\n\nParameters：`Parameters<T>` \n\n作用：用于获取 获取函数类型的参数类型\n\n```typescript\ntype Props = Parameters<() => string> // []\ntype Props1 = Parameters<(data: string) => void> // [string]\ntype Props2 = Parameters<any>; // unknown[]\ntype Props3 = Parameters<never>; // never\n```\n\n\n\n\n## 拓展\n\n+ [TypeScript 4.0 文档](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-0.html)\n+ [深入理解 TypeScript ](https://jkchao.github.io/typescript-book-chinese/project/namespaces.html)\n+ [一份不可多得的 TS 学习指南（1.8W字）](https://juejin.cn/post/6872111128135073806)\n\n","source":"_posts/ts000.md","raw":"---\ntitle: 快速掌握 TypeScript 基础\ndate: 2022-06-07 22:21:38\ntags: TypeScript\ncategories: JavaScript\ndescription: TS 是 TypeScript 的简称，是一种由微软开发的自由和开源的编程语言。对比于JS，TS是JS的超集，简单的说就是在 JavaScript 的基础上加入了类型系统，让每个参数都有明确的意义，从而带来了更加智能的提示。\n---\n\n\n## TS 是什么 ？\n\n**TS**：是 **TypeScript** 的简称，是一种由微软开发的自由和开源的编程语言。\n\n**TS和JS的关系**\n\n对比于JS，TS是JS的 **超集**，简单的说就是在 JavaScript 的基础上加入了 **类型系统**，让每个参数都有明确的意义，从而带来了更加 **智能** 的提示。\n\n相对于JS而言，TS属于 **强类型** 语言，所以对于项目而言，会使代码更加规范，从而解决了大型项目代码的复杂性，其次，浏览器是不识别TS的，所以在编译的时候，TS文件会先编译为JS文件。\n\n**安装TS**\n\n执行命令：\n\n```bash\nnpm install -g typescript \n// 或\nyarn global add typescript\n```\n\n**查看版本**\n\n```bash\ntsc -v\n```\n\n**编译**\n\n```bash\ntsc test.ts\n# test.ts => test.js\n```\n\n**在线编译**\n\n我们为了方便起见，可以使用线上的编辑器：[TypeScript Playground](https://www.typescriptlang.org/zh/play)\n\n并且你还可以看看生成对应的`ts`转化`ES5`，`ES6`之后的代码，也有相关的例子供你查看\n\n\n\n## TS数据类型\n\n这里将TS的数据类型简单的进行下归类：\n\n+ 基本类型：string、number、boolean、symbol、bigint、null、undefined\n+ 引用类型：array、 Tuple(元组)、 object(包含Object和{})、function\n+ 特殊类型：any、unknow、void、never、Enum(枚举)\n+ 其他类型：类型推理、字面量类型、交叉类型\n\n注：案例中有可能用到type和interface，在下面会详细讲解，有比较模糊的可以先看看\n\n### 基本类型\n\n```typescript\n//字符串\nlet str: string = \"Domesy\"\n\n// 数字\nlet num: number = 7\n\n//布尔\nlet bool: boolean = true\n\n//symbol\nlet sym: symbol = Symbol();\n\n//bigint\nlet big: bigint = 10n\n\n//null\nlet nu: null = null\n\n//undefined\nlet un: undefined = undefined\n\n```\n\n需要注意：\n\n+ null 和 undefined 两个类型一旦赋值上，就不能在赋值给任何其他类型\n+ symbol是独一无二的，假设再定义一个 sym1，那么 `sym === sym1` 为 false\n\n### 引用类型\n\n#### Array\n\n两种方式：\n\n- 类型名称 + []\n- Array<数据类型>\n\n```typescript\nlet arr1: number[] = [1, 2, 3]\n\nlet arr2: Array<number> = [1, 2, 3]\n\nlet arr2: Array<number> = [1, 2, '3'] // error\n\n//要想是数字类型或字符串类型，需要使用 ｜\nlet arr3: Array<number | string> = [1, 2, '3'] //ok\n```\n\n#### Tuple(元组)\n\nTuple 可以说是 Array 的一种特殊情况,针对上面的 arr3,我们看他的类型可以是string也可以是number，但对每个元素没有作出具体的限制。\n\n那么 Tuple 的作用就是限制元素的类型并且限制个数的数组,同时 Tuple这个概念值存在于TS，在JS上是不存在的\n这里存在一个问题：在TS中,是允许对 Tuple 扩增的（也就是允许使用 push方法），但在访问上不允许\n\n```typescript\nlet t: [number, string] = [1, '2'] // ok\nlet t1: [number, string] = [1, 3] // error\nlet t2: [number, string] = [1] // error\nlet t3: [number, string] = [1, '1', true] // error\n\nlet t5: [number, string] = [1, '2'] // ok\nt.push(2)\nconsole.log(t) // [1, '2', 2]\n\nlet a =  t[0] // ok\nlet b = t[1] // ok\nlet c = t[2] // error\n```\n\n#### object\n\n`object` 非原始类型，在定义上直接使用 object 是可以的，但你要更改对象的属性就会报错，原因是并没有使对象的内部具体的属性做限制，所以需要使用 **{}** 来定义内部类型\n\n```typescript\nlet obj1: object = { a: 1, b: 2}\nobj1.a = 3 // error\n\nlet obj2: { a: number, b: number } = {a: 1, b: 2}\nobj2.a = 3 // ok\n```\n`Object`(大写的O）,代表所有的原始类型或非原始类型都可以进行赋值,除了`null`和`undefined`\n\n```typescript\nlet obj: Object;\nobj = 1; // ok\nobj = \"a\"; // ok\nobj = true; // ok\nobj = {}; // ok\nobj = Symbol() //ok\nobj = 10n //ok\nobj = null; // error\nobj = undefined; // error\n```\n#### function\n\n**定义函数**\n\n- 有两种方式，一种为 `function`， 另一种为`箭头函数`\n- 在书写的时候，也可以写入返回值的类型，如果写入，则必须要有对应类型的返回值，**但通常情况下是省略**，因为`TS`的类型推断功能够正确推断出返回值类型\n\n```typescript\nfunction setName1(name: string) { //ok\n  console.log(\"hello\", name);\n}\nsetName1(\"Domesy\"); // \"hello\",  \"Domesy\"\n\nfunction setName2(name: string):string { //error\n  console.log(\"hello\", name);\n}\nsetName2(\"Domesy\");\n\nfunction setName3(name: string):string { //error\n  console.log(\"hello\", name);\n  return 1\n}\nsetName3(\"Domesy\");\n\nfunction setName4(name: string): string { //ok\n  console.log(\"hello\", name);\n  return name\n}\nsetName4(\"Domesy\"); // \"hello\",  \"Domesy\"\n\n//箭头函数与上述同理\nconst setName5 = (name:string) => console.log(\"hello\", name);\nsetName5(\"Domesy\") // \"hello\",  \"Domesy\"\n```\n**参数类型**\n\n- 可选参数： 如果函数要配置可有可无的参数时，可以通过 **?** 实现，切可选参数一定要在最后面\n- 默认参数：函数内可以自己设定其默认参数，用 **=** 实现\n- 剩余参数：仍可以使用扩展运算符 **...**\n\n```typescript\n// 可选参数\nconst setInfo1 = (name: string, age?: number) => console.log(name, age)\nsetInfo1('Domesy') //\"Domesy\",  undefined\nsetInfo1('Domesy', 7) //\"Domesy\",  7\n\n// 默认参数\nconst setInfo2 = (name: string, age: number = 11) => console.log(name, age)\nsetInfo2('Domesy') //\"Domesy\",  11\nsetInfo2('Domesy', 7) //\"Domesy\",  7\n\n// 剩余参数\nconst allCount = (...numbers: number[]) => console.log(`数字总和为：${numbers.reduce((val, item) => (val += item), 0)}`)\nallCount(1, 2, 3) //\"数字总和为：6\"\n```\n**函数重载**\n\n**函数重载**：是使用相同名称和不同参数数量或类型创建多个方法的一种能力。 在 TypeScript 中，表现为给同一个函数提供多个函数类型定义。 简单的说：**可以在同一个函数下定义多种类型值，最后汇总到一块**\n\n```typescript\nlet obj: any = {};\nfunction setInfo(val: string): void;\nfunction setInfo(val: number): void;\nfunction setInfo(val: boolean): void;\nfunction setInfo(val: string | number | boolean): void {\n  if (typeof val === \"string\") {\n    obj.name = val;\n  } else {\n    obj.age = val;\n  }\n}\nsetInfo(\"Domesy\");\nsetInfo(7);\nsetInfo(true);\nconsole.log(obj); // { name: 'Domesy', age: 7 }\n```\n\n\n\n### 特殊类型\n\n#### any\n\n在 TS 中，任何类型都可以归于 `any` 类型，所以`any`类型也就成了所有类型的**顶级类型**，同时，**如果不指定变量的类型，则默认为any类型**, 当然不推荐使用该类型，因为这样丧失了TS的作用。\n\n```typescript\nlet d:any; //等价于 let d \nd = '1';\nd = 2;\nd = true;\nd = [1, 2, 3];\nd = {}\n```\n#### unknow\n\n与any一样，都可以作为所有类型的**顶级类型**，但 unknow更加**严格**，那么可以说除了any 之下的第二大类型，接下来对比下any，主要严格于一下两点：\n\n+ unknow会对值进行检测，而类型any不会做检测操作，说白了，any类型可以赋值给任何类型，但unknow只能赋值给unknow类型和any类型\n+ unknow不允许定义的值有任何操作（如 方法，new等），但any可以\n\n```typescript\nlet u:unknown;\nlet a: any;\n\nu = '1'; //ok\nu = 2; //ok\nu = true; //ok\nu = [1, 2, 3]; //ok\nu = {}; //ok\n\nlet value:any = u //ok\nlet value1:any = a //ok\nlet value2:unknown = u //ok\nlet value3:unknown = a //ok\nlet value4:string = u //error\nlet value5:string = a //ok\nlet value6:number = u //error\nlet value7:number = a //ok\nlet value8:boolean = u //error\nlet value9:boolean = a //ok\n\nu.set() // error\na.set() //ok\nu() // error\na() //ok\nnew u() // error\nnew a() //ok\n```\n#### void\n\n当一个函数，没有返回值时，TS会默认他的返回值为  `void`  类型\n\n```typescript\nconst setInfo = ():void => {} // 等价于 const setInfo = () => {}\n\nconst setInfo1 = ():void => { return '1' }  // error\nconst setInfo2 = ():void => { return 2 } // error\nconst setInfo3 = ():void => { return true } // error\nconst setInfo4 = ():void => { return  } // ok\nconst setInfo5 = ():void => { return undefined } //ok \n```\n#### never\n\n表示一个函数永远不存在返回值，TS会认为类型为 never，那么与 void 相比, never应该是 void子集， 因为 void实际上的返回值为 undefined，而 never 连 undefined也不行\n\n符合never的情况有：当抛出异常的情况和无限死循环\n\n```typescript\nlet error = ():never => { // 等价约 let error = () => {}\n        throw new Error(\"error\");\n};\n\nlet error1 = ():never => {\n    while(true){}\n}\n```\n#### Enum(枚举)\n\n可以定义一些带名字的常量，这样可以 **清晰表达意图** 或 **创建一组有区别的用例**\n\n注意：\n\n- 枚举的类型只能是 `string` 或 `number`\n- 定义的名称不能为 **关键字**\n\n同时我们可以看看翻译为ES5是何样子\n\n#### 数字枚举\n\n- 枚组的类型默认为**数字类型**，默认从0开始以此累加，如果有设置默认值，则**只会对下面的值产生影响**\n- 同时支持**反向映射**（及从成员值到成员名的映射），但智能映射无默认值的情况，并且只能是默认值的前面\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7559b8e5b7b94f8fbafc95fd37eeffbd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n#### 字符串枚举\n\n字符串枚举要注意的是必须要有**默认值**，不支持**反向映射**\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0df3876ecc6a474085e468cbd3f1929f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n#### 常量枚举\n\n除了数字类型和字符串类型之外，还有一种特殊的类型，那就是常量枚举，也就是通过const去定义enum，但这种类型不会编译成任何 JS,只会编译对应的值\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/160ac2e75cab457d99093ce48c34756a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n#### 异构枚举\n\n包含了 `数字类型` 和 `字符串类型` 的混合，反向映射一样的道理\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d5f1433ab2c48bebc65ca5f8ace0da4~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n### 类型推论\n\n我们在学完这些基础类型，我们是不是每个类型都要去写字段是什么类型呢？其实不是，在TS中如果不设置类型，并且不进行赋值时，将会推论为any类型，如果进行赋值就会默认为类型\n\n```typescript\nlet a; // 推断为any\nlet str = '小杜杜'; // 推断为string\nlet num = 13; // 推断为number\nlet flag = false; // 推断为boolean\n\nstr = true // error Type 'boolean' is not assignable to type 'string'.(2322)\nnum = 'Domesy' // error\nflag = 7 // error\n```\n### 字面量类型\n\n字面量类型：在TS中，我们可以指定参数的类型是什么，目前支持字符串、数字、布尔三种类型。比如说我定义了 str 的类型是 '小杜杜'， 那么str的值只能是小杜杜\n\n```typescript\nlet str:'小杜杜' \nlet num: 1 | 2 | 3 = 1\nlet flag:true\n\nstr = '小杜杜' //ok\nstr = 'Donmesy' // error\n\nnum = 2 //ok\nnum = 7 // error\n\nflag = true // ok\nflag = false // error\n```\n### 交叉类型（&）\n\n交叉类型：将多个类型合并为一个类型，使用&符号连接，如：\n\n```typescript\ntype AProps = { a: string }\ntype BProps = { b: number }\n\ntype allProps = AProps & BProps\n\nconst Info: allProps = {\n    a: '小杜杜',\n    b: 7\n}\n```\n#### 同名基础属性合并\n\n我们可以看到交叉类型是结合两个属性的属性值，那么我们现在有个问题，要是两个属性都有相同的属性值，那么此时总的类型会怎么样，先看看下面的案列：\n\n```typescript\ntype AProps = { a: string, c: number }\ntype BProps = { b: number, c: string }\n\ntype allProps = AProps & BProps\n\nconst Info: allProps = {\n    a: '小杜杜',\n    b: 7,\n    c:  1, // error (property) c: never\n    c:  'Domesy', // error (property) c: never\n}\n```\n如果是相同的类型，合并后的类型也是此类型，那如果是不同的类型会如何：\n\n我们在Aprops和BProps中同时加入c属性，并且c属性的类型不同，一个是number类型，另一个是string类型\n现在结合为 allProps 后呢? 是不是c属性是 number 或 string 类型都可以，还是其中的一种？\n\n然而在实际中， c 传入数字类型和字符串类型都不行，我么看到报错，现实的是 c的类型是 never。\n\n这是因为对应 c属性而言是 string & number，然而这种属性明显是不存在的，所以c的属性是never\n\n#### 同名非基础属性合并\n\n```typescript\ninterface A { a: number }\ninterface B { b: string }\n\ninterface C {\n    x: A\n}\ninterface D {\n    x: B\n}\ntype allProps = C & D\n\nconst Info: allProps = {\n  x: {\n    a: 7,\n    b: '小杜杜'\n  }\n}\n\nconsole.log(Info) // { x: { \"a\": 7, \"b\": \"小杜杜\" }}\n```\n我们来看看案例，对于混入多个类型时，若存在相同的成员，且成员类型为非基本数据类型，那么是可以成功合。\n\n如果 接口A 中的 也是 b，类型为number，就会跟**同名基础属性合并**一样\n\n\n\n## Class（类）\n\n在ES6中推出了一个叫 class（类） 的玩意，具体定义就不说了，相信用过React的小伙伴一定不陌生。\n\n### 基本方法\n\n在基本方法中有：静态属性，静态方法、成员属性、成员方法、构造器、get set方法，接下来逐个看看：\n\n需要注意的是： 在成员属性中，如果不给默认值,并且不使用是会报错的，如果不想报错就给如` !`，如：`name4!:string`\n\n```typescript\nclass Info {\n  //静态属性\n  static name1: string = 'Domesy'\n\n  //成员属性，实际上是通过public上进行修饰，只是省略了\n  nmae2:string = 'Hello' //ok \n  name3:string //error\n  name4!:string //ok 不设置默认值的时候必须加入 !\n\n  //构造方法\n  constructor(_name:string){\n    this.name4 = _name\n  }\n\n  //静态方法\n  static getName = () => {\n    return '我是静态方法'\n  }\n\n  //成员方法\n  getName4 = () => {\n    return `我是成员方法:${this.name4}`\n  }\n\n  //get 方法\n  get name5(){\n    return this.name4\n  }\n\n  //set 方法\n  set name5(name5){\n    this.name4 = name5\n  }\n}\n\nconst setName = new Info('你好')\nconsole.log(Info.name1) //  \"Domesy\" \nconsole.log(Info.getName()) // \"我是静态方法\" \nconsole.log(setName.getName4()) // \"我是成员方法:你好\" \n```\n让我们看看上述代码翻译成ES5是什么样：\n\n```js\n\"use strict\";\nvar Info = /** @class */ (function () {\n    //构造方法\n    function Info(_name) {\n        var _this = this;\n        //成员属性\n        this.nmae2 = 'Hello'; //ok\n        //成员方法\n        this.getName4 = function () {\n            return \"\\u6211\\u662F\\u6210\\u5458\\u65B9\\u6CD5:\".concat(_this.name4);\n        };\n        this.name4 = _name;\n    }\n    Object.defineProperty(Info.prototype, \"name5\", {\n        //get 方法\n        get: function () {\n            return this.name4;\n        },\n        //set 方法\n        set: function (name5) {\n            this.name4 = name5;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    //静态属性\n    Info.name1 = 'Domesy';\n    //静态方法\n    Info.getName = function () {\n        return '我是静态方法';\n    };\n    return Info;\n}());\nvar setName = new Info('你好');\nconsole.log(Info.name1); //  \"Domesy\" \nconsole.log(Info.getName()); // \"我是静态方法\" \nconsole.log(setName.getName4()); // \"我是成员方法:你好\" \n```\n### 私有字段(#)\n\n在 TS 3.8版本便开始支持 ECMACMAScript 的私有字段。\n\n需要注意的是私有字段与常规字段不同，主要的区别是：\n\n- 私有字段以 `#` 字符开头，也叫私有名称；\n- 每个私有字段名称都**唯一**地限定于其包含的类；\n- 不能在私有字段上使用 TypeScript 可访问性修饰符（如 public 或 private）；\n- 私有字段不能在包含的类之外访问，甚至不能被检测到。\n\n```typescript\nclass Info {\n  #name: string; //私有字段\n  getName: string;\n\n  constructor(name: string) {\n    this.#name = name;\n    this.getName = name\n  }\n\n  setName() {\n    return `我的名字是${this.#name}`\n  }\n}\n\nlet myName = new Info(\"Domesy\");\n\nconsole.log(myName.setName()) // \"我的名字是Domesy\" \nconsole.log(myName.getName) // ok \"Domesy\" \nconsole.log(myName.#name) // error \n// Property '#name' is not accessible outside class 'Info' \n// because it has a private identifier.(18013)\n```\n\n### 只读属性（readonly）\n\n只读属性：用 readonly修饰，只能在构造函数中初始化，并且在TS中，只允许将interface、type、class上的属性标识为readonly\n\n- `readonly`实际上只是在 `编译阶段` 进行代码检查\n- 被`radonly`修饰的词只能在 `constructor` 阶段修改，其他时刻不允许修改\n\n```typescript\nclass Info {\n  public readonly name: string; // 只读属性\n  name1:string\n\n  constructor(name: string) {\n    this.name = name;\n    this.name1 = name;\n  }\n\n  setName(name:string) {\n    this.name = name // error\n    this.name1 = name; // ok\n  }\n}\n```\n### 继承（extends）\n\n继承：是个比较重要的点，指的是子可以继承父的思想，也就是说 子类 通过继承父类后，就拥有了父类的属性和方法，这点与HOC有点类似。\n\n这里有个`super`字段，给不知道的小伙伴说说，其作用是**调用父类上的属性和方法**\n\n```typescript\n// 父类\nclass Person {\n  name: string\n  age: number\n\n  constructor(name: string, age:number){\n    this.name = name\n    this.age = age\n  }\n\n  getName(){\n    console.log(`我的姓名是：${this.name}`)\n    return this.name\n  }\n\n  setName(name: string){\n    console.log(`设置姓名为：${name}`)\n    this.name = name\n  }\n}\n\n// 子类\nclass Child extends Person {\n  tel: number\n  constructor(name: string, age: number, tel:number){\n    super(name, age)\n    this.tel = tel\n  }\n\n  getTel(){\n    console.log(`电话号码是${this.tel}`)\n    return this.tel\n  }\n}\n\nlet res = new Child(\"Domesy\", 7 , 123456)\nconsole.log(res) // Child {.\"name\": \"Domesy\", \"age\": 7, \"no\": 1 }\nconsole.log(res.age) // 7\nres.setName('小杜杜') // \"设置姓名为：小杜杜\" \nres.getName() //   \"我的姓名是：小杜杜\"\nres.getTel() //  \"电话号码是123456\" \n```\n### 修饰符\n\n主要有三种修饰符：\n\n- **public**：类中、子类内的任何地方、外部**都能调用**\n- **protected**：类中、子类内的任何地方都能调用,但**外部不能调用**\n- **private**：类中可以调用，子类内的任何地方、外部**均不可调用**\n\n```typescript\nclass Person {\n  public name: string\n  protected age: number\n  private tel: number\n\n  constructor(name: string, age:number, tel: number){\n    this.name = name\n    this.age = age\n    this.tel = tel\n  }\n}\n\nclass Child extends Person {\n  constructor(name: string, age: number, tel: number) {\n    super(name, age, tel);\n  }\n\n  getName(){\n    console.log(`我的名字叫${this.name},年龄是${this.age}`) // ok name 和 age可以\n    console.log(`电话是${this.tel}`) // error 报错 原因是 tel 拿不出来\n  }\n}\n\nconst res = new Child('Domesy', 7, 123456)\nconsole.log(res.name) // ok Domesy\nconsole.log(res.age) // error\nconsole.log(res.tel) // error\n```\n\n### abstract\n\nabstract: 用abstract关键字声明的类叫做**抽象类**，声明的方法叫做**抽象方法**。\n\n- **抽象类**：指不能被实例化，因为它里面包含一个或多个抽象方法。\n- **抽象方法**：是指不包含具体实现的方法；\n\n注：抽象类是不能直接实例化，只能实例化实现了所有抽象方法的子类\n\n```typescript\nabstract class Person {\n  constructor(public name: string){}\n\n  // 抽象方法\n  abstract setAge(age: number) :void;\n}\n\nclass Child extends Person {\n  constructor(name: string) {\n    super(name);\n  }\n\n  setAge(age: number): void {\n    console.log(`我的名字是${this.name},年龄是${age}`);\n  }\n}\n\nlet res = new Person(\"小杜杜\") //error\nlet res1 = new Child(\"小杜杜\");\n\nres1.setAge(7) // \"我的名字是小杜杜,年龄是7\"\n```\n### 重写和重载\n\n- **重写**：子类重写继承自父类中的方法\n- **重载**：指为同一个函数提供多个类型定义，与上述函数的重载类似\n\n```typescript\n// 重写\nclass Person{\n  setName(name: string){\n    return `我的名字叫${name}`\n  }\n}\n\nclass Child extends Person{\n  setName(name: string){\n    return `你的名字叫${name}`\n  }\n}\n\nconst yourName = new Child()\nconsole.log(yourName.setName('小杜杜')) // \"你的名字叫小杜杜\" \n\n// 重载\nclass Person1{\n  setNameAge(name: string):void;\n  setNameAge(name: number):void;\n  setNameAge(name:string | number){\n    if(typeof name === 'string'){\n      console.log(`我的名字是${name}`)\n    }else{\n      console.log(`我的年龄是${name}`)\n    }\n  };\n}\n\nconst res = new Person1()\nres.setNameAge('小杜杜') // \"我的名字是小杜杜\" \nres.setNameAge(7) // \"我的年龄是7\"\n```\n\n\n\n\n## TS断言和类型守卫\n\n### TS断言\n\n分为三种：`类型断言`、`非空断言`、`确定赋值断言`\n\n当断言失效后，可能使用到：**双重断言**\n\n#### 类型断言\n\n在特定的环境中，我们会比TS知道这个值具体是什么类型，不需要TS去判断，简单的理解就是，**类型断言会告诉编译器，你不用给我进行检查，相信我，他就是这个类型**\n\n共有两种方式：\n\n- **尖括号**\n- **as**：推荐\n\n```typescript\n//尖括号\nlet num:any = '小杜杜'\nlet res1: number = (<string>num).length; // React中会 error\n\n// as 语法\nlet str: any = 'Domesy';\nlet res: number = (str as string).length;\n```\n\n但需要注意的是：尖括号语法在React中会报错，原因是与JSX语法会产生冲突，所以只能使用as语法。\n\n#### 非空断言\n\n在上下文中当类型检查器无法断定类型时，一个新的后缀表达式操作符 `!` 可以用于断言操作对象是**非 null 和非 undefined 类型。**\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fa80b9ac2a54614a129c5724678254a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n我们可以看出来 !可以帮助我们过滤 null和 undefined类型，也就是说，编译器会默认我们只会传来string类型的数据，所以可以赋值为str1。\n\n但变成ES5后 !会被移除，所以当传入 null 的时候，还是会打出 null。\n\n#### 确定赋值断言\n\n在TS 2.7版本中引入了确定赋值断言，即允许在实例属性和变量声明后面放置一个 ! 号，以告诉TS该属性会被明确赋值。\n\n```typescript\nlet num: number;\nlet num1!: number;\n\nconst setNumber = () => num = 7\nconst setNumber1 = () => num1 = 7\n\nsetNumber()\nsetNumber1()\n\nconsole.log(num) // error \nconsole.log(num1) // ok\n```\n#### 双重断言\n\n断言失效后，可能会用到，但一般情况下不会使用。\n\n失效的情况：基础类型不能断言为接口。\n\n```typescript\ninterface Info{\n  name: string;\n  age: number;\n}\n\nconst name = '小杜杜' as Info; // error, 原因是不能把 string 类型断言为 一个接口\nconst name1 = '小杜杜' as any as Info; //ok\n```\n\n\n### 类型守卫\n\n**类型守卫**：是**可执行运行时检查的**一种表达式，用于确保**该类型在一定的范围内**。\n\n个人的感觉是，类型守卫就是你可以设置多种类型，但我默认你是什么类型的意思\n\n目前，常有的类型守卫共有4种：**in关键字**、**typeof关键字**、**instanceof**和**类型谓词（is)**\n\n#### in关键字\n\n用于判断这个属性是哪个里面的\n\n```typescript\ninterface Info {\n  name: string\n  age: number\n}\n\ninterface Info1{\n  name: string\n  flage: true\n}\n\nconst setInfo = (data: Info | Info1) => {\n  if(\"age\" in data){\n    console.log(`我的名字是：${data.name}，年龄是：${data.age}`)\n  }\n\n   if(\"flage\" in data){\n    console.log(`我的名字是：${data.name}，性别是：${data.flage}`)\n  }\n}\n\nsetInfo({name: '小杜杜', age: 7}) // \"我的名字是：小杜杜，年龄是：7\" \nsetInfo({name: '小杜杜', flage: true}) // \"我的名字是：小杜杜，性别是：true\"\n```\n#### typeof关键字\n\n用于判断基本类型，如string ｜ number等。\n\n```typescript\nconst setInfo = (data: number | string | undefined) => {\n  if(typeof data === \"string\"){\n    console.log(`我的名字是：${data}`)\n  }\n\n  if(typeof data === \"number\"){\n    console.log(`我的年龄是：${data}`)\n  }\n\n  if(typeof data === \"undefined\"){\n    console.log(data)\n  }\n}\n\nsetInfo('小杜杜') // \"我的名字是：小杜杜\"  \nsetInfo(7) // \"我的年龄是：7\" \nsetInfo(undefined) // undefined\" \n```\n#### instanceof关键字\n\n用于判断一个实例是不是构造函数，或使用类的时候\n\n```typescript\nclass Name {\n  name: string = '小杜杜'\n}\n\nclass Age extends Name{\n  age: number = 7\n}\n\nconst setInfo = (data: Name) => {\n  if (data instanceof Age) {\n    console.log(`我的年龄是${data.age}`);\n  } else {\n    console.log(`我的名字是${data.name}`);\n  }\n} \n\nsetInfo(new Name()) // \"我的名字是小杜杜\"\nsetInfo(new Age()) // \"我的年龄是7\" \n```\n#### 类型谓词（is)\n\n```typescript\nfunction isNumber(x: any): x is number { //默认传入的是number类型\n  return typeof x === \"number\"; \n}\n\nconsole.log(isNumber(7)) // true\nconsole.log(isNumber('7')) //false\nconsole.log(isNumber(true)) //false\n```\n\n\n\n### 两者的区别\n\n通过上面的介绍，我们可以发现`断言`与`类型守卫`的概念非常相似，都是确定参数的类型，但`断言`更加**霸道**，它是直接告诉编辑器，这个参数就是这个类型，而类型守卫更像确定这个参数具体是什么类型。\n\n\n\n\n\n## 类型别名、接口\n\n### 类型别名（type）\n\n类型别名：也就是type，用来给一个类型起个新名字。\n\n```typescript\ntype InfoProps = string | number\n\nconst setInfo = (data: InfoProps) => {}\n```\n### 接口（interface）\n\n接口：在面向对象语言中表示行为抽象，也可以用来描述对象的形状。\n\n使用interface关键字来定义接口：\n\n#### 对象的形状\n\n接口可以用来描述对象，主要可以包括以下数据：可读属性、只读属性、任意属性\n\n+ **可读属性**：当我们定义一个接口时，我们的属性可能不需要全都要，这是就需要 **?** 来解决\n+ **只读属性**：用 **readonly**修饰的属性为只读属性，意思是指允许定义，不允许之后进行更改\n+ **任意属性**：这个属性极为重要，它是可以用作就算没有定义，也可以使用，比如 **[data: string]: any**。比如说我们对组件进行封装，而封装的那个组件并没有导出对应的类型，然而又想让他不报错，这时就可以使用任意属性\n\n```typescript\ninterface Props {\n    a: string;\n    b: number;\n    c: boolean;\n    d?: number; // 可选属性\n    readonly e: string; //只读属性\n    [f: string]: any //任意属性\n}\nlet res: Props = {\n    a: '小杜杜',\n    b: 7,\n    c: true,\n    e: 'Domesy',\n    d: 1, // 有没有d都可以\n    h: 2 // 任意属性，之前为定义过h\n}\n\nlet res.e = 'hi' // error, 原因是可读属性不允许更改\n```\n#### 继承\n\n继承：与类一样，接口也存在继承属性，也是使用 **extends** 字段\n\n```typescript\ninterface nameProps {\n    name: string\n}\n\ninterface Props extends nameProps{\n    age: number\n}\n\nconst res: Props = {\n    name: '小杜杜',\n    age: 7\n}\n```\n#### 函数类型接口\n\n同时，可以定义函数和类，**加new修饰的是类，不加new的是函数**\n\n```typescript\ninterface Props {\n    (data: number): number\n}\n\nconst info: Props = (number:number) => number  //可定义函数\n\n// 定义函数\nclass A {\n    name:string\n    constructor(name: string){\n        this.name = name\n    }\n}\n\ninterface PropsClass{\n    new (name: string): A\n}\n\nconst info1 = (fun: PropsClass, name: string) => new fun(name)\n\nconst res = info1(A, \"小杜杜\")\nconsole.log(res.name) // \"小杜杜\" \n```\n\n\n### type 和 interface 的区别\n\n类型别名和接口非常相似，可以说在大多数情况下，type与interface是等价的。\n\n但在一些特定的场景差距还是比较大的，接下来逐个来看看：\n\n#### 基础数据类型\n\n+ type 和 interface 都可以定义 对象 和 函数\n+ type 可以定义其他数据类型，如字符串、数字、元祖、联合类型等，而 interface不行\n\n```typescript\ntype A = string // 基本类型\n\ntype B = string | number // 联合类型\n\ntype C = [number, string] // 元祖\n\nconst dom = document.createElement(\"div\");  // dom元素\ntype D = typeof dom\n```\n#### 扩展\n\ninterface 可以扩展 type，type 也可以扩展为 interface，但两者实现扩展的方式不同。\n\n+ interface 是通过 **extends** 来实现\n+ type 是通过 **&** 来实现\n\n```typescript\n// interface 扩展 interface\ninterface A {\n    a: string\n}\ninterface B extends  A {\n    b: number\n}\nconst obj:B = { a: `小杜杜`, b: 7 }\n\n// type 扩展 type\ntype C = { a: string }\ntype D = C & { b: number }\nconst obj1:D = { a: `小杜杜`, b: 7 }\n\n// interface 扩展为 Type\ntype E = { a: string }\ninterface F extends E { b: number }\nconst obj2:F = { a: `小杜杜`, b: 7 }\n\n// type 扩展为 interface\ninterface G { a: string }\ntype H = G & {b: number}\nconst obj3:H = { a: `小杜杜`, b: 7 }\n```\n#### 重复定义\n\ninterface 可以多次被定义，并且会进行合并，但type不行\n\n```typescript\ninterface A {\n    a: string\n}\ninterface A {\n    b: number\n}\nconst obj:A = { a: `小杜杜`, b: 7 }\n\ntype B = { a: string }\ntype B = { b: number } // error\n```\n\n\n\n\n## 联合类型(Union Types)\n\n联合类型(Union Types): 表示取值可以为多种类型中的一种，未赋值时联合类型上只能访问两个类型共有的属性和方法，如：\n\n```typescript\nconst setInfo = (name: string | number) => {}\n\nsetInfo('小杜杜')\nsetInfo(7)\n```\n从上面看 setInfo接收一个name，而 name 可以接收 string或number类型，那么这个参数便是联合类型。\n\n### 可辨识联合\n\n可辨识联合：包含三个特点，分别是可辨识、联合类型、类型守卫,\n\n这种类型的本质是：结合**联合类型**和**字面量类型**的一种类型保护方法。\n\n如果一个类型是多个类型的联合类型，且多个类型含有一个公共属性，那么就可以利用这个公共属性，来创建不同的类型保护区块。\n\n也就是上面一起结合使用，这里写个小例子：\n\n```typescript\ninterface A {\n  type: 1,\n  name: string\n}\n\ninterface B {\n  type: 2\n  age: number\n}\n\ninterface C {\n  type: 3,\n  sex: boolean\n}\n\n// const setInfo = (data: A | B | C) => {\n//   return data.type // ok 原因是 A 、B、C 都有 type属性\n//   return data.age // error，  原因是没有判断具体是哪个类型，不能确定是A，还是B，或者是C\n// }\n\nconst setInfo1 = (data: A | B | C) => {\n  if (data.type === 1 ) {\n    console.log(`我的名字是${data.name}`);\n  } else if (data.type === 2 ){\n    console.log(`我的年龄是${data.age}`);\n  } else if (data.type === 3 ){\n    console.log(`我的性别是${data.sex}`);\n  }\n}\n\nsetInfo1({type: 1, name: '小杜杜'}) // \"我的名字是小杜杜\"\nsetInfo1({type: 2, age: 7}) // \"我的年龄是7\" \nsetInfo1({type: 3, sex: true}) // \"我的性别是true\" \n```\n定义了 A、B、C 三次接口，但这三个接口都包含type属性，那么type就是可辨识的属性,而其他属性只跟特性的接口相关。\n\n然后通过可辨识属性type，才能使用其相关的属性。\n\n\n\n\n\n## 泛型\n\n泛型：Generics，是指在定义函数、接口或类的时候，不预先指定具体的类型，而在使用的时候再指定类型的一种特性。\n\n也就是说，泛型是**允许同一个函数接受不同类型参数的一种模版**，与`any`相比，使用泛型来创建可服用的组件要更好，因为**泛型会保留参数类型**（PS：泛型是整个TS的重点，也是难点，请多多注意～）\n\n### 为什么需要泛型\n\n我们先看看一个例子：\n\n```typescript\nconst calcArray = (data:any):any[] => {\n    let list = []\n    for(let i = 0; i < 3; i++){\n        list.push(data)\n    }\n    return list\n}\n\nconsole.log(calcArray('d')) // [\"d\", \"d\", \"d\"]\n```\n上述的例子我们发现，在calcArray中传任何类型的参数，返回的数组都是any类型。\n\n由于我们不知道传入的数据是什么，所以返回的数据也为any的数组。\n\n但我们现在想要的效果是：**无论我们传什么类型，都能返回对应的类型**，针对这种情况怎么办？所以此时 `泛型` 就登场了。\n\n### 泛型语法\n\n我们先用泛型对上面的例子进行改造下，\n\n```typescript\nconst calcArray = <T,>(data:T):T[] => {\n    let list:T[] = []\n    for(let i = 0; i < 3; i++){\n        list.push(data)\n    }\n    return list\n}\n\nconst res:string[] = calcArray<string>('d') // ok\nconst res1:number[] = calcArray<number>(7) // ok\n\ntype Props = {\n    name: string,\n    age: number\n}\nconst res3: Props[] = calcArray<Props>({name: '小杜杜', age: 7}) //ok\n```\n经过上面的案例，我们发现传入的字符串、数字、对象，都能返回对应的类型，从而达到我们的目的，接下来我们再看看泛型语法：\n\n```typescript\nfunction identity <T>(value:T) : T {\n    return value\n}\n```\n第一次看到这个 `<T>` 我们是不是很懵，实际上这个T就是传递的类型,从上述的例子来看，这个 `<T>` 就是 `<string>` ，要注意一点，这个 `<string>` 实际上是可以省略的，因为 TS 具有类型推论，可以自己推断类型。\n\n### 多类型传参\n\n我们有多个未知的类型占位，我们可以定义任何的字母来表示不同的参数类型\n\n```typescript\nconst calcArray = <T,U>(name:T, age:U): {name:T, age:U} => {\n    const res: {name:T, age:U} = {name, age}\n    return res\n}\n\nconst res = calcArray<string, number>('小杜杜', 7)\nconsole.log(res) // {\"name\": \"小杜杜\", \"age\": 7}\n```\n### 泛型接口\n\n定义接口的时候，我们也可以使用泛型\n\n```typescript\ninterface A<T> {\n    data: T\n}\n\nconst Info: A<string> = {data: '1'}\nconsole.log(Info.data) // \"1\"\n```\n### 泛型类\n\n同样泛型也可以定义类\n\n```typescript\nclass clacArray<T>{\n    private arr: T[] = [];\n\n    add(value: T) {\n        this.arr.push(value)\n    }\n    getValue(): T {\n        let res = this.arr[0];\n        console.log(this.arr)\n        return res;\n    }\n}\n\nconst res = new clacArray()\n\nres.add(1)\nres.add(2)\nres.add(3)\n\nres.getValue() //[1, 2, 3] \nconsole.log(res.getValue) // 1\n```\n### 泛型类型别名\n\n```typescript\ntype Info<T> = {\n    name?: T\n    age?: T\n}\n\nconst res:Info<string> = { name: '小杜杜'}\nconst res1:Info<number> = { age: 7}\n```\n### 泛型默认参数\n\n所谓默认参数，是指定类型，如默认值一样，从实际值参数中也无法推断出类型时，这个默认类型就会起作用。\n\n```typescript\nconst calcArray = <T = string,>(data:T):T[] => {\n    let list:T[] = []\n    for(let i = 0; i < 3; i++){\n        list.push(data)\n    }\n    return list\n}\n```\n### 泛型常用字母\n\n用常用的字母来表示一些变量的代表：\n\n- **T**：代表 **Type**，定义泛型时通常用作第一个类型变量名称\n- **K**：代表 **Key**，表示对象中的**键类型**；\n- **V**：代表 **Value**，表示对象中的**值类型**；\n- **E**：代表 **Element**，表示的**元素类型**；\n\n\n\n\n\n## 常用技巧\n\n在 TS 中有许多关键字和工具类型，在使用上，需要注意**泛型**上的应用，有的时候结合起来可能就有一定的问题。\n\n在此特别需要注意 `extends`、`typeof`、`Partial`、`Record`、`Exclude`、`Omit`这几个工具类型。\n\n### extends\n\nextends：检验是否拥有其属性 在这里，举个例子，我们知道字符串和数组拥有length属性，但number没有这个属性。\n\n```typescript\nconst calcArray = <T,>(data:T): number => {\n  return data.length // error \n}\n```\n上述的 calcArray的作用只是获取data的数量,但此时在TS中会报错，这是因为TS不确定传来的属性是否具备length这个属性，毕竟每个属性都不可能完全相同。\n\n那么这时该怎么解决呢？\n\n我们已经确定，要拿到传过来数据的 length，也就是说传过来的属性必须具备length这个属性，如果没有，则不让他调用这个方法。\n\n换句话说，calcArray需要具备检验属性的功能，对于上述例子就是检验是否有length的功能，这是我们就需要extends这个属性帮我们去鉴定：\n\n```typescript\ninterface Props {\n    length: number\n}\n\nconst calcArray = <T extends Props,>(data:T): number => {\n  return data.length\n}\n\ncalcArray('12') // ok\ncalcArray([1,3]) //ok\ncalcArray(2) //error \n```\n可以看出 calcArray(2) 会报错，这是因为number类型并不具备length这个属性\n\n### typeof\n\ntypeof关键字：我们在类型保护的时候讲解了typeof的作用，除此之外，这个关键字还可以实现推出类型，如下图，可以推断中 Props 包含的类型。\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c01f7f01bc449d78530bc5e38ee2a5a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n### keyof\n\nkeyof关键字: 可以获取一个对象接口的所有key值,可以检查对象上的键是否存在：\n\n```typescript\ninterface Props {\n    name: string;\n    age: number;\n    sex: boolean\n}\n\ntype PropsKey = keyof Props; //包含 name， age， sex\n\nconst res:PropsKey = 'name' // ok\nconst res1:PropsKey = 'tel' // error\n\n// 泛型中的应用\nconst getInfo = <T, K extends keyof T>(data: T, key: K): T[K] => {\n    return data[key]\n}\n\nconst info = {\n    name: '小杜杜',\n    age: 7,\n    sex: true\n}\n\ngetInfo(info, 'name'); //ok\ngetInfo(info, 'tel'); //error\n```\n### 索引访问操作符\n\n索引访问操作符：通过 `[]` 操作符可进行索引访问,可以访问其中一个属性\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39784ee772554968b70a7274924e2f11~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n### in\n\nin：映射类型, 用来映射遍历枚举类型\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/717b932d27054e7bba535c606b5910a9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n### infer\n\ninfer：可以是使用为条件语句，可以用 infer 声明一个类型变量并且对它进行使用。如\n\n```typescript\ntype Info<T> = T extends { a: infer U; b: infer U } ? U : never;\n\ntype Props = Info<{ a: string; b: number }>; // Props类： string | number\n\ntype Props1 = Info<number> // Props类型： never\n```\n### Partial\n\nPartial语法：`Partial<T>` 作用：将所有属性变为可选的 `?`\n\n```typescript\ninterface Props {\n    name: string,\n    age: number\n}\n\nconst info: Props = {\n    name: '小杜杜',\n    age: 7\n}\n\nconst info1: Partial<Props> = { \n    name: '小杜杜'\n}\n```\n从上述代码上来看，name 和 age 属于必填，对于 info 来说必须要设置 name 和 age 属性才行，但对于 info1来说，只要是个对象就可以，至于是否有name、 age属性并不重要。\n\n### Required\n\nRequired语法：`Required<T>` 作用：将所有属性变为必选的，与 Partial相反\n\n```typescript\ninterface Props {\n    name: string,\n    age: number,\n    sex?: boolean\n}\n\nconst info: Props = {\n    name: '小杜杜',\n    age: 7\n}\n\nconst info1: Required<Props> = { \n    name: '小杜杜',\n    age: 7,\n    sex: true\n}\n```\n### Readonly\n\nReadonly语法：`Readonly<T>` 作用：将所有属性都加上 readonly 修饰符来实现。也就是说无法修改\n\n```typescript\ninterface Props {\n    name: string\n    age: number\n}\n\nlet info: Readonly<Props> = {\n    name: '小杜杜',\n    age: 7\n}\n\ninfo.age = 1 //error read-only 只读属性\n```\n### Record\n\nRecord语法：`Record<K extends keyof any, T>`\n\n作用：将 `K` 中所有的属性的值转化为 `T` 类型。\n\n```typescript\ninterface Props {\n    name: string,\n    age: number\n}\n\ntype InfoProps = 'JS' | 'TS'\n\nconst Info: Record<InfoProps, Props> = {\n    JS: {\n        name: '小杜杜',\n        age: 7\n    },\n    TS: {\n        name: 'TypeScript',\n        age: 11\n    }\n}\n```\n从上述代码上来看, InfoProps的属性分别包含Props的属性。\n\n需要注意的一点是：K extends keyof any其类型可以是:string、number、symbol。\n\n### Pick\n\nPick语法：`Pick<T, K extends keyof T>`\n\n作用：将某个类型中的子属性挑出来，变成包含这个类型部分属性的子类型。\n\n```typescript\ninterface Props {\n    name: string,\n    age: number,\n    sex: boolean\n}\n\ntype nameProps = Pick<Props, 'name' | 'age'>\n\nconst info: nameProps = {\n    name: '小杜杜',\n    age: 7\n}\n```\n从上述代码上来看, Props原本属性包括name、age、sex三个属性，通过 Pick我们吧name和age挑了出来，所以不需要sex属性。\n\n### Exclude\n\nExclude语法：`Exclude<T, U>`\n\n作用：将T类型中的U类型剔除。\n\n```typescript\n// 数字类型\ntype numProps = Exclude<1 | 2 | 3, 1 | 2> // 3\ntype numProps1 = Exclude<1, 1 | 2> // nerver\ntype numProps2 = Exclude<1, 1> // nerver\ntype numProps3 = Exclude<1 | 2, 7> // 1 2\n\n// 字符串类型\ntype info = \"name\" | \"age\" | \"sex\"\ntype info1 = \"name\" | \"age\" \ntype infoProps = Exclude<info, info1> //  \"sex\"\n\n// 类型\ntype typeProps = Exclude<string | number | (() => void), Function> // string | number\n\n// 对象\ntype obj = { name: 1, sex: true }\ntype obj1 = { name: 1 }\ntype objProps = Exclude<obj, obj1> // nerver\n```\n从上述代码上来看,我们比较了下类型上的，当 T 中有 U 就会剔除对应的属性，如果 U 中又的属性 T 中没有，或 T 和 U 刚好一样的情况都会返回 **nerver**，且对象永远返回`nerver`。\n\n### Extra\n\nExtra语法：`Extra<T, U>`\n\n作用：将 T 可分配给的类型中提取 U。与 **Exclude**相反\n\n```typescript\ntype numProps = Extract<1 | 2 | 3, 1 | 2> // 1 | 2\n```\n\n### Omit\n\nOmit语法：`Omit<T, U>`\n\n作用：将已经声明的类型进行属性剔除获得新类型\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7afb178ecc2b4427b82b7a5ebe3ab035~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n与 Exclude的区别：Omit 返回的是新的类型，原理上是在 Exclude之上进行的，Exclude是根据自类型返回的。\n\n### NonNullable\n\nNonNullable语法：`NonNullable<T>` 作用：从 T 中排除 null 和 undefined\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/825ae5b2e0704d4aba9b143fdf6c6835~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)\n\n### ReturnType\n\nReturnType语法：`ReturnType<T>`\n\n作用：用于获取 **函数T的返回类型。**\n\n```typescript\ntype Props = ReturnType<() => string> // string\ntype Props1 = ReturnType<<T extends U, U extends number>() => T>; // number\ntype Props2 = ReturnType<any>; // any\ntype Props3 = ReturnType<never>; // any\n```\n从上述代码上来看， ReturnType可以接受 any 和 never 类型，原因是这两个类型属于顶级类型，包含函数。\n\n### Parameters\n\nParameters：`Parameters<T>` \n\n作用：用于获取 获取函数类型的参数类型\n\n```typescript\ntype Props = Parameters<() => string> // []\ntype Props1 = Parameters<(data: string) => void> // [string]\ntype Props2 = Parameters<any>; // unknown[]\ntype Props3 = Parameters<never>; // never\n```\n\n\n\n\n## 拓展\n\n+ [TypeScript 4.0 文档](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-0.html)\n+ [深入理解 TypeScript ](https://jkchao.github.io/typescript-book-chinese/project/namespaces.html)\n+ [一份不可多得的 TS 学习指南（1.8W字）](https://juejin.cn/post/6872111128135073806)\n\n","slug":"ts000","published":1,"updated":"2023-03-07T14:49:31.555Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsii0033yt8wfznhhifm","content":"<h2 id=\"TS-是什么-？\"><a href=\"#TS-是什么-？\" class=\"headerlink\" title=\"TS 是什么 ？\"></a>TS 是什么 ？</h2><p><strong>TS</strong>：是 <strong>TypeScript</strong> 的简称，是一种由微软开发的自由和开源的编程语言。</p>\n<p><strong>TS和JS的关系</strong></p>\n<p>对比于JS，TS是JS的 <strong>超集</strong>，简单的说就是在 JavaScript 的基础上加入了 <strong>类型系统</strong>，让每个参数都有明确的意义，从而带来了更加 <strong>智能</strong> 的提示。</p>\n<p>相对于JS而言，TS属于 <strong>强类型</strong> 语言，所以对于项目而言，会使代码更加规范，从而解决了大型项目代码的复杂性，其次，浏览器是不识别TS的，所以在编译的时候，TS文件会先编译为JS文件。</p>\n<p><strong>安装TS</strong></p>\n<p>执行命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g typescript </span><br><span class=\"line\">// 或</span><br><span class=\"line\">yarn global add typescript</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看版本</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tsc -v</span><br></pre></td></tr></table></figure>\n\n<p><strong>编译</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tsc test.ts</span><br><span class=\"line\"><span class=\"comment\"># test.ts =&gt; test.js</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>在线编译</strong></p>\n<p>我们为了方便起见，可以使用线上的编辑器：<a href=\"https://www.typescriptlang.org/zh/play\">TypeScript Playground</a></p>\n<p>并且你还可以看看生成对应的<code>ts</code>转化<code>ES5</code>，<code>ES6</code>之后的代码，也有相关的例子供你查看</p>\n<h2 id=\"TS数据类型\"><a href=\"#TS数据类型\" class=\"headerlink\" title=\"TS数据类型\"></a>TS数据类型</h2><p>这里将TS的数据类型简单的进行下归类：</p>\n<ul>\n<li>基本类型：string、number、boolean、symbol、bigint、null、undefined</li>\n<li>引用类型：array、 Tuple(元组)、 object(包含Object和{})、function</li>\n<li>特殊类型：any、unknow、void、never、Enum(枚举)</li>\n<li>其他类型：类型推理、字面量类型、交叉类型</li>\n</ul>\n<p>注：案例中有可能用到type和interface，在下面会详细讲解，有比较模糊的可以先看看</p>\n<h3 id=\"基本类型\"><a href=\"#基本类型\" class=\"headerlink\" title=\"基本类型\"></a>基本类型</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//字符串</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">str</span>: <span class=\"built_in\">string</span> = <span class=\"string\">&quot;Domesy&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 数字</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">num</span>: <span class=\"built_in\">number</span> = <span class=\"number\">7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//布尔</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">bool</span>: <span class=\"built_in\">boolean</span> = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//symbol</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">sym</span>: <span class=\"built_in\">symbol</span> = <span class=\"title class_\">Symbol</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//bigint</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">big</span>: <span class=\"built_in\">bigint</span> = <span class=\"number\">10n</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//null</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">nu</span>: <span class=\"literal\">null</span> = <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">un</span>: <span class=\"literal\">undefined</span> = <span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>需要注意：</p>\n<ul>\n<li>null 和 undefined 两个类型一旦赋值上，就不能在赋值给任何其他类型</li>\n<li>symbol是独一无二的，假设再定义一个 sym1，那么 <code>sym === sym1</code> 为 false</li>\n</ul>\n<h3 id=\"引用类型\"><a href=\"#引用类型\" class=\"headerlink\" title=\"引用类型\"></a>引用类型</h3><h4 id=\"Array\"><a href=\"#Array\" class=\"headerlink\" title=\"Array\"></a>Array</h4><p>两种方式：</p>\n<ul>\n<li>类型名称 + []</li>\n<li>Array&lt;数据类型&gt;</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">arr1</span>: <span class=\"built_in\">number</span>[] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">arr2</span>: <span class=\"title class_\">Array</span>&lt;<span class=\"built_in\">number</span>&gt; = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">arr2</span>: <span class=\"title class_\">Array</span>&lt;<span class=\"built_in\">number</span>&gt; = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;3&#x27;</span>] <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//要想是数字类型或字符串类型，需要使用 ｜</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">arr3</span>: <span class=\"title class_\">Array</span>&lt;<span class=\"built_in\">number</span> | <span class=\"built_in\">string</span>&gt; = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;3&#x27;</span>] <span class=\"comment\">//ok</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Tuple-元组\"><a href=\"#Tuple-元组\" class=\"headerlink\" title=\"Tuple(元组)\"></a>Tuple(元组)</h4><p>Tuple 可以说是 Array 的一种特殊情况,针对上面的 arr3,我们看他的类型可以是string也可以是number，但对每个元素没有作出具体的限制。</p>\n<p>那么 Tuple 的作用就是限制元素的类型并且限制个数的数组,同时 Tuple这个概念值存在于TS，在JS上是不存在的<br>这里存在一个问题：在TS中,是允许对 Tuple 扩增的（也就是允许使用 push方法），但在访问上不允许</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">t</span>: [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] = [<span class=\"number\">1</span>, <span class=\"string\">&#x27;2&#x27;</span>] <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">t1</span>: [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] = [<span class=\"number\">1</span>, <span class=\"number\">3</span>] <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">t2</span>: [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] = [<span class=\"number\">1</span>] <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">t3</span>: [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] = [<span class=\"number\">1</span>, <span class=\"string\">&#x27;1&#x27;</span>, <span class=\"literal\">true</span>] <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">t5</span>: [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] = [<span class=\"number\">1</span>, <span class=\"string\">&#x27;2&#x27;</span>] <span class=\"comment\">// ok</span></span><br><span class=\"line\">t.<span class=\"title function_\">push</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(t) <span class=\"comment\">// [1, &#x27;2&#x27;, 2]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> a =  t[<span class=\"number\">0</span>] <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> b = t[<span class=\"number\">1</span>] <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> c = t[<span class=\"number\">2</span>] <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"object\"><a href=\"#object\" class=\"headerlink\" title=\"object\"></a>object</h4><p><code>object</code> 非原始类型，在定义上直接使用 object 是可以的，但你要更改对象的属性就会报错，原因是并没有使对象的内部具体的属性做限制，所以需要使用 <strong>{}</strong> 来定义内部类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">obj1</span>: <span class=\"built_in\">object</span> = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">obj1.<span class=\"property\">a</span> = <span class=\"number\">3</span> <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">obj2</span>: &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">number</span>, <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125; = &#123;<span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">obj2.<span class=\"property\">a</span> = <span class=\"number\">3</span> <span class=\"comment\">// ok</span></span><br></pre></td></tr></table></figure>\n<p><code>Object</code>(大写的O）,代表所有的原始类型或非原始类型都可以进行赋值,除了<code>null</code>和<code>undefined</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">obj</span>: <span class=\"title class_\">Object</span>;</span><br><span class=\"line\">obj = <span class=\"number\">1</span>; <span class=\"comment\">// ok</span></span><br><span class=\"line\">obj = <span class=\"string\">&quot;a&quot;</span>; <span class=\"comment\">// ok</span></span><br><span class=\"line\">obj = <span class=\"literal\">true</span>; <span class=\"comment\">// ok</span></span><br><span class=\"line\">obj = &#123;&#125;; <span class=\"comment\">// ok</span></span><br><span class=\"line\">obj = <span class=\"title class_\">Symbol</span>() <span class=\"comment\">//ok</span></span><br><span class=\"line\">obj = <span class=\"number\">10n</span> <span class=\"comment\">//ok</span></span><br><span class=\"line\">obj = <span class=\"literal\">null</span>; <span class=\"comment\">// error</span></span><br><span class=\"line\">obj = <span class=\"literal\">undefined</span>; <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"function\"><a href=\"#function\" class=\"headerlink\" title=\"function\"></a>function</h4><p><strong>定义函数</strong></p>\n<ul>\n<li>有两种方式，一种为 <code>function</code>， 另一种为<code>箭头函数</code></li>\n<li>在书写的时候，也可以写入返回值的类型，如果写入，则必须要有对应类型的返回值，<strong>但通常情况下是省略</strong>，因为<code>TS</code>的类型推断功能够正确推断出返回值类型</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setName1</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>) &#123; <span class=\"comment\">//ok</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;hello&quot;</span>, name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">setName1</span>(<span class=\"string\">&quot;Domesy&quot;</span>); <span class=\"comment\">// &quot;hello&quot;,  &quot;Domesy&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setName2</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>):<span class=\"built_in\">string</span> &#123; <span class=\"comment\">//error</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;hello&quot;</span>, name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">setName2</span>(<span class=\"string\">&quot;Domesy&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setName3</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>):<span class=\"built_in\">string</span> &#123; <span class=\"comment\">//error</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;hello&quot;</span>, name);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">setName3</span>(<span class=\"string\">&quot;Domesy&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setName4</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>): <span class=\"built_in\">string</span> &#123; <span class=\"comment\">//ok</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;hello&quot;</span>, name);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">setName4</span>(<span class=\"string\">&quot;Domesy&quot;</span>); <span class=\"comment\">// &quot;hello&quot;,  &quot;Domesy&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//箭头函数与上述同理</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setName5</span> = (<span class=\"params\">name:<span class=\"built_in\">string</span></span>) =&gt; <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;hello&quot;</span>, name);</span><br><span class=\"line\"><span class=\"title function_\">setName5</span>(<span class=\"string\">&quot;Domesy&quot;</span>) <span class=\"comment\">// &quot;hello&quot;,  &quot;Domesy&quot;</span></span><br></pre></td></tr></table></figure>\n<p><strong>参数类型</strong></p>\n<ul>\n<li>可选参数： 如果函数要配置可有可无的参数时，可以通过 <strong>?</strong> 实现，切可选参数一定要在最后面</li>\n<li>默认参数：函数内可以自己设定其默认参数，用 <strong>&#x3D;</strong> 实现</li>\n<li>剩余参数：仍可以使用扩展运算符 <strong>…</strong></li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 可选参数</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo1</span> = (<span class=\"params\">name: <span class=\"built_in\">string</span>, age?: <span class=\"built_in\">number</span></span>) =&gt; <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name, age)</span><br><span class=\"line\"><span class=\"title function_\">setInfo1</span>(<span class=\"string\">&#x27;Domesy&#x27;</span>) <span class=\"comment\">//&quot;Domesy&quot;,  undefined</span></span><br><span class=\"line\"><span class=\"title function_\">setInfo1</span>(<span class=\"string\">&#x27;Domesy&#x27;</span>, <span class=\"number\">7</span>) <span class=\"comment\">//&quot;Domesy&quot;,  7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 默认参数</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo2</span> = (<span class=\"params\">name: <span class=\"built_in\">string</span>, age: <span class=\"built_in\">number</span> = <span class=\"number\">11</span></span>) =&gt; <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name, age)</span><br><span class=\"line\"><span class=\"title function_\">setInfo2</span>(<span class=\"string\">&#x27;Domesy&#x27;</span>) <span class=\"comment\">//&quot;Domesy&quot;,  11</span></span><br><span class=\"line\"><span class=\"title function_\">setInfo2</span>(<span class=\"string\">&#x27;Domesy&#x27;</span>, <span class=\"number\">7</span>) <span class=\"comment\">//&quot;Domesy&quot;,  7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 剩余参数</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">allCount</span> = (<span class=\"params\">...numbers: <span class=\"built_in\">number</span>[]</span>) =&gt; <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`数字总和为：<span class=\"subst\">$&#123;numbers.reduce((val, item) =&gt; (val += item), <span class=\"number\">0</span>)&#125;</span>`</span>)</span><br><span class=\"line\"><span class=\"title function_\">allCount</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) <span class=\"comment\">//&quot;数字总和为：6&quot;</span></span><br></pre></td></tr></table></figure>\n<p><strong>函数重载</strong></p>\n<p><strong>函数重载</strong>：是使用相同名称和不同参数数量或类型创建多个方法的一种能力。 在 TypeScript 中，表现为给同一个函数提供多个函数类型定义。 简单的说：<strong>可以在同一个函数下定义多种类型值，最后汇总到一块</strong></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">obj</span>: <span class=\"built_in\">any</span> = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setInfo</span>(<span class=\"params\">val: <span class=\"built_in\">string</span></span>): <span class=\"built_in\">void</span>;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setInfo</span>(<span class=\"params\">val: <span class=\"built_in\">number</span></span>): <span class=\"built_in\">void</span>;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setInfo</span>(<span class=\"params\">val: <span class=\"built_in\">boolean</span></span>): <span class=\"built_in\">void</span>;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setInfo</span>(<span class=\"params\">val: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span> | <span class=\"built_in\">boolean</span></span>): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> val === <span class=\"string\">&quot;string&quot;</span>) &#123;</span><br><span class=\"line\">    obj.<span class=\"property\">name</span> = val;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    obj.<span class=\"property\">age</span> = val;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"string\">&quot;Domesy&quot;</span>);</span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"number\">7</span>);</span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(obj); <span class=\"comment\">// &#123; name: &#x27;Domesy&#x27;, age: 7 &#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"特殊类型\"><a href=\"#特殊类型\" class=\"headerlink\" title=\"特殊类型\"></a>特殊类型</h3><h4 id=\"any\"><a href=\"#any\" class=\"headerlink\" title=\"any\"></a>any</h4><p>在 TS 中，任何类型都可以归于 <code>any</code> 类型，所以<code>any</code>类型也就成了所有类型的<strong>顶级类型</strong>，同时，<strong>如果不指定变量的类型，则默认为any类型</strong>, 当然不推荐使用该类型，因为这样丧失了TS的作用。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">d</span>:<span class=\"built_in\">any</span>; <span class=\"comment\">//等价于 let d </span></span><br><span class=\"line\">d = <span class=\"string\">&#x27;1&#x27;</span>;</span><br><span class=\"line\">d = <span class=\"number\">2</span>;</span><br><span class=\"line\">d = <span class=\"literal\">true</span>;</span><br><span class=\"line\">d = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">d = &#123;&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"unknow\"><a href=\"#unknow\" class=\"headerlink\" title=\"unknow\"></a>unknow</h4><p>与any一样，都可以作为所有类型的<strong>顶级类型</strong>，但 unknow更加<strong>严格</strong>，那么可以说除了any 之下的第二大类型，接下来对比下any，主要严格于一下两点：</p>\n<ul>\n<li>unknow会对值进行检测，而类型any不会做检测操作，说白了，any类型可以赋值给任何类型，但unknow只能赋值给unknow类型和any类型</li>\n<li>unknow不允许定义的值有任何操作（如 方法，new等），但any可以</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">u</span>:<span class=\"built_in\">unknown</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">a</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">u = <span class=\"string\">&#x27;1&#x27;</span>; <span class=\"comment\">//ok</span></span><br><span class=\"line\">u = <span class=\"number\">2</span>; <span class=\"comment\">//ok</span></span><br><span class=\"line\">u = <span class=\"literal\">true</span>; <span class=\"comment\">//ok</span></span><br><span class=\"line\">u = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]; <span class=\"comment\">//ok</span></span><br><span class=\"line\">u = &#123;&#125;; <span class=\"comment\">//ok</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value</span>:<span class=\"built_in\">any</span> = u <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value1</span>:<span class=\"built_in\">any</span> = a <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value2</span>:<span class=\"built_in\">unknown</span> = u <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value3</span>:<span class=\"built_in\">unknown</span> = a <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value4</span>:<span class=\"built_in\">string</span> = u <span class=\"comment\">//error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value5</span>:<span class=\"built_in\">string</span> = a <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value6</span>:<span class=\"built_in\">number</span> = u <span class=\"comment\">//error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value7</span>:<span class=\"built_in\">number</span> = a <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value8</span>:<span class=\"built_in\">boolean</span> = u <span class=\"comment\">//error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value9</span>:<span class=\"built_in\">boolean</span> = a <span class=\"comment\">//ok</span></span><br><span class=\"line\"></span><br><span class=\"line\">u.<span class=\"title function_\">set</span>() <span class=\"comment\">// error</span></span><br><span class=\"line\">a.<span class=\"title function_\">set</span>() <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"title function_\">u</span>() <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"title function_\">a</span>() <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"title function_\">u</span>() <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"title function_\">a</span>() <span class=\"comment\">//ok</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"void\"><a href=\"#void\" class=\"headerlink\" title=\"void\"></a>void</h4><p>当一个函数，没有返回值时，TS会默认他的返回值为  <code>void</code>  类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> setInfo = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;&#125; <span class=\"comment\">// 等价于 const setInfo = () =&gt; &#123;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> setInfo1 = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123; <span class=\"keyword\">return</span> <span class=\"string\">&#x27;1&#x27;</span> &#125;  <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> setInfo2 = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123; <span class=\"keyword\">return</span> <span class=\"number\">2</span> &#125; <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> setInfo3 = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123; <span class=\"keyword\">return</span> <span class=\"literal\">true</span> &#125; <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> setInfo4 = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123; <span class=\"keyword\">return</span>  &#125; <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> setInfo5 = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123; <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span> &#125; <span class=\"comment\">//ok </span></span><br></pre></td></tr></table></figure>\n<h4 id=\"never\"><a href=\"#never\" class=\"headerlink\" title=\"never\"></a>never</h4><p>表示一个函数永远不存在返回值，TS会认为类型为 never，那么与 void 相比, never应该是 void子集， 因为 void实际上的返回值为 undefined，而 never 连 undefined也不行</p>\n<p>符合never的情况有：当抛出异常的情况和无限死循环</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> error = ():<span class=\"function\"><span class=\"params\">never</span> =&gt;</span> &#123; <span class=\"comment\">// 等价约 let error = () =&gt; &#123;&#125;</span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&quot;error&quot;</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> error1 = ():<span class=\"function\"><span class=\"params\">never</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"Enum-枚举\"><a href=\"#Enum-枚举\" class=\"headerlink\" title=\"Enum(枚举)\"></a>Enum(枚举)</h4><p>可以定义一些带名字的常量，这样可以 <strong>清晰表达意图</strong> 或 <strong>创建一组有区别的用例</strong></p>\n<p>注意：</p>\n<ul>\n<li>枚举的类型只能是 <code>string</code> 或 <code>number</code></li>\n<li>定义的名称不能为 <strong>关键字</strong></li>\n</ul>\n<p>同时我们可以看看翻译为ES5是何样子</p>\n<h4 id=\"数字枚举\"><a href=\"#数字枚举\" class=\"headerlink\" title=\"数字枚举\"></a>数字枚举</h4><ul>\n<li>枚组的类型默认为<strong>数字类型</strong>，默认从0开始以此累加，如果有设置默认值，则<strong>只会对下面的值产生影响</strong></li>\n<li>同时支持<strong>反向映射</strong>（及从成员值到成员名的映射），但智能映射无默认值的情况，并且只能是默认值的前面</li>\n</ul>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7559b8e5b7b94f8fbafc95fd37eeffbd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h4 id=\"字符串枚举\"><a href=\"#字符串枚举\" class=\"headerlink\" title=\"字符串枚举\"></a>字符串枚举</h4><p>字符串枚举要注意的是必须要有<strong>默认值</strong>，不支持<strong>反向映射</strong></p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0df3876ecc6a474085e468cbd3f1929f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h4 id=\"常量枚举\"><a href=\"#常量枚举\" class=\"headerlink\" title=\"常量枚举\"></a>常量枚举</h4><p>除了数字类型和字符串类型之外，还有一种特殊的类型，那就是常量枚举，也就是通过const去定义enum，但这种类型不会编译成任何 JS,只会编译对应的值</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/160ac2e75cab457d99093ce48c34756a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h4 id=\"异构枚举\"><a href=\"#异构枚举\" class=\"headerlink\" title=\"异构枚举\"></a>异构枚举</h4><p>包含了 <code>数字类型</code> 和 <code>字符串类型</code> 的混合，反向映射一样的道理</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d5f1433ab2c48bebc65ca5f8ace0da4~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h3 id=\"类型推论\"><a href=\"#类型推论\" class=\"headerlink\" title=\"类型推论\"></a>类型推论</h3><p>我们在学完这些基础类型，我们是不是每个类型都要去写字段是什么类型呢？其实不是，在TS中如果不设置类型，并且不进行赋值时，将会推论为any类型，如果进行赋值就会默认为类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a; <span class=\"comment\">// 推断为any</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> str = <span class=\"string\">&#x27;小杜杜&#x27;</span>; <span class=\"comment\">// 推断为string</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> num = <span class=\"number\">13</span>; <span class=\"comment\">// 推断为number</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> flag = <span class=\"literal\">false</span>; <span class=\"comment\">// 推断为boolean</span></span><br><span class=\"line\"></span><br><span class=\"line\">str = <span class=\"literal\">true</span> <span class=\"comment\">// error Type &#x27;boolean&#x27; is not assignable to type &#x27;string&#x27;.(2322)</span></span><br><span class=\"line\">num = <span class=\"string\">&#x27;Domesy&#x27;</span> <span class=\"comment\">// error</span></span><br><span class=\"line\">flag = <span class=\"number\">7</span> <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"字面量类型\"><a href=\"#字面量类型\" class=\"headerlink\" title=\"字面量类型\"></a>字面量类型</h3><p>字面量类型：在TS中，我们可以指定参数的类型是什么，目前支持字符串、数字、布尔三种类型。比如说我定义了 str 的类型是 ‘小杜杜’， 那么str的值只能是小杜杜</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">str</span>:<span class=\"string\">&#x27;小杜杜&#x27;</span> </span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">num</span>: <span class=\"number\">1</span> | <span class=\"number\">2</span> | <span class=\"number\">3</span> = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">flag</span>:<span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">str = <span class=\"string\">&#x27;小杜杜&#x27;</span> <span class=\"comment\">//ok</span></span><br><span class=\"line\">str = <span class=\"string\">&#x27;Donmesy&#x27;</span> <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\">num = <span class=\"number\">2</span> <span class=\"comment\">//ok</span></span><br><span class=\"line\">num = <span class=\"number\">7</span> <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\">flag = <span class=\"literal\">true</span> <span class=\"comment\">// ok</span></span><br><span class=\"line\">flag = <span class=\"literal\">false</span> <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"交叉类型（-amp-）\"><a href=\"#交叉类型（-amp-）\" class=\"headerlink\" title=\"交叉类型（&amp;）\"></a>交叉类型（&amp;）</h3><p>交叉类型：将多个类型合并为一个类型，使用&amp;符号连接，如：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">AProps</span> = &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">BProps</span> = &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> allProps = <span class=\"title class_\">AProps</span> &amp; <span class=\"title class_\">BProps</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Info</span>: allProps = &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"同名基础属性合并\"><a href=\"#同名基础属性合并\" class=\"headerlink\" title=\"同名基础属性合并\"></a>同名基础属性合并</h4><p>我们可以看到交叉类型是结合两个属性的属性值，那么我们现在有个问题，要是两个属性都有相同的属性值，那么此时总的类型会怎么样，先看看下面的案列：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">AProps</span> = &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span>, <span class=\"attr\">c</span>: <span class=\"built_in\">number</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">BProps</span> = &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span>, <span class=\"attr\">c</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> allProps = <span class=\"title class_\">AProps</span> &amp; <span class=\"title class_\">BProps</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Info</span>: allProps = &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">    <span class=\"attr\">c</span>:  <span class=\"number\">1</span>, <span class=\"comment\">// error (property) c: never</span></span><br><span class=\"line\">    <span class=\"attr\">c</span>:  <span class=\"string\">&#x27;Domesy&#x27;</span>, <span class=\"comment\">// error (property) c: never</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果是相同的类型，合并后的类型也是此类型，那如果是不同的类型会如何：</p>\n<p>我们在Aprops和BProps中同时加入c属性，并且c属性的类型不同，一个是number类型，另一个是string类型<br>现在结合为 allProps 后呢? 是不是c属性是 number 或 string 类型都可以，还是其中的一种？</p>\n<p>然而在实际中， c 传入数字类型和字符串类型都不行，我么看到报错，现实的是 c的类型是 never。</p>\n<p>这是因为对应 c属性而言是 string &amp; number，然而这种属性明显是不存在的，所以c的属性是never</p>\n<h4 id=\"同名非基础属性合并\"><a href=\"#同名非基础属性合并\" class=\"headerlink\" title=\"同名非基础属性合并\"></a>同名非基础属性合并</h4><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> A &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">number</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> B &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> C &#123;</span><br><span class=\"line\">    <span class=\"attr\">x</span>: A</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> D &#123;</span><br><span class=\"line\">    <span class=\"attr\">x</span>: B</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> allProps = C &amp; D</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Info</span>: allProps = &#123;</span><br><span class=\"line\">  <span class=\"attr\">x</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>) <span class=\"comment\">// &#123; x: &#123; &quot;a&quot;: 7, &quot;b&quot;: &quot;小杜杜&quot; &#125;&#125;</span></span><br></pre></td></tr></table></figure>\n<p>我们来看看案例，对于混入多个类型时，若存在相同的成员，且成员类型为非基本数据类型，那么是可以成功合。</p>\n<p>如果 接口A 中的 也是 b，类型为number，就会跟<strong>同名基础属性合并</strong>一样</p>\n<h2 id=\"Class（类）\"><a href=\"#Class（类）\" class=\"headerlink\" title=\"Class（类）\"></a>Class（类）</h2><p>在ES6中推出了一个叫 class（类） 的玩意，具体定义就不说了，相信用过React的小伙伴一定不陌生。</p>\n<h3 id=\"基本方法\"><a href=\"#基本方法\" class=\"headerlink\" title=\"基本方法\"></a>基本方法</h3><p>在基本方法中有：静态属性，静态方法、成员属性、成员方法、构造器、get set方法，接下来逐个看看：</p>\n<p>需要注意的是： 在成员属性中，如果不给默认值,并且不使用是会报错的，如果不想报错就给如<code> !</code>，如：<code>name4!:string</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Info</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">//静态属性</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"attr\">name1</span>: <span class=\"built_in\">string</span> = <span class=\"string\">&#x27;Domesy&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//成员属性，实际上是通过public上进行修饰，只是省略了</span></span><br><span class=\"line\">  <span class=\"attr\">nmae2</span>:<span class=\"built_in\">string</span> = <span class=\"string\">&#x27;Hello&#x27;</span> <span class=\"comment\">//ok </span></span><br><span class=\"line\">  <span class=\"attr\">name3</span>:<span class=\"built_in\">string</span> <span class=\"comment\">//error</span></span><br><span class=\"line\">  name4!:<span class=\"built_in\">string</span> <span class=\"comment\">//ok 不设置默认值的时候必须加入 !</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//构造方法</span></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">_name:<span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span> = _name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//静态方法</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> getName = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;我是静态方法&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//成员方法</span></span><br><span class=\"line\">  getName4 = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`我是成员方法:<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.name4&#125;</span>`</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//get 方法</span></span><br><span class=\"line\">  <span class=\"keyword\">get</span> <span class=\"title function_\">name5</span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//set 方法</span></span><br><span class=\"line\">  <span class=\"keyword\">set</span> <span class=\"title function_\">name5</span>(<span class=\"params\">name5</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span> = name5</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> setName = <span class=\"keyword\">new</span> <span class=\"title class_\">Info</span>(<span class=\"string\">&#x27;你好&#x27;</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>.<span class=\"property\">name1</span>) <span class=\"comment\">//  &quot;Domesy&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>.<span class=\"title function_\">getName</span>()) <span class=\"comment\">// &quot;我是静态方法&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(setName.<span class=\"title function_\">getName4</span>()) <span class=\"comment\">// &quot;我是成员方法:你好&quot; </span></span><br></pre></td></tr></table></figure>\n<p>让我们看看上述代码翻译成ES5是什么样：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&quot;use strict&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Info</span> = <span class=\"comment\">/** <span class=\"doctag\">@class</span> */</span> (<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//构造方法</span></span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">Info</span>(<span class=\"params\">_name</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> _this = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">        <span class=\"comment\">//成员属性</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">nmae2</span> = <span class=\"string\">&#x27;Hello&#x27;</span>; <span class=\"comment\">//ok</span></span><br><span class=\"line\">        <span class=\"comment\">//成员方法</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">getName4</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;\\u6211\\u662F\\u6210\\u5458\\u65B9\\u6CD5:&quot;</span>.<span class=\"title function_\">concat</span>(_this.<span class=\"property\">name4</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span> = _name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(<span class=\"title class_\">Info</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>, <span class=\"string\">&quot;name5&quot;</span>, &#123;</span><br><span class=\"line\">        <span class=\"comment\">//get 方法</span></span><br><span class=\"line\">        <span class=\"attr\">get</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span>;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"comment\">//set 方法</span></span><br><span class=\"line\">        <span class=\"attr\">set</span>: <span class=\"keyword\">function</span> (<span class=\"params\">name5</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span> = name5;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">enumerable</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">configurable</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">//静态属性</span></span><br><span class=\"line\">    <span class=\"title class_\">Info</span>.<span class=\"property\">name1</span> = <span class=\"string\">&#x27;Domesy&#x27;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//静态方法</span></span><br><span class=\"line\">    <span class=\"title class_\">Info</span>.<span class=\"property\">getName</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;我是静态方法&#x27;</span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title class_\">Info</span>;</span><br><span class=\"line\">&#125;());</span><br><span class=\"line\"><span class=\"keyword\">var</span> setName = <span class=\"keyword\">new</span> <span class=\"title class_\">Info</span>(<span class=\"string\">&#x27;你好&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>.<span class=\"property\">name1</span>); <span class=\"comment\">//  &quot;Domesy&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>.<span class=\"title function_\">getName</span>()); <span class=\"comment\">// &quot;我是静态方法&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(setName.<span class=\"title function_\">getName4</span>()); <span class=\"comment\">// &quot;我是成员方法:你好&quot; </span></span><br></pre></td></tr></table></figure>\n<h3 id=\"私有字段\"><a href=\"#私有字段\" class=\"headerlink\" title=\"私有字段(#)\"></a>私有字段(#)</h3><p>在 TS 3.8版本便开始支持 ECMACMAScript 的私有字段。</p>\n<p>需要注意的是私有字段与常规字段不同，主要的区别是：</p>\n<ul>\n<li>私有字段以 <code>#</code> 字符开头，也叫私有名称；</li>\n<li>每个私有字段名称都<strong>唯一</strong>地限定于其包含的类；</li>\n<li>不能在私有字段上使用 TypeScript 可访问性修饰符（如 public 或 private）；</li>\n<li>私有字段不能在包含的类之外访问，甚至不能被检测到。</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Info</span> &#123;</span><br><span class=\"line\">  #<span class=\"attr\">name</span>: <span class=\"built_in\">string</span>; <span class=\"comment\">//私有字段</span></span><br><span class=\"line\">  <span class=\"attr\">getName</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.#name = name;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">getName</span> = name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">setName</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`我的名字是<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.#name&#125;</span>`</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> myName = <span class=\"keyword\">new</span> <span class=\"title class_\">Info</span>(<span class=\"string\">&quot;Domesy&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(myName.<span class=\"title function_\">setName</span>()) <span class=\"comment\">// &quot;我的名字是Domesy&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(myName.<span class=\"property\">getName</span>) <span class=\"comment\">// ok &quot;Domesy&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(myName.#name) <span class=\"comment\">// error </span></span><br><span class=\"line\"><span class=\"comment\">// Property &#x27;#name&#x27; is not accessible outside class &#x27;Info&#x27; </span></span><br><span class=\"line\"><span class=\"comment\">// because it has a private identifier.(18013)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"只读属性（readonly）\"><a href=\"#只读属性（readonly）\" class=\"headerlink\" title=\"只读属性（readonly）\"></a>只读属性（readonly）</h3><p>只读属性：用 readonly修饰，只能在构造函数中初始化，并且在TS中，只允许将interface、type、class上的属性标识为readonly</p>\n<ul>\n<li><code>readonly</code>实际上只是在 <code>编译阶段</code> 进行代码检查</li>\n<li>被<code>radonly</code>修饰的词只能在 <code>constructor</code> 阶段修改，其他时刻不允许修改</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Info</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">readonly</span> <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>; <span class=\"comment\">// 只读属性</span></span><br><span class=\"line\">  <span class=\"attr\">name1</span>:<span class=\"built_in\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name1</span> = name;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">setName</span>(<span class=\"params\">name:<span class=\"built_in\">string</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name <span class=\"comment\">// error</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name1</span> = name; <span class=\"comment\">// ok</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"继承（extends）\"><a href=\"#继承（extends）\" class=\"headerlink\" title=\"继承（extends）\"></a>继承（extends）</h3><p>继承：是个比较重要的点，指的是子可以继承父的思想，也就是说 子类 通过继承父类后，就拥有了父类的属性和方法，这点与HOC有点类似。</p>\n<p>这里有个<code>super</code>字段，给不知道的小伙伴说说，其作用是<strong>调用父类上的属性和方法</strong></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 父类</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, age:<span class=\"built_in\">number</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">age</span> = age</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">getName</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的姓名是：<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.name&#125;</span>`</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">name</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">setName</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`设置姓名为：<span class=\"subst\">$&#123;name&#125;</span>`</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 子类</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">tel</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, age: <span class=\"built_in\">number</span>, tel:<span class=\"built_in\">number</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">super</span>(name, age)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">tel</span> = tel</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">getTel</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`电话号码是<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.tel&#125;</span>`</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">tel</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> res = <span class=\"keyword\">new</span> <span class=\"title class_\">Child</span>(<span class=\"string\">&quot;Domesy&quot;</span>, <span class=\"number\">7</span> , <span class=\"number\">123456</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res) <span class=\"comment\">// Child &#123;.&quot;name&quot;: &quot;Domesy&quot;, &quot;age&quot;: 7, &quot;no&quot;: 1 &#125;</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">age</span>) <span class=\"comment\">// 7</span></span><br><span class=\"line\">res.<span class=\"title function_\">setName</span>(<span class=\"string\">&#x27;小杜杜&#x27;</span>) <span class=\"comment\">// &quot;设置姓名为：小杜杜&quot; </span></span><br><span class=\"line\">res.<span class=\"title function_\">getName</span>() <span class=\"comment\">//   &quot;我的姓名是：小杜杜&quot;</span></span><br><span class=\"line\">res.<span class=\"title function_\">getTel</span>() <span class=\"comment\">//  &quot;电话号码是123456&quot; </span></span><br></pre></td></tr></table></figure>\n<h3 id=\"修饰符\"><a href=\"#修饰符\" class=\"headerlink\" title=\"修饰符\"></a>修饰符</h3><p>主要有三种修饰符：</p>\n<ul>\n<li><strong>public</strong>：类中、子类内的任何地方、外部<strong>都能调用</strong></li>\n<li><strong>protected</strong>：类中、子类内的任何地方都能调用,但<strong>外部不能调用</strong></li>\n<li><strong>private</strong>：类中可以调用，子类内的任何地方、外部<strong>均不可调用</strong></li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"keyword\">protected</span> <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"attr\">tel</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, age:<span class=\"built_in\">number</span>, tel: <span class=\"built_in\">number</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">age</span> = age</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">tel</span> = tel</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, age: <span class=\"built_in\">number</span>, tel: <span class=\"built_in\">number</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">super</span>(name, age, tel);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">getName</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字叫<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.name&#125;</span>,年龄是<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.age&#125;</span>`</span>) <span class=\"comment\">// ok name 和 age可以</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`电话是<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.tel&#125;</span>`</span>) <span class=\"comment\">// error 报错 原因是 tel 拿不出来</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"keyword\">new</span> <span class=\"title class_\">Child</span>(<span class=\"string\">&#x27;Domesy&#x27;</span>, <span class=\"number\">7</span>, <span class=\"number\">123456</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">name</span>) <span class=\"comment\">// ok Domesy</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">age</span>) <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">tel</span>) <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"abstract\"><a href=\"#abstract\" class=\"headerlink\" title=\"abstract\"></a>abstract</h3><p>abstract: 用abstract关键字声明的类叫做<strong>抽象类</strong>，声明的方法叫做<strong>抽象方法</strong>。</p>\n<ul>\n<li><strong>抽象类</strong>：指不能被实例化，因为它里面包含一个或多个抽象方法。</li>\n<li><strong>抽象方法</strong>：是指不包含具体实现的方法；</li>\n</ul>\n<p>注：抽象类是不能直接实例化，只能实例化实现了所有抽象方法的子类</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"><span class=\"keyword\">public</span> name: <span class=\"built_in\">string</span></span>)&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 抽象方法</span></span><br><span class=\"line\">  <span class=\"keyword\">abstract</span> <span class=\"title function_\">setAge</span>(<span class=\"attr\">age</span>: <span class=\"built_in\">number</span>) :<span class=\"built_in\">void</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">super</span>(name);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">setAge</span>(<span class=\"attr\">age</span>: <span class=\"built_in\">number</span>): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.name&#125;</span>,年龄是<span class=\"subst\">$&#123;age&#125;</span>`</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> res = <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;小杜杜&quot;</span>) <span class=\"comment\">//error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> res1 = <span class=\"keyword\">new</span> <span class=\"title class_\">Child</span>(<span class=\"string\">&quot;小杜杜&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">res1.<span class=\"title function_\">setAge</span>(<span class=\"number\">7</span>) <span class=\"comment\">// &quot;我的名字是小杜杜,年龄是7&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"重写和重载\"><a href=\"#重写和重载\" class=\"headerlink\" title=\"重写和重载\"></a>重写和重载</h3><ul>\n<li><strong>重写</strong>：子类重写继承自父类中的方法</li>\n<li><strong>重载</strong>：指为同一个函数提供多个类型定义，与上述函数的重载类似</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 重写</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person</span>&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setName</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`我的名字叫<span class=\"subst\">$&#123;name&#125;</span>`</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Person</span>&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setName</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`你的名字叫<span class=\"subst\">$&#123;name&#125;</span>`</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> yourName = <span class=\"keyword\">new</span> <span class=\"title class_\">Child</span>()</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(yourName.<span class=\"title function_\">setName</span>(<span class=\"string\">&#x27;小杜杜&#x27;</span>)) <span class=\"comment\">// &quot;你的名字叫小杜杜&quot; </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 重载</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person1</span>&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setNameAge</span>(<span class=\"attr\">name</span>: <span class=\"built_in\">string</span>):<span class=\"built_in\">void</span>;</span><br><span class=\"line\">  <span class=\"title function_\">setNameAge</span>(<span class=\"attr\">name</span>: <span class=\"built_in\">number</span>):<span class=\"built_in\">void</span>;</span><br><span class=\"line\">  <span class=\"title function_\">setNameAge</span>(<span class=\"params\">name:<span class=\"built_in\">string</span> | <span class=\"built_in\">number</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> name === <span class=\"string\">&#x27;string&#x27;</span>)&#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是<span class=\"subst\">$&#123;name&#125;</span>`</span>)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的年龄是<span class=\"subst\">$&#123;name&#125;</span>`</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"keyword\">new</span> <span class=\"title class_\">Person1</span>()</span><br><span class=\"line\">res.<span class=\"title function_\">setNameAge</span>(<span class=\"string\">&#x27;小杜杜&#x27;</span>) <span class=\"comment\">// &quot;我的名字是小杜杜&quot; </span></span><br><span class=\"line\">res.<span class=\"title function_\">setNameAge</span>(<span class=\"number\">7</span>) <span class=\"comment\">// &quot;我的年龄是7&quot;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n<h2 id=\"TS断言和类型守卫\"><a href=\"#TS断言和类型守卫\" class=\"headerlink\" title=\"TS断言和类型守卫\"></a>TS断言和类型守卫</h2><h3 id=\"TS断言\"><a href=\"#TS断言\" class=\"headerlink\" title=\"TS断言\"></a>TS断言</h3><p>分为三种：<code>类型断言</code>、<code>非空断言</code>、<code>确定赋值断言</code></p>\n<p>当断言失效后，可能使用到：<strong>双重断言</strong></p>\n<h4 id=\"类型断言\"><a href=\"#类型断言\" class=\"headerlink\" title=\"类型断言\"></a>类型断言</h4><p>在特定的环境中，我们会比TS知道这个值具体是什么类型，不需要TS去判断，简单的理解就是，<strong>类型断言会告诉编译器，你不用给我进行检查，相信我，他就是这个类型</strong></p>\n<p>共有两种方式：</p>\n<ul>\n<li><strong>尖括号</strong></li>\n<li><strong>as</strong>：推荐</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//尖括号</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">num</span>:<span class=\"built_in\">any</span> = <span class=\"string\">&#x27;小杜杜&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">res1</span>: <span class=\"built_in\">number</span> = (&lt;<span class=\"built_in\">string</span>&gt;num).<span class=\"property\">length</span>; <span class=\"comment\">// React中会 error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// as 语法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">str</span>: <span class=\"built_in\">any</span> = <span class=\"string\">&#x27;Domesy&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">res</span>: <span class=\"built_in\">number</span> = (str <span class=\"keyword\">as</span> <span class=\"built_in\">string</span>).<span class=\"property\">length</span>;</span><br></pre></td></tr></table></figure>\n\n<p>但需要注意的是：尖括号语法在React中会报错，原因是与JSX语法会产生冲突，所以只能使用as语法。</p>\n<h4 id=\"非空断言\"><a href=\"#非空断言\" class=\"headerlink\" title=\"非空断言\"></a>非空断言</h4><p>在上下文中当类型检查器无法断定类型时，一个新的后缀表达式操作符 <code>!</code> 可以用于断言操作对象是<strong>非 null 和非 undefined 类型。</strong></p>\n<p><img src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fa80b9ac2a54614a129c5724678254a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<p>我们可以看出来 !可以帮助我们过滤 null和 undefined类型，也就是说，编译器会默认我们只会传来string类型的数据，所以可以赋值为str1。</p>\n<p>但变成ES5后 !会被移除，所以当传入 null 的时候，还是会打出 null。</p>\n<h4 id=\"确定赋值断言\"><a href=\"#确定赋值断言\" class=\"headerlink\" title=\"确定赋值断言\"></a>确定赋值断言</h4><p>在TS 2.7版本中引入了确定赋值断言，即允许在实例属性和变量声明后面放置一个 ! 号，以告诉TS该属性会被明确赋值。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">num</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> num1!: <span class=\"built_in\">number</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setNumber</span> = (<span class=\"params\"></span>) =&gt; num = <span class=\"number\">7</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setNumber1</span> = (<span class=\"params\"></span>) =&gt; num1 = <span class=\"number\">7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setNumber</span>()</span><br><span class=\"line\"><span class=\"title function_\">setNumber1</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(num) <span class=\"comment\">// error </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(num1) <span class=\"comment\">// ok</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"双重断言\"><a href=\"#双重断言\" class=\"headerlink\" title=\"双重断言\"></a>双重断言</h4><p>断言失效后，可能会用到，但一般情况下不会使用。</p>\n<p>失效的情况：基础类型不能断言为接口。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Info</span>&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">  <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">&#x27;小杜杜&#x27;</span> <span class=\"keyword\">as</span> <span class=\"title class_\">Info</span>; <span class=\"comment\">// error, 原因是不能把 string 类型断言为 一个接口</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> name1 = <span class=\"string\">&#x27;小杜杜&#x27;</span> <span class=\"keyword\">as</span> <span class=\"built_in\">any</span> <span class=\"keyword\">as</span> <span class=\"title class_\">Info</span>; <span class=\"comment\">//ok</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"类型守卫\"><a href=\"#类型守卫\" class=\"headerlink\" title=\"类型守卫\"></a>类型守卫</h3><p><strong>类型守卫</strong>：是<strong>可执行运行时检查的</strong>一种表达式，用于确保<strong>该类型在一定的范围内</strong>。</p>\n<p>个人的感觉是，类型守卫就是你可以设置多种类型，但我默认你是什么类型的意思</p>\n<p>目前，常有的类型守卫共有4种：<strong>in关键字</strong>、<strong>typeof关键字</strong>、<strong>instanceof</strong>和<strong>类型谓词（is)</strong></p>\n<h4 id=\"in关键字\"><a href=\"#in关键字\" class=\"headerlink\" title=\"in关键字\"></a>in关键字</h4><p>用于判断这个属性是哪个里面的</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Info</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Info1</span>&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">flage</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo</span> = (<span class=\"params\">data: Info | Info1</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"string\">&quot;age&quot;</span> <span class=\"keyword\">in</span> data)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是：<span class=\"subst\">$&#123;data.name&#125;</span>，年龄是：<span class=\"subst\">$&#123;data.age&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">if</span>(<span class=\"string\">&quot;flage&quot;</span> <span class=\"keyword\">in</span> data)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是：<span class=\"subst\">$&#123;data.name&#125;</span>，性别是：<span class=\"subst\">$&#123;data.flage&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(&#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>, <span class=\"attr\">age</span>: <span class=\"number\">7</span>&#125;) <span class=\"comment\">// &quot;我的名字是：小杜杜，年龄是：7&quot; </span></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(&#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>, <span class=\"attr\">flage</span>: <span class=\"literal\">true</span>&#125;) <span class=\"comment\">// &quot;我的名字是：小杜杜，性别是：true&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"typeof关键字\"><a href=\"#typeof关键字\" class=\"headerlink\" title=\"typeof关键字\"></a>typeof关键字</h4><p>用于判断基本类型，如string ｜ number等。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo</span> = (<span class=\"params\">data: <span class=\"built_in\">number</span> | <span class=\"built_in\">string</span> | <span class=\"literal\">undefined</span></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> data === <span class=\"string\">&quot;string&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是：<span class=\"subst\">$&#123;data&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> data === <span class=\"string\">&quot;number&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的年龄是：<span class=\"subst\">$&#123;data&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> data === <span class=\"string\">&quot;undefined&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"string\">&#x27;小杜杜&#x27;</span>) <span class=\"comment\">// &quot;我的名字是：小杜杜&quot;  </span></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"number\">7</span>) <span class=\"comment\">// &quot;我的年龄是：7&quot; </span></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"literal\">undefined</span>) <span class=\"comment\">// undefined&quot; </span></span><br></pre></td></tr></table></figure>\n<h4 id=\"instanceof关键字\"><a href=\"#instanceof关键字\" class=\"headerlink\" title=\"instanceof关键字\"></a>instanceof关键字</h4><p>用于判断一个实例是不是构造函数，或使用类的时候</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span> = <span class=\"string\">&#x27;小杜杜&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Age</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Name</span>&#123;</span><br><span class=\"line\">  <span class=\"attr\">age</span>: <span class=\"built_in\">number</span> = <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo</span> = (<span class=\"params\">data: Name</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (data <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Age</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的年龄是<span class=\"subst\">$&#123;data.age&#125;</span>`</span>);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是<span class=\"subst\">$&#123;data.name&#125;</span>`</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Name</span>()) <span class=\"comment\">// &quot;我的名字是小杜杜&quot;</span></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Age</span>()) <span class=\"comment\">// &quot;我的年龄是7&quot; </span></span><br></pre></td></tr></table></figure>\n<h4 id=\"类型谓词（is\"><a href=\"#类型谓词（is\" class=\"headerlink\" title=\"类型谓词（is)\"></a>类型谓词（is)</h4><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">isNumber</span>(<span class=\"params\">x: <span class=\"built_in\">any</span></span>): x is <span class=\"built_in\">number</span> &#123; <span class=\"comment\">//默认传入的是number类型</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">typeof</span> x === <span class=\"string\">&quot;number&quot;</span>; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">isNumber</span>(<span class=\"number\">7</span>)) <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">isNumber</span>(<span class=\"string\">&#x27;7&#x27;</span>)) <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">isNumber</span>(<span class=\"literal\">true</span>)) <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"两者的区别\"><a href=\"#两者的区别\" class=\"headerlink\" title=\"两者的区别\"></a>两者的区别</h3><p>通过上面的介绍，我们可以发现<code>断言</code>与<code>类型守卫</code>的概念非常相似，都是确定参数的类型，但<code>断言</code>更加<strong>霸道</strong>，它是直接告诉编辑器，这个参数就是这个类型，而类型守卫更像确定这个参数具体是什么类型。</p>\n<h2 id=\"类型别名、接口\"><a href=\"#类型别名、接口\" class=\"headerlink\" title=\"类型别名、接口\"></a>类型别名、接口</h2><h3 id=\"类型别名（type）\"><a href=\"#类型别名（type）\" class=\"headerlink\" title=\"类型别名（type）\"></a>类型别名（type）</h3><p>类型别名：也就是type，用来给一个类型起个新名字。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">InfoProps</span> = <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo</span> = (<span class=\"params\">data: InfoProps</span>) =&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"接口（interface）\"><a href=\"#接口（interface）\" class=\"headerlink\" title=\"接口（interface）\"></a>接口（interface）</h3><p>接口：在面向对象语言中表示行为抽象，也可以用来描述对象的形状。</p>\n<p>使用interface关键字来定义接口：</p>\n<h4 id=\"对象的形状\"><a href=\"#对象的形状\" class=\"headerlink\" title=\"对象的形状\"></a>对象的形状</h4><p>接口可以用来描述对象，主要可以包括以下数据：可读属性、只读属性、任意属性</p>\n<ul>\n<li><strong>可读属性</strong>：当我们定义一个接口时，我们的属性可能不需要全都要，这是就需要 <strong>?</strong> 来解决</li>\n<li><strong>只读属性</strong>：用 <strong>readonly</strong>修饰的属性为只读属性，意思是指允许定义，不允许之后进行更改</li>\n<li><strong>任意属性</strong>：这个属性极为重要，它是可以用作就算没有定义，也可以使用，比如 <strong>[data: string]: any</strong>。比如说我们对组件进行封装，而封装的那个组件并没有导出对应的类型，然而又想让他不报错，这时就可以使用任意属性</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">    <span class=\"attr\">c</span>: <span class=\"built_in\">boolean</span>;</span><br><span class=\"line\">    d?: <span class=\"built_in\">number</span>; <span class=\"comment\">// 可选属性</span></span><br><span class=\"line\">    <span class=\"keyword\">readonly</span> <span class=\"attr\">e</span>: <span class=\"built_in\">string</span>; <span class=\"comment\">//只读属性</span></span><br><span class=\"line\">    [<span class=\"attr\">f</span>: <span class=\"built_in\">string</span>]: <span class=\"built_in\">any</span> <span class=\"comment\">//任意属性</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">res</span>: <span class=\"title class_\">Props</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">    <span class=\"attr\">c</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">e</span>: <span class=\"string\">&#x27;Domesy&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">d</span>: <span class=\"number\">1</span>, <span class=\"comment\">// 有没有d都可以</span></span><br><span class=\"line\">    <span class=\"attr\">h</span>: <span class=\"number\">2</span> <span class=\"comment\">// 任意属性，之前为定义过h</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> res.<span class=\"property\">e</span> = <span class=\"string\">&#x27;hi&#x27;</span> <span class=\"comment\">// error, 原因是可读属性不允许更改</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h4><p>继承：与类一样，接口也存在继承属性，也是使用 <strong>extends</strong> 字段</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> nameProps &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> <span class=\"keyword\">extends</span> nameProps&#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res</span>: <span class=\"title class_\">Props</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"函数类型接口\"><a href=\"#函数类型接口\" class=\"headerlink\" title=\"函数类型接口\"></a>函数类型接口</h4><p>同时，可以定义函数和类，<strong>加new修饰的是类，不加new的是函数</strong></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    (<span class=\"attr\">data</span>: <span class=\"built_in\">number</span>): <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info</span>: <span class=\"title class_\">Props</span> = <span class=\"function\">(<span class=\"params\"><span class=\"built_in\">number</span>:<span class=\"built_in\">number</span></span>) =&gt;</span> <span class=\"built_in\">number</span>  <span class=\"comment\">//可定义函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义函数</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">A</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>:<span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">PropsClass</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">new</span> (<span class=\"attr\">name</span>: <span class=\"built_in\">string</span>): A</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">info1</span> = (<span class=\"params\">fun: PropsClass, name: <span class=\"built_in\">string</span></span>) =&gt; <span class=\"keyword\">new</span> <span class=\"title function_\">fun</span>(name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"title function_\">info1</span>(A, <span class=\"string\">&quot;小杜杜&quot;</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">name</span>) <span class=\"comment\">// &quot;小杜杜&quot; </span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"type-和-interface-的区别\"><a href=\"#type-和-interface-的区别\" class=\"headerlink\" title=\"type 和 interface 的区别\"></a>type 和 interface 的区别</h3><p>类型别名和接口非常相似，可以说在大多数情况下，type与interface是等价的。</p>\n<p>但在一些特定的场景差距还是比较大的，接下来逐个来看看：</p>\n<h4 id=\"基础数据类型\"><a href=\"#基础数据类型\" class=\"headerlink\" title=\"基础数据类型\"></a>基础数据类型</h4><ul>\n<li>type 和 interface 都可以定义 对象 和 函数</li>\n<li>type 可以定义其他数据类型，如字符串、数字、元祖、联合类型等，而 interface不行</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> A = <span class=\"built_in\">string</span> <span class=\"comment\">// 基本类型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> B = <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span> <span class=\"comment\">// 联合类型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> C = [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] <span class=\"comment\">// 元祖</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> dom = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);  <span class=\"comment\">// dom元素</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> D = <span class=\"keyword\">typeof</span> dom</span><br></pre></td></tr></table></figure>\n<h4 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h4><p>interface 可以扩展 type，type 也可以扩展为 interface，但两者实现扩展的方式不同。</p>\n<ul>\n<li>interface 是通过 <strong>extends</strong> 来实现</li>\n<li>type 是通过 <strong>&amp;</strong> 来实现</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// interface 扩展 interface</span></span><br><span class=\"line\"><span class=\"keyword\">interface</span> A &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> B <span class=\"keyword\">extends</span>  A &#123;</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">obj</span>:B = &#123; <span class=\"attr\">a</span>: <span class=\"string\">`小杜杜`</span>, <span class=\"attr\">b</span>: <span class=\"number\">7</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// type 扩展 type</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> C = &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> D = C &amp; &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">obj1</span>:D = &#123; <span class=\"attr\">a</span>: <span class=\"string\">`小杜杜`</span>, <span class=\"attr\">b</span>: <span class=\"number\">7</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// interface 扩展为 Type</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> E = &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> F <span class=\"keyword\">extends</span> E &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">obj2</span>:F = &#123; <span class=\"attr\">a</span>: <span class=\"string\">`小杜杜`</span>, <span class=\"attr\">b</span>: <span class=\"number\">7</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// type 扩展为 interface</span></span><br><span class=\"line\"><span class=\"keyword\">interface</span> G &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> H = G &amp; &#123;<span class=\"attr\">b</span>: <span class=\"built_in\">number</span>&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">obj3</span>:H = &#123; <span class=\"attr\">a</span>: <span class=\"string\">`小杜杜`</span>, <span class=\"attr\">b</span>: <span class=\"number\">7</span> &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"重复定义\"><a href=\"#重复定义\" class=\"headerlink\" title=\"重复定义\"></a>重复定义</h4><p>interface 可以多次被定义，并且会进行合并，但type不行</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> A &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> A &#123;</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">obj</span>:A = &#123; <span class=\"attr\">a</span>: <span class=\"string\">`小杜杜`</span>, <span class=\"attr\">b</span>: <span class=\"number\">7</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> B = &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> B = &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125; <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n<h2 id=\"联合类型-Union-Types\"><a href=\"#联合类型-Union-Types\" class=\"headerlink\" title=\"联合类型(Union Types)\"></a>联合类型(Union Types)</h2><p>联合类型(Union Types): 表示取值可以为多种类型中的一种，未赋值时联合类型上只能访问两个类型共有的属性和方法，如：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo</span> = (<span class=\"params\">name: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span></span>) =&gt; &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"string\">&#x27;小杜杜&#x27;</span>)</span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"number\">7</span>)</span><br></pre></td></tr></table></figure>\n<p>从上面看 setInfo接收一个name，而 name 可以接收 string或number类型，那么这个参数便是联合类型。</p>\n<h3 id=\"可辨识联合\"><a href=\"#可辨识联合\" class=\"headerlink\" title=\"可辨识联合\"></a>可辨识联合</h3><p>可辨识联合：包含三个特点，分别是可辨识、联合类型、类型守卫,</p>\n<p>这种类型的本质是：结合<strong>联合类型</strong>和<strong>字面量类型</strong>的一种类型保护方法。</p>\n<p>如果一个类型是多个类型的联合类型，且多个类型含有一个公共属性，那么就可以利用这个公共属性，来创建不同的类型保护区块。</p>\n<p>也就是上面一起结合使用，这里写个小例子：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> A &#123;</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> B &#123;</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> C &#123;</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">  <span class=\"attr\">sex</span>: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// const setInfo = (data: A | B | C) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   return data.type // ok 原因是 A 、B、C 都有 type属性</span></span><br><span class=\"line\"><span class=\"comment\">//   return data.age // error，  原因是没有判断具体是哪个类型，不能确定是A，还是B，或者是C</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo1</span> = (<span class=\"params\">data: A | B | C</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (data.<span class=\"property\">type</span> === <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是<span class=\"subst\">$&#123;data.name&#125;</span>`</span>);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.<span class=\"property\">type</span> === <span class=\"number\">2</span> )&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的年龄是<span class=\"subst\">$&#123;data.age&#125;</span>`</span>);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.<span class=\"property\">type</span> === <span class=\"number\">3</span> )&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的性别是<span class=\"subst\">$&#123;data.sex&#125;</span>`</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setInfo1</span>(&#123;<span class=\"attr\">type</span>: <span class=\"number\">1</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>&#125;) <span class=\"comment\">// &quot;我的名字是小杜杜&quot;</span></span><br><span class=\"line\"><span class=\"title function_\">setInfo1</span>(&#123;<span class=\"attr\">type</span>: <span class=\"number\">2</span>, <span class=\"attr\">age</span>: <span class=\"number\">7</span>&#125;) <span class=\"comment\">// &quot;我的年龄是7&quot; </span></span><br><span class=\"line\"><span class=\"title function_\">setInfo1</span>(&#123;<span class=\"attr\">type</span>: <span class=\"number\">3</span>, <span class=\"attr\">sex</span>: <span class=\"literal\">true</span>&#125;) <span class=\"comment\">// &quot;我的性别是true&quot; </span></span><br></pre></td></tr></table></figure>\n<p>定义了 A、B、C 三次接口，但这三个接口都包含type属性，那么type就是可辨识的属性,而其他属性只跟特性的接口相关。</p>\n<p>然后通过可辨识属性type，才能使用其相关的属性。</p>\n<h2 id=\"泛型\"><a href=\"#泛型\" class=\"headerlink\" title=\"泛型\"></a>泛型</h2><p>泛型：Generics，是指在定义函数、接口或类的时候，不预先指定具体的类型，而在使用的时候再指定类型的一种特性。</p>\n<p>也就是说，泛型是<strong>允许同一个函数接受不同类型参数的一种模版</strong>，与<code>any</code>相比，使用泛型来创建可服用的组件要更好，因为<strong>泛型会保留参数类型</strong>（PS：泛型是整个TS的重点，也是难点，请多多注意～）</p>\n<h3 id=\"为什么需要泛型\"><a href=\"#为什么需要泛型\" class=\"headerlink\" title=\"为什么需要泛型\"></a>为什么需要泛型</h3><p>我们先看看一个例子：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> calcArray = (<span class=\"attr\">data</span>:<span class=\"built_in\">any</span>):<span class=\"built_in\">any</span>[] =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> list = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++)&#123;</span><br><span class=\"line\">        list.<span class=\"title function_\">push</span>(data)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> list</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">calcArray</span>(<span class=\"string\">&#x27;d&#x27;</span>)) <span class=\"comment\">// [&quot;d&quot;, &quot;d&quot;, &quot;d&quot;]</span></span><br></pre></td></tr></table></figure>\n<p>上述的例子我们发现，在calcArray中传任何类型的参数，返回的数组都是any类型。</p>\n<p>由于我们不知道传入的数据是什么，所以返回的数据也为any的数组。</p>\n<p>但我们现在想要的效果是：<strong>无论我们传什么类型，都能返回对应的类型</strong>，针对这种情况怎么办？所以此时 <code>泛型</code> 就登场了。</p>\n<h3 id=\"泛型语法\"><a href=\"#泛型语法\" class=\"headerlink\" title=\"泛型语法\"></a>泛型语法</h3><p>我们先用泛型对上面的例子进行改造下，</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> calcArray = &lt;T,&gt;(<span class=\"attr\">data</span>:T):T[] =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">list</span>:T[] = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++)&#123;</span><br><span class=\"line\">        list.<span class=\"title function_\">push</span>(data)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> list</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res</span>:<span class=\"built_in\">string</span>[] = calcArray&lt;<span class=\"built_in\">string</span>&gt;(<span class=\"string\">&#x27;d&#x27;</span>) <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res1</span>:<span class=\"built_in\">number</span>[] = calcArray&lt;<span class=\"built_in\">number</span>&gt;(<span class=\"number\">7</span>) <span class=\"comment\">// ok</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res3</span>: <span class=\"title class_\">Props</span>[] = calcArray&lt;<span class=\"title class_\">Props</span>&gt;(&#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>, <span class=\"attr\">age</span>: <span class=\"number\">7</span>&#125;) <span class=\"comment\">//ok</span></span><br></pre></td></tr></table></figure>\n<p>经过上面的案例，我们发现传入的字符串、数字、对象，都能返回对应的类型，从而达到我们的目的，接下来我们再看看泛型语法：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> identity &lt;T&gt;(<span class=\"attr\">value</span>:T) : T &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>第一次看到这个 <code>&lt;T&gt;</code> 我们是不是很懵，实际上这个T就是传递的类型,从上述的例子来看，这个 <code>&lt;T&gt;</code> 就是 <code>&lt;string&gt;</code> ，要注意一点，这个 <code>&lt;string&gt;</code> 实际上是可以省略的，因为 TS 具有类型推论，可以自己推断类型。</p>\n<h3 id=\"多类型传参\"><a href=\"#多类型传参\" class=\"headerlink\" title=\"多类型传参\"></a>多类型传参</h3><p>我们有多个未知的类型占位，我们可以定义任何的字母来表示不同的参数类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> calcArray = &lt;T,U&gt;(<span class=\"attr\">name</span>:T, <span class=\"attr\">age</span>:U): &#123;<span class=\"attr\">name</span>:T, <span class=\"attr\">age</span>:U&#125; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"attr\">res</span>: &#123;<span class=\"attr\">name</span>:T, <span class=\"attr\">age</span>:U&#125; = &#123;name, age&#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = calcArray&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">number</span>&gt;(<span class=\"string\">&#x27;小杜杜&#x27;</span>, <span class=\"number\">7</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res) <span class=\"comment\">// &#123;&quot;name&quot;: &quot;小杜杜&quot;, &quot;age&quot;: 7&#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"泛型接口\"><a href=\"#泛型接口\" class=\"headerlink\" title=\"泛型接口\"></a>泛型接口</h3><p>定义接口的时候，我们也可以使用泛型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> A&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"attr\">data</span>: T</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Info</span>: A&lt;<span class=\"built_in\">string</span>&gt; = &#123;<span class=\"attr\">data</span>: <span class=\"string\">&#x27;1&#x27;</span>&#125;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>.<span class=\"property\">data</span>) <span class=\"comment\">// &quot;1&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"泛型类\"><a href=\"#泛型类\" class=\"headerlink\" title=\"泛型类\"></a>泛型类</h3><p>同样泛型也可以定义类</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">clacArray</span>&lt;T&gt;&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"attr\">arr</span>: T[] = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">add</span>(<span class=\"params\">value: T</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">arr</span>.<span class=\"title function_\">push</span>(value)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">getValue</span>(): T &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> res = <span class=\"variable language_\">this</span>.<span class=\"property\">arr</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">arr</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"keyword\">new</span> <span class=\"title function_\">clacArray</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">res.<span class=\"title function_\">add</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">res.<span class=\"title function_\">add</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\">res.<span class=\"title function_\">add</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">res.<span class=\"title function_\">getValue</span>() <span class=\"comment\">//[1, 2, 3] </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">getValue</span>) <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"泛型类型别名\"><a href=\"#泛型类型别名\" class=\"headerlink\" title=\"泛型类型别名\"></a>泛型类型别名</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Info</span>&lt;T&gt; = &#123;</span><br><span class=\"line\">    name?: T</span><br><span class=\"line\">    age?: T</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res</span>:<span class=\"title class_\">Info</span>&lt;<span class=\"built_in\">string</span>&gt; = &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res1</span>:<span class=\"title class_\">Info</span>&lt;<span class=\"built_in\">number</span>&gt; = &#123; <span class=\"attr\">age</span>: <span class=\"number\">7</span>&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"泛型默认参数\"><a href=\"#泛型默认参数\" class=\"headerlink\" title=\"泛型默认参数\"></a>泛型默认参数</h3><p>所谓默认参数，是指定类型，如默认值一样，从实际值参数中也无法推断出类型时，这个默认类型就会起作用。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> calcArray = &lt;T = <span class=\"built_in\">string</span>,&gt;(<span class=\"attr\">data</span>:T):T[] =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">list</span>:T[] = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++)&#123;</span><br><span class=\"line\">        list.<span class=\"title function_\">push</span>(data)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> list</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"泛型常用字母\"><a href=\"#泛型常用字母\" class=\"headerlink\" title=\"泛型常用字母\"></a>泛型常用字母</h3><p>用常用的字母来表示一些变量的代表：</p>\n<ul>\n<li><strong>T</strong>：代表 <strong>Type</strong>，定义泛型时通常用作第一个类型变量名称</li>\n<li><strong>K</strong>：代表 <strong>Key</strong>，表示对象中的<strong>键类型</strong>；</li>\n<li><strong>V</strong>：代表 <strong>Value</strong>，表示对象中的<strong>值类型</strong>；</li>\n<li><strong>E</strong>：代表 <strong>Element</strong>，表示的<strong>元素类型</strong>；</li>\n</ul>\n<h2 id=\"常用技巧\"><a href=\"#常用技巧\" class=\"headerlink\" title=\"常用技巧\"></a>常用技巧</h2><p>在 TS 中有许多关键字和工具类型，在使用上，需要注意<strong>泛型</strong>上的应用，有的时候结合起来可能就有一定的问题。</p>\n<p>在此特别需要注意 <code>extends</code>、<code>typeof</code>、<code>Partial</code>、<code>Record</code>、<code>Exclude</code>、<code>Omit</code>这几个工具类型。</p>\n<h3 id=\"extends\"><a href=\"#extends\" class=\"headerlink\" title=\"extends\"></a>extends</h3><p>extends：检验是否拥有其属性 在这里，举个例子，我们知道字符串和数组拥有length属性，但number没有这个属性。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> calcArray = &lt;T,&gt;(<span class=\"attr\">data</span>:T): <span class=\"function\"><span class=\"params\">number</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> data.<span class=\"property\">length</span> <span class=\"comment\">// error </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上述的 calcArray的作用只是获取data的数量,但此时在TS中会报错，这是因为TS不确定传来的属性是否具备length这个属性，毕竟每个属性都不可能完全相同。</p>\n<p>那么这时该怎么解决呢？</p>\n<p>我们已经确定，要拿到传过来数据的 length，也就是说传过来的属性必须具备length这个属性，如果没有，则不让他调用这个方法。</p>\n<p>换句话说，calcArray需要具备检验属性的功能，对于上述例子就是检验是否有length的功能，这是我们就需要extends这个属性帮我们去鉴定：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">length</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> calcArray = &lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">Props</span>,&gt;(<span class=\"attr\">data</span>:T): <span class=\"function\"><span class=\"params\">number</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> data.<span class=\"property\">length</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">calcArray</span>(<span class=\"string\">&#x27;12&#x27;</span>) <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"title function_\">calcArray</span>([<span class=\"number\">1</span>,<span class=\"number\">3</span>]) <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"title function_\">calcArray</span>(<span class=\"number\">2</span>) <span class=\"comment\">//error </span></span><br></pre></td></tr></table></figure>\n<p>可以看出 calcArray(2) 会报错，这是因为number类型并不具备length这个属性</p>\n<h3 id=\"typeof\"><a href=\"#typeof\" class=\"headerlink\" title=\"typeof\"></a>typeof</h3><p>typeof关键字：我们在类型保护的时候讲解了typeof的作用，除此之外，这个关键字还可以实现推出类型，如下图，可以推断中 Props 包含的类型。</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c01f7f01bc449d78530bc5e38ee2a5a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h3 id=\"keyof\"><a href=\"#keyof\" class=\"headerlink\" title=\"keyof\"></a>keyof</h3><p>keyof关键字: 可以获取一个对象接口的所有key值,可以检查对象上的键是否存在：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">    <span class=\"attr\">sex</span>: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">PropsKey</span> = keyof <span class=\"title class_\">Props</span>; <span class=\"comment\">//包含 name， age， sex</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res</span>:<span class=\"title class_\">PropsKey</span> = <span class=\"string\">&#x27;name&#x27;</span> <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res1</span>:<span class=\"title class_\">PropsKey</span> = <span class=\"string\">&#x27;tel&#x27;</span> <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 泛型中的应用</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> getInfo = &lt;T, K <span class=\"keyword\">extends</span> keyof T&gt;(<span class=\"attr\">data</span>: T, <span class=\"attr\">key</span>: K): T[K] =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> data[key]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> info = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">    <span class=\"attr\">sex</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">getInfo</span>(info, <span class=\"string\">&#x27;name&#x27;</span>); <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"title function_\">getInfo</span>(info, <span class=\"string\">&#x27;tel&#x27;</span>); <span class=\"comment\">//error</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"索引访问操作符\"><a href=\"#索引访问操作符\" class=\"headerlink\" title=\"索引访问操作符\"></a>索引访问操作符</h3><p>索引访问操作符：通过 <code>[]</code> 操作符可进行索引访问,可以访问其中一个属性</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39784ee772554968b70a7274924e2f11~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h3 id=\"in\"><a href=\"#in\" class=\"headerlink\" title=\"in\"></a>in</h3><p>in：映射类型, 用来映射遍历枚举类型</p>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/717b932d27054e7bba535c606b5910a9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h3 id=\"infer\"><a href=\"#infer\" class=\"headerlink\" title=\"infer\"></a>infer</h3><p>infer：可以是使用为条件语句，可以用 infer 声明一个类型变量并且对它进行使用。如</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Info</span>&lt;T&gt; = T <span class=\"keyword\">extends</span> &#123; <span class=\"attr\">a</span>: infer U; <span class=\"attr\">b</span>: infer U &#125; ? U : <span class=\"built_in\">never</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props</span> = <span class=\"title class_\">Info</span>&lt;&#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span>; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125;&gt;; <span class=\"comment\">// Props类： string | number</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props1</span> = <span class=\"title class_\">Info</span>&lt;<span class=\"built_in\">number</span>&gt; <span class=\"comment\">// Props类型： never</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Partial\"><a href=\"#Partial\" class=\"headerlink\" title=\"Partial\"></a>Partial</h3><p>Partial语法：<code>Partial&lt;T&gt;</code> 作用：将所有属性变为可选的 <code>?</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info</span>: <span class=\"title class_\">Props</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info1</span>: <span class=\"title class_\">Partial</span>&lt;<span class=\"title class_\">Props</span>&gt; = &#123; </span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>从上述代码上来看，name 和 age 属于必填，对于 info 来说必须要设置 name 和 age 属性才行，但对于 info1来说，只要是个对象就可以，至于是否有name、 age属性并不重要。</p>\n<h3 id=\"Required\"><a href=\"#Required\" class=\"headerlink\" title=\"Required\"></a>Required</h3><p>Required语法：<code>Required&lt;T&gt;</code> 作用：将所有属性变为必选的，与 Partial相反</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>,</span><br><span class=\"line\">    sex?: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info</span>: <span class=\"title class_\">Props</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info1</span>: <span class=\"title class_\">Required</span>&lt;<span class=\"title class_\">Props</span>&gt; = &#123; </span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">    <span class=\"attr\">sex</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Readonly\"><a href=\"#Readonly\" class=\"headerlink\" title=\"Readonly\"></a>Readonly</h3><p>Readonly语法：<code>Readonly&lt;T&gt;</code> 作用：将所有属性都加上 readonly 修饰符来实现。也就是说无法修改</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">info</span>: <span class=\"title class_\">Readonly</span>&lt;<span class=\"title class_\">Props</span>&gt; = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">info.<span class=\"property\">age</span> = <span class=\"number\">1</span> <span class=\"comment\">//error read-only 只读属性</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Record\"><a href=\"#Record\" class=\"headerlink\" title=\"Record\"></a>Record</h3><p>Record语法：<code>Record&lt;K extends keyof any, T&gt;</code></p>\n<p>作用：将 <code>K</code> 中所有的属性的值转化为 <code>T</code> 类型。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">InfoProps</span> = <span class=\"string\">&#x27;JS&#x27;</span> | <span class=\"string\">&#x27;TS&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Info</span>: <span class=\"title class_\">Record</span>&lt;<span class=\"title class_\">InfoProps</span>, <span class=\"title class_\">Props</span>&gt; = &#123;</span><br><span class=\"line\">    <span class=\"attr\">JS</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">TS</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&#x27;TypeScript&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">age</span>: <span class=\"number\">11</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>从上述代码上来看, InfoProps的属性分别包含Props的属性。</p>\n<p>需要注意的一点是：K extends keyof any其类型可以是:string、number、symbol。</p>\n<h3 id=\"Pick\"><a href=\"#Pick\" class=\"headerlink\" title=\"Pick\"></a>Pick</h3><p>Pick语法：<code>Pick&lt;T, K extends keyof T&gt;</code></p>\n<p>作用：将某个类型中的子属性挑出来，变成包含这个类型部分属性的子类型。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>,</span><br><span class=\"line\">    <span class=\"attr\">sex</span>: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> nameProps = <span class=\"title class_\">Pick</span>&lt;<span class=\"title class_\">Props</span>, <span class=\"string\">&#x27;name&#x27;</span> | <span class=\"string\">&#x27;age&#x27;</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info</span>: nameProps = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>从上述代码上来看, Props原本属性包括name、age、sex三个属性，通过 Pick我们吧name和age挑了出来，所以不需要sex属性。</p>\n<h3 id=\"Exclude\"><a href=\"#Exclude\" class=\"headerlink\" title=\"Exclude\"></a>Exclude</h3><p>Exclude语法：<code>Exclude&lt;T, U&gt;</code></p>\n<p>作用：将T类型中的U类型剔除。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 数字类型</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> numProps = <span class=\"title class_\">Exclude</span>&lt;<span class=\"number\">1</span> | <span class=\"number\">2</span> | <span class=\"number\">3</span>, <span class=\"number\">1</span> | <span class=\"number\">2</span>&gt; <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> numProps1 = <span class=\"title class_\">Exclude</span>&lt;<span class=\"number\">1</span>, <span class=\"number\">1</span> | <span class=\"number\">2</span>&gt; <span class=\"comment\">// nerver</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> numProps2 = <span class=\"title class_\">Exclude</span>&lt;<span class=\"number\">1</span>, <span class=\"number\">1</span>&gt; <span class=\"comment\">// nerver</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> numProps3 = <span class=\"title class_\">Exclude</span>&lt;<span class=\"number\">1</span> | <span class=\"number\">2</span>, <span class=\"number\">7</span>&gt; <span class=\"comment\">// 1 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 字符串类型</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> info = <span class=\"string\">&quot;name&quot;</span> | <span class=\"string\">&quot;age&quot;</span> | <span class=\"string\">&quot;sex&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> info1 = <span class=\"string\">&quot;name&quot;</span> | <span class=\"string\">&quot;age&quot;</span> </span><br><span class=\"line\"><span class=\"keyword\">type</span> infoProps = <span class=\"title class_\">Exclude</span>&lt;info, info1&gt; <span class=\"comment\">//  &quot;sex&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 类型</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> typeProps = <span class=\"title class_\">Exclude</span>&lt;<span class=\"built_in\">string</span> | <span class=\"built_in\">number</span> | (<span class=\"function\">() =&gt;</span> <span class=\"built_in\">void</span>), <span class=\"title class_\">Function</span>&gt; <span class=\"comment\">// string | number</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对象</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> obj = &#123; <span class=\"attr\">name</span>: <span class=\"number\">1</span>, <span class=\"attr\">sex</span>: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> obj1 = &#123; <span class=\"attr\">name</span>: <span class=\"number\">1</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> objProps = <span class=\"title class_\">Exclude</span>&lt;obj, obj1&gt; <span class=\"comment\">// nerver</span></span><br></pre></td></tr></table></figure>\n<p>从上述代码上来看,我们比较了下类型上的，当 T 中有 U 就会剔除对应的属性，如果 U 中又的属性 T 中没有，或 T 和 U 刚好一样的情况都会返回 <strong>nerver</strong>，且对象永远返回<code>nerver</code>。</p>\n<h3 id=\"Extra\"><a href=\"#Extra\" class=\"headerlink\" title=\"Extra\"></a>Extra</h3><p>Extra语法：<code>Extra&lt;T, U&gt;</code></p>\n<p>作用：将 T 可分配给的类型中提取 U。与 <strong>Exclude</strong>相反</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> numProps = <span class=\"title class_\">Extract</span>&lt;<span class=\"number\">1</span> | <span class=\"number\">2</span> | <span class=\"number\">3</span>, <span class=\"number\">1</span> | <span class=\"number\">2</span>&gt; <span class=\"comment\">// 1 | 2</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Omit\"><a href=\"#Omit\" class=\"headerlink\" title=\"Omit\"></a>Omit</h3><p>Omit语法：<code>Omit&lt;T, U&gt;</code></p>\n<p>作用：将已经声明的类型进行属性剔除获得新类型</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7afb178ecc2b4427b82b7a5ebe3ab035~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<p>与 Exclude的区别：Omit 返回的是新的类型，原理上是在 Exclude之上进行的，Exclude是根据自类型返回的。</p>\n<h3 id=\"NonNullable\"><a href=\"#NonNullable\" class=\"headerlink\" title=\"NonNullable\"></a>NonNullable</h3><p>NonNullable语法：<code>NonNullable&lt;T&gt;</code> 作用：从 T 中排除 null 和 undefined</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/825ae5b2e0704d4aba9b143fdf6c6835~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h3 id=\"ReturnType\"><a href=\"#ReturnType\" class=\"headerlink\" title=\"ReturnType\"></a>ReturnType</h3><p>ReturnType语法：<code>ReturnType&lt;T&gt;</code></p>\n<p>作用：用于获取 <strong>函数T的返回类型。</strong></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props</span> = <span class=\"title class_\">ReturnType</span>&lt;<span class=\"function\">() =&gt;</span> <span class=\"built_in\">string</span>&gt; <span class=\"comment\">// string</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props1</span> = <span class=\"title class_\">ReturnType</span>&lt;&lt;T <span class=\"keyword\">extends</span> U, U <span class=\"keyword\">extends</span> <span class=\"built_in\">number</span>&gt;<span class=\"function\">() =&gt;</span> T&gt;; <span class=\"comment\">// number</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props2</span> = <span class=\"title class_\">ReturnType</span>&lt;<span class=\"built_in\">any</span>&gt;; <span class=\"comment\">// any</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props3</span> = <span class=\"title class_\">ReturnType</span>&lt;<span class=\"built_in\">never</span>&gt;; <span class=\"comment\">// any</span></span><br></pre></td></tr></table></figure>\n<p>从上述代码上来看， ReturnType可以接受 any 和 never 类型，原因是这两个类型属于顶级类型，包含函数。</p>\n<h3 id=\"Parameters\"><a href=\"#Parameters\" class=\"headerlink\" title=\"Parameters\"></a>Parameters</h3><p>Parameters：<code>Parameters&lt;T&gt;</code> </p>\n<p>作用：用于获取 获取函数类型的参数类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props</span> = <span class=\"title class_\">Parameters</span>&lt;<span class=\"function\">() =&gt;</span> <span class=\"built_in\">string</span>&gt; <span class=\"comment\">// []</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props1</span> = <span class=\"title class_\">Parameters</span>&lt;<span class=\"function\">(<span class=\"params\">data: <span class=\"built_in\">string</span></span>) =&gt;</span> <span class=\"built_in\">void</span>&gt; <span class=\"comment\">// [string]</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props2</span> = <span class=\"title class_\">Parameters</span>&lt;<span class=\"built_in\">any</span>&gt;; <span class=\"comment\">// unknown[]</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props3</span> = <span class=\"title class_\">Parameters</span>&lt;<span class=\"built_in\">never</span>&gt;; <span class=\"comment\">// never</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n<h2 id=\"拓展\"><a href=\"#拓展\" class=\"headerlink\" title=\"拓展\"></a>拓展</h2><ul>\n<li><a href=\"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-0.html\">TypeScript 4.0 文档</a></li>\n<li><a href=\"https://jkchao.github.io/typescript-book-chinese/project/namespaces.html\">深入理解 TypeScript </a></li>\n<li><a href=\"https://juejin.cn/post/6872111128135073806\">一份不可多得的 TS 学习指南（1.8W字）</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"TS-是什么-？\"><a href=\"#TS-是什么-？\" class=\"headerlink\" title=\"TS 是什么 ？\"></a>TS 是什么 ？</h2><p><strong>TS</strong>：是 <strong>TypeScript</strong> 的简称，是一种由微软开发的自由和开源的编程语言。</p>\n<p><strong>TS和JS的关系</strong></p>\n<p>对比于JS，TS是JS的 <strong>超集</strong>，简单的说就是在 JavaScript 的基础上加入了 <strong>类型系统</strong>，让每个参数都有明确的意义，从而带来了更加 <strong>智能</strong> 的提示。</p>\n<p>相对于JS而言，TS属于 <strong>强类型</strong> 语言，所以对于项目而言，会使代码更加规范，从而解决了大型项目代码的复杂性，其次，浏览器是不识别TS的，所以在编译的时候，TS文件会先编译为JS文件。</p>\n<p><strong>安装TS</strong></p>\n<p>执行命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g typescript </span><br><span class=\"line\">// 或</span><br><span class=\"line\">yarn global add typescript</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看版本</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tsc -v</span><br></pre></td></tr></table></figure>\n\n<p><strong>编译</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tsc test.ts</span><br><span class=\"line\"><span class=\"comment\"># test.ts =&gt; test.js</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>在线编译</strong></p>\n<p>我们为了方便起见，可以使用线上的编辑器：<a href=\"https://www.typescriptlang.org/zh/play\">TypeScript Playground</a></p>\n<p>并且你还可以看看生成对应的<code>ts</code>转化<code>ES5</code>，<code>ES6</code>之后的代码，也有相关的例子供你查看</p>\n<h2 id=\"TS数据类型\"><a href=\"#TS数据类型\" class=\"headerlink\" title=\"TS数据类型\"></a>TS数据类型</h2><p>这里将TS的数据类型简单的进行下归类：</p>\n<ul>\n<li>基本类型：string、number、boolean、symbol、bigint、null、undefined</li>\n<li>引用类型：array、 Tuple(元组)、 object(包含Object和{})、function</li>\n<li>特殊类型：any、unknow、void、never、Enum(枚举)</li>\n<li>其他类型：类型推理、字面量类型、交叉类型</li>\n</ul>\n<p>注：案例中有可能用到type和interface，在下面会详细讲解，有比较模糊的可以先看看</p>\n<h3 id=\"基本类型\"><a href=\"#基本类型\" class=\"headerlink\" title=\"基本类型\"></a>基本类型</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//字符串</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">str</span>: <span class=\"built_in\">string</span> = <span class=\"string\">&quot;Domesy&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 数字</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">num</span>: <span class=\"built_in\">number</span> = <span class=\"number\">7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//布尔</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">bool</span>: <span class=\"built_in\">boolean</span> = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//symbol</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">sym</span>: <span class=\"built_in\">symbol</span> = <span class=\"title class_\">Symbol</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//bigint</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">big</span>: <span class=\"built_in\">bigint</span> = <span class=\"number\">10n</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//null</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">nu</span>: <span class=\"literal\">null</span> = <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">un</span>: <span class=\"literal\">undefined</span> = <span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>需要注意：</p>\n<ul>\n<li>null 和 undefined 两个类型一旦赋值上，就不能在赋值给任何其他类型</li>\n<li>symbol是独一无二的，假设再定义一个 sym1，那么 <code>sym === sym1</code> 为 false</li>\n</ul>\n<h3 id=\"引用类型\"><a href=\"#引用类型\" class=\"headerlink\" title=\"引用类型\"></a>引用类型</h3><h4 id=\"Array\"><a href=\"#Array\" class=\"headerlink\" title=\"Array\"></a>Array</h4><p>两种方式：</p>\n<ul>\n<li>类型名称 + []</li>\n<li>Array&lt;数据类型&gt;</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">arr1</span>: <span class=\"built_in\">number</span>[] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">arr2</span>: <span class=\"title class_\">Array</span>&lt;<span class=\"built_in\">number</span>&gt; = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">arr2</span>: <span class=\"title class_\">Array</span>&lt;<span class=\"built_in\">number</span>&gt; = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;3&#x27;</span>] <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//要想是数字类型或字符串类型，需要使用 ｜</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">arr3</span>: <span class=\"title class_\">Array</span>&lt;<span class=\"built_in\">number</span> | <span class=\"built_in\">string</span>&gt; = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;3&#x27;</span>] <span class=\"comment\">//ok</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Tuple-元组\"><a href=\"#Tuple-元组\" class=\"headerlink\" title=\"Tuple(元组)\"></a>Tuple(元组)</h4><p>Tuple 可以说是 Array 的一种特殊情况,针对上面的 arr3,我们看他的类型可以是string也可以是number，但对每个元素没有作出具体的限制。</p>\n<p>那么 Tuple 的作用就是限制元素的类型并且限制个数的数组,同时 Tuple这个概念值存在于TS，在JS上是不存在的<br>这里存在一个问题：在TS中,是允许对 Tuple 扩增的（也就是允许使用 push方法），但在访问上不允许</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">t</span>: [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] = [<span class=\"number\">1</span>, <span class=\"string\">&#x27;2&#x27;</span>] <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">t1</span>: [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] = [<span class=\"number\">1</span>, <span class=\"number\">3</span>] <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">t2</span>: [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] = [<span class=\"number\">1</span>] <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">t3</span>: [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] = [<span class=\"number\">1</span>, <span class=\"string\">&#x27;1&#x27;</span>, <span class=\"literal\">true</span>] <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">t5</span>: [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] = [<span class=\"number\">1</span>, <span class=\"string\">&#x27;2&#x27;</span>] <span class=\"comment\">// ok</span></span><br><span class=\"line\">t.<span class=\"title function_\">push</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(t) <span class=\"comment\">// [1, &#x27;2&#x27;, 2]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> a =  t[<span class=\"number\">0</span>] <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> b = t[<span class=\"number\">1</span>] <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> c = t[<span class=\"number\">2</span>] <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"object\"><a href=\"#object\" class=\"headerlink\" title=\"object\"></a>object</h4><p><code>object</code> 非原始类型，在定义上直接使用 object 是可以的，但你要更改对象的属性就会报错，原因是并没有使对象的内部具体的属性做限制，所以需要使用 <strong>{}</strong> 来定义内部类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">obj1</span>: <span class=\"built_in\">object</span> = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">obj1.<span class=\"property\">a</span> = <span class=\"number\">3</span> <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">obj2</span>: &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">number</span>, <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125; = &#123;<span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">obj2.<span class=\"property\">a</span> = <span class=\"number\">3</span> <span class=\"comment\">// ok</span></span><br></pre></td></tr></table></figure>\n<p><code>Object</code>(大写的O）,代表所有的原始类型或非原始类型都可以进行赋值,除了<code>null</code>和<code>undefined</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">obj</span>: <span class=\"title class_\">Object</span>;</span><br><span class=\"line\">obj = <span class=\"number\">1</span>; <span class=\"comment\">// ok</span></span><br><span class=\"line\">obj = <span class=\"string\">&quot;a&quot;</span>; <span class=\"comment\">// ok</span></span><br><span class=\"line\">obj = <span class=\"literal\">true</span>; <span class=\"comment\">// ok</span></span><br><span class=\"line\">obj = &#123;&#125;; <span class=\"comment\">// ok</span></span><br><span class=\"line\">obj = <span class=\"title class_\">Symbol</span>() <span class=\"comment\">//ok</span></span><br><span class=\"line\">obj = <span class=\"number\">10n</span> <span class=\"comment\">//ok</span></span><br><span class=\"line\">obj = <span class=\"literal\">null</span>; <span class=\"comment\">// error</span></span><br><span class=\"line\">obj = <span class=\"literal\">undefined</span>; <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"function\"><a href=\"#function\" class=\"headerlink\" title=\"function\"></a>function</h4><p><strong>定义函数</strong></p>\n<ul>\n<li>有两种方式，一种为 <code>function</code>， 另一种为<code>箭头函数</code></li>\n<li>在书写的时候，也可以写入返回值的类型，如果写入，则必须要有对应类型的返回值，<strong>但通常情况下是省略</strong>，因为<code>TS</code>的类型推断功能够正确推断出返回值类型</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setName1</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>) &#123; <span class=\"comment\">//ok</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;hello&quot;</span>, name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">setName1</span>(<span class=\"string\">&quot;Domesy&quot;</span>); <span class=\"comment\">// &quot;hello&quot;,  &quot;Domesy&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setName2</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>):<span class=\"built_in\">string</span> &#123; <span class=\"comment\">//error</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;hello&quot;</span>, name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">setName2</span>(<span class=\"string\">&quot;Domesy&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setName3</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>):<span class=\"built_in\">string</span> &#123; <span class=\"comment\">//error</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;hello&quot;</span>, name);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">setName3</span>(<span class=\"string\">&quot;Domesy&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setName4</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>): <span class=\"built_in\">string</span> &#123; <span class=\"comment\">//ok</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;hello&quot;</span>, name);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">setName4</span>(<span class=\"string\">&quot;Domesy&quot;</span>); <span class=\"comment\">// &quot;hello&quot;,  &quot;Domesy&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//箭头函数与上述同理</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setName5</span> = (<span class=\"params\">name:<span class=\"built_in\">string</span></span>) =&gt; <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;hello&quot;</span>, name);</span><br><span class=\"line\"><span class=\"title function_\">setName5</span>(<span class=\"string\">&quot;Domesy&quot;</span>) <span class=\"comment\">// &quot;hello&quot;,  &quot;Domesy&quot;</span></span><br></pre></td></tr></table></figure>\n<p><strong>参数类型</strong></p>\n<ul>\n<li>可选参数： 如果函数要配置可有可无的参数时，可以通过 <strong>?</strong> 实现，切可选参数一定要在最后面</li>\n<li>默认参数：函数内可以自己设定其默认参数，用 <strong>&#x3D;</strong> 实现</li>\n<li>剩余参数：仍可以使用扩展运算符 <strong>…</strong></li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 可选参数</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo1</span> = (<span class=\"params\">name: <span class=\"built_in\">string</span>, age?: <span class=\"built_in\">number</span></span>) =&gt; <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name, age)</span><br><span class=\"line\"><span class=\"title function_\">setInfo1</span>(<span class=\"string\">&#x27;Domesy&#x27;</span>) <span class=\"comment\">//&quot;Domesy&quot;,  undefined</span></span><br><span class=\"line\"><span class=\"title function_\">setInfo1</span>(<span class=\"string\">&#x27;Domesy&#x27;</span>, <span class=\"number\">7</span>) <span class=\"comment\">//&quot;Domesy&quot;,  7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 默认参数</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo2</span> = (<span class=\"params\">name: <span class=\"built_in\">string</span>, age: <span class=\"built_in\">number</span> = <span class=\"number\">11</span></span>) =&gt; <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name, age)</span><br><span class=\"line\"><span class=\"title function_\">setInfo2</span>(<span class=\"string\">&#x27;Domesy&#x27;</span>) <span class=\"comment\">//&quot;Domesy&quot;,  11</span></span><br><span class=\"line\"><span class=\"title function_\">setInfo2</span>(<span class=\"string\">&#x27;Domesy&#x27;</span>, <span class=\"number\">7</span>) <span class=\"comment\">//&quot;Domesy&quot;,  7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 剩余参数</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">allCount</span> = (<span class=\"params\">...numbers: <span class=\"built_in\">number</span>[]</span>) =&gt; <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`数字总和为：<span class=\"subst\">$&#123;numbers.reduce((val, item) =&gt; (val += item), <span class=\"number\">0</span>)&#125;</span>`</span>)</span><br><span class=\"line\"><span class=\"title function_\">allCount</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) <span class=\"comment\">//&quot;数字总和为：6&quot;</span></span><br></pre></td></tr></table></figure>\n<p><strong>函数重载</strong></p>\n<p><strong>函数重载</strong>：是使用相同名称和不同参数数量或类型创建多个方法的一种能力。 在 TypeScript 中，表现为给同一个函数提供多个函数类型定义。 简单的说：<strong>可以在同一个函数下定义多种类型值，最后汇总到一块</strong></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">obj</span>: <span class=\"built_in\">any</span> = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setInfo</span>(<span class=\"params\">val: <span class=\"built_in\">string</span></span>): <span class=\"built_in\">void</span>;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setInfo</span>(<span class=\"params\">val: <span class=\"built_in\">number</span></span>): <span class=\"built_in\">void</span>;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setInfo</span>(<span class=\"params\">val: <span class=\"built_in\">boolean</span></span>): <span class=\"built_in\">void</span>;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setInfo</span>(<span class=\"params\">val: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span> | <span class=\"built_in\">boolean</span></span>): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> val === <span class=\"string\">&quot;string&quot;</span>) &#123;</span><br><span class=\"line\">    obj.<span class=\"property\">name</span> = val;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    obj.<span class=\"property\">age</span> = val;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"string\">&quot;Domesy&quot;</span>);</span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"number\">7</span>);</span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(obj); <span class=\"comment\">// &#123; name: &#x27;Domesy&#x27;, age: 7 &#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"特殊类型\"><a href=\"#特殊类型\" class=\"headerlink\" title=\"特殊类型\"></a>特殊类型</h3><h4 id=\"any\"><a href=\"#any\" class=\"headerlink\" title=\"any\"></a>any</h4><p>在 TS 中，任何类型都可以归于 <code>any</code> 类型，所以<code>any</code>类型也就成了所有类型的<strong>顶级类型</strong>，同时，<strong>如果不指定变量的类型，则默认为any类型</strong>, 当然不推荐使用该类型，因为这样丧失了TS的作用。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">d</span>:<span class=\"built_in\">any</span>; <span class=\"comment\">//等价于 let d </span></span><br><span class=\"line\">d = <span class=\"string\">&#x27;1&#x27;</span>;</span><br><span class=\"line\">d = <span class=\"number\">2</span>;</span><br><span class=\"line\">d = <span class=\"literal\">true</span>;</span><br><span class=\"line\">d = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">d = &#123;&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"unknow\"><a href=\"#unknow\" class=\"headerlink\" title=\"unknow\"></a>unknow</h4><p>与any一样，都可以作为所有类型的<strong>顶级类型</strong>，但 unknow更加<strong>严格</strong>，那么可以说除了any 之下的第二大类型，接下来对比下any，主要严格于一下两点：</p>\n<ul>\n<li>unknow会对值进行检测，而类型any不会做检测操作，说白了，any类型可以赋值给任何类型，但unknow只能赋值给unknow类型和any类型</li>\n<li>unknow不允许定义的值有任何操作（如 方法，new等），但any可以</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">u</span>:<span class=\"built_in\">unknown</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">a</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">u = <span class=\"string\">&#x27;1&#x27;</span>; <span class=\"comment\">//ok</span></span><br><span class=\"line\">u = <span class=\"number\">2</span>; <span class=\"comment\">//ok</span></span><br><span class=\"line\">u = <span class=\"literal\">true</span>; <span class=\"comment\">//ok</span></span><br><span class=\"line\">u = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]; <span class=\"comment\">//ok</span></span><br><span class=\"line\">u = &#123;&#125;; <span class=\"comment\">//ok</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value</span>:<span class=\"built_in\">any</span> = u <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value1</span>:<span class=\"built_in\">any</span> = a <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value2</span>:<span class=\"built_in\">unknown</span> = u <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value3</span>:<span class=\"built_in\">unknown</span> = a <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value4</span>:<span class=\"built_in\">string</span> = u <span class=\"comment\">//error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value5</span>:<span class=\"built_in\">string</span> = a <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value6</span>:<span class=\"built_in\">number</span> = u <span class=\"comment\">//error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value7</span>:<span class=\"built_in\">number</span> = a <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value8</span>:<span class=\"built_in\">boolean</span> = u <span class=\"comment\">//error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">value9</span>:<span class=\"built_in\">boolean</span> = a <span class=\"comment\">//ok</span></span><br><span class=\"line\"></span><br><span class=\"line\">u.<span class=\"title function_\">set</span>() <span class=\"comment\">// error</span></span><br><span class=\"line\">a.<span class=\"title function_\">set</span>() <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"title function_\">u</span>() <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"title function_\">a</span>() <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"title function_\">u</span>() <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"title function_\">a</span>() <span class=\"comment\">//ok</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"void\"><a href=\"#void\" class=\"headerlink\" title=\"void\"></a>void</h4><p>当一个函数，没有返回值时，TS会默认他的返回值为  <code>void</code>  类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> setInfo = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;&#125; <span class=\"comment\">// 等价于 const setInfo = () =&gt; &#123;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> setInfo1 = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123; <span class=\"keyword\">return</span> <span class=\"string\">&#x27;1&#x27;</span> &#125;  <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> setInfo2 = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123; <span class=\"keyword\">return</span> <span class=\"number\">2</span> &#125; <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> setInfo3 = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123; <span class=\"keyword\">return</span> <span class=\"literal\">true</span> &#125; <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> setInfo4 = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123; <span class=\"keyword\">return</span>  &#125; <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> setInfo5 = ():<span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123; <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span> &#125; <span class=\"comment\">//ok </span></span><br></pre></td></tr></table></figure>\n<h4 id=\"never\"><a href=\"#never\" class=\"headerlink\" title=\"never\"></a>never</h4><p>表示一个函数永远不存在返回值，TS会认为类型为 never，那么与 void 相比, never应该是 void子集， 因为 void实际上的返回值为 undefined，而 never 连 undefined也不行</p>\n<p>符合never的情况有：当抛出异常的情况和无限死循环</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> error = ():<span class=\"function\"><span class=\"params\">never</span> =&gt;</span> &#123; <span class=\"comment\">// 等价约 let error = () =&gt; &#123;&#125;</span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&quot;error&quot;</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> error1 = ():<span class=\"function\"><span class=\"params\">never</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"Enum-枚举\"><a href=\"#Enum-枚举\" class=\"headerlink\" title=\"Enum(枚举)\"></a>Enum(枚举)</h4><p>可以定义一些带名字的常量，这样可以 <strong>清晰表达意图</strong> 或 <strong>创建一组有区别的用例</strong></p>\n<p>注意：</p>\n<ul>\n<li>枚举的类型只能是 <code>string</code> 或 <code>number</code></li>\n<li>定义的名称不能为 <strong>关键字</strong></li>\n</ul>\n<p>同时我们可以看看翻译为ES5是何样子</p>\n<h4 id=\"数字枚举\"><a href=\"#数字枚举\" class=\"headerlink\" title=\"数字枚举\"></a>数字枚举</h4><ul>\n<li>枚组的类型默认为<strong>数字类型</strong>，默认从0开始以此累加，如果有设置默认值，则<strong>只会对下面的值产生影响</strong></li>\n<li>同时支持<strong>反向映射</strong>（及从成员值到成员名的映射），但智能映射无默认值的情况，并且只能是默认值的前面</li>\n</ul>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7559b8e5b7b94f8fbafc95fd37eeffbd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h4 id=\"字符串枚举\"><a href=\"#字符串枚举\" class=\"headerlink\" title=\"字符串枚举\"></a>字符串枚举</h4><p>字符串枚举要注意的是必须要有<strong>默认值</strong>，不支持<strong>反向映射</strong></p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0df3876ecc6a474085e468cbd3f1929f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h4 id=\"常量枚举\"><a href=\"#常量枚举\" class=\"headerlink\" title=\"常量枚举\"></a>常量枚举</h4><p>除了数字类型和字符串类型之外，还有一种特殊的类型，那就是常量枚举，也就是通过const去定义enum，但这种类型不会编译成任何 JS,只会编译对应的值</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/160ac2e75cab457d99093ce48c34756a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h4 id=\"异构枚举\"><a href=\"#异构枚举\" class=\"headerlink\" title=\"异构枚举\"></a>异构枚举</h4><p>包含了 <code>数字类型</code> 和 <code>字符串类型</code> 的混合，反向映射一样的道理</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d5f1433ab2c48bebc65ca5f8ace0da4~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h3 id=\"类型推论\"><a href=\"#类型推论\" class=\"headerlink\" title=\"类型推论\"></a>类型推论</h3><p>我们在学完这些基础类型，我们是不是每个类型都要去写字段是什么类型呢？其实不是，在TS中如果不设置类型，并且不进行赋值时，将会推论为any类型，如果进行赋值就会默认为类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a; <span class=\"comment\">// 推断为any</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> str = <span class=\"string\">&#x27;小杜杜&#x27;</span>; <span class=\"comment\">// 推断为string</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> num = <span class=\"number\">13</span>; <span class=\"comment\">// 推断为number</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> flag = <span class=\"literal\">false</span>; <span class=\"comment\">// 推断为boolean</span></span><br><span class=\"line\"></span><br><span class=\"line\">str = <span class=\"literal\">true</span> <span class=\"comment\">// error Type &#x27;boolean&#x27; is not assignable to type &#x27;string&#x27;.(2322)</span></span><br><span class=\"line\">num = <span class=\"string\">&#x27;Domesy&#x27;</span> <span class=\"comment\">// error</span></span><br><span class=\"line\">flag = <span class=\"number\">7</span> <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"字面量类型\"><a href=\"#字面量类型\" class=\"headerlink\" title=\"字面量类型\"></a>字面量类型</h3><p>字面量类型：在TS中，我们可以指定参数的类型是什么，目前支持字符串、数字、布尔三种类型。比如说我定义了 str 的类型是 ‘小杜杜’， 那么str的值只能是小杜杜</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">str</span>:<span class=\"string\">&#x27;小杜杜&#x27;</span> </span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">num</span>: <span class=\"number\">1</span> | <span class=\"number\">2</span> | <span class=\"number\">3</span> = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">flag</span>:<span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">str = <span class=\"string\">&#x27;小杜杜&#x27;</span> <span class=\"comment\">//ok</span></span><br><span class=\"line\">str = <span class=\"string\">&#x27;Donmesy&#x27;</span> <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\">num = <span class=\"number\">2</span> <span class=\"comment\">//ok</span></span><br><span class=\"line\">num = <span class=\"number\">7</span> <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\">flag = <span class=\"literal\">true</span> <span class=\"comment\">// ok</span></span><br><span class=\"line\">flag = <span class=\"literal\">false</span> <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"交叉类型（-amp-）\"><a href=\"#交叉类型（-amp-）\" class=\"headerlink\" title=\"交叉类型（&amp;）\"></a>交叉类型（&amp;）</h3><p>交叉类型：将多个类型合并为一个类型，使用&amp;符号连接，如：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">AProps</span> = &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">BProps</span> = &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> allProps = <span class=\"title class_\">AProps</span> &amp; <span class=\"title class_\">BProps</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Info</span>: allProps = &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"同名基础属性合并\"><a href=\"#同名基础属性合并\" class=\"headerlink\" title=\"同名基础属性合并\"></a>同名基础属性合并</h4><p>我们可以看到交叉类型是结合两个属性的属性值，那么我们现在有个问题，要是两个属性都有相同的属性值，那么此时总的类型会怎么样，先看看下面的案列：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">AProps</span> = &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span>, <span class=\"attr\">c</span>: <span class=\"built_in\">number</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">BProps</span> = &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span>, <span class=\"attr\">c</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> allProps = <span class=\"title class_\">AProps</span> &amp; <span class=\"title class_\">BProps</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Info</span>: allProps = &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">    <span class=\"attr\">c</span>:  <span class=\"number\">1</span>, <span class=\"comment\">// error (property) c: never</span></span><br><span class=\"line\">    <span class=\"attr\">c</span>:  <span class=\"string\">&#x27;Domesy&#x27;</span>, <span class=\"comment\">// error (property) c: never</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果是相同的类型，合并后的类型也是此类型，那如果是不同的类型会如何：</p>\n<p>我们在Aprops和BProps中同时加入c属性，并且c属性的类型不同，一个是number类型，另一个是string类型<br>现在结合为 allProps 后呢? 是不是c属性是 number 或 string 类型都可以，还是其中的一种？</p>\n<p>然而在实际中， c 传入数字类型和字符串类型都不行，我么看到报错，现实的是 c的类型是 never。</p>\n<p>这是因为对应 c属性而言是 string &amp; number，然而这种属性明显是不存在的，所以c的属性是never</p>\n<h4 id=\"同名非基础属性合并\"><a href=\"#同名非基础属性合并\" class=\"headerlink\" title=\"同名非基础属性合并\"></a>同名非基础属性合并</h4><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> A &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">number</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> B &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> C &#123;</span><br><span class=\"line\">    <span class=\"attr\">x</span>: A</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> D &#123;</span><br><span class=\"line\">    <span class=\"attr\">x</span>: B</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> allProps = C &amp; D</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Info</span>: allProps = &#123;</span><br><span class=\"line\">  <span class=\"attr\">x</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>) <span class=\"comment\">// &#123; x: &#123; &quot;a&quot;: 7, &quot;b&quot;: &quot;小杜杜&quot; &#125;&#125;</span></span><br></pre></td></tr></table></figure>\n<p>我们来看看案例，对于混入多个类型时，若存在相同的成员，且成员类型为非基本数据类型，那么是可以成功合。</p>\n<p>如果 接口A 中的 也是 b，类型为number，就会跟<strong>同名基础属性合并</strong>一样</p>\n<h2 id=\"Class（类）\"><a href=\"#Class（类）\" class=\"headerlink\" title=\"Class（类）\"></a>Class（类）</h2><p>在ES6中推出了一个叫 class（类） 的玩意，具体定义就不说了，相信用过React的小伙伴一定不陌生。</p>\n<h3 id=\"基本方法\"><a href=\"#基本方法\" class=\"headerlink\" title=\"基本方法\"></a>基本方法</h3><p>在基本方法中有：静态属性，静态方法、成员属性、成员方法、构造器、get set方法，接下来逐个看看：</p>\n<p>需要注意的是： 在成员属性中，如果不给默认值,并且不使用是会报错的，如果不想报错就给如<code> !</code>，如：<code>name4!:string</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Info</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">//静态属性</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"attr\">name1</span>: <span class=\"built_in\">string</span> = <span class=\"string\">&#x27;Domesy&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//成员属性，实际上是通过public上进行修饰，只是省略了</span></span><br><span class=\"line\">  <span class=\"attr\">nmae2</span>:<span class=\"built_in\">string</span> = <span class=\"string\">&#x27;Hello&#x27;</span> <span class=\"comment\">//ok </span></span><br><span class=\"line\">  <span class=\"attr\">name3</span>:<span class=\"built_in\">string</span> <span class=\"comment\">//error</span></span><br><span class=\"line\">  name4!:<span class=\"built_in\">string</span> <span class=\"comment\">//ok 不设置默认值的时候必须加入 !</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//构造方法</span></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">_name:<span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span> = _name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//静态方法</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> getName = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;我是静态方法&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//成员方法</span></span><br><span class=\"line\">  getName4 = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`我是成员方法:<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.name4&#125;</span>`</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//get 方法</span></span><br><span class=\"line\">  <span class=\"keyword\">get</span> <span class=\"title function_\">name5</span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//set 方法</span></span><br><span class=\"line\">  <span class=\"keyword\">set</span> <span class=\"title function_\">name5</span>(<span class=\"params\">name5</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span> = name5</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> setName = <span class=\"keyword\">new</span> <span class=\"title class_\">Info</span>(<span class=\"string\">&#x27;你好&#x27;</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>.<span class=\"property\">name1</span>) <span class=\"comment\">//  &quot;Domesy&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>.<span class=\"title function_\">getName</span>()) <span class=\"comment\">// &quot;我是静态方法&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(setName.<span class=\"title function_\">getName4</span>()) <span class=\"comment\">// &quot;我是成员方法:你好&quot; </span></span><br></pre></td></tr></table></figure>\n<p>让我们看看上述代码翻译成ES5是什么样：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&quot;use strict&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Info</span> = <span class=\"comment\">/** <span class=\"doctag\">@class</span> */</span> (<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//构造方法</span></span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">Info</span>(<span class=\"params\">_name</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> _this = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">        <span class=\"comment\">//成员属性</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">nmae2</span> = <span class=\"string\">&#x27;Hello&#x27;</span>; <span class=\"comment\">//ok</span></span><br><span class=\"line\">        <span class=\"comment\">//成员方法</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">getName4</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;\\u6211\\u662F\\u6210\\u5458\\u65B9\\u6CD5:&quot;</span>.<span class=\"title function_\">concat</span>(_this.<span class=\"property\">name4</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span> = _name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(<span class=\"title class_\">Info</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>, <span class=\"string\">&quot;name5&quot;</span>, &#123;</span><br><span class=\"line\">        <span class=\"comment\">//get 方法</span></span><br><span class=\"line\">        <span class=\"attr\">get</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span>;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"comment\">//set 方法</span></span><br><span class=\"line\">        <span class=\"attr\">set</span>: <span class=\"keyword\">function</span> (<span class=\"params\">name5</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">name4</span> = name5;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">enumerable</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">configurable</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">//静态属性</span></span><br><span class=\"line\">    <span class=\"title class_\">Info</span>.<span class=\"property\">name1</span> = <span class=\"string\">&#x27;Domesy&#x27;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//静态方法</span></span><br><span class=\"line\">    <span class=\"title class_\">Info</span>.<span class=\"property\">getName</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;我是静态方法&#x27;</span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title class_\">Info</span>;</span><br><span class=\"line\">&#125;());</span><br><span class=\"line\"><span class=\"keyword\">var</span> setName = <span class=\"keyword\">new</span> <span class=\"title class_\">Info</span>(<span class=\"string\">&#x27;你好&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>.<span class=\"property\">name1</span>); <span class=\"comment\">//  &quot;Domesy&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>.<span class=\"title function_\">getName</span>()); <span class=\"comment\">// &quot;我是静态方法&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(setName.<span class=\"title function_\">getName4</span>()); <span class=\"comment\">// &quot;我是成员方法:你好&quot; </span></span><br></pre></td></tr></table></figure>\n<h3 id=\"私有字段\"><a href=\"#私有字段\" class=\"headerlink\" title=\"私有字段(#)\"></a>私有字段(#)</h3><p>在 TS 3.8版本便开始支持 ECMACMAScript 的私有字段。</p>\n<p>需要注意的是私有字段与常规字段不同，主要的区别是：</p>\n<ul>\n<li>私有字段以 <code>#</code> 字符开头，也叫私有名称；</li>\n<li>每个私有字段名称都<strong>唯一</strong>地限定于其包含的类；</li>\n<li>不能在私有字段上使用 TypeScript 可访问性修饰符（如 public 或 private）；</li>\n<li>私有字段不能在包含的类之外访问，甚至不能被检测到。</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Info</span> &#123;</span><br><span class=\"line\">  #<span class=\"attr\">name</span>: <span class=\"built_in\">string</span>; <span class=\"comment\">//私有字段</span></span><br><span class=\"line\">  <span class=\"attr\">getName</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.#name = name;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">getName</span> = name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">setName</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`我的名字是<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.#name&#125;</span>`</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> myName = <span class=\"keyword\">new</span> <span class=\"title class_\">Info</span>(<span class=\"string\">&quot;Domesy&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(myName.<span class=\"title function_\">setName</span>()) <span class=\"comment\">// &quot;我的名字是Domesy&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(myName.<span class=\"property\">getName</span>) <span class=\"comment\">// ok &quot;Domesy&quot; </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(myName.#name) <span class=\"comment\">// error </span></span><br><span class=\"line\"><span class=\"comment\">// Property &#x27;#name&#x27; is not accessible outside class &#x27;Info&#x27; </span></span><br><span class=\"line\"><span class=\"comment\">// because it has a private identifier.(18013)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"只读属性（readonly）\"><a href=\"#只读属性（readonly）\" class=\"headerlink\" title=\"只读属性（readonly）\"></a>只读属性（readonly）</h3><p>只读属性：用 readonly修饰，只能在构造函数中初始化，并且在TS中，只允许将interface、type、class上的属性标识为readonly</p>\n<ul>\n<li><code>readonly</code>实际上只是在 <code>编译阶段</code> 进行代码检查</li>\n<li>被<code>radonly</code>修饰的词只能在 <code>constructor</code> 阶段修改，其他时刻不允许修改</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Info</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">readonly</span> <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>; <span class=\"comment\">// 只读属性</span></span><br><span class=\"line\">  <span class=\"attr\">name1</span>:<span class=\"built_in\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name1</span> = name;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">setName</span>(<span class=\"params\">name:<span class=\"built_in\">string</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name <span class=\"comment\">// error</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name1</span> = name; <span class=\"comment\">// ok</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"继承（extends）\"><a href=\"#继承（extends）\" class=\"headerlink\" title=\"继承（extends）\"></a>继承（extends）</h3><p>继承：是个比较重要的点，指的是子可以继承父的思想，也就是说 子类 通过继承父类后，就拥有了父类的属性和方法，这点与HOC有点类似。</p>\n<p>这里有个<code>super</code>字段，给不知道的小伙伴说说，其作用是<strong>调用父类上的属性和方法</strong></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 父类</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, age:<span class=\"built_in\">number</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">age</span> = age</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">getName</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的姓名是：<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.name&#125;</span>`</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">name</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">setName</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`设置姓名为：<span class=\"subst\">$&#123;name&#125;</span>`</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 子类</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">tel</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, age: <span class=\"built_in\">number</span>, tel:<span class=\"built_in\">number</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">super</span>(name, age)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">tel</span> = tel</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">getTel</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`电话号码是<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.tel&#125;</span>`</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">tel</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> res = <span class=\"keyword\">new</span> <span class=\"title class_\">Child</span>(<span class=\"string\">&quot;Domesy&quot;</span>, <span class=\"number\">7</span> , <span class=\"number\">123456</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res) <span class=\"comment\">// Child &#123;.&quot;name&quot;: &quot;Domesy&quot;, &quot;age&quot;: 7, &quot;no&quot;: 1 &#125;</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">age</span>) <span class=\"comment\">// 7</span></span><br><span class=\"line\">res.<span class=\"title function_\">setName</span>(<span class=\"string\">&#x27;小杜杜&#x27;</span>) <span class=\"comment\">// &quot;设置姓名为：小杜杜&quot; </span></span><br><span class=\"line\">res.<span class=\"title function_\">getName</span>() <span class=\"comment\">//   &quot;我的姓名是：小杜杜&quot;</span></span><br><span class=\"line\">res.<span class=\"title function_\">getTel</span>() <span class=\"comment\">//  &quot;电话号码是123456&quot; </span></span><br></pre></td></tr></table></figure>\n<h3 id=\"修饰符\"><a href=\"#修饰符\" class=\"headerlink\" title=\"修饰符\"></a>修饰符</h3><p>主要有三种修饰符：</p>\n<ul>\n<li><strong>public</strong>：类中、子类内的任何地方、外部<strong>都能调用</strong></li>\n<li><strong>protected</strong>：类中、子类内的任何地方都能调用,但<strong>外部不能调用</strong></li>\n<li><strong>private</strong>：类中可以调用，子类内的任何地方、外部<strong>均不可调用</strong></li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"keyword\">protected</span> <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"attr\">tel</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, age:<span class=\"built_in\">number</span>, tel: <span class=\"built_in\">number</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">age</span> = age</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">tel</span> = tel</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, age: <span class=\"built_in\">number</span>, tel: <span class=\"built_in\">number</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">super</span>(name, age, tel);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">getName</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字叫<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.name&#125;</span>,年龄是<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.age&#125;</span>`</span>) <span class=\"comment\">// ok name 和 age可以</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`电话是<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.tel&#125;</span>`</span>) <span class=\"comment\">// error 报错 原因是 tel 拿不出来</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"keyword\">new</span> <span class=\"title class_\">Child</span>(<span class=\"string\">&#x27;Domesy&#x27;</span>, <span class=\"number\">7</span>, <span class=\"number\">123456</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">name</span>) <span class=\"comment\">// ok Domesy</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">age</span>) <span class=\"comment\">// error</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">tel</span>) <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"abstract\"><a href=\"#abstract\" class=\"headerlink\" title=\"abstract\"></a>abstract</h3><p>abstract: 用abstract关键字声明的类叫做<strong>抽象类</strong>，声明的方法叫做<strong>抽象方法</strong>。</p>\n<ul>\n<li><strong>抽象类</strong>：指不能被实例化，因为它里面包含一个或多个抽象方法。</li>\n<li><strong>抽象方法</strong>：是指不包含具体实现的方法；</li>\n</ul>\n<p>注：抽象类是不能直接实例化，只能实例化实现了所有抽象方法的子类</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"><span class=\"keyword\">public</span> name: <span class=\"built_in\">string</span></span>)&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 抽象方法</span></span><br><span class=\"line\">  <span class=\"keyword\">abstract</span> <span class=\"title function_\">setAge</span>(<span class=\"attr\">age</span>: <span class=\"built_in\">number</span>) :<span class=\"built_in\">void</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Person</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">super</span>(name);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">setAge</span>(<span class=\"attr\">age</span>: <span class=\"built_in\">number</span>): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.name&#125;</span>,年龄是<span class=\"subst\">$&#123;age&#125;</span>`</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> res = <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;小杜杜&quot;</span>) <span class=\"comment\">//error</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> res1 = <span class=\"keyword\">new</span> <span class=\"title class_\">Child</span>(<span class=\"string\">&quot;小杜杜&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">res1.<span class=\"title function_\">setAge</span>(<span class=\"number\">7</span>) <span class=\"comment\">// &quot;我的名字是小杜杜,年龄是7&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"重写和重载\"><a href=\"#重写和重载\" class=\"headerlink\" title=\"重写和重载\"></a>重写和重载</h3><ul>\n<li><strong>重写</strong>：子类重写继承自父类中的方法</li>\n<li><strong>重载</strong>：指为同一个函数提供多个类型定义，与上述函数的重载类似</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 重写</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person</span>&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setName</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`我的名字叫<span class=\"subst\">$&#123;name&#125;</span>`</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Person</span>&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setName</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`你的名字叫<span class=\"subst\">$&#123;name&#125;</span>`</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> yourName = <span class=\"keyword\">new</span> <span class=\"title class_\">Child</span>()</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(yourName.<span class=\"title function_\">setName</span>(<span class=\"string\">&#x27;小杜杜&#x27;</span>)) <span class=\"comment\">// &quot;你的名字叫小杜杜&quot; </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 重载</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person1</span>&#123;</span><br><span class=\"line\">  <span class=\"title function_\">setNameAge</span>(<span class=\"attr\">name</span>: <span class=\"built_in\">string</span>):<span class=\"built_in\">void</span>;</span><br><span class=\"line\">  <span class=\"title function_\">setNameAge</span>(<span class=\"attr\">name</span>: <span class=\"built_in\">number</span>):<span class=\"built_in\">void</span>;</span><br><span class=\"line\">  <span class=\"title function_\">setNameAge</span>(<span class=\"params\">name:<span class=\"built_in\">string</span> | <span class=\"built_in\">number</span></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> name === <span class=\"string\">&#x27;string&#x27;</span>)&#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是<span class=\"subst\">$&#123;name&#125;</span>`</span>)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的年龄是<span class=\"subst\">$&#123;name&#125;</span>`</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"keyword\">new</span> <span class=\"title class_\">Person1</span>()</span><br><span class=\"line\">res.<span class=\"title function_\">setNameAge</span>(<span class=\"string\">&#x27;小杜杜&#x27;</span>) <span class=\"comment\">// &quot;我的名字是小杜杜&quot; </span></span><br><span class=\"line\">res.<span class=\"title function_\">setNameAge</span>(<span class=\"number\">7</span>) <span class=\"comment\">// &quot;我的年龄是7&quot;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n<h2 id=\"TS断言和类型守卫\"><a href=\"#TS断言和类型守卫\" class=\"headerlink\" title=\"TS断言和类型守卫\"></a>TS断言和类型守卫</h2><h3 id=\"TS断言\"><a href=\"#TS断言\" class=\"headerlink\" title=\"TS断言\"></a>TS断言</h3><p>分为三种：<code>类型断言</code>、<code>非空断言</code>、<code>确定赋值断言</code></p>\n<p>当断言失效后，可能使用到：<strong>双重断言</strong></p>\n<h4 id=\"类型断言\"><a href=\"#类型断言\" class=\"headerlink\" title=\"类型断言\"></a>类型断言</h4><p>在特定的环境中，我们会比TS知道这个值具体是什么类型，不需要TS去判断，简单的理解就是，<strong>类型断言会告诉编译器，你不用给我进行检查，相信我，他就是这个类型</strong></p>\n<p>共有两种方式：</p>\n<ul>\n<li><strong>尖括号</strong></li>\n<li><strong>as</strong>：推荐</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//尖括号</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">num</span>:<span class=\"built_in\">any</span> = <span class=\"string\">&#x27;小杜杜&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">res1</span>: <span class=\"built_in\">number</span> = (&lt;<span class=\"built_in\">string</span>&gt;num).<span class=\"property\">length</span>; <span class=\"comment\">// React中会 error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// as 语法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">str</span>: <span class=\"built_in\">any</span> = <span class=\"string\">&#x27;Domesy&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">res</span>: <span class=\"built_in\">number</span> = (str <span class=\"keyword\">as</span> <span class=\"built_in\">string</span>).<span class=\"property\">length</span>;</span><br></pre></td></tr></table></figure>\n\n<p>但需要注意的是：尖括号语法在React中会报错，原因是与JSX语法会产生冲突，所以只能使用as语法。</p>\n<h4 id=\"非空断言\"><a href=\"#非空断言\" class=\"headerlink\" title=\"非空断言\"></a>非空断言</h4><p>在上下文中当类型检查器无法断定类型时，一个新的后缀表达式操作符 <code>!</code> 可以用于断言操作对象是<strong>非 null 和非 undefined 类型。</strong></p>\n<p><img src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fa80b9ac2a54614a129c5724678254a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<p>我们可以看出来 !可以帮助我们过滤 null和 undefined类型，也就是说，编译器会默认我们只会传来string类型的数据，所以可以赋值为str1。</p>\n<p>但变成ES5后 !会被移除，所以当传入 null 的时候，还是会打出 null。</p>\n<h4 id=\"确定赋值断言\"><a href=\"#确定赋值断言\" class=\"headerlink\" title=\"确定赋值断言\"></a>确定赋值断言</h4><p>在TS 2.7版本中引入了确定赋值断言，即允许在实例属性和变量声明后面放置一个 ! 号，以告诉TS该属性会被明确赋值。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">num</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> num1!: <span class=\"built_in\">number</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setNumber</span> = (<span class=\"params\"></span>) =&gt; num = <span class=\"number\">7</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setNumber1</span> = (<span class=\"params\"></span>) =&gt; num1 = <span class=\"number\">7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setNumber</span>()</span><br><span class=\"line\"><span class=\"title function_\">setNumber1</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(num) <span class=\"comment\">// error </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(num1) <span class=\"comment\">// ok</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"双重断言\"><a href=\"#双重断言\" class=\"headerlink\" title=\"双重断言\"></a>双重断言</h4><p>断言失效后，可能会用到，但一般情况下不会使用。</p>\n<p>失效的情况：基础类型不能断言为接口。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Info</span>&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">  <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">&#x27;小杜杜&#x27;</span> <span class=\"keyword\">as</span> <span class=\"title class_\">Info</span>; <span class=\"comment\">// error, 原因是不能把 string 类型断言为 一个接口</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> name1 = <span class=\"string\">&#x27;小杜杜&#x27;</span> <span class=\"keyword\">as</span> <span class=\"built_in\">any</span> <span class=\"keyword\">as</span> <span class=\"title class_\">Info</span>; <span class=\"comment\">//ok</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"类型守卫\"><a href=\"#类型守卫\" class=\"headerlink\" title=\"类型守卫\"></a>类型守卫</h3><p><strong>类型守卫</strong>：是<strong>可执行运行时检查的</strong>一种表达式，用于确保<strong>该类型在一定的范围内</strong>。</p>\n<p>个人的感觉是，类型守卫就是你可以设置多种类型，但我默认你是什么类型的意思</p>\n<p>目前，常有的类型守卫共有4种：<strong>in关键字</strong>、<strong>typeof关键字</strong>、<strong>instanceof</strong>和<strong>类型谓词（is)</strong></p>\n<h4 id=\"in关键字\"><a href=\"#in关键字\" class=\"headerlink\" title=\"in关键字\"></a>in关键字</h4><p>用于判断这个属性是哪个里面的</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Info</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Info1</span>&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  <span class=\"attr\">flage</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo</span> = (<span class=\"params\">data: Info | Info1</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"string\">&quot;age&quot;</span> <span class=\"keyword\">in</span> data)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是：<span class=\"subst\">$&#123;data.name&#125;</span>，年龄是：<span class=\"subst\">$&#123;data.age&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">if</span>(<span class=\"string\">&quot;flage&quot;</span> <span class=\"keyword\">in</span> data)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是：<span class=\"subst\">$&#123;data.name&#125;</span>，性别是：<span class=\"subst\">$&#123;data.flage&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(&#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>, <span class=\"attr\">age</span>: <span class=\"number\">7</span>&#125;) <span class=\"comment\">// &quot;我的名字是：小杜杜，年龄是：7&quot; </span></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(&#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>, <span class=\"attr\">flage</span>: <span class=\"literal\">true</span>&#125;) <span class=\"comment\">// &quot;我的名字是：小杜杜，性别是：true&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"typeof关键字\"><a href=\"#typeof关键字\" class=\"headerlink\" title=\"typeof关键字\"></a>typeof关键字</h4><p>用于判断基本类型，如string ｜ number等。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo</span> = (<span class=\"params\">data: <span class=\"built_in\">number</span> | <span class=\"built_in\">string</span> | <span class=\"literal\">undefined</span></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> data === <span class=\"string\">&quot;string&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是：<span class=\"subst\">$&#123;data&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> data === <span class=\"string\">&quot;number&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的年龄是：<span class=\"subst\">$&#123;data&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> data === <span class=\"string\">&quot;undefined&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"string\">&#x27;小杜杜&#x27;</span>) <span class=\"comment\">// &quot;我的名字是：小杜杜&quot;  </span></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"number\">7</span>) <span class=\"comment\">// &quot;我的年龄是：7&quot; </span></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"literal\">undefined</span>) <span class=\"comment\">// undefined&quot; </span></span><br></pre></td></tr></table></figure>\n<h4 id=\"instanceof关键字\"><a href=\"#instanceof关键字\" class=\"headerlink\" title=\"instanceof关键字\"></a>instanceof关键字</h4><p>用于判断一个实例是不是构造函数，或使用类的时候</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span> = <span class=\"string\">&#x27;小杜杜&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Age</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Name</span>&#123;</span><br><span class=\"line\">  <span class=\"attr\">age</span>: <span class=\"built_in\">number</span> = <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo</span> = (<span class=\"params\">data: Name</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (data <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Age</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的年龄是<span class=\"subst\">$&#123;data.age&#125;</span>`</span>);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是<span class=\"subst\">$&#123;data.name&#125;</span>`</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Name</span>()) <span class=\"comment\">// &quot;我的名字是小杜杜&quot;</span></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Age</span>()) <span class=\"comment\">// &quot;我的年龄是7&quot; </span></span><br></pre></td></tr></table></figure>\n<h4 id=\"类型谓词（is\"><a href=\"#类型谓词（is\" class=\"headerlink\" title=\"类型谓词（is)\"></a>类型谓词（is)</h4><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">isNumber</span>(<span class=\"params\">x: <span class=\"built_in\">any</span></span>): x is <span class=\"built_in\">number</span> &#123; <span class=\"comment\">//默认传入的是number类型</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">typeof</span> x === <span class=\"string\">&quot;number&quot;</span>; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">isNumber</span>(<span class=\"number\">7</span>)) <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">isNumber</span>(<span class=\"string\">&#x27;7&#x27;</span>)) <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">isNumber</span>(<span class=\"literal\">true</span>)) <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"两者的区别\"><a href=\"#两者的区别\" class=\"headerlink\" title=\"两者的区别\"></a>两者的区别</h3><p>通过上面的介绍，我们可以发现<code>断言</code>与<code>类型守卫</code>的概念非常相似，都是确定参数的类型，但<code>断言</code>更加<strong>霸道</strong>，它是直接告诉编辑器，这个参数就是这个类型，而类型守卫更像确定这个参数具体是什么类型。</p>\n<h2 id=\"类型别名、接口\"><a href=\"#类型别名、接口\" class=\"headerlink\" title=\"类型别名、接口\"></a>类型别名、接口</h2><h3 id=\"类型别名（type）\"><a href=\"#类型别名（type）\" class=\"headerlink\" title=\"类型别名（type）\"></a>类型别名（type）</h3><p>类型别名：也就是type，用来给一个类型起个新名字。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">InfoProps</span> = <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo</span> = (<span class=\"params\">data: InfoProps</span>) =&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"接口（interface）\"><a href=\"#接口（interface）\" class=\"headerlink\" title=\"接口（interface）\"></a>接口（interface）</h3><p>接口：在面向对象语言中表示行为抽象，也可以用来描述对象的形状。</p>\n<p>使用interface关键字来定义接口：</p>\n<h4 id=\"对象的形状\"><a href=\"#对象的形状\" class=\"headerlink\" title=\"对象的形状\"></a>对象的形状</h4><p>接口可以用来描述对象，主要可以包括以下数据：可读属性、只读属性、任意属性</p>\n<ul>\n<li><strong>可读属性</strong>：当我们定义一个接口时，我们的属性可能不需要全都要，这是就需要 <strong>?</strong> 来解决</li>\n<li><strong>只读属性</strong>：用 <strong>readonly</strong>修饰的属性为只读属性，意思是指允许定义，不允许之后进行更改</li>\n<li><strong>任意属性</strong>：这个属性极为重要，它是可以用作就算没有定义，也可以使用，比如 <strong>[data: string]: any</strong>。比如说我们对组件进行封装，而封装的那个组件并没有导出对应的类型，然而又想让他不报错，这时就可以使用任意属性</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">    <span class=\"attr\">c</span>: <span class=\"built_in\">boolean</span>;</span><br><span class=\"line\">    d?: <span class=\"built_in\">number</span>; <span class=\"comment\">// 可选属性</span></span><br><span class=\"line\">    <span class=\"keyword\">readonly</span> <span class=\"attr\">e</span>: <span class=\"built_in\">string</span>; <span class=\"comment\">//只读属性</span></span><br><span class=\"line\">    [<span class=\"attr\">f</span>: <span class=\"built_in\">string</span>]: <span class=\"built_in\">any</span> <span class=\"comment\">//任意属性</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">res</span>: <span class=\"title class_\">Props</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">    <span class=\"attr\">c</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">e</span>: <span class=\"string\">&#x27;Domesy&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">d</span>: <span class=\"number\">1</span>, <span class=\"comment\">// 有没有d都可以</span></span><br><span class=\"line\">    <span class=\"attr\">h</span>: <span class=\"number\">2</span> <span class=\"comment\">// 任意属性，之前为定义过h</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> res.<span class=\"property\">e</span> = <span class=\"string\">&#x27;hi&#x27;</span> <span class=\"comment\">// error, 原因是可读属性不允许更改</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h4><p>继承：与类一样，接口也存在继承属性，也是使用 <strong>extends</strong> 字段</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> nameProps &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> <span class=\"keyword\">extends</span> nameProps&#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res</span>: <span class=\"title class_\">Props</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"函数类型接口\"><a href=\"#函数类型接口\" class=\"headerlink\" title=\"函数类型接口\"></a>函数类型接口</h4><p>同时，可以定义函数和类，<strong>加new修饰的是类，不加new的是函数</strong></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    (<span class=\"attr\">data</span>: <span class=\"built_in\">number</span>): <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info</span>: <span class=\"title class_\">Props</span> = <span class=\"function\">(<span class=\"params\"><span class=\"built_in\">number</span>:<span class=\"built_in\">number</span></span>) =&gt;</span> <span class=\"built_in\">number</span>  <span class=\"comment\">//可定义函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义函数</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">A</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>:<span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">PropsClass</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">new</span> (<span class=\"attr\">name</span>: <span class=\"built_in\">string</span>): A</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">info1</span> = (<span class=\"params\">fun: PropsClass, name: <span class=\"built_in\">string</span></span>) =&gt; <span class=\"keyword\">new</span> <span class=\"title function_\">fun</span>(name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"title function_\">info1</span>(A, <span class=\"string\">&quot;小杜杜&quot;</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">name</span>) <span class=\"comment\">// &quot;小杜杜&quot; </span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"type-和-interface-的区别\"><a href=\"#type-和-interface-的区别\" class=\"headerlink\" title=\"type 和 interface 的区别\"></a>type 和 interface 的区别</h3><p>类型别名和接口非常相似，可以说在大多数情况下，type与interface是等价的。</p>\n<p>但在一些特定的场景差距还是比较大的，接下来逐个来看看：</p>\n<h4 id=\"基础数据类型\"><a href=\"#基础数据类型\" class=\"headerlink\" title=\"基础数据类型\"></a>基础数据类型</h4><ul>\n<li>type 和 interface 都可以定义 对象 和 函数</li>\n<li>type 可以定义其他数据类型，如字符串、数字、元祖、联合类型等，而 interface不行</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> A = <span class=\"built_in\">string</span> <span class=\"comment\">// 基本类型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> B = <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span> <span class=\"comment\">// 联合类型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> C = [<span class=\"built_in\">number</span>, <span class=\"built_in\">string</span>] <span class=\"comment\">// 元祖</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> dom = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);  <span class=\"comment\">// dom元素</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> D = <span class=\"keyword\">typeof</span> dom</span><br></pre></td></tr></table></figure>\n<h4 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h4><p>interface 可以扩展 type，type 也可以扩展为 interface，但两者实现扩展的方式不同。</p>\n<ul>\n<li>interface 是通过 <strong>extends</strong> 来实现</li>\n<li>type 是通过 <strong>&amp;</strong> 来实现</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// interface 扩展 interface</span></span><br><span class=\"line\"><span class=\"keyword\">interface</span> A &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> B <span class=\"keyword\">extends</span>  A &#123;</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">obj</span>:B = &#123; <span class=\"attr\">a</span>: <span class=\"string\">`小杜杜`</span>, <span class=\"attr\">b</span>: <span class=\"number\">7</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// type 扩展 type</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> C = &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> D = C &amp; &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">obj1</span>:D = &#123; <span class=\"attr\">a</span>: <span class=\"string\">`小杜杜`</span>, <span class=\"attr\">b</span>: <span class=\"number\">7</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// interface 扩展为 Type</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> E = &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> F <span class=\"keyword\">extends</span> E &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">obj2</span>:F = &#123; <span class=\"attr\">a</span>: <span class=\"string\">`小杜杜`</span>, <span class=\"attr\">b</span>: <span class=\"number\">7</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// type 扩展为 interface</span></span><br><span class=\"line\"><span class=\"keyword\">interface</span> G &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> H = G &amp; &#123;<span class=\"attr\">b</span>: <span class=\"built_in\">number</span>&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">obj3</span>:H = &#123; <span class=\"attr\">a</span>: <span class=\"string\">`小杜杜`</span>, <span class=\"attr\">b</span>: <span class=\"number\">7</span> &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"重复定义\"><a href=\"#重复定义\" class=\"headerlink\" title=\"重复定义\"></a>重复定义</h4><p>interface 可以多次被定义，并且会进行合并，但type不行</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> A &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> A &#123;</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">obj</span>:A = &#123; <span class=\"attr\">a</span>: <span class=\"string\">`小杜杜`</span>, <span class=\"attr\">b</span>: <span class=\"number\">7</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> B = &#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> B = &#123; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125; <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n<h2 id=\"联合类型-Union-Types\"><a href=\"#联合类型-Union-Types\" class=\"headerlink\" title=\"联合类型(Union Types)\"></a>联合类型(Union Types)</h2><p>联合类型(Union Types): 表示取值可以为多种类型中的一种，未赋值时联合类型上只能访问两个类型共有的属性和方法，如：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo</span> = (<span class=\"params\">name: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span></span>) =&gt; &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"string\">&#x27;小杜杜&#x27;</span>)</span><br><span class=\"line\"><span class=\"title function_\">setInfo</span>(<span class=\"number\">7</span>)</span><br></pre></td></tr></table></figure>\n<p>从上面看 setInfo接收一个name，而 name 可以接收 string或number类型，那么这个参数便是联合类型。</p>\n<h3 id=\"可辨识联合\"><a href=\"#可辨识联合\" class=\"headerlink\" title=\"可辨识联合\"></a>可辨识联合</h3><p>可辨识联合：包含三个特点，分别是可辨识、联合类型、类型守卫,</p>\n<p>这种类型的本质是：结合<strong>联合类型</strong>和<strong>字面量类型</strong>的一种类型保护方法。</p>\n<p>如果一个类型是多个类型的联合类型，且多个类型含有一个公共属性，那么就可以利用这个公共属性，来创建不同的类型保护区块。</p>\n<p>也就是上面一起结合使用，这里写个小例子：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> A &#123;</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> B &#123;</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> C &#123;</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">  <span class=\"attr\">sex</span>: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// const setInfo = (data: A | B | C) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   return data.type // ok 原因是 A 、B、C 都有 type属性</span></span><br><span class=\"line\"><span class=\"comment\">//   return data.age // error，  原因是没有判断具体是哪个类型，不能确定是A，还是B，或者是C</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setInfo1</span> = (<span class=\"params\">data: A | B | C</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (data.<span class=\"property\">type</span> === <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的名字是<span class=\"subst\">$&#123;data.name&#125;</span>`</span>);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.<span class=\"property\">type</span> === <span class=\"number\">2</span> )&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的年龄是<span class=\"subst\">$&#123;data.age&#125;</span>`</span>);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.<span class=\"property\">type</span> === <span class=\"number\">3</span> )&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`我的性别是<span class=\"subst\">$&#123;data.sex&#125;</span>`</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setInfo1</span>(&#123;<span class=\"attr\">type</span>: <span class=\"number\">1</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>&#125;) <span class=\"comment\">// &quot;我的名字是小杜杜&quot;</span></span><br><span class=\"line\"><span class=\"title function_\">setInfo1</span>(&#123;<span class=\"attr\">type</span>: <span class=\"number\">2</span>, <span class=\"attr\">age</span>: <span class=\"number\">7</span>&#125;) <span class=\"comment\">// &quot;我的年龄是7&quot; </span></span><br><span class=\"line\"><span class=\"title function_\">setInfo1</span>(&#123;<span class=\"attr\">type</span>: <span class=\"number\">3</span>, <span class=\"attr\">sex</span>: <span class=\"literal\">true</span>&#125;) <span class=\"comment\">// &quot;我的性别是true&quot; </span></span><br></pre></td></tr></table></figure>\n<p>定义了 A、B、C 三次接口，但这三个接口都包含type属性，那么type就是可辨识的属性,而其他属性只跟特性的接口相关。</p>\n<p>然后通过可辨识属性type，才能使用其相关的属性。</p>\n<h2 id=\"泛型\"><a href=\"#泛型\" class=\"headerlink\" title=\"泛型\"></a>泛型</h2><p>泛型：Generics，是指在定义函数、接口或类的时候，不预先指定具体的类型，而在使用的时候再指定类型的一种特性。</p>\n<p>也就是说，泛型是<strong>允许同一个函数接受不同类型参数的一种模版</strong>，与<code>any</code>相比，使用泛型来创建可服用的组件要更好，因为<strong>泛型会保留参数类型</strong>（PS：泛型是整个TS的重点，也是难点，请多多注意～）</p>\n<h3 id=\"为什么需要泛型\"><a href=\"#为什么需要泛型\" class=\"headerlink\" title=\"为什么需要泛型\"></a>为什么需要泛型</h3><p>我们先看看一个例子：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> calcArray = (<span class=\"attr\">data</span>:<span class=\"built_in\">any</span>):<span class=\"built_in\">any</span>[] =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> list = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++)&#123;</span><br><span class=\"line\">        list.<span class=\"title function_\">push</span>(data)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> list</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">calcArray</span>(<span class=\"string\">&#x27;d&#x27;</span>)) <span class=\"comment\">// [&quot;d&quot;, &quot;d&quot;, &quot;d&quot;]</span></span><br></pre></td></tr></table></figure>\n<p>上述的例子我们发现，在calcArray中传任何类型的参数，返回的数组都是any类型。</p>\n<p>由于我们不知道传入的数据是什么，所以返回的数据也为any的数组。</p>\n<p>但我们现在想要的效果是：<strong>无论我们传什么类型，都能返回对应的类型</strong>，针对这种情况怎么办？所以此时 <code>泛型</code> 就登场了。</p>\n<h3 id=\"泛型语法\"><a href=\"#泛型语法\" class=\"headerlink\" title=\"泛型语法\"></a>泛型语法</h3><p>我们先用泛型对上面的例子进行改造下，</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> calcArray = &lt;T,&gt;(<span class=\"attr\">data</span>:T):T[] =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">list</span>:T[] = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++)&#123;</span><br><span class=\"line\">        list.<span class=\"title function_\">push</span>(data)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> list</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res</span>:<span class=\"built_in\">string</span>[] = calcArray&lt;<span class=\"built_in\">string</span>&gt;(<span class=\"string\">&#x27;d&#x27;</span>) <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res1</span>:<span class=\"built_in\">number</span>[] = calcArray&lt;<span class=\"built_in\">number</span>&gt;(<span class=\"number\">7</span>) <span class=\"comment\">// ok</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res3</span>: <span class=\"title class_\">Props</span>[] = calcArray&lt;<span class=\"title class_\">Props</span>&gt;(&#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>, <span class=\"attr\">age</span>: <span class=\"number\">7</span>&#125;) <span class=\"comment\">//ok</span></span><br></pre></td></tr></table></figure>\n<p>经过上面的案例，我们发现传入的字符串、数字、对象，都能返回对应的类型，从而达到我们的目的，接下来我们再看看泛型语法：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> identity &lt;T&gt;(<span class=\"attr\">value</span>:T) : T &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>第一次看到这个 <code>&lt;T&gt;</code> 我们是不是很懵，实际上这个T就是传递的类型,从上述的例子来看，这个 <code>&lt;T&gt;</code> 就是 <code>&lt;string&gt;</code> ，要注意一点，这个 <code>&lt;string&gt;</code> 实际上是可以省略的，因为 TS 具有类型推论，可以自己推断类型。</p>\n<h3 id=\"多类型传参\"><a href=\"#多类型传参\" class=\"headerlink\" title=\"多类型传参\"></a>多类型传参</h3><p>我们有多个未知的类型占位，我们可以定义任何的字母来表示不同的参数类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> calcArray = &lt;T,U&gt;(<span class=\"attr\">name</span>:T, <span class=\"attr\">age</span>:U): &#123;<span class=\"attr\">name</span>:T, <span class=\"attr\">age</span>:U&#125; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"attr\">res</span>: &#123;<span class=\"attr\">name</span>:T, <span class=\"attr\">age</span>:U&#125; = &#123;name, age&#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = calcArray&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">number</span>&gt;(<span class=\"string\">&#x27;小杜杜&#x27;</span>, <span class=\"number\">7</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res) <span class=\"comment\">// &#123;&quot;name&quot;: &quot;小杜杜&quot;, &quot;age&quot;: 7&#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"泛型接口\"><a href=\"#泛型接口\" class=\"headerlink\" title=\"泛型接口\"></a>泛型接口</h3><p>定义接口的时候，我们也可以使用泛型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> A&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"attr\">data</span>: T</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Info</span>: A&lt;<span class=\"built_in\">string</span>&gt; = &#123;<span class=\"attr\">data</span>: <span class=\"string\">&#x27;1&#x27;</span>&#125;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title class_\">Info</span>.<span class=\"property\">data</span>) <span class=\"comment\">// &quot;1&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"泛型类\"><a href=\"#泛型类\" class=\"headerlink\" title=\"泛型类\"></a>泛型类</h3><p>同样泛型也可以定义类</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">clacArray</span>&lt;T&gt;&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"attr\">arr</span>: T[] = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">add</span>(<span class=\"params\">value: T</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">arr</span>.<span class=\"title function_\">push</span>(value)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">getValue</span>(): T &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> res = <span class=\"variable language_\">this</span>.<span class=\"property\">arr</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">arr</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"keyword\">new</span> <span class=\"title function_\">clacArray</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">res.<span class=\"title function_\">add</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">res.<span class=\"title function_\">add</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\">res.<span class=\"title function_\">add</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">res.<span class=\"title function_\">getValue</span>() <span class=\"comment\">//[1, 2, 3] </span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">getValue</span>) <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"泛型类型别名\"><a href=\"#泛型类型别名\" class=\"headerlink\" title=\"泛型类型别名\"></a>泛型类型别名</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Info</span>&lt;T&gt; = &#123;</span><br><span class=\"line\">    name?: T</span><br><span class=\"line\">    age?: T</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res</span>:<span class=\"title class_\">Info</span>&lt;<span class=\"built_in\">string</span>&gt; = &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res1</span>:<span class=\"title class_\">Info</span>&lt;<span class=\"built_in\">number</span>&gt; = &#123; <span class=\"attr\">age</span>: <span class=\"number\">7</span>&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"泛型默认参数\"><a href=\"#泛型默认参数\" class=\"headerlink\" title=\"泛型默认参数\"></a>泛型默认参数</h3><p>所谓默认参数，是指定类型，如默认值一样，从实际值参数中也无法推断出类型时，这个默认类型就会起作用。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> calcArray = &lt;T = <span class=\"built_in\">string</span>,&gt;(<span class=\"attr\">data</span>:T):T[] =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">list</span>:T[] = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++)&#123;</span><br><span class=\"line\">        list.<span class=\"title function_\">push</span>(data)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> list</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"泛型常用字母\"><a href=\"#泛型常用字母\" class=\"headerlink\" title=\"泛型常用字母\"></a>泛型常用字母</h3><p>用常用的字母来表示一些变量的代表：</p>\n<ul>\n<li><strong>T</strong>：代表 <strong>Type</strong>，定义泛型时通常用作第一个类型变量名称</li>\n<li><strong>K</strong>：代表 <strong>Key</strong>，表示对象中的<strong>键类型</strong>；</li>\n<li><strong>V</strong>：代表 <strong>Value</strong>，表示对象中的<strong>值类型</strong>；</li>\n<li><strong>E</strong>：代表 <strong>Element</strong>，表示的<strong>元素类型</strong>；</li>\n</ul>\n<h2 id=\"常用技巧\"><a href=\"#常用技巧\" class=\"headerlink\" title=\"常用技巧\"></a>常用技巧</h2><p>在 TS 中有许多关键字和工具类型，在使用上，需要注意<strong>泛型</strong>上的应用，有的时候结合起来可能就有一定的问题。</p>\n<p>在此特别需要注意 <code>extends</code>、<code>typeof</code>、<code>Partial</code>、<code>Record</code>、<code>Exclude</code>、<code>Omit</code>这几个工具类型。</p>\n<h3 id=\"extends\"><a href=\"#extends\" class=\"headerlink\" title=\"extends\"></a>extends</h3><p>extends：检验是否拥有其属性 在这里，举个例子，我们知道字符串和数组拥有length属性，但number没有这个属性。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> calcArray = &lt;T,&gt;(<span class=\"attr\">data</span>:T): <span class=\"function\"><span class=\"params\">number</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> data.<span class=\"property\">length</span> <span class=\"comment\">// error </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上述的 calcArray的作用只是获取data的数量,但此时在TS中会报错，这是因为TS不确定传来的属性是否具备length这个属性，毕竟每个属性都不可能完全相同。</p>\n<p>那么这时该怎么解决呢？</p>\n<p>我们已经确定，要拿到传过来数据的 length，也就是说传过来的属性必须具备length这个属性，如果没有，则不让他调用这个方法。</p>\n<p>换句话说，calcArray需要具备检验属性的功能，对于上述例子就是检验是否有length的功能，这是我们就需要extends这个属性帮我们去鉴定：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">length</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> calcArray = &lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">Props</span>,&gt;(<span class=\"attr\">data</span>:T): <span class=\"function\"><span class=\"params\">number</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> data.<span class=\"property\">length</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">calcArray</span>(<span class=\"string\">&#x27;12&#x27;</span>) <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"title function_\">calcArray</span>([<span class=\"number\">1</span>,<span class=\"number\">3</span>]) <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"title function_\">calcArray</span>(<span class=\"number\">2</span>) <span class=\"comment\">//error </span></span><br></pre></td></tr></table></figure>\n<p>可以看出 calcArray(2) 会报错，这是因为number类型并不具备length这个属性</p>\n<h3 id=\"typeof\"><a href=\"#typeof\" class=\"headerlink\" title=\"typeof\"></a>typeof</h3><p>typeof关键字：我们在类型保护的时候讲解了typeof的作用，除此之外，这个关键字还可以实现推出类型，如下图，可以推断中 Props 包含的类型。</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c01f7f01bc449d78530bc5e38ee2a5a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h3 id=\"keyof\"><a href=\"#keyof\" class=\"headerlink\" title=\"keyof\"></a>keyof</h3><p>keyof关键字: 可以获取一个对象接口的所有key值,可以检查对象上的键是否存在：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">    <span class=\"attr\">sex</span>: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">PropsKey</span> = keyof <span class=\"title class_\">Props</span>; <span class=\"comment\">//包含 name， age， sex</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res</span>:<span class=\"title class_\">PropsKey</span> = <span class=\"string\">&#x27;name&#x27;</span> <span class=\"comment\">// ok</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">res1</span>:<span class=\"title class_\">PropsKey</span> = <span class=\"string\">&#x27;tel&#x27;</span> <span class=\"comment\">// error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 泛型中的应用</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> getInfo = &lt;T, K <span class=\"keyword\">extends</span> keyof T&gt;(<span class=\"attr\">data</span>: T, <span class=\"attr\">key</span>: K): T[K] =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> data[key]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> info = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">    <span class=\"attr\">sex</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">getInfo</span>(info, <span class=\"string\">&#x27;name&#x27;</span>); <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"title function_\">getInfo</span>(info, <span class=\"string\">&#x27;tel&#x27;</span>); <span class=\"comment\">//error</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"索引访问操作符\"><a href=\"#索引访问操作符\" class=\"headerlink\" title=\"索引访问操作符\"></a>索引访问操作符</h3><p>索引访问操作符：通过 <code>[]</code> 操作符可进行索引访问,可以访问其中一个属性</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39784ee772554968b70a7274924e2f11~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h3 id=\"in\"><a href=\"#in\" class=\"headerlink\" title=\"in\"></a>in</h3><p>in：映射类型, 用来映射遍历枚举类型</p>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/717b932d27054e7bba535c606b5910a9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h3 id=\"infer\"><a href=\"#infer\" class=\"headerlink\" title=\"infer\"></a>infer</h3><p>infer：可以是使用为条件语句，可以用 infer 声明一个类型变量并且对它进行使用。如</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Info</span>&lt;T&gt; = T <span class=\"keyword\">extends</span> &#123; <span class=\"attr\">a</span>: infer U; <span class=\"attr\">b</span>: infer U &#125; ? U : <span class=\"built_in\">never</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props</span> = <span class=\"title class_\">Info</span>&lt;&#123; <span class=\"attr\">a</span>: <span class=\"built_in\">string</span>; <span class=\"attr\">b</span>: <span class=\"built_in\">number</span> &#125;&gt;; <span class=\"comment\">// Props类： string | number</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props1</span> = <span class=\"title class_\">Info</span>&lt;<span class=\"built_in\">number</span>&gt; <span class=\"comment\">// Props类型： never</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Partial\"><a href=\"#Partial\" class=\"headerlink\" title=\"Partial\"></a>Partial</h3><p>Partial语法：<code>Partial&lt;T&gt;</code> 作用：将所有属性变为可选的 <code>?</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info</span>: <span class=\"title class_\">Props</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info1</span>: <span class=\"title class_\">Partial</span>&lt;<span class=\"title class_\">Props</span>&gt; = &#123; </span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>从上述代码上来看，name 和 age 属于必填，对于 info 来说必须要设置 name 和 age 属性才行，但对于 info1来说，只要是个对象就可以，至于是否有name、 age属性并不重要。</p>\n<h3 id=\"Required\"><a href=\"#Required\" class=\"headerlink\" title=\"Required\"></a>Required</h3><p>Required语法：<code>Required&lt;T&gt;</code> 作用：将所有属性变为必选的，与 Partial相反</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>,</span><br><span class=\"line\">    sex?: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info</span>: <span class=\"title class_\">Props</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info1</span>: <span class=\"title class_\">Required</span>&lt;<span class=\"title class_\">Props</span>&gt; = &#123; </span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">    <span class=\"attr\">sex</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Readonly\"><a href=\"#Readonly\" class=\"headerlink\" title=\"Readonly\"></a>Readonly</h3><p>Readonly语法：<code>Readonly&lt;T&gt;</code> 作用：将所有属性都加上 readonly 修饰符来实现。也就是说无法修改</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">info</span>: <span class=\"title class_\">Readonly</span>&lt;<span class=\"title class_\">Props</span>&gt; = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">info.<span class=\"property\">age</span> = <span class=\"number\">1</span> <span class=\"comment\">//error read-only 只读属性</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Record\"><a href=\"#Record\" class=\"headerlink\" title=\"Record\"></a>Record</h3><p>Record语法：<code>Record&lt;K extends keyof any, T&gt;</code></p>\n<p>作用：将 <code>K</code> 中所有的属性的值转化为 <code>T</code> 类型。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">InfoProps</span> = <span class=\"string\">&#x27;JS&#x27;</span> | <span class=\"string\">&#x27;TS&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Info</span>: <span class=\"title class_\">Record</span>&lt;<span class=\"title class_\">InfoProps</span>, <span class=\"title class_\">Props</span>&gt; = &#123;</span><br><span class=\"line\">    <span class=\"attr\">JS</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">TS</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&#x27;TypeScript&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">age</span>: <span class=\"number\">11</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>从上述代码上来看, InfoProps的属性分别包含Props的属性。</p>\n<p>需要注意的一点是：K extends keyof any其类型可以是:string、number、symbol。</p>\n<h3 id=\"Pick\"><a href=\"#Pick\" class=\"headerlink\" title=\"Pick\"></a>Pick</h3><p>Pick语法：<code>Pick&lt;T, K extends keyof T&gt;</code></p>\n<p>作用：将某个类型中的子属性挑出来，变成包含这个类型部分属性的子类型。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>,</span><br><span class=\"line\">    <span class=\"attr\">sex</span>: <span class=\"built_in\">boolean</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> nameProps = <span class=\"title class_\">Pick</span>&lt;<span class=\"title class_\">Props</span>, <span class=\"string\">&#x27;name&#x27;</span> | <span class=\"string\">&#x27;age&#x27;</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">info</span>: nameProps = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;小杜杜&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"number\">7</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>从上述代码上来看, Props原本属性包括name、age、sex三个属性，通过 Pick我们吧name和age挑了出来，所以不需要sex属性。</p>\n<h3 id=\"Exclude\"><a href=\"#Exclude\" class=\"headerlink\" title=\"Exclude\"></a>Exclude</h3><p>Exclude语法：<code>Exclude&lt;T, U&gt;</code></p>\n<p>作用：将T类型中的U类型剔除。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 数字类型</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> numProps = <span class=\"title class_\">Exclude</span>&lt;<span class=\"number\">1</span> | <span class=\"number\">2</span> | <span class=\"number\">3</span>, <span class=\"number\">1</span> | <span class=\"number\">2</span>&gt; <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> numProps1 = <span class=\"title class_\">Exclude</span>&lt;<span class=\"number\">1</span>, <span class=\"number\">1</span> | <span class=\"number\">2</span>&gt; <span class=\"comment\">// nerver</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> numProps2 = <span class=\"title class_\">Exclude</span>&lt;<span class=\"number\">1</span>, <span class=\"number\">1</span>&gt; <span class=\"comment\">// nerver</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> numProps3 = <span class=\"title class_\">Exclude</span>&lt;<span class=\"number\">1</span> | <span class=\"number\">2</span>, <span class=\"number\">7</span>&gt; <span class=\"comment\">// 1 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 字符串类型</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> info = <span class=\"string\">&quot;name&quot;</span> | <span class=\"string\">&quot;age&quot;</span> | <span class=\"string\">&quot;sex&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> info1 = <span class=\"string\">&quot;name&quot;</span> | <span class=\"string\">&quot;age&quot;</span> </span><br><span class=\"line\"><span class=\"keyword\">type</span> infoProps = <span class=\"title class_\">Exclude</span>&lt;info, info1&gt; <span class=\"comment\">//  &quot;sex&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 类型</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> typeProps = <span class=\"title class_\">Exclude</span>&lt;<span class=\"built_in\">string</span> | <span class=\"built_in\">number</span> | (<span class=\"function\">() =&gt;</span> <span class=\"built_in\">void</span>), <span class=\"title class_\">Function</span>&gt; <span class=\"comment\">// string | number</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对象</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> obj = &#123; <span class=\"attr\">name</span>: <span class=\"number\">1</span>, <span class=\"attr\">sex</span>: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> obj1 = &#123; <span class=\"attr\">name</span>: <span class=\"number\">1</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> objProps = <span class=\"title class_\">Exclude</span>&lt;obj, obj1&gt; <span class=\"comment\">// nerver</span></span><br></pre></td></tr></table></figure>\n<p>从上述代码上来看,我们比较了下类型上的，当 T 中有 U 就会剔除对应的属性，如果 U 中又的属性 T 中没有，或 T 和 U 刚好一样的情况都会返回 <strong>nerver</strong>，且对象永远返回<code>nerver</code>。</p>\n<h3 id=\"Extra\"><a href=\"#Extra\" class=\"headerlink\" title=\"Extra\"></a>Extra</h3><p>Extra语法：<code>Extra&lt;T, U&gt;</code></p>\n<p>作用：将 T 可分配给的类型中提取 U。与 <strong>Exclude</strong>相反</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> numProps = <span class=\"title class_\">Extract</span>&lt;<span class=\"number\">1</span> | <span class=\"number\">2</span> | <span class=\"number\">3</span>, <span class=\"number\">1</span> | <span class=\"number\">2</span>&gt; <span class=\"comment\">// 1 | 2</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Omit\"><a href=\"#Omit\" class=\"headerlink\" title=\"Omit\"></a>Omit</h3><p>Omit语法：<code>Omit&lt;T, U&gt;</code></p>\n<p>作用：将已经声明的类型进行属性剔除获得新类型</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7afb178ecc2b4427b82b7a5ebe3ab035~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<p>与 Exclude的区别：Omit 返回的是新的类型，原理上是在 Exclude之上进行的，Exclude是根据自类型返回的。</p>\n<h3 id=\"NonNullable\"><a href=\"#NonNullable\" class=\"headerlink\" title=\"NonNullable\"></a>NonNullable</h3><p>NonNullable语法：<code>NonNullable&lt;T&gt;</code> 作用：从 T 中排除 null 和 undefined</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/825ae5b2e0704d4aba9b143fdf6c6835~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp\" alt=\"image.png\"></p>\n<h3 id=\"ReturnType\"><a href=\"#ReturnType\" class=\"headerlink\" title=\"ReturnType\"></a>ReturnType</h3><p>ReturnType语法：<code>ReturnType&lt;T&gt;</code></p>\n<p>作用：用于获取 <strong>函数T的返回类型。</strong></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props</span> = <span class=\"title class_\">ReturnType</span>&lt;<span class=\"function\">() =&gt;</span> <span class=\"built_in\">string</span>&gt; <span class=\"comment\">// string</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props1</span> = <span class=\"title class_\">ReturnType</span>&lt;&lt;T <span class=\"keyword\">extends</span> U, U <span class=\"keyword\">extends</span> <span class=\"built_in\">number</span>&gt;<span class=\"function\">() =&gt;</span> T&gt;; <span class=\"comment\">// number</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props2</span> = <span class=\"title class_\">ReturnType</span>&lt;<span class=\"built_in\">any</span>&gt;; <span class=\"comment\">// any</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props3</span> = <span class=\"title class_\">ReturnType</span>&lt;<span class=\"built_in\">never</span>&gt;; <span class=\"comment\">// any</span></span><br></pre></td></tr></table></figure>\n<p>从上述代码上来看， ReturnType可以接受 any 和 never 类型，原因是这两个类型属于顶级类型，包含函数。</p>\n<h3 id=\"Parameters\"><a href=\"#Parameters\" class=\"headerlink\" title=\"Parameters\"></a>Parameters</h3><p>Parameters：<code>Parameters&lt;T&gt;</code> </p>\n<p>作用：用于获取 获取函数类型的参数类型</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props</span> = <span class=\"title class_\">Parameters</span>&lt;<span class=\"function\">() =&gt;</span> <span class=\"built_in\">string</span>&gt; <span class=\"comment\">// []</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props1</span> = <span class=\"title class_\">Parameters</span>&lt;<span class=\"function\">(<span class=\"params\">data: <span class=\"built_in\">string</span></span>) =&gt;</span> <span class=\"built_in\">void</span>&gt; <span class=\"comment\">// [string]</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props2</span> = <span class=\"title class_\">Parameters</span>&lt;<span class=\"built_in\">any</span>&gt;; <span class=\"comment\">// unknown[]</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Props3</span> = <span class=\"title class_\">Parameters</span>&lt;<span class=\"built_in\">never</span>&gt;; <span class=\"comment\">// never</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n<h2 id=\"拓展\"><a href=\"#拓展\" class=\"headerlink\" title=\"拓展\"></a>拓展</h2><ul>\n<li><a href=\"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-0.html\">TypeScript 4.0 文档</a></li>\n<li><a href=\"https://jkchao.github.io/typescript-book-chinese/project/namespaces.html\">深入理解 TypeScript </a></li>\n<li><a href=\"https://juejin.cn/post/6872111128135073806\">一份不可多得的 TS 学习指南（1.8W字）</a></li>\n</ul>\n"},{"title":"vue-devtools 安装教程","date":"2023-03-07T14:51:55.000Z","description":"vue-devtools是一款基于chrome浏览器的插件，用于调试vue应用，这可以极大地提高我们的调试效率。","_content":"\n## 安装\n\n> 省流版：https://crxdl.com/ 搜索vue就能下载 .crx 文件，之后打开谷歌扩展程序，拖进去即可。\n\n**1. 克隆 vue-devtools 代码到本地**\n\n```sh\ngit clone https://github.com/vuejs/vue-devtools.git\n```\n\n**2. 进入代码目录，安装依赖**\n\n```sh\ncd vue-devtools\nnpm install\n```\n\n如果你的 npm 是 npm7.x，那么很可能出现以下问题：\n\n```js\nnpm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! While resolving: vue-devtools@6.0.0-beta.15\nnpm ERR! Found: eslint@7.32.0\nnpm ERR! node_modules/eslint\nnpm ERR!   dev eslint@\"^7.26.0\" from the root project\nnpm ERR!   peer eslint@\"^7.12.1\" from @vue/eslint-config-standard@6.1.0\nnpm ERR!   node_modules/@vue/eslint-config-standard\nnpm ERR!     dev @vue/eslint-config-standard@\"^6.0.0\" from the root project\nnpm ERR!   3 more (eslint-plugin-import, eslint-plugin-node, eslint-plugin-promise)\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! peer eslint@\"^5.0.0 || ^6.0.0\" from eslint-plugin-vue@6.2.2\nnpm ERR! node_modules/eslint-plugin-vue\nnpm ERR!   dev eslint-plugin-vue@\"^6.0.0\" from the root project\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\nnpm ERR! \nnpm ERR! See /Users/ykx/.npm/eresolve-report.txt for a full report.\n \nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/xxx/.npm/_logs/2021-09-01T06_06_25_956Z-debug.log\n```\n\n因为npm7.x对某些事情比npm6.x更严格\n\n解决办法：\n\n```sh\nnpm i --legacy-peer-deps\n```\n\n**3. 修改 manifest.json 文件 persistent 为 true**\n\nvue-devtools>packages>shell-chrome>manifest.josn\n\n**4. 在 vue-devtools 目录下编译代码**\n\n```sh\nnpm run build\n```\n\n这个过程若报错如下：\n\n```sh\nlerna notice cli v4.0.0\nlerna info Executing command in 9 packages: \"yarn run build\"\nlerna ERR! yarn run build exited 2 in '@vue/devtools-api'\nlerna ERR! yarn run build exited 2 in '@vue/devtools-api'\n```\n\n解决办法：\n\n1. 安装 yarn 工具 `npm install yarn -g`\n2. 用 yarn 安装依赖 `yarn install`\n3. 用 yarn 构建 `yarn run build`\n\n**5. 安装 Chrome 扩展插件**\n\n打开 Chrome 浏览器，点击 三个点-更多工具-扩展程序-开发者模式-加载已解压的扩展程序- vue-devtools>packages>shell-chrome 放入。\n\n启动 Vue 项目后，f12 在控制台中即会出现 vue 一栏，选中 vue 就可使用了。\n\n\n **安装后控制台不显示vue选项的可能原因：** \n\n1. 找到插件 -> 点击“详情” -> 把“允许访问文件网址”开启；\n2. 入口文件（main.js）中禁用了 vue 调试工具：Vue.config.devtools = false 把它设置为 true 即可；\n3. 因为使用了 vue 的压缩版本，所以浏览器控制台默认不显示 vue 调试工具，可以在 index.html 中加个判断条件，开发环境时不使用压缩版本。\n    ```html\n    <% if (process.env.NODE_ENV === 'production') { %>\n    <script src=\"xxx/vue.min.js\"></script>\n    <% } else { %>\n    <script src=\"xxx/vue.js\"></script>\n    <% } %>\n    ```","source":"_posts/vue-devtools.md","raw":"---\ntitle: vue-devtools 安装教程\ndate: 2023-03-07 22:51:55\ntags: Vue.js\ncategories: 工具\ndescription: vue-devtools是一款基于chrome浏览器的插件，用于调试vue应用，这可以极大地提高我们的调试效率。\n---\n\n## 安装\n\n> 省流版：https://crxdl.com/ 搜索vue就能下载 .crx 文件，之后打开谷歌扩展程序，拖进去即可。\n\n**1. 克隆 vue-devtools 代码到本地**\n\n```sh\ngit clone https://github.com/vuejs/vue-devtools.git\n```\n\n**2. 进入代码目录，安装依赖**\n\n```sh\ncd vue-devtools\nnpm install\n```\n\n如果你的 npm 是 npm7.x，那么很可能出现以下问题：\n\n```js\nnpm ERR! code ERESOLVE\nnpm ERR! ERESOLVE unable to resolve dependency tree\nnpm ERR! \nnpm ERR! While resolving: vue-devtools@6.0.0-beta.15\nnpm ERR! Found: eslint@7.32.0\nnpm ERR! node_modules/eslint\nnpm ERR!   dev eslint@\"^7.26.0\" from the root project\nnpm ERR!   peer eslint@\"^7.12.1\" from @vue/eslint-config-standard@6.1.0\nnpm ERR!   node_modules/@vue/eslint-config-standard\nnpm ERR!     dev @vue/eslint-config-standard@\"^6.0.0\" from the root project\nnpm ERR!   3 more (eslint-plugin-import, eslint-plugin-node, eslint-plugin-promise)\nnpm ERR! \nnpm ERR! Could not resolve dependency:\nnpm ERR! peer eslint@\"^5.0.0 || ^6.0.0\" from eslint-plugin-vue@6.2.2\nnpm ERR! node_modules/eslint-plugin-vue\nnpm ERR!   dev eslint-plugin-vue@\"^6.0.0\" from the root project\nnpm ERR! \nnpm ERR! Fix the upstream dependency conflict, or retry\nnpm ERR! this command with --force, or --legacy-peer-deps\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\nnpm ERR! \nnpm ERR! See /Users/ykx/.npm/eresolve-report.txt for a full report.\n \nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /Users/xxx/.npm/_logs/2021-09-01T06_06_25_956Z-debug.log\n```\n\n因为npm7.x对某些事情比npm6.x更严格\n\n解决办法：\n\n```sh\nnpm i --legacy-peer-deps\n```\n\n**3. 修改 manifest.json 文件 persistent 为 true**\n\nvue-devtools>packages>shell-chrome>manifest.josn\n\n**4. 在 vue-devtools 目录下编译代码**\n\n```sh\nnpm run build\n```\n\n这个过程若报错如下：\n\n```sh\nlerna notice cli v4.0.0\nlerna info Executing command in 9 packages: \"yarn run build\"\nlerna ERR! yarn run build exited 2 in '@vue/devtools-api'\nlerna ERR! yarn run build exited 2 in '@vue/devtools-api'\n```\n\n解决办法：\n\n1. 安装 yarn 工具 `npm install yarn -g`\n2. 用 yarn 安装依赖 `yarn install`\n3. 用 yarn 构建 `yarn run build`\n\n**5. 安装 Chrome 扩展插件**\n\n打开 Chrome 浏览器，点击 三个点-更多工具-扩展程序-开发者模式-加载已解压的扩展程序- vue-devtools>packages>shell-chrome 放入。\n\n启动 Vue 项目后，f12 在控制台中即会出现 vue 一栏，选中 vue 就可使用了。\n\n\n **安装后控制台不显示vue选项的可能原因：** \n\n1. 找到插件 -> 点击“详情” -> 把“允许访问文件网址”开启；\n2. 入口文件（main.js）中禁用了 vue 调试工具：Vue.config.devtools = false 把它设置为 true 即可；\n3. 因为使用了 vue 的压缩版本，所以浏览器控制台默认不显示 vue 调试工具，可以在 index.html 中加个判断条件，开发环境时不使用压缩版本。\n    ```html\n    <% if (process.env.NODE_ENV === 'production') { %>\n    <script src=\"xxx/vue.min.js\"></script>\n    <% } else { %>\n    <script src=\"xxx/vue.js\"></script>\n    <% } %>\n    ```","slug":"vue-devtools","published":1,"updated":"2023-03-11T16:40:36.823Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsij0036yt8wg4mt2hsn","content":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><blockquote>\n<p>省流版：<a href=\"https://crxdl.com/\">https://crxdl.com/</a> 搜索vue就能下载 .crx 文件，之后打开谷歌扩展程序，拖进去即可。</p>\n</blockquote>\n<p><strong>1. 克隆 vue-devtools 代码到本地</strong></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/vuejs/vue-devtools.git</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 进入代码目录，安装依赖</strong></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> vue-devtools</span><br><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n\n<p>如果你的 npm 是 npm7.x，那么很可能出现以下问题：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! code <span class=\"variable constant_\">ERESOLVE</span></span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"variable constant_\">ERESOLVE</span> unable to resolve dependency tree</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! </span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"title class_\">While</span> <span class=\"attr\">resolving</span>: vue-devtools@<span class=\"number\">6.0</span><span class=\"number\">.0</span>-beta<span class=\"number\">.15</span></span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"title class_\">Found</span>: eslint@<span class=\"number\">7.32</span><span class=\"number\">.0</span></span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! node_modules/eslint</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!   dev eslint@<span class=\"string\">&quot;^7.26.0&quot;</span> <span class=\"keyword\">from</span> the root project</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!   peer eslint@<span class=\"string\">&quot;^7.12.1&quot;</span> <span class=\"keyword\">from</span> @vue/eslint-config-standard@<span class=\"number\">6.1</span><span class=\"number\">.0</span></span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!   node_modules/@vue/eslint-config-standard</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!     dev @vue/eslint-config-standard@<span class=\"string\">&quot;^6.0.0&quot;</span> <span class=\"keyword\">from</span> the root project</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!   <span class=\"number\">3</span> more (eslint-plugin-<span class=\"keyword\">import</span>, eslint-plugin-node, eslint-plugin-promise)</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! </span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"title class_\">Could</span> not resolve <span class=\"attr\">dependency</span>:</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! peer eslint@<span class=\"string\">&quot;^5.0.0 || ^6.0.0&quot;</span> <span class=\"keyword\">from</span> eslint-plugin-vue@<span class=\"number\">6.2</span><span class=\"number\">.2</span></span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! node_modules/eslint-plugin-vue</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!   dev eslint-plugin-vue@<span class=\"string\">&quot;^6.0.0&quot;</span> <span class=\"keyword\">from</span> the root project</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! </span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"title class_\">Fix</span> the upstream dependency conflict, or retry</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"variable language_\">this</span> command <span class=\"keyword\">with</span> --force, or --legacy-peer-deps</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! to accept an incorrect (and potentially broken) dependency resolution.</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! </span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"title class_\">See</span> /<span class=\"title class_\">Users</span>/ykx/.<span class=\"property\">npm</span>/eresolve-report.<span class=\"property\">txt</span> <span class=\"keyword\">for</span> a full report.</span><br><span class=\"line\"> </span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! A complete log <span class=\"keyword\">of</span> <span class=\"variable language_\">this</span> run can be found <span class=\"attr\">in</span>:</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!     <span class=\"regexp\">/Users/</span>xxx/.<span class=\"property\">npm</span>/_logs/<span class=\"number\">2021</span>-<span class=\"number\">09</span>-01T06_06_25_956Z-debug.<span class=\"property\">log</span></span><br></pre></td></tr></table></figure>\n\n<p>因为npm7.x对某些事情比npm6.x更严格</p>\n<p>解决办法：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --legacy-peer-deps</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. 修改 manifest.json 文件 persistent 为 true</strong></p>\n<p>vue-devtools&gt;packages&gt;shell-chrome&gt;manifest.josn</p>\n<p><strong>4. 在 vue-devtools 目录下编译代码</strong></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<p>这个过程若报错如下：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lerna notice cli v4.0.0</span><br><span class=\"line\">lerna info Executing <span class=\"built_in\">command</span> <span class=\"keyword\">in</span> 9 packages: <span class=\"string\">&quot;yarn run build&quot;</span></span><br><span class=\"line\">lerna ERR! yarn run build exited 2 <span class=\"keyword\">in</span> <span class=\"string\">&#x27;@vue/devtools-api&#x27;</span></span><br><span class=\"line\">lerna ERR! yarn run build exited 2 <span class=\"keyword\">in</span> <span class=\"string\">&#x27;@vue/devtools-api&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>解决办法：</p>\n<ol>\n<li>安装 yarn 工具 <code>npm install yarn -g</code></li>\n<li>用 yarn 安装依赖 <code>yarn install</code></li>\n<li>用 yarn 构建 <code>yarn run build</code></li>\n</ol>\n<p><strong>5. 安装 Chrome 扩展插件</strong></p>\n<p>打开 Chrome 浏览器，点击 三个点-更多工具-扩展程序-开发者模式-加载已解压的扩展程序- vue-devtools&gt;packages&gt;shell-chrome 放入。</p>\n<p>启动 Vue 项目后，f12 在控制台中即会出现 vue 一栏，选中 vue 就可使用了。</p>\n<p> <strong>安装后控制台不显示vue选项的可能原因：</strong> </p>\n<ol>\n<li>找到插件 -&gt; 点击“详情” -&gt; 把“允许访问文件网址”开启；</li>\n<li>入口文件（main.js）中禁用了 vue 调试工具：Vue.config.devtools &#x3D; false 把它设置为 true 即可；</li>\n<li>因为使用了 vue 的压缩版本，所以浏览器控制台默认不显示 vue 调试工具，可以在 index.html 中加个判断条件，开发环境时不使用压缩版本。 <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;% if (process.env.NODE_ENV === &#x27;production&#x27;) &#123; %&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;xxx/vue.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">&lt;% &#125; else &#123; %&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;xxx/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><blockquote>\n<p>省流版：<a href=\"https://crxdl.com/\">https://crxdl.com/</a> 搜索vue就能下载 .crx 文件，之后打开谷歌扩展程序，拖进去即可。</p>\n</blockquote>\n<p><strong>1. 克隆 vue-devtools 代码到本地</strong></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/vuejs/vue-devtools.git</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 进入代码目录，安装依赖</strong></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> vue-devtools</span><br><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n\n<p>如果你的 npm 是 npm7.x，那么很可能出现以下问题：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! code <span class=\"variable constant_\">ERESOLVE</span></span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"variable constant_\">ERESOLVE</span> unable to resolve dependency tree</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! </span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"title class_\">While</span> <span class=\"attr\">resolving</span>: vue-devtools@<span class=\"number\">6.0</span><span class=\"number\">.0</span>-beta<span class=\"number\">.15</span></span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"title class_\">Found</span>: eslint@<span class=\"number\">7.32</span><span class=\"number\">.0</span></span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! node_modules/eslint</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!   dev eslint@<span class=\"string\">&quot;^7.26.0&quot;</span> <span class=\"keyword\">from</span> the root project</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!   peer eslint@<span class=\"string\">&quot;^7.12.1&quot;</span> <span class=\"keyword\">from</span> @vue/eslint-config-standard@<span class=\"number\">6.1</span><span class=\"number\">.0</span></span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!   node_modules/@vue/eslint-config-standard</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!     dev @vue/eslint-config-standard@<span class=\"string\">&quot;^6.0.0&quot;</span> <span class=\"keyword\">from</span> the root project</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!   <span class=\"number\">3</span> more (eslint-plugin-<span class=\"keyword\">import</span>, eslint-plugin-node, eslint-plugin-promise)</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! </span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"title class_\">Could</span> not resolve <span class=\"attr\">dependency</span>:</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! peer eslint@<span class=\"string\">&quot;^5.0.0 || ^6.0.0&quot;</span> <span class=\"keyword\">from</span> eslint-plugin-vue@<span class=\"number\">6.2</span><span class=\"number\">.2</span></span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! node_modules/eslint-plugin-vue</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!   dev eslint-plugin-vue@<span class=\"string\">&quot;^6.0.0&quot;</span> <span class=\"keyword\">from</span> the root project</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! </span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"title class_\">Fix</span> the upstream dependency conflict, or retry</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"variable language_\">this</span> command <span class=\"keyword\">with</span> --force, or --legacy-peer-deps</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! to accept an incorrect (and potentially broken) dependency resolution.</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! </span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! <span class=\"title class_\">See</span> /<span class=\"title class_\">Users</span>/ykx/.<span class=\"property\">npm</span>/eresolve-report.<span class=\"property\">txt</span> <span class=\"keyword\">for</span> a full report.</span><br><span class=\"line\"> </span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>! A complete log <span class=\"keyword\">of</span> <span class=\"variable language_\">this</span> run can be found <span class=\"attr\">in</span>:</span><br><span class=\"line\">npm <span class=\"variable constant_\">ERR</span>!     <span class=\"regexp\">/Users/</span>xxx/.<span class=\"property\">npm</span>/_logs/<span class=\"number\">2021</span>-<span class=\"number\">09</span>-01T06_06_25_956Z-debug.<span class=\"property\">log</span></span><br></pre></td></tr></table></figure>\n\n<p>因为npm7.x对某些事情比npm6.x更严格</p>\n<p>解决办法：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --legacy-peer-deps</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. 修改 manifest.json 文件 persistent 为 true</strong></p>\n<p>vue-devtools&gt;packages&gt;shell-chrome&gt;manifest.josn</p>\n<p><strong>4. 在 vue-devtools 目录下编译代码</strong></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<p>这个过程若报错如下：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lerna notice cli v4.0.0</span><br><span class=\"line\">lerna info Executing <span class=\"built_in\">command</span> <span class=\"keyword\">in</span> 9 packages: <span class=\"string\">&quot;yarn run build&quot;</span></span><br><span class=\"line\">lerna ERR! yarn run build exited 2 <span class=\"keyword\">in</span> <span class=\"string\">&#x27;@vue/devtools-api&#x27;</span></span><br><span class=\"line\">lerna ERR! yarn run build exited 2 <span class=\"keyword\">in</span> <span class=\"string\">&#x27;@vue/devtools-api&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>解决办法：</p>\n<ol>\n<li>安装 yarn 工具 <code>npm install yarn -g</code></li>\n<li>用 yarn 安装依赖 <code>yarn install</code></li>\n<li>用 yarn 构建 <code>yarn run build</code></li>\n</ol>\n<p><strong>5. 安装 Chrome 扩展插件</strong></p>\n<p>打开 Chrome 浏览器，点击 三个点-更多工具-扩展程序-开发者模式-加载已解压的扩展程序- vue-devtools&gt;packages&gt;shell-chrome 放入。</p>\n<p>启动 Vue 项目后，f12 在控制台中即会出现 vue 一栏，选中 vue 就可使用了。</p>\n<p> <strong>安装后控制台不显示vue选项的可能原因：</strong> </p>\n<ol>\n<li>找到插件 -&gt; 点击“详情” -&gt; 把“允许访问文件网址”开启；</li>\n<li>入口文件（main.js）中禁用了 vue 调试工具：Vue.config.devtools &#x3D; false 把它设置为 true 即可；</li>\n<li>因为使用了 vue 的压缩版本，所以浏览器控制台默认不显示 vue 调试工具，可以在 index.html 中加个判断条件，开发环境时不使用压缩版本。 <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;% if (process.env.NODE_ENV === &#x27;production&#x27;) &#123; %&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;xxx/vue.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">&lt;% &#125; else &#123; %&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;xxx/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure></li>\n</ol>\n"},{"title":"十个场景助你从 vue2 过渡到 vue3","date":"2023-03-01T13:23:27.000Z","description":"十个场景结合尤大大推荐的 setup，助你从 Vue2 丝滑过渡到 Vue3","_content":"\n相信有很多这样的兄弟，学了 Vue3 的各种 API 和新特性，但公司项目依然使用的是 Vue2 ，也不知道自己的水平能否上手 Vue3 项目。其实你学的是零碎的知识点，缺少真实的使用场景。\n\n今天就把实战过程中遇到的十个场景分享给大家，结合尤大大推荐的 `<script setup>`，希望你能从 Vue2 丝滑过渡到 Vue3！\n\n## 「场景一：父子组件数据传递」\n\n### 父组件数据传递到子组件\n\nVue3 中父组件同样是通过属性传递数据，但子组件接受数据的方式和 Vue2 不同。在 `<script setup>` 中，props 需要使用 defineProps() 这个宏函数来进行声明，它的参数和 Vue2 props 选项的值是一样的。\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\n</script>\n\n<template>\n  <ChildView some-prop=\"parent message\" />\n</template>\n```\n\n```html\n<!-- 子组件 -->\n<script setup>\nconst props = defineProps({\n  someProp: {\n    type: String,\n    required: true\n  }\n})\nconsole.log(props.someProp) // parent message\n</script>\n\n<template>\n  <!-- 使用 someProp 或 props.someProp -->\n  <div>{{ someProp }}</div>\n  <div>{{ props.someProp }}</div>\n</template>\n```\n\n注意：defineProps 、defineEmits 、 defineExpose 和 withDefaults 这四个宏函数只能在 `<script setup>` 中使用。他们不需要导入，会随着 `<script setup>` 的处理过程中一起被编译。\n\n### 子组件数据传递到父组件\n\nVue2 中子组件数据传递到父组件，通常是使用 $emit 触发一个自定义事件来进行传递。但 $emit 无法在 `<script setup>` 中使用，这时候我们需要使用 defineEmits()：\n\n```html\n<!-- 子组件 -->\n<script setup>\nconst emit = defineEmits(['someEvent'])\nfunction onClick() {\n  emit('someEvent', 'child message')\n}\n</script>\n\n<template>\n  <button @click=\"onClick\">点击</button>\n</template>\n```\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\n\nfunction someEvent(value) {\n  console.log(value) // child message\n}\n</script>\n\n<template>\n  <ChildView @some-event=\"someEvent\" />\n</template>\n```\n\n### 父组件使用子组件数据\n\n在 `<script setup>` 中，组件的属性和方法默认都是私有的。父组件无法访问到子组件中的任何东西，除非子组件通过 defineExpose 显式的暴露出去：\n\n```html\n<!-- 子组件 -->\n<script setup>\nimport { ref } from 'vue'\n\nconst msg = ref('hello vue3!')\nfunction change() {\n  msg.value = 'hi vue3!'\n  console.log(msg.value)\n}\n// 属性或方法必须暴露出去，父组件才能使用\ndefineExpose({ msg, change })\n</script>\n```\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\nimport { ref, onMounted } from 'vue'\n\nconst child = ref(null)\nonMounted(() => {\n  console.log(child.value.msg) // hello vue3!\n  child.value.change() // hi vue3!\n})\n</script>\n\n<template>\n  <ChildView ref=\"child\"></ChildView>\n</template>\n```\n\n\n## 「场景二：组件之间双向绑定」\n\n家都知道 Vue2 中组件的双向绑定采用的是 v-model 或 .snyc 修饰符，两种写法多少显得有点重复，于是在 Vue3 中合成了一种。Vue3 统一使用 v-model 进行处理，并且可以和多个数据进行绑定，如 v-model:foo、v-model:bar。\n\n- v-model 等价于 :model-value=\"someValue\" 和 @update:model-value=\"someValue = $event\"\n- v-model:foo 等价于 :foo=\"someValue\" 和 @update:foo=\"someValue = $event\"\n\n下面就是一个父子组件之间双向绑定的例子：\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\nimport { ref } from 'vue'\n\nconst msg = ref('hello vue3!')\n</script>\n\n<template>\n  <ChildView v-model=\"msg\" />\n</template>\n```\n\n```html\n<!-- 子组件 -->\n<script setup>\ndefineProps(['modelValue'])\nconst emit = defineEmits(['update:modelValue'])\n</script>\n\n<template>\n  <div @click=\"emit('update:modelValue', 'hi vue3！')\">{{ modelValue }}</div>\n</template>\n```\n\n子组件可以结合 input 使用：\n\n```html\n<!-- 子组件 -->\n<script setup>\ndefineProps(['modelValue'])\nconst emit = defineEmits(['update:modelValue'])\n</script>\n\n<template>\n  <input :value=\"modelValue\" @input=\"emit('update:modelValue', $event.target.value)\" />\n</template>\n```\n\n如果你觉得上面的模板比较繁琐，也可以结合 computed 一起使用：\n\n```html\n<!-- 子组件 -->\n<script setup>\nimport { computed } from 'vue'\n\nconst props = defineProps(['modelValue'])\nconst emit = defineEmits(['update:modelValue'])\nconst newValue = computed({\n  get() {\n    return props.modelValue\n  },\n  set(value) {\n    emit('update:modelValue', value)\n  }\n})\n</script>\n\n<template>\n  <input v-model=\"newValue\" />\n</template>\n```\n\n\n## 「场景三：路由跳转，获取路由参数」\n\nVue2 中我们通常是使用 this.$router 或 this.$route 来进行路由的跳转和参数获取，但在 `<script-setup>`中，是这些方法无法使用的。我们可以使用 vue-router 提供的 useRouter 方法，来进行路由跳转：\n\n```html\n<script setup>\nimport { useRouter } from 'vue-router'\n\nconst router = useRouter()\nfunction onClick() {\n  router.push({\n    path: '/about',\n    query: {\n      msg: 'hello vue3!'\n    }\n  })\n}\n</script>\n```\n\n当我们要获取路由参数时，可以使用 vue-router 提供的 useRoute方法：\n\n```html\n<script setup>\nimport { useRoute } from 'vue-router'\n\nconst route = useRoute()\nconsole.log(route.query.msg) // hello vue3!\n</script>\n```\n\n\n## 「场景四：获取上下文对象」\n\nVue3 的 setup 中无法使用 this 这个上下文对象。可能刚接触 Vue3 的兄弟会有点懵，我想使用 this 上的属性和方法应该怎么办呢。虽然不推荐这样使用，但依然可以通过 getCurrentInstance 方法获取上下文对象：\n\n```js\nimport { getCurrentInstance } from 'vue'\n\n// 以下两种方法都可以获取到上下文对象\nconst { ctx } = getCurrentInstance()\nconst { proxy }  = getCurrentInstance()\n```\n\n这样我们就可以使用 $parent 、$refs 等，干自己想干的事情了。\n\n注意：ctx 只能在开发环境使用，生成环境为 undefined 。 推荐使用 proxy ，在开发环境和生产环境都可以使用。\n\n\n## 「场景五：插槽的使用」\n\n在 Vue2 的中一般是通过 slot 属性指定模板的位置，通过 slot-scope 获取作用域插槽的数据，如：\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\n</script>\n\n<template>\n  <div>parent<div>\n  <ChildView>\n    <template slot=\"content\" slot-scope=\"{ msg }\">\n      <div>{{ msg }}</div>\n    </template>\n  </ChildView>\n</template>\n```\n\n```html\n<!-- 子组件 -->\n<template>\n  <div>child</div>\n  <slot name=\"content\" msg=\"hello vue3!\"></slot>\n</template>\n```\n\n在 Vue3 中则是通过 v-slot 这个指令来指定模板的位置，同时获取作用域插槽的数据，如：\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\n</script>\n\n<template>\n  <div>parent</div>\n  <ChildView>\n    <template v-slot:content=\"{ msg }\">\n      <div>{{ msg }}</div>\n    </template>\n  </ChildView>\n</template>\n\n<!-- ChildView 也可以简写为： -->\n<ChildView>\n  <template #content=\"{ msg }\">\n    <div>{{ msg }}</div>\n  </template>\n</ChildView>\n```\n\n```html\n<!-- 子组件 -->\n<template>\n  <div>child</div>\n  <slot name=\"content\" msg=\"hello vue3!\"></slot>\n</template>\n```\n\n注意：v-slot 在 Vue2 中也可以使用，但必须是 Vue2.6+ 的版本。\n\n\n## 「场景六：缓存路由组件」\n\n缓存一般的动态组件，Vue3 和 Vue2 的用法是一样的，都是使用 KeepAlive 包裹 Component。但缓存路由组件，Vue3 需要结合插槽一起使用：\n\n```js\n// Vue2 中缓存路由组件\n<KeepAlive>\n  <RouterView />\n</KeepAlive>\n```\n\n```js\n// Vue3 中缓存路由组件\n<RouterView v-slot=\"{ Component }\">\n  <KeepAlive>\n    <Component :is=\"Component\"></Component>\n  </KeepAlive>\n</RouterView>\n```\n\n一个持续存在的组件可以通过 onActivated() 和 onDeactivated() 两个生命周期钩子注入相应的逻辑:\n\n```js\nimport { onActivated, onDeactivated } from 'vue'\n\nonActivated(() => {\n  // 调用时机为首次挂载\n  // 以及每次从缓存中被重新插入时\n})\n\nonDeactivated(() => {\n  // 调用时机为从 DOM 上移除、进入缓存\n  // 以及组件卸载时\n})\n```\n\n## 「场景七：逻辑复用」\n\nVue2 中逻辑复用主要是采用 mixin，但 mixin 会使数据来源不明，同时会引起命名冲突。所以 Vue3 更推荐的是全新的 Composition Api。\n\n下面是鼠标跟踪的例子，我们可以把逻辑提取出来：\n\n```js\n// mouse.js\nimport { ref, onMounted, onUnmounted } from 'vue'\n\n// 按照惯例，组合式函数名以 use 开头\nexport function useMouse() {\n  // 组合式函数管理的数据\n  const x = ref(0)\n  const y = ref(0)\n\n  function update(event) {\n    x.value = event.pageX\n    y.value = event.pageY\n  }\n\n  // 组合式函数可以挂靠在所属组件的生命周期上，来启动和卸载副作用\n  onMounted(() => window.addEventListener('mousemove', update))\n  onUnmounted(() => window.removeEventListener('mousemove', update))\n\n  // 通过返回值暴露所管理的数据\n  return { x, y }\n}\n```\n\n这时候在组件中我们就可以直接使用 mouse.js 暴露的数据了。\n\n```html\n<script setup>\nimport { useMouse } from './mouse.js'\n\nconst { x, y } = useMouse()\n</script>\n\n<template>Mouse position is at: {{ x }}, {{ y }}</template>\n```\n\n我们还可以在一个组件中引入多个组合式函数，或者在一个组合式函数中引入其他的组合式函数，这个比较简单，我就不演示了。接下来，我们看看使用异步方法的组合式函数。\n\n在做异步数据请求时，我们通常需要处理三个不同的状态：加载中、加载成功和加载失败。获取这些状态的逻辑是通用的，我们可以把它提取出来：\n\n```js\n// request.js\nimport { ref } from 'vue'\n\nexport function useRequest(url) {\n  const data = ref(null)\n  const error = ref(null)\n\n  axios.get(url)\n    .then((res) => (data.value = res.data))\n    .catch((err) => (error.value = err))\n\n  return { data, error }\n}\n```\n\n现在我们在组件中只需要：\n\n```html\n<script setup>\nimport { useRequest } from './request.js'\n\nconst { data, error } = useRequest('http://...')\n</script>\n\n<template>\n  <div v-if=\"data\">Data is: {{ data }}</div>\n  <div v-else-if=\"error\">Error message is: {{ error.message }}</div>\n  <div v-else>Loading...</div>\n</template>\n```\n\n任何组件都可以使用上面这个逻辑，这就是逻辑复用。\n\n\n## 「场景八：生命周期」\n\nVue3 的生命周期和 Vue2 相比，有以下改动：\n\n- Vue3 生命周期钩子都以 on 开头，并且需要在组件中手动导入。\n- Vue3 取消了 beforeCreate 和 created 钩子。如果需要在组件创建前注入逻辑，直接在 `<script setup>` 中编写同步代码就可以了。如果这几个钩子同时存在，setup 的执行顺序要优先于 beforeCreate 和 created。\n- Vue3 中组件卸载的钩子名称有变化，beforeDestroy 改为 onBeforeUnmount，destroyed 改为 onUnmounted。\n\n```js\nimport { onMounted } from 'vue'\n\nonMounted(() => {\n  console.log('onMounted')\n})\n```\n\n\n## 「场景九：全局 API」\n\nVue2 中的全局属性或全局方法，是在构造函数 Vue 的原型对象上进行添加，如：Vue.prototype.$axios = axios 。但在 Vue3 中，需要在 app 实例上添加：\n\n```js\n// main.js\napp.config.globalProperties.$axios = axios\n```\n\n在组件中使用：\n\n```js\nimport { getCurrentInstance } from 'vue'\n\nconst { proxy } = getCurrentInstance()\nproxy.$axios.get('http://...')\n```\n\nVue3 中其他的全局 API，如 directive 、component 等，跟 Vue2 的用法都差不多，只不过一个是在 Vue 上调用，一个是在 app 实例上调用：\n\n```js\n// main.js\n// 全局自定义指令\napp.directive('focus', {\n  mounted(el) {\n    el.focus()\n  }\n})\n\n// 全局自定义组件\nimport CustomComp from './components/CustomComp.vue'\n\napp.component('CustomComp', CustomComp)\n```\n\n需要注意的是，Vue3 废弃了 filter 这个方法，因为通过函数或 computed 可以实现一样的功能。\n\n\n## 「常见十：与 TypeScript 结合使用」\n\n与 TypeScript 结合使用，我们只需要在 `<script setup>` 中添加 `lang=\"ts\"` 就可以了。下面是一些和 TypeScript 结合使用的例子。\n\n### 为 props 标注类型\n\n**运行时声明**\n\n当使用 `<script setup>` 时，defineProps() 宏函数支持从它的参数中推导类型：\n\n```typescript\n<script setup lang=\"ts\">\nconst props = defineProps({\n  foo: { type: String, required: true },\n  bar: Number\n})\n\nprops.foo // string\nprops.bar // number | undefined\n</script>\n```\n\n这被称为 运行时声明 ，因为传递给 defineProps() 的参数会作为运行时的 props 选项使用。\n\n**基于类型的声明**\n\n我们还可以通过泛型参数来定义 props 的类型，这种方式更加常用：\n\n```typescript\n<script setup lang=\"ts\">\ninterface Props {\n  foo: string\n  bar?: number\n}\n\nconst props = defineProps<Props>()\n</script>\n```\n\n这被称为 基于类型的声明 ，编译器会尽可能地尝试根据类型参数推导出等价的运行时选项。这种方式的不足之处在于，失去了定义 props 默认值的能力。为了解决这个问题，我们可以使用 withDefaults 宏函数：\n\n```js\n<script setup lang=\"ts\">\ninterface Props {\n  msg?: string\n  labels?: string[]\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  msg: 'hello vue3!',\n  labels: () => ['one', 'two']\n})\n</script>\n```\n\n### 为 ref() 标注类型\n\n**默认推导类型**\n\nref 会根据初始化时的值自动推导其类型：\n\n```js\nimport { ref } from 'vue'\n\nconst year = ref(2022)\nyear.value = '2022' // TS Error: 不能将类型 string 分配给类型 number\n```\n\n**通过接口指定类型**\n\n有时我们可能想为 ref 内的值指定一个更复杂的类型，可以使用 Ref 这个接口：\n\n```ts\nimport { ref } from 'vue'\nimport type { Ref } from 'vue'\n\nconst year: Ref<string | number> = ref('2022')\nyear.value = 2022 // 成功！\n```\n\n**通过泛型指定类型**\n\n我们也可以在调用 ref() 时传入一个泛型参数，来覆盖默认的推导行为：\n\n```ts\nconst year = ref<string | number>('2022')\nyear.value = 2022 // 成功！\n```\n\n### 为 reactive() 标注类型\n\n**默认推导类型**\n\nreactive() 也会隐式地从它的参数中推导类型：\n\n```ts\nimport { reactive } from 'vue'\n\nconst book = reactive({ title: 'Vue 3 指引' })\nbook.year = 2022 // TS Error: 类型 { title: string; } 上不存在属性 year\n```\n\n**通过接口指定类型**\n\n要显式地指定一个 reactive 变量的类型，我们可以使用接口：\n\n```ts\nimport { reactive } from 'vue'\n\ninterface Book {\n  title: string\n  year?: number\n}\n\nconst book: Book = reactive({ title: 'Vue 3 指引' })\nbook.year = 2022 // 成功！\n```\n\n其他 API 与 TypeScript 结合使用的方法和上面大同小异，这里我就不一一列举了。具体可以参考这篇文章：[如何为 Vue3 组件标注 TS 类型，看这个就够了！](https://juejin.cn/post/7129130323148800031)。\n\n\n## 最后\n\n以上就是我在 Vue3 项目中遇到最多的场景，如果你掌握了 Vue3 常用的 API 和今天这些场景，相信参与 Vue3 项目的开发是没有问题了。当然如果要用好 Vue3 ，可能还需要对 Pinia 、 Vite 等相关生态有一个深入的了解。","source":"_posts/vue3-scene.md","raw":"---\ntitle: 十个场景助你从 vue2 过渡到 vue3\ndate: 2023-03-01 21:23:27\ntags: Vue.js\ncategories: JavaScript\ndescription: 十个场景结合尤大大推荐的 setup，助你从 Vue2 丝滑过渡到 Vue3\n---\n\n相信有很多这样的兄弟，学了 Vue3 的各种 API 和新特性，但公司项目依然使用的是 Vue2 ，也不知道自己的水平能否上手 Vue3 项目。其实你学的是零碎的知识点，缺少真实的使用场景。\n\n今天就把实战过程中遇到的十个场景分享给大家，结合尤大大推荐的 `<script setup>`，希望你能从 Vue2 丝滑过渡到 Vue3！\n\n## 「场景一：父子组件数据传递」\n\n### 父组件数据传递到子组件\n\nVue3 中父组件同样是通过属性传递数据，但子组件接受数据的方式和 Vue2 不同。在 `<script setup>` 中，props 需要使用 defineProps() 这个宏函数来进行声明，它的参数和 Vue2 props 选项的值是一样的。\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\n</script>\n\n<template>\n  <ChildView some-prop=\"parent message\" />\n</template>\n```\n\n```html\n<!-- 子组件 -->\n<script setup>\nconst props = defineProps({\n  someProp: {\n    type: String,\n    required: true\n  }\n})\nconsole.log(props.someProp) // parent message\n</script>\n\n<template>\n  <!-- 使用 someProp 或 props.someProp -->\n  <div>{{ someProp }}</div>\n  <div>{{ props.someProp }}</div>\n</template>\n```\n\n注意：defineProps 、defineEmits 、 defineExpose 和 withDefaults 这四个宏函数只能在 `<script setup>` 中使用。他们不需要导入，会随着 `<script setup>` 的处理过程中一起被编译。\n\n### 子组件数据传递到父组件\n\nVue2 中子组件数据传递到父组件，通常是使用 $emit 触发一个自定义事件来进行传递。但 $emit 无法在 `<script setup>` 中使用，这时候我们需要使用 defineEmits()：\n\n```html\n<!-- 子组件 -->\n<script setup>\nconst emit = defineEmits(['someEvent'])\nfunction onClick() {\n  emit('someEvent', 'child message')\n}\n</script>\n\n<template>\n  <button @click=\"onClick\">点击</button>\n</template>\n```\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\n\nfunction someEvent(value) {\n  console.log(value) // child message\n}\n</script>\n\n<template>\n  <ChildView @some-event=\"someEvent\" />\n</template>\n```\n\n### 父组件使用子组件数据\n\n在 `<script setup>` 中，组件的属性和方法默认都是私有的。父组件无法访问到子组件中的任何东西，除非子组件通过 defineExpose 显式的暴露出去：\n\n```html\n<!-- 子组件 -->\n<script setup>\nimport { ref } from 'vue'\n\nconst msg = ref('hello vue3!')\nfunction change() {\n  msg.value = 'hi vue3!'\n  console.log(msg.value)\n}\n// 属性或方法必须暴露出去，父组件才能使用\ndefineExpose({ msg, change })\n</script>\n```\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\nimport { ref, onMounted } from 'vue'\n\nconst child = ref(null)\nonMounted(() => {\n  console.log(child.value.msg) // hello vue3!\n  child.value.change() // hi vue3!\n})\n</script>\n\n<template>\n  <ChildView ref=\"child\"></ChildView>\n</template>\n```\n\n\n## 「场景二：组件之间双向绑定」\n\n家都知道 Vue2 中组件的双向绑定采用的是 v-model 或 .snyc 修饰符，两种写法多少显得有点重复，于是在 Vue3 中合成了一种。Vue3 统一使用 v-model 进行处理，并且可以和多个数据进行绑定，如 v-model:foo、v-model:bar。\n\n- v-model 等价于 :model-value=\"someValue\" 和 @update:model-value=\"someValue = $event\"\n- v-model:foo 等价于 :foo=\"someValue\" 和 @update:foo=\"someValue = $event\"\n\n下面就是一个父子组件之间双向绑定的例子：\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\nimport { ref } from 'vue'\n\nconst msg = ref('hello vue3!')\n</script>\n\n<template>\n  <ChildView v-model=\"msg\" />\n</template>\n```\n\n```html\n<!-- 子组件 -->\n<script setup>\ndefineProps(['modelValue'])\nconst emit = defineEmits(['update:modelValue'])\n</script>\n\n<template>\n  <div @click=\"emit('update:modelValue', 'hi vue3！')\">{{ modelValue }}</div>\n</template>\n```\n\n子组件可以结合 input 使用：\n\n```html\n<!-- 子组件 -->\n<script setup>\ndefineProps(['modelValue'])\nconst emit = defineEmits(['update:modelValue'])\n</script>\n\n<template>\n  <input :value=\"modelValue\" @input=\"emit('update:modelValue', $event.target.value)\" />\n</template>\n```\n\n如果你觉得上面的模板比较繁琐，也可以结合 computed 一起使用：\n\n```html\n<!-- 子组件 -->\n<script setup>\nimport { computed } from 'vue'\n\nconst props = defineProps(['modelValue'])\nconst emit = defineEmits(['update:modelValue'])\nconst newValue = computed({\n  get() {\n    return props.modelValue\n  },\n  set(value) {\n    emit('update:modelValue', value)\n  }\n})\n</script>\n\n<template>\n  <input v-model=\"newValue\" />\n</template>\n```\n\n\n## 「场景三：路由跳转，获取路由参数」\n\nVue2 中我们通常是使用 this.$router 或 this.$route 来进行路由的跳转和参数获取，但在 `<script-setup>`中，是这些方法无法使用的。我们可以使用 vue-router 提供的 useRouter 方法，来进行路由跳转：\n\n```html\n<script setup>\nimport { useRouter } from 'vue-router'\n\nconst router = useRouter()\nfunction onClick() {\n  router.push({\n    path: '/about',\n    query: {\n      msg: 'hello vue3!'\n    }\n  })\n}\n</script>\n```\n\n当我们要获取路由参数时，可以使用 vue-router 提供的 useRoute方法：\n\n```html\n<script setup>\nimport { useRoute } from 'vue-router'\n\nconst route = useRoute()\nconsole.log(route.query.msg) // hello vue3!\n</script>\n```\n\n\n## 「场景四：获取上下文对象」\n\nVue3 的 setup 中无法使用 this 这个上下文对象。可能刚接触 Vue3 的兄弟会有点懵，我想使用 this 上的属性和方法应该怎么办呢。虽然不推荐这样使用，但依然可以通过 getCurrentInstance 方法获取上下文对象：\n\n```js\nimport { getCurrentInstance } from 'vue'\n\n// 以下两种方法都可以获取到上下文对象\nconst { ctx } = getCurrentInstance()\nconst { proxy }  = getCurrentInstance()\n```\n\n这样我们就可以使用 $parent 、$refs 等，干自己想干的事情了。\n\n注意：ctx 只能在开发环境使用，生成环境为 undefined 。 推荐使用 proxy ，在开发环境和生产环境都可以使用。\n\n\n## 「场景五：插槽的使用」\n\n在 Vue2 的中一般是通过 slot 属性指定模板的位置，通过 slot-scope 获取作用域插槽的数据，如：\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\n</script>\n\n<template>\n  <div>parent<div>\n  <ChildView>\n    <template slot=\"content\" slot-scope=\"{ msg }\">\n      <div>{{ msg }}</div>\n    </template>\n  </ChildView>\n</template>\n```\n\n```html\n<!-- 子组件 -->\n<template>\n  <div>child</div>\n  <slot name=\"content\" msg=\"hello vue3!\"></slot>\n</template>\n```\n\n在 Vue3 中则是通过 v-slot 这个指令来指定模板的位置，同时获取作用域插槽的数据，如：\n\n```html\n<!-- 父组件 -->\n<script setup>\nimport ChildView from './ChildView.vue'\n</script>\n\n<template>\n  <div>parent</div>\n  <ChildView>\n    <template v-slot:content=\"{ msg }\">\n      <div>{{ msg }}</div>\n    </template>\n  </ChildView>\n</template>\n\n<!-- ChildView 也可以简写为： -->\n<ChildView>\n  <template #content=\"{ msg }\">\n    <div>{{ msg }}</div>\n  </template>\n</ChildView>\n```\n\n```html\n<!-- 子组件 -->\n<template>\n  <div>child</div>\n  <slot name=\"content\" msg=\"hello vue3!\"></slot>\n</template>\n```\n\n注意：v-slot 在 Vue2 中也可以使用，但必须是 Vue2.6+ 的版本。\n\n\n## 「场景六：缓存路由组件」\n\n缓存一般的动态组件，Vue3 和 Vue2 的用法是一样的，都是使用 KeepAlive 包裹 Component。但缓存路由组件，Vue3 需要结合插槽一起使用：\n\n```js\n// Vue2 中缓存路由组件\n<KeepAlive>\n  <RouterView />\n</KeepAlive>\n```\n\n```js\n// Vue3 中缓存路由组件\n<RouterView v-slot=\"{ Component }\">\n  <KeepAlive>\n    <Component :is=\"Component\"></Component>\n  </KeepAlive>\n</RouterView>\n```\n\n一个持续存在的组件可以通过 onActivated() 和 onDeactivated() 两个生命周期钩子注入相应的逻辑:\n\n```js\nimport { onActivated, onDeactivated } from 'vue'\n\nonActivated(() => {\n  // 调用时机为首次挂载\n  // 以及每次从缓存中被重新插入时\n})\n\nonDeactivated(() => {\n  // 调用时机为从 DOM 上移除、进入缓存\n  // 以及组件卸载时\n})\n```\n\n## 「场景七：逻辑复用」\n\nVue2 中逻辑复用主要是采用 mixin，但 mixin 会使数据来源不明，同时会引起命名冲突。所以 Vue3 更推荐的是全新的 Composition Api。\n\n下面是鼠标跟踪的例子，我们可以把逻辑提取出来：\n\n```js\n// mouse.js\nimport { ref, onMounted, onUnmounted } from 'vue'\n\n// 按照惯例，组合式函数名以 use 开头\nexport function useMouse() {\n  // 组合式函数管理的数据\n  const x = ref(0)\n  const y = ref(0)\n\n  function update(event) {\n    x.value = event.pageX\n    y.value = event.pageY\n  }\n\n  // 组合式函数可以挂靠在所属组件的生命周期上，来启动和卸载副作用\n  onMounted(() => window.addEventListener('mousemove', update))\n  onUnmounted(() => window.removeEventListener('mousemove', update))\n\n  // 通过返回值暴露所管理的数据\n  return { x, y }\n}\n```\n\n这时候在组件中我们就可以直接使用 mouse.js 暴露的数据了。\n\n```html\n<script setup>\nimport { useMouse } from './mouse.js'\n\nconst { x, y } = useMouse()\n</script>\n\n<template>Mouse position is at: {{ x }}, {{ y }}</template>\n```\n\n我们还可以在一个组件中引入多个组合式函数，或者在一个组合式函数中引入其他的组合式函数，这个比较简单，我就不演示了。接下来，我们看看使用异步方法的组合式函数。\n\n在做异步数据请求时，我们通常需要处理三个不同的状态：加载中、加载成功和加载失败。获取这些状态的逻辑是通用的，我们可以把它提取出来：\n\n```js\n// request.js\nimport { ref } from 'vue'\n\nexport function useRequest(url) {\n  const data = ref(null)\n  const error = ref(null)\n\n  axios.get(url)\n    .then((res) => (data.value = res.data))\n    .catch((err) => (error.value = err))\n\n  return { data, error }\n}\n```\n\n现在我们在组件中只需要：\n\n```html\n<script setup>\nimport { useRequest } from './request.js'\n\nconst { data, error } = useRequest('http://...')\n</script>\n\n<template>\n  <div v-if=\"data\">Data is: {{ data }}</div>\n  <div v-else-if=\"error\">Error message is: {{ error.message }}</div>\n  <div v-else>Loading...</div>\n</template>\n```\n\n任何组件都可以使用上面这个逻辑，这就是逻辑复用。\n\n\n## 「场景八：生命周期」\n\nVue3 的生命周期和 Vue2 相比，有以下改动：\n\n- Vue3 生命周期钩子都以 on 开头，并且需要在组件中手动导入。\n- Vue3 取消了 beforeCreate 和 created 钩子。如果需要在组件创建前注入逻辑，直接在 `<script setup>` 中编写同步代码就可以了。如果这几个钩子同时存在，setup 的执行顺序要优先于 beforeCreate 和 created。\n- Vue3 中组件卸载的钩子名称有变化，beforeDestroy 改为 onBeforeUnmount，destroyed 改为 onUnmounted。\n\n```js\nimport { onMounted } from 'vue'\n\nonMounted(() => {\n  console.log('onMounted')\n})\n```\n\n\n## 「场景九：全局 API」\n\nVue2 中的全局属性或全局方法，是在构造函数 Vue 的原型对象上进行添加，如：Vue.prototype.$axios = axios 。但在 Vue3 中，需要在 app 实例上添加：\n\n```js\n// main.js\napp.config.globalProperties.$axios = axios\n```\n\n在组件中使用：\n\n```js\nimport { getCurrentInstance } from 'vue'\n\nconst { proxy } = getCurrentInstance()\nproxy.$axios.get('http://...')\n```\n\nVue3 中其他的全局 API，如 directive 、component 等，跟 Vue2 的用法都差不多，只不过一个是在 Vue 上调用，一个是在 app 实例上调用：\n\n```js\n// main.js\n// 全局自定义指令\napp.directive('focus', {\n  mounted(el) {\n    el.focus()\n  }\n})\n\n// 全局自定义组件\nimport CustomComp from './components/CustomComp.vue'\n\napp.component('CustomComp', CustomComp)\n```\n\n需要注意的是，Vue3 废弃了 filter 这个方法，因为通过函数或 computed 可以实现一样的功能。\n\n\n## 「常见十：与 TypeScript 结合使用」\n\n与 TypeScript 结合使用，我们只需要在 `<script setup>` 中添加 `lang=\"ts\"` 就可以了。下面是一些和 TypeScript 结合使用的例子。\n\n### 为 props 标注类型\n\n**运行时声明**\n\n当使用 `<script setup>` 时，defineProps() 宏函数支持从它的参数中推导类型：\n\n```typescript\n<script setup lang=\"ts\">\nconst props = defineProps({\n  foo: { type: String, required: true },\n  bar: Number\n})\n\nprops.foo // string\nprops.bar // number | undefined\n</script>\n```\n\n这被称为 运行时声明 ，因为传递给 defineProps() 的参数会作为运行时的 props 选项使用。\n\n**基于类型的声明**\n\n我们还可以通过泛型参数来定义 props 的类型，这种方式更加常用：\n\n```typescript\n<script setup lang=\"ts\">\ninterface Props {\n  foo: string\n  bar?: number\n}\n\nconst props = defineProps<Props>()\n</script>\n```\n\n这被称为 基于类型的声明 ，编译器会尽可能地尝试根据类型参数推导出等价的运行时选项。这种方式的不足之处在于，失去了定义 props 默认值的能力。为了解决这个问题，我们可以使用 withDefaults 宏函数：\n\n```js\n<script setup lang=\"ts\">\ninterface Props {\n  msg?: string\n  labels?: string[]\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  msg: 'hello vue3!',\n  labels: () => ['one', 'two']\n})\n</script>\n```\n\n### 为 ref() 标注类型\n\n**默认推导类型**\n\nref 会根据初始化时的值自动推导其类型：\n\n```js\nimport { ref } from 'vue'\n\nconst year = ref(2022)\nyear.value = '2022' // TS Error: 不能将类型 string 分配给类型 number\n```\n\n**通过接口指定类型**\n\n有时我们可能想为 ref 内的值指定一个更复杂的类型，可以使用 Ref 这个接口：\n\n```ts\nimport { ref } from 'vue'\nimport type { Ref } from 'vue'\n\nconst year: Ref<string | number> = ref('2022')\nyear.value = 2022 // 成功！\n```\n\n**通过泛型指定类型**\n\n我们也可以在调用 ref() 时传入一个泛型参数，来覆盖默认的推导行为：\n\n```ts\nconst year = ref<string | number>('2022')\nyear.value = 2022 // 成功！\n```\n\n### 为 reactive() 标注类型\n\n**默认推导类型**\n\nreactive() 也会隐式地从它的参数中推导类型：\n\n```ts\nimport { reactive } from 'vue'\n\nconst book = reactive({ title: 'Vue 3 指引' })\nbook.year = 2022 // TS Error: 类型 { title: string; } 上不存在属性 year\n```\n\n**通过接口指定类型**\n\n要显式地指定一个 reactive 变量的类型，我们可以使用接口：\n\n```ts\nimport { reactive } from 'vue'\n\ninterface Book {\n  title: string\n  year?: number\n}\n\nconst book: Book = reactive({ title: 'Vue 3 指引' })\nbook.year = 2022 // 成功！\n```\n\n其他 API 与 TypeScript 结合使用的方法和上面大同小异，这里我就不一一列举了。具体可以参考这篇文章：[如何为 Vue3 组件标注 TS 类型，看这个就够了！](https://juejin.cn/post/7129130323148800031)。\n\n\n## 最后\n\n以上就是我在 Vue3 项目中遇到最多的场景，如果你掌握了 Vue3 常用的 API 和今天这些场景，相信参与 Vue3 项目的开发是没有问题了。当然如果要用好 Vue3 ，可能还需要对 Pinia 、 Vite 等相关生态有一个深入的了解。","slug":"vue3-scene","published":1,"updated":"2023-03-20T13:29:43.320Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsik0039yt8w0rj93lve","content":"<p>相信有很多这样的兄弟，学了 Vue3 的各种 API 和新特性，但公司项目依然使用的是 Vue2 ，也不知道自己的水平能否上手 Vue3 项目。其实你学的是零碎的知识点，缺少真实的使用场景。</p>\n<p>今天就把实战过程中遇到的十个场景分享给大家，结合尤大大推荐的 <code>&lt;script setup&gt;</code>，希望你能从 Vue2 丝滑过渡到 Vue3！</p>\n<h2 id=\"「场景一：父子组件数据传递」\"><a href=\"#「场景一：父子组件数据传递」\" class=\"headerlink\" title=\"「场景一：父子组件数据传递」\"></a>「场景一：父子组件数据传递」</h2><h3 id=\"父组件数据传递到子组件\"><a href=\"#父组件数据传递到子组件\" class=\"headerlink\" title=\"父组件数据传递到子组件\"></a>父组件数据传递到子组件</h3><p>Vue3 中父组件同样是通过属性传递数据，但子组件接受数据的方式和 Vue2 不同。在 <code>&lt;script setup&gt;</code> 中，props 需要使用 defineProps() 这个宏函数来进行声明，它的参数和 Vue2 props 选项的值是一样的。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span> <span class=\"attr\">some-prop</span>=<span class=\"string\">&quot;parent message&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">someProp</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">required</span>: <span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(props.<span class=\"property\">someProp</span>) <span class=\"comment\">// parent message</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 使用 someProp 或 props.someProp --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; someProp &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; props.someProp &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>注意：defineProps 、defineEmits 、 defineExpose 和 withDefaults 这四个宏函数只能在 <code>&lt;script setup&gt;</code> 中使用。他们不需要导入，会随着 <code>&lt;script setup&gt;</code> 的处理过程中一起被编译。</p>\n<h3 id=\"子组件数据传递到父组件\"><a href=\"#子组件数据传递到父组件\" class=\"headerlink\" title=\"子组件数据传递到父组件\"></a>子组件数据传递到父组件</h3><p>Vue2 中子组件数据传递到父组件，通常是使用 $emit 触发一个自定义事件来进行传递。但 $emit 无法在 <code>&lt;script setup&gt;</code> 中使用，这时候我们需要使用 defineEmits()：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;someEvent&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">onClick</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;someEvent&#x27;</span>, <span class=\"string\">&#x27;child message&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;onClick&quot;</span>&gt;</span>点击<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">someEvent</span>(<span class=\"params\">value</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(value) <span class=\"comment\">// child message</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span> @<span class=\"attr\">some-event</span>=<span class=\"string\">&quot;someEvent&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"父组件使用子组件数据\"><a href=\"#父组件使用子组件数据\" class=\"headerlink\" title=\"父组件使用子组件数据\"></a>父组件使用子组件数据</h3><p>在 <code>&lt;script setup&gt;</code> 中，组件的属性和方法默认都是私有的。父组件无法访问到子组件中的任何东西，除非子组件通过 defineExpose 显式的暴露出去：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> msg = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;hello vue3!&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">change</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  msg.<span class=\"property\">value</span> = <span class=\"string\">&#x27;hi vue3!&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(msg.<span class=\"property\">value</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 属性或方法必须暴露出去，父组件才能使用</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineExpose</span>(&#123; msg, change &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref, onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> child = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(child.<span class=\"property\">value</span>.<span class=\"property\">msg</span>) <span class=\"comment\">// hello vue3!</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  child.<span class=\"property\">value</span>.<span class=\"title function_\">change</span>() <span class=\"comment\">// hi vue3!</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;child&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"「场景二：组件之间双向绑定」\"><a href=\"#「场景二：组件之间双向绑定」\" class=\"headerlink\" title=\"「场景二：组件之间双向绑定」\"></a>「场景二：组件之间双向绑定」</h2><p>家都知道 Vue2 中组件的双向绑定采用的是 v-model 或 .snyc 修饰符，两种写法多少显得有点重复，于是在 Vue3 中合成了一种。Vue3 统一使用 v-model 进行处理，并且可以和多个数据进行绑定，如 v-model:foo、v-model:bar。</p>\n<ul>\n<li>v-model 等价于 :model-value&#x3D;”someValue” 和 @update:model-value&#x3D;”someValue &#x3D; $event”</li>\n<li>v-model:foo 等价于 :foo&#x3D;”someValue” 和 @update:foo&#x3D;”someValue &#x3D; $event”</li>\n</ul>\n<p>下面就是一个父子组件之间双向绑定的例子：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> msg = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;hello vue3!&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;msg&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;emit(&#x27;update:modelValue&#x27;, &#x27;hi vue3！&#x27;)&quot;</span>&gt;</span>&#123;&#123; modelValue &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>子组件可以结合 input 使用：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">:value</span>=<span class=\"string\">&quot;modelValue&quot;</span> @<span class=\"attr\">input</span>=<span class=\"string\">&quot;emit(&#x27;update:modelValue&#x27;, $event.target.value)&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果你觉得上面的模板比较繁琐，也可以结合 computed 一起使用：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; computed &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> newValue = <span class=\"title function_\">computed</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">get</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">return</span> props.<span class=\"property\">modelValue</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">set</span>(<span class=\"params\">value</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;update:modelValue&#x27;</span>, value)</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;newValue&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"「场景三：路由跳转，获取路由参数」\"><a href=\"#「场景三：路由跳转，获取路由参数」\" class=\"headerlink\" title=\"「场景三：路由跳转，获取路由参数」\"></a>「场景三：路由跳转，获取路由参数」</h2><p>Vue2 中我们通常是使用 this.$router 或 this.$route 来进行路由的跳转和参数获取，但在 <code>&lt;script-setup&gt;</code>中，是这些方法无法使用的。我们可以使用 vue-router 提供的 useRouter 方法，来进行路由跳转：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; useRouter &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-router&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> router = <span class=\"title function_\">useRouter</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">onClick</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  router.<span class=\"title function_\">push</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">path</span>: <span class=\"string\">&#x27;/about&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">query</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"attr\">msg</span>: <span class=\"string\">&#x27;hello vue3!&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>当我们要获取路由参数时，可以使用 vue-router 提供的 useRoute方法：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; useRoute &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-router&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> route = <span class=\"title function_\">useRoute</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(route.<span class=\"property\">query</span>.<span class=\"property\">msg</span>) <span class=\"comment\">// hello vue3!</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"「场景四：获取上下文对象」\"><a href=\"#「场景四：获取上下文对象」\" class=\"headerlink\" title=\"「场景四：获取上下文对象」\"></a>「场景四：获取上下文对象」</h2><p>Vue3 的 setup 中无法使用 this 这个上下文对象。可能刚接触 Vue3 的兄弟会有点懵，我想使用 this 上的属性和方法应该怎么办呢。虽然不推荐这样使用，但依然可以通过 getCurrentInstance 方法获取上下文对象：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; getCurrentInstance &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 以下两种方法都可以获取到上下文对象</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; ctx &#125; = <span class=\"title function_\">getCurrentInstance</span>()</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; proxy &#125;  = <span class=\"title function_\">getCurrentInstance</span>()</span><br></pre></td></tr></table></figure>\n\n<p>这样我们就可以使用 $parent 、$refs 等，干自己想干的事情了。</p>\n<p>注意：ctx 只能在开发环境使用，生成环境为 undefined 。 推荐使用 proxy ，在开发环境和生产环境都可以使用。</p>\n<h2 id=\"「场景五：插槽的使用」\"><a href=\"#「场景五：插槽的使用」\" class=\"headerlink\" title=\"「场景五：插槽的使用」\"></a>「场景五：插槽的使用」</h2><p>在 Vue2 的中一般是通过 slot 属性指定模板的位置，通过 slot-scope 获取作用域插槽的数据，如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>parent<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot</span>=<span class=\"string\">&quot;content&quot;</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">&quot;&#123; msg &#125;&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>child<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;content&quot;</span> <span class=\"attr\">msg</span>=<span class=\"string\">&quot;hello vue3!&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在 Vue3 中则是通过 v-slot 这个指令来指定模板的位置，同时获取作用域插槽的数据，如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>parent<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-slot:content</span>=<span class=\"string\">&quot;&#123; msg &#125;&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- ChildView 也可以简写为： --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> #<span class=\"attr\">content</span>=<span class=\"string\">&quot;&#123; msg &#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ChildView</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>child<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;content&quot;</span> <span class=\"attr\">msg</span>=<span class=\"string\">&quot;hello vue3!&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>注意：v-slot 在 Vue2 中也可以使用，但必须是 Vue2.6+ 的版本。</p>\n<h2 id=\"「场景六：缓存路由组件」\"><a href=\"#「场景六：缓存路由组件」\" class=\"headerlink\" title=\"「场景六：缓存路由组件」\"></a>「场景六：缓存路由组件」</h2><p>缓存一般的动态组件，Vue3 和 Vue2 的用法是一样的，都是使用 KeepAlive 包裹 Component。但缓存路由组件，Vue3 需要结合插槽一起使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Vue2 中缓存路由组件</span></span><br><span class=\"line\">&lt;<span class=\"title class_\">KeepAlive</span>&gt;</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">RouterView</span> /&gt;</span></span></span><br><span class=\"line\">&lt;/<span class=\"title class_\">KeepAlive</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Vue3 中缓存路由组件</span></span><br><span class=\"line\">&lt;<span class=\"title class_\">RouterView</span> v-slot=<span class=\"string\">&quot;&#123; Component &#125;&quot;</span>&gt;</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">KeepAlive</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">Component</span> <span class=\"attr\">:is</span>=<span class=\"string\">&quot;Component&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Component</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">KeepAlive</span>&gt;</span></span></span><br><span class=\"line\">&lt;/<span class=\"title class_\">RouterView</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<p>一个持续存在的组件可以通过 onActivated() 和 onDeactivated() 两个生命周期钩子注入相应的逻辑:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; onActivated, onDeactivated &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">onActivated</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 调用时机为首次挂载</span></span><br><span class=\"line\">  <span class=\"comment\">// 以及每次从缓存中被重新插入时</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">onDeactivated</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 调用时机为从 DOM 上移除、进入缓存</span></span><br><span class=\"line\">  <span class=\"comment\">// 以及组件卸载时</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"「场景七：逻辑复用」\"><a href=\"#「场景七：逻辑复用」\" class=\"headerlink\" title=\"「场景七：逻辑复用」\"></a>「场景七：逻辑复用」</h2><p>Vue2 中逻辑复用主要是采用 mixin，但 mixin 会使数据来源不明，同时会引起命名冲突。所以 Vue3 更推荐的是全新的 Composition Api。</p>\n<p>下面是鼠标跟踪的例子，我们可以把逻辑提取出来：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mouse.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref, onMounted, onUnmounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 按照惯例，组合式函数名以 use 开头</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">useMouse</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 组合式函数管理的数据</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> x = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> y = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">update</span>(<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">    x.<span class=\"property\">value</span> = event.<span class=\"property\">pageX</span></span><br><span class=\"line\">    y.<span class=\"property\">value</span> = event.<span class=\"property\">pageY</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 组合式函数可以挂靠在所属组件的生命周期上，来启动和卸载副作用</span></span><br><span class=\"line\">  <span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, update))</span><br><span class=\"line\">  <span class=\"title function_\">onUnmounted</span>(<span class=\"function\">() =&gt;</span> <span class=\"variable language_\">window</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, update))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 通过返回值暴露所管理的数据</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; x, y &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这时候在组件中我们就可以直接使用 mouse.js 暴露的数据了。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; useMouse &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./mouse.js&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> &#123; x, y &#125; = <span class=\"title function_\">useMouse</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span>Mouse position is at: &#123;&#123; x &#125;&#125;, &#123;&#123; y &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>我们还可以在一个组件中引入多个组合式函数，或者在一个组合式函数中引入其他的组合式函数，这个比较简单，我就不演示了。接下来，我们看看使用异步方法的组合式函数。</p>\n<p>在做异步数据请求时，我们通常需要处理三个不同的状态：加载中、加载成功和加载失败。获取这些状态的逻辑是通用的，我们可以把它提取出来：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// request.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">useRequest</span>(<span class=\"params\">url</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> data = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> error = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  axios.<span class=\"title function_\">get</span>(url)</span><br><span class=\"line\">    .<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> (data.<span class=\"property\">value</span> = res.<span class=\"property\">data</span>))</span><br><span class=\"line\">    .<span class=\"title function_\">catch</span>(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> (error.<span class=\"property\">value</span> = err))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; data, error &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>现在我们在组件中只需要：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; useRequest &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./request.js&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> &#123; data, error &#125; = <span class=\"title function_\">useRequest</span>(<span class=\"string\">&#x27;http://...&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&quot;data&quot;</span>&gt;</span>Data is: &#123;&#123; data &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-else-if</span>=<span class=\"string\">&quot;error&quot;</span>&gt;</span>Error message is: &#123;&#123; error.message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-else</span>&gt;</span>Loading...<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>任何组件都可以使用上面这个逻辑，这就是逻辑复用。</p>\n<h2 id=\"「场景八：生命周期」\"><a href=\"#「场景八：生命周期」\" class=\"headerlink\" title=\"「场景八：生命周期」\"></a>「场景八：生命周期」</h2><p>Vue3 的生命周期和 Vue2 相比，有以下改动：</p>\n<ul>\n<li>Vue3 生命周期钩子都以 on 开头，并且需要在组件中手动导入。</li>\n<li>Vue3 取消了 beforeCreate 和 created 钩子。如果需要在组件创建前注入逻辑，直接在 <code>&lt;script setup&gt;</code> 中编写同步代码就可以了。如果这几个钩子同时存在，setup 的执行顺序要优先于 beforeCreate 和 created。</li>\n<li>Vue3 中组件卸载的钩子名称有变化，beforeDestroy 改为 onBeforeUnmount，destroyed 改为 onUnmounted。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;onMounted&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"「场景九：全局-API」\"><a href=\"#「场景九：全局-API」\" class=\"headerlink\" title=\"「场景九：全局 API」\"></a>「场景九：全局 API」</h2><p>Vue2 中的全局属性或全局方法，是在构造函数 Vue 的原型对象上进行添加，如：Vue.prototype.$axios &#x3D; axios 。但在 Vue3 中，需要在 app 实例上添加：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\">app.<span class=\"property\">config</span>.<span class=\"property\">globalProperties</span>.<span class=\"property\">$axios</span> = axios</span><br></pre></td></tr></table></figure>\n\n<p>在组件中使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; getCurrentInstance &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; proxy &#125; = <span class=\"title function_\">getCurrentInstance</span>()</span><br><span class=\"line\">proxy.<span class=\"property\">$axios</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;http://...&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Vue3 中其他的全局 API，如 directive 、component 等，跟 Vue2 的用法都差不多，只不过一个是在 Vue 上调用，一个是在 app 实例上调用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"><span class=\"comment\">// 全局自定义指令</span></span><br><span class=\"line\">app.<span class=\"title function_\">directive</span>(<span class=\"string\">&#x27;focus&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"title function_\">focus</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 全局自定义组件</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">CustomComp</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./components/CustomComp.vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;CustomComp&#x27;</span>, <span class=\"title class_\">CustomComp</span>)</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，Vue3 废弃了 filter 这个方法，因为通过函数或 computed 可以实现一样的功能。</p>\n<h2 id=\"「常见十：与-TypeScript-结合使用」\"><a href=\"#「常见十：与-TypeScript-结合使用」\" class=\"headerlink\" title=\"「常见十：与 TypeScript 结合使用」\"></a>「常见十：与 TypeScript 结合使用」</h2><p>与 TypeScript 结合使用，我们只需要在 <code>&lt;script setup&gt;</code> 中添加 <code>lang=&quot;ts&quot;</code> 就可以了。下面是一些和 TypeScript 结合使用的例子。</p>\n<h3 id=\"为-props-标注类型\"><a href=\"#为-props-标注类型\" class=\"headerlink\" title=\"为 props 标注类型\"></a>为 props 标注类型</h3><p><strong>运行时声明</strong></p>\n<p>当使用 <code>&lt;script setup&gt;</code> 时，defineProps() 宏函数支持从它的参数中推导类型：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script setup lang=<span class=\"string\">&quot;ts&quot;</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">foo</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">  <span class=\"attr\">bar</span>: <span class=\"title class_\">Number</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">props.<span class=\"property\">foo</span> <span class=\"comment\">// string</span></span><br><span class=\"line\">props.<span class=\"property\">bar</span> <span class=\"comment\">// number | undefined</span></span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>这被称为 运行时声明 ，因为传递给 defineProps() 的参数会作为运行时的 props 选项使用。</p>\n<p><strong>基于类型的声明</strong></p>\n<p>我们还可以通过泛型参数来定义 props 的类型，这种方式更加常用：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script setup lang=<span class=\"string\">&quot;ts&quot;</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">foo</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  bar?: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> props = defineProps&lt;<span class=\"title class_\">Props</span>&gt;()</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>这被称为 基于类型的声明 ，编译器会尽可能地尝试根据类型参数推导出等价的运行时选项。这种方式的不足之处在于，失去了定义 props 默认值的能力。为了解决这个问题，我们可以使用 withDefaults 宏函数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script setup lang=<span class=\"string\">&quot;ts&quot;</span>&gt;</span><br><span class=\"line\">interface <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">  msg?: string</span><br><span class=\"line\">  labels?: string[]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">withDefaults</span>(defineProps&lt;<span class=\"title class_\">Props</span>&gt;(), &#123;</span><br><span class=\"line\">  <span class=\"attr\">msg</span>: <span class=\"string\">&#x27;hello vue3!&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">labels</span>: <span class=\"function\">() =&gt;</span> [<span class=\"string\">&#x27;one&#x27;</span>, <span class=\"string\">&#x27;two&#x27;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"为-ref-标注类型\"><a href=\"#为-ref-标注类型\" class=\"headerlink\" title=\"为 ref() 标注类型\"></a>为 ref() 标注类型</h3><p><strong>默认推导类型</strong></p>\n<p>ref 会根据初始化时的值自动推导其类型：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> year = <span class=\"title function_\">ref</span>(<span class=\"number\">2022</span>)</span><br><span class=\"line\">year.<span class=\"property\">value</span> = <span class=\"string\">&#x27;2022&#x27;</span> <span class=\"comment\">// TS Error: 不能将类型 string 分配给类型 number</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>通过接口指定类型</strong></p>\n<p>有时我们可能想为 ref 内的值指定一个更复杂的类型，可以使用 Ref 这个接口：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Ref</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">year</span>: <span class=\"title class_\">Ref</span>&lt;<span class=\"built_in\">string</span> | <span class=\"built_in\">number</span>&gt; = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;2022&#x27;</span>)</span><br><span class=\"line\">year.<span class=\"property\">value</span> = <span class=\"number\">2022</span> <span class=\"comment\">// 成功！</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>通过泛型指定类型</strong></p>\n<p>我们也可以在调用 ref() 时传入一个泛型参数，来覆盖默认的推导行为：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> year = ref&lt;<span class=\"built_in\">string</span> | <span class=\"built_in\">number</span>&gt;(<span class=\"string\">&#x27;2022&#x27;</span>)</span><br><span class=\"line\">year.<span class=\"property\">value</span> = <span class=\"number\">2022</span> <span class=\"comment\">// 成功！</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"为-reactive-标注类型\"><a href=\"#为-reactive-标注类型\" class=\"headerlink\" title=\"为 reactive() 标注类型\"></a>为 reactive() 标注类型</h3><p><strong>默认推导类型</strong></p>\n<p>reactive() 也会隐式地从它的参数中推导类型：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; reactive &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> book = <span class=\"title function_\">reactive</span>(&#123; <span class=\"attr\">title</span>: <span class=\"string\">&#x27;Vue 3 指引&#x27;</span> &#125;)</span><br><span class=\"line\">book.<span class=\"property\">year</span> = <span class=\"number\">2022</span> <span class=\"comment\">// TS Error: 类型 &#123; title: string; &#125; 上不存在属性 year</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>通过接口指定类型</strong></p>\n<p>要显式地指定一个 reactive 变量的类型，我们可以使用接口：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; reactive &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Book</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">title</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  year?: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">book</span>: <span class=\"title class_\">Book</span> = <span class=\"title function_\">reactive</span>(&#123; <span class=\"attr\">title</span>: <span class=\"string\">&#x27;Vue 3 指引&#x27;</span> &#125;)</span><br><span class=\"line\">book.<span class=\"property\">year</span> = <span class=\"number\">2022</span> <span class=\"comment\">// 成功！</span></span><br></pre></td></tr></table></figure>\n\n<p>其他 API 与 TypeScript 结合使用的方法和上面大同小异，这里我就不一一列举了。具体可以参考这篇文章：<a href=\"https://juejin.cn/post/7129130323148800031\">如何为 Vue3 组件标注 TS 类型，看这个就够了！</a>。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>以上就是我在 Vue3 项目中遇到最多的场景，如果你掌握了 Vue3 常用的 API 和今天这些场景，相信参与 Vue3 项目的开发是没有问题了。当然如果要用好 Vue3 ，可能还需要对 Pinia 、 Vite 等相关生态有一个深入的了解。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>相信有很多这样的兄弟，学了 Vue3 的各种 API 和新特性，但公司项目依然使用的是 Vue2 ，也不知道自己的水平能否上手 Vue3 项目。其实你学的是零碎的知识点，缺少真实的使用场景。</p>\n<p>今天就把实战过程中遇到的十个场景分享给大家，结合尤大大推荐的 <code>&lt;script setup&gt;</code>，希望你能从 Vue2 丝滑过渡到 Vue3！</p>\n<h2 id=\"「场景一：父子组件数据传递」\"><a href=\"#「场景一：父子组件数据传递」\" class=\"headerlink\" title=\"「场景一：父子组件数据传递」\"></a>「场景一：父子组件数据传递」</h2><h3 id=\"父组件数据传递到子组件\"><a href=\"#父组件数据传递到子组件\" class=\"headerlink\" title=\"父组件数据传递到子组件\"></a>父组件数据传递到子组件</h3><p>Vue3 中父组件同样是通过属性传递数据，但子组件接受数据的方式和 Vue2 不同。在 <code>&lt;script setup&gt;</code> 中，props 需要使用 defineProps() 这个宏函数来进行声明，它的参数和 Vue2 props 选项的值是一样的。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span> <span class=\"attr\">some-prop</span>=<span class=\"string\">&quot;parent message&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">someProp</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">required</span>: <span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(props.<span class=\"property\">someProp</span>) <span class=\"comment\">// parent message</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 使用 someProp 或 props.someProp --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; someProp &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; props.someProp &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>注意：defineProps 、defineEmits 、 defineExpose 和 withDefaults 这四个宏函数只能在 <code>&lt;script setup&gt;</code> 中使用。他们不需要导入，会随着 <code>&lt;script setup&gt;</code> 的处理过程中一起被编译。</p>\n<h3 id=\"子组件数据传递到父组件\"><a href=\"#子组件数据传递到父组件\" class=\"headerlink\" title=\"子组件数据传递到父组件\"></a>子组件数据传递到父组件</h3><p>Vue2 中子组件数据传递到父组件，通常是使用 $emit 触发一个自定义事件来进行传递。但 $emit 无法在 <code>&lt;script setup&gt;</code> 中使用，这时候我们需要使用 defineEmits()：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;someEvent&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">onClick</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;someEvent&#x27;</span>, <span class=\"string\">&#x27;child message&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;onClick&quot;</span>&gt;</span>点击<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">someEvent</span>(<span class=\"params\">value</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(value) <span class=\"comment\">// child message</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span> @<span class=\"attr\">some-event</span>=<span class=\"string\">&quot;someEvent&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"父组件使用子组件数据\"><a href=\"#父组件使用子组件数据\" class=\"headerlink\" title=\"父组件使用子组件数据\"></a>父组件使用子组件数据</h3><p>在 <code>&lt;script setup&gt;</code> 中，组件的属性和方法默认都是私有的。父组件无法访问到子组件中的任何东西，除非子组件通过 defineExpose 显式的暴露出去：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> msg = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;hello vue3!&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">change</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  msg.<span class=\"property\">value</span> = <span class=\"string\">&#x27;hi vue3!&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(msg.<span class=\"property\">value</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 属性或方法必须暴露出去，父组件才能使用</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineExpose</span>(&#123; msg, change &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref, onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> child = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(child.<span class=\"property\">value</span>.<span class=\"property\">msg</span>) <span class=\"comment\">// hello vue3!</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  child.<span class=\"property\">value</span>.<span class=\"title function_\">change</span>() <span class=\"comment\">// hi vue3!</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;child&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"「场景二：组件之间双向绑定」\"><a href=\"#「场景二：组件之间双向绑定」\" class=\"headerlink\" title=\"「场景二：组件之间双向绑定」\"></a>「场景二：组件之间双向绑定」</h2><p>家都知道 Vue2 中组件的双向绑定采用的是 v-model 或 .snyc 修饰符，两种写法多少显得有点重复，于是在 Vue3 中合成了一种。Vue3 统一使用 v-model 进行处理，并且可以和多个数据进行绑定，如 v-model:foo、v-model:bar。</p>\n<ul>\n<li>v-model 等价于 :model-value&#x3D;”someValue” 和 @update:model-value&#x3D;”someValue &#x3D; $event”</li>\n<li>v-model:foo 等价于 :foo&#x3D;”someValue” 和 @update:foo&#x3D;”someValue &#x3D; $event”</li>\n</ul>\n<p>下面就是一个父子组件之间双向绑定的例子：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> msg = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;hello vue3!&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;msg&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;emit(&#x27;update:modelValue&#x27;, &#x27;hi vue3！&#x27;)&quot;</span>&gt;</span>&#123;&#123; modelValue &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>子组件可以结合 input 使用：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">:value</span>=<span class=\"string\">&quot;modelValue&quot;</span> @<span class=\"attr\">input</span>=<span class=\"string\">&quot;emit(&#x27;update:modelValue&#x27;, $event.target.value)&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果你觉得上面的模板比较繁琐，也可以结合 computed 一起使用：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; computed &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:modelValue&#x27;</span>])</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> newValue = <span class=\"title function_\">computed</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">get</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">return</span> props.<span class=\"property\">modelValue</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">set</span>(<span class=\"params\">value</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;update:modelValue&#x27;</span>, value)</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;newValue&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"「场景三：路由跳转，获取路由参数」\"><a href=\"#「场景三：路由跳转，获取路由参数」\" class=\"headerlink\" title=\"「场景三：路由跳转，获取路由参数」\"></a>「场景三：路由跳转，获取路由参数」</h2><p>Vue2 中我们通常是使用 this.$router 或 this.$route 来进行路由的跳转和参数获取，但在 <code>&lt;script-setup&gt;</code>中，是这些方法无法使用的。我们可以使用 vue-router 提供的 useRouter 方法，来进行路由跳转：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; useRouter &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-router&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> router = <span class=\"title function_\">useRouter</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">onClick</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  router.<span class=\"title function_\">push</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">path</span>: <span class=\"string\">&#x27;/about&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">query</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"attr\">msg</span>: <span class=\"string\">&#x27;hello vue3!&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>当我们要获取路由参数时，可以使用 vue-router 提供的 useRoute方法：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; useRoute &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-router&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> route = <span class=\"title function_\">useRoute</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(route.<span class=\"property\">query</span>.<span class=\"property\">msg</span>) <span class=\"comment\">// hello vue3!</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"「场景四：获取上下文对象」\"><a href=\"#「场景四：获取上下文对象」\" class=\"headerlink\" title=\"「场景四：获取上下文对象」\"></a>「场景四：获取上下文对象」</h2><p>Vue3 的 setup 中无法使用 this 这个上下文对象。可能刚接触 Vue3 的兄弟会有点懵，我想使用 this 上的属性和方法应该怎么办呢。虽然不推荐这样使用，但依然可以通过 getCurrentInstance 方法获取上下文对象：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; getCurrentInstance &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 以下两种方法都可以获取到上下文对象</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; ctx &#125; = <span class=\"title function_\">getCurrentInstance</span>()</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; proxy &#125;  = <span class=\"title function_\">getCurrentInstance</span>()</span><br></pre></td></tr></table></figure>\n\n<p>这样我们就可以使用 $parent 、$refs 等，干自己想干的事情了。</p>\n<p>注意：ctx 只能在开发环境使用，生成环境为 undefined 。 推荐使用 proxy ，在开发环境和生产环境都可以使用。</p>\n<h2 id=\"「场景五：插槽的使用」\"><a href=\"#「场景五：插槽的使用」\" class=\"headerlink\" title=\"「场景五：插槽的使用」\"></a>「场景五：插槽的使用」</h2><p>在 Vue2 的中一般是通过 slot 属性指定模板的位置，通过 slot-scope 获取作用域插槽的数据，如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>parent<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot</span>=<span class=\"string\">&quot;content&quot;</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">&quot;&#123; msg &#125;&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>child<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;content&quot;</span> <span class=\"attr\">msg</span>=<span class=\"string\">&quot;hello vue3!&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在 Vue3 中则是通过 v-slot 这个指令来指定模板的位置，同时获取作用域插槽的数据，如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">ChildView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ChildView.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>parent<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-slot:content</span>=<span class=\"string\">&quot;&#123; msg &#125;&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- ChildView 也可以简写为： --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ChildView</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> #<span class=\"attr\">content</span>=<span class=\"string\">&quot;&#123; msg &#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ChildView</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>child<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;content&quot;</span> <span class=\"attr\">msg</span>=<span class=\"string\">&quot;hello vue3!&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>注意：v-slot 在 Vue2 中也可以使用，但必须是 Vue2.6+ 的版本。</p>\n<h2 id=\"「场景六：缓存路由组件」\"><a href=\"#「场景六：缓存路由组件」\" class=\"headerlink\" title=\"「场景六：缓存路由组件」\"></a>「场景六：缓存路由组件」</h2><p>缓存一般的动态组件，Vue3 和 Vue2 的用法是一样的，都是使用 KeepAlive 包裹 Component。但缓存路由组件，Vue3 需要结合插槽一起使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Vue2 中缓存路由组件</span></span><br><span class=\"line\">&lt;<span class=\"title class_\">KeepAlive</span>&gt;</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">RouterView</span> /&gt;</span></span></span><br><span class=\"line\">&lt;/<span class=\"title class_\">KeepAlive</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Vue3 中缓存路由组件</span></span><br><span class=\"line\">&lt;<span class=\"title class_\">RouterView</span> v-slot=<span class=\"string\">&quot;&#123; Component &#125;&quot;</span>&gt;</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">KeepAlive</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">Component</span> <span class=\"attr\">:is</span>=<span class=\"string\">&quot;Component&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Component</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">KeepAlive</span>&gt;</span></span></span><br><span class=\"line\">&lt;/<span class=\"title class_\">RouterView</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<p>一个持续存在的组件可以通过 onActivated() 和 onDeactivated() 两个生命周期钩子注入相应的逻辑:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; onActivated, onDeactivated &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">onActivated</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 调用时机为首次挂载</span></span><br><span class=\"line\">  <span class=\"comment\">// 以及每次从缓存中被重新插入时</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">onDeactivated</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 调用时机为从 DOM 上移除、进入缓存</span></span><br><span class=\"line\">  <span class=\"comment\">// 以及组件卸载时</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"「场景七：逻辑复用」\"><a href=\"#「场景七：逻辑复用」\" class=\"headerlink\" title=\"「场景七：逻辑复用」\"></a>「场景七：逻辑复用」</h2><p>Vue2 中逻辑复用主要是采用 mixin，但 mixin 会使数据来源不明，同时会引起命名冲突。所以 Vue3 更推荐的是全新的 Composition Api。</p>\n<p>下面是鼠标跟踪的例子，我们可以把逻辑提取出来：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mouse.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref, onMounted, onUnmounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 按照惯例，组合式函数名以 use 开头</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">useMouse</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 组合式函数管理的数据</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> x = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> y = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">update</span>(<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">    x.<span class=\"property\">value</span> = event.<span class=\"property\">pageX</span></span><br><span class=\"line\">    y.<span class=\"property\">value</span> = event.<span class=\"property\">pageY</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 组合式函数可以挂靠在所属组件的生命周期上，来启动和卸载副作用</span></span><br><span class=\"line\">  <span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, update))</span><br><span class=\"line\">  <span class=\"title function_\">onUnmounted</span>(<span class=\"function\">() =&gt;</span> <span class=\"variable language_\">window</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, update))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 通过返回值暴露所管理的数据</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; x, y &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这时候在组件中我们就可以直接使用 mouse.js 暴露的数据了。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; useMouse &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./mouse.js&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> &#123; x, y &#125; = <span class=\"title function_\">useMouse</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span>Mouse position is at: &#123;&#123; x &#125;&#125;, &#123;&#123; y &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>我们还可以在一个组件中引入多个组合式函数，或者在一个组合式函数中引入其他的组合式函数，这个比较简单，我就不演示了。接下来，我们看看使用异步方法的组合式函数。</p>\n<p>在做异步数据请求时，我们通常需要处理三个不同的状态：加载中、加载成功和加载失败。获取这些状态的逻辑是通用的，我们可以把它提取出来：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// request.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">useRequest</span>(<span class=\"params\">url</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> data = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> error = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  axios.<span class=\"title function_\">get</span>(url)</span><br><span class=\"line\">    .<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> (data.<span class=\"property\">value</span> = res.<span class=\"property\">data</span>))</span><br><span class=\"line\">    .<span class=\"title function_\">catch</span>(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> (error.<span class=\"property\">value</span> = err))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; data, error &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>现在我们在组件中只需要：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; useRequest &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./request.js&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> &#123; data, error &#125; = <span class=\"title function_\">useRequest</span>(<span class=\"string\">&#x27;http://...&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&quot;data&quot;</span>&gt;</span>Data is: &#123;&#123; data &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-else-if</span>=<span class=\"string\">&quot;error&quot;</span>&gt;</span>Error message is: &#123;&#123; error.message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-else</span>&gt;</span>Loading...<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>任何组件都可以使用上面这个逻辑，这就是逻辑复用。</p>\n<h2 id=\"「场景八：生命周期」\"><a href=\"#「场景八：生命周期」\" class=\"headerlink\" title=\"「场景八：生命周期」\"></a>「场景八：生命周期」</h2><p>Vue3 的生命周期和 Vue2 相比，有以下改动：</p>\n<ul>\n<li>Vue3 生命周期钩子都以 on 开头，并且需要在组件中手动导入。</li>\n<li>Vue3 取消了 beforeCreate 和 created 钩子。如果需要在组件创建前注入逻辑，直接在 <code>&lt;script setup&gt;</code> 中编写同步代码就可以了。如果这几个钩子同时存在，setup 的执行顺序要优先于 beforeCreate 和 created。</li>\n<li>Vue3 中组件卸载的钩子名称有变化，beforeDestroy 改为 onBeforeUnmount，destroyed 改为 onUnmounted。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;onMounted&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"「场景九：全局-API」\"><a href=\"#「场景九：全局-API」\" class=\"headerlink\" title=\"「场景九：全局 API」\"></a>「场景九：全局 API」</h2><p>Vue2 中的全局属性或全局方法，是在构造函数 Vue 的原型对象上进行添加，如：Vue.prototype.$axios &#x3D; axios 。但在 Vue3 中，需要在 app 实例上添加：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\">app.<span class=\"property\">config</span>.<span class=\"property\">globalProperties</span>.<span class=\"property\">$axios</span> = axios</span><br></pre></td></tr></table></figure>\n\n<p>在组件中使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; getCurrentInstance &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; proxy &#125; = <span class=\"title function_\">getCurrentInstance</span>()</span><br><span class=\"line\">proxy.<span class=\"property\">$axios</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;http://...&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Vue3 中其他的全局 API，如 directive 、component 等，跟 Vue2 的用法都差不多，只不过一个是在 Vue 上调用，一个是在 app 实例上调用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"><span class=\"comment\">// 全局自定义指令</span></span><br><span class=\"line\">app.<span class=\"title function_\">directive</span>(<span class=\"string\">&#x27;focus&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"title function_\">focus</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 全局自定义组件</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">CustomComp</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./components/CustomComp.vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;CustomComp&#x27;</span>, <span class=\"title class_\">CustomComp</span>)</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，Vue3 废弃了 filter 这个方法，因为通过函数或 computed 可以实现一样的功能。</p>\n<h2 id=\"「常见十：与-TypeScript-结合使用」\"><a href=\"#「常见十：与-TypeScript-结合使用」\" class=\"headerlink\" title=\"「常见十：与 TypeScript 结合使用」\"></a>「常见十：与 TypeScript 结合使用」</h2><p>与 TypeScript 结合使用，我们只需要在 <code>&lt;script setup&gt;</code> 中添加 <code>lang=&quot;ts&quot;</code> 就可以了。下面是一些和 TypeScript 结合使用的例子。</p>\n<h3 id=\"为-props-标注类型\"><a href=\"#为-props-标注类型\" class=\"headerlink\" title=\"为 props 标注类型\"></a>为 props 标注类型</h3><p><strong>运行时声明</strong></p>\n<p>当使用 <code>&lt;script setup&gt;</code> 时，defineProps() 宏函数支持从它的参数中推导类型：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script setup lang=<span class=\"string\">&quot;ts&quot;</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">foo</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">  <span class=\"attr\">bar</span>: <span class=\"title class_\">Number</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">props.<span class=\"property\">foo</span> <span class=\"comment\">// string</span></span><br><span class=\"line\">props.<span class=\"property\">bar</span> <span class=\"comment\">// number | undefined</span></span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>这被称为 运行时声明 ，因为传递给 defineProps() 的参数会作为运行时的 props 选项使用。</p>\n<p><strong>基于类型的声明</strong></p>\n<p>我们还可以通过泛型参数来定义 props 的类型，这种方式更加常用：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script setup lang=<span class=\"string\">&quot;ts&quot;</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">foo</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  bar?: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> props = defineProps&lt;<span class=\"title class_\">Props</span>&gt;()</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>这被称为 基于类型的声明 ，编译器会尽可能地尝试根据类型参数推导出等价的运行时选项。这种方式的不足之处在于，失去了定义 props 默认值的能力。为了解决这个问题，我们可以使用 withDefaults 宏函数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script setup lang=<span class=\"string\">&quot;ts&quot;</span>&gt;</span><br><span class=\"line\">interface <span class=\"title class_\">Props</span> &#123;</span><br><span class=\"line\">  msg?: string</span><br><span class=\"line\">  labels?: string[]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">withDefaults</span>(defineProps&lt;<span class=\"title class_\">Props</span>&gt;(), &#123;</span><br><span class=\"line\">  <span class=\"attr\">msg</span>: <span class=\"string\">&#x27;hello vue3!&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">labels</span>: <span class=\"function\">() =&gt;</span> [<span class=\"string\">&#x27;one&#x27;</span>, <span class=\"string\">&#x27;two&#x27;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"为-ref-标注类型\"><a href=\"#为-ref-标注类型\" class=\"headerlink\" title=\"为 ref() 标注类型\"></a>为 ref() 标注类型</h3><p><strong>默认推导类型</strong></p>\n<p>ref 会根据初始化时的值自动推导其类型：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> year = <span class=\"title function_\">ref</span>(<span class=\"number\">2022</span>)</span><br><span class=\"line\">year.<span class=\"property\">value</span> = <span class=\"string\">&#x27;2022&#x27;</span> <span class=\"comment\">// TS Error: 不能将类型 string 分配给类型 number</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>通过接口指定类型</strong></p>\n<p>有时我们可能想为 ref 内的值指定一个更复杂的类型，可以使用 Ref 这个接口：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Ref</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">year</span>: <span class=\"title class_\">Ref</span>&lt;<span class=\"built_in\">string</span> | <span class=\"built_in\">number</span>&gt; = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;2022&#x27;</span>)</span><br><span class=\"line\">year.<span class=\"property\">value</span> = <span class=\"number\">2022</span> <span class=\"comment\">// 成功！</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>通过泛型指定类型</strong></p>\n<p>我们也可以在调用 ref() 时传入一个泛型参数，来覆盖默认的推导行为：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> year = ref&lt;<span class=\"built_in\">string</span> | <span class=\"built_in\">number</span>&gt;(<span class=\"string\">&#x27;2022&#x27;</span>)</span><br><span class=\"line\">year.<span class=\"property\">value</span> = <span class=\"number\">2022</span> <span class=\"comment\">// 成功！</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"为-reactive-标注类型\"><a href=\"#为-reactive-标注类型\" class=\"headerlink\" title=\"为 reactive() 标注类型\"></a>为 reactive() 标注类型</h3><p><strong>默认推导类型</strong></p>\n<p>reactive() 也会隐式地从它的参数中推导类型：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; reactive &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> book = <span class=\"title function_\">reactive</span>(&#123; <span class=\"attr\">title</span>: <span class=\"string\">&#x27;Vue 3 指引&#x27;</span> &#125;)</span><br><span class=\"line\">book.<span class=\"property\">year</span> = <span class=\"number\">2022</span> <span class=\"comment\">// TS Error: 类型 &#123; title: string; &#125; 上不存在属性 year</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>通过接口指定类型</strong></p>\n<p>要显式地指定一个 reactive 变量的类型，我们可以使用接口：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; reactive &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Book</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">title</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">  year?: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">book</span>: <span class=\"title class_\">Book</span> = <span class=\"title function_\">reactive</span>(&#123; <span class=\"attr\">title</span>: <span class=\"string\">&#x27;Vue 3 指引&#x27;</span> &#125;)</span><br><span class=\"line\">book.<span class=\"property\">year</span> = <span class=\"number\">2022</span> <span class=\"comment\">// 成功！</span></span><br></pre></td></tr></table></figure>\n\n<p>其他 API 与 TypeScript 结合使用的方法和上面大同小异，这里我就不一一列举了。具体可以参考这篇文章：<a href=\"https://juejin.cn/post/7129130323148800031\">如何为 Vue3 组件标注 TS 类型，看这个就够了！</a>。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>以上就是我在 Vue3 项目中遇到最多的场景，如果你掌握了 Vue3 常用的 API 和今天这些场景，相信参与 Vue3 项目的开发是没有问题了。当然如果要用好 Vue3 ，可能还需要对 Pinia 、 Vite 等相关生态有一个深入的了解。</p>\n"},{"title":"vue3 scoped 和 样式穿透","date":"2023-03-21T13:23:07.000Z","description":"vue 中的 scoped 通过在DOM结构以及css样式上加唯一不重复的标记 data-v-hash 的方式，以保证唯一，达到样式私有化模块化的目的。","_content":"\n### scoped原理\n\nvue 中的 scoped 通过在DOM结构以及css样式上加唯一不重复的标记: `data-v-hash` 的方式，以保证唯一（而这个工作是由过PostCSS转译实现的），达到样式私有化模块化的目的。\n\n总结一下scoped三条渲染规则：\n\n1. 给HTML的DOM节点加一个不重复data属性(形如：`data-v-123`)来表示他的唯一性\n2. 在每句css选择器的末尾（编译后的生成的css语句）加一个当前组件的data属性选择器（如 `[data-v-123]`）来私有化样式\n3. 如果组件内部包含有其他组件，只会给其他组件的最外层标签加上当前组件的data属性\n\nPostCSS会给一个组件中的所有dom添加了一个独一无二的动态属性data-v-xxxx，然后，给CSS选择器额外添加一个对应的属性选择器来选择该组件中dom，这种做法使得样式只作用于含有该属性的dom——组件内部dom, 从而达到了'样式模块化'的效果。\n\n\n### 样式穿透\n\n在vue3中项目中，使用深度选择器可能会出现如下错误：\n\n`[@vue/compiler-sfc] the >>> and /deep/ combinators have been deprecated. Use :deep() instead.`\n\n意思是 `>>>` 和 `/deep/` 已经被弃用，要用 `:deep()` 代替：\n\n```css\n.父元素class :deep(.class){ xxx }\n```\n\n他的作用是用来改变属性选择器的位置，由 `.father input[data-v-9ew234df]` 改为 `.father[data-v-9ew234df] input`。","source":"_posts/vue3-scoped.md","raw":"---\ntitle: vue3 scoped 和 样式穿透\ndate: 2023-03-21 21:23:07\ntags: Vue.js\ncategories: JavaScript\ndescription: vue 中的 scoped 通过在DOM结构以及css样式上加唯一不重复的标记 data-v-hash 的方式，以保证唯一，达到样式私有化模块化的目的。\n---\n\n### scoped原理\n\nvue 中的 scoped 通过在DOM结构以及css样式上加唯一不重复的标记: `data-v-hash` 的方式，以保证唯一（而这个工作是由过PostCSS转译实现的），达到样式私有化模块化的目的。\n\n总结一下scoped三条渲染规则：\n\n1. 给HTML的DOM节点加一个不重复data属性(形如：`data-v-123`)来表示他的唯一性\n2. 在每句css选择器的末尾（编译后的生成的css语句）加一个当前组件的data属性选择器（如 `[data-v-123]`）来私有化样式\n3. 如果组件内部包含有其他组件，只会给其他组件的最外层标签加上当前组件的data属性\n\nPostCSS会给一个组件中的所有dom添加了一个独一无二的动态属性data-v-xxxx，然后，给CSS选择器额外添加一个对应的属性选择器来选择该组件中dom，这种做法使得样式只作用于含有该属性的dom——组件内部dom, 从而达到了'样式模块化'的效果。\n\n\n### 样式穿透\n\n在vue3中项目中，使用深度选择器可能会出现如下错误：\n\n`[@vue/compiler-sfc] the >>> and /deep/ combinators have been deprecated. Use :deep() instead.`\n\n意思是 `>>>` 和 `/deep/` 已经被弃用，要用 `:deep()` 代替：\n\n```css\n.父元素class :deep(.class){ xxx }\n```\n\n他的作用是用来改变属性选择器的位置，由 `.father input[data-v-9ew234df]` 改为 `.father[data-v-9ew234df] input`。","slug":"vue3-scoped","published":1,"updated":"2023-03-21T13:28:20.267Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsil003cyt8w6yngglxl","content":"<h3 id=\"scoped原理\"><a href=\"#scoped原理\" class=\"headerlink\" title=\"scoped原理\"></a>scoped原理</h3><p>vue 中的 scoped 通过在DOM结构以及css样式上加唯一不重复的标记: <code>data-v-hash</code> 的方式，以保证唯一（而这个工作是由过PostCSS转译实现的），达到样式私有化模块化的目的。</p>\n<p>总结一下scoped三条渲染规则：</p>\n<ol>\n<li>给HTML的DOM节点加一个不重复data属性(形如：<code>data-v-123</code>)来表示他的唯一性</li>\n<li>在每句css选择器的末尾（编译后的生成的css语句）加一个当前组件的data属性选择器（如 <code>[data-v-123]</code>）来私有化样式</li>\n<li>如果组件内部包含有其他组件，只会给其他组件的最外层标签加上当前组件的data属性</li>\n</ol>\n<p>PostCSS会给一个组件中的所有dom添加了一个独一无二的动态属性data-v-xxxx，然后，给CSS选择器额外添加一个对应的属性选择器来选择该组件中dom，这种做法使得样式只作用于含有该属性的dom——组件内部dom, 从而达到了’样式模块化’的效果。</p>\n<h3 id=\"样式穿透\"><a href=\"#样式穿透\" class=\"headerlink\" title=\"样式穿透\"></a>样式穿透</h3><p>在vue3中项目中，使用深度选择器可能会出现如下错误：</p>\n<p><code>[@vue/compiler-sfc] the &gt;&gt;&gt; and /deep/ combinators have been deprecated. Use :deep() instead.</code></p>\n<p>意思是 <code>&gt;&gt;&gt;</code> 和 <code>/deep/</code> 已经被弃用，要用 <code>:deep()</code> 代替：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.父元素class :<span class=\"built_in\">deep</span>(.class)&#123; xxx &#125;</span><br></pre></td></tr></table></figure>\n\n<p>他的作用是用来改变属性选择器的位置，由 <code>.father input[data-v-9ew234df]</code> 改为 <code>.father[data-v-9ew234df] input</code>。</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"scoped原理\"><a href=\"#scoped原理\" class=\"headerlink\" title=\"scoped原理\"></a>scoped原理</h3><p>vue 中的 scoped 通过在DOM结构以及css样式上加唯一不重复的标记: <code>data-v-hash</code> 的方式，以保证唯一（而这个工作是由过PostCSS转译实现的），达到样式私有化模块化的目的。</p>\n<p>总结一下scoped三条渲染规则：</p>\n<ol>\n<li>给HTML的DOM节点加一个不重复data属性(形如：<code>data-v-123</code>)来表示他的唯一性</li>\n<li>在每句css选择器的末尾（编译后的生成的css语句）加一个当前组件的data属性选择器（如 <code>[data-v-123]</code>）来私有化样式</li>\n<li>如果组件内部包含有其他组件，只会给其他组件的最外层标签加上当前组件的data属性</li>\n</ol>\n<p>PostCSS会给一个组件中的所有dom添加了一个独一无二的动态属性data-v-xxxx，然后，给CSS选择器额外添加一个对应的属性选择器来选择该组件中dom，这种做法使得样式只作用于含有该属性的dom——组件内部dom, 从而达到了’样式模块化’的效果。</p>\n<h3 id=\"样式穿透\"><a href=\"#样式穿透\" class=\"headerlink\" title=\"样式穿透\"></a>样式穿透</h3><p>在vue3中项目中，使用深度选择器可能会出现如下错误：</p>\n<p><code>[@vue/compiler-sfc] the &gt;&gt;&gt; and /deep/ combinators have been deprecated. Use :deep() instead.</code></p>\n<p>意思是 <code>&gt;&gt;&gt;</code> 和 <code>/deep/</code> 已经被弃用，要用 <code>:deep()</code> 代替：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.父元素class :<span class=\"built_in\">deep</span>(.class)&#123; xxx &#125;</span><br></pre></td></tr></table></figure>\n\n<p>他的作用是用来改变属性选择器的位置，由 <code>.father input[data-v-9ew234df]</code> 改为 <code>.father[data-v-9ew234df] input</code>。</p>\n"},{"title":"使用 vuepress 生成静态网站","date":"2022-05-14T06:04:39.000Z","description":"vuepress 是一个 Vue 驱动的静态网站生成器，它可以让你快速搭建一个文档/博客，后期只需要修改markdown内容和导航参数，即可一键打包生成页面。","_content":"\n# 使用 vuepress 生成静态网站\n\n## vuepress 是什么\n\nvuepress 是一个 Vue 驱动的**静态网站生成器**，它可以让你：\n\n+ **快速搭建**一个文档/博客，后期只需要修改markdown内容和导航参数，即可一键打包生成页面。\n\n+ 页面具有非常好的加载性能和搜索引擎优化（SEO），其他的页面则会只在用户浏览到的时候才按需加载。\n\n+ 自动生成全局搜索、记录上次修改时间等功能。\n\n+ 可嵌入vue组件或跳转至其他页面，可定制自己的样式模板便于扩展。\n\n+ 一键免费部署到 github.pages，**无需服务器即可拥有自己的在线文档/博客**。\n\n\n\n## 开始\n\n### 初始化\n\n1、全局安装vuepress\n\n```bash\nnpm install -g vuepress\n```\n\n2、初始化项目\n\n```bash\nnpm init -y\n```\n\n3、按 [官方](https://vuepress.vuejs.org/zh/guide/directory-structure.html) 规定创建文件和文件夹\n\n```bash\n# 下面没有文件类型后缀的都是文件夹\n# 部分内容并不是必须的，想自己定制的话可以参考官方文档。这里是按照我的思路写的。\n├── docs\n│   ├── .vuepress  //存放核心内容的文件夹\n│   │   ├── components  //存放你需要添加的vue组件\n│   │   ├── public  //存放静态文件，如图片等\n│   │   ├── styles  //存放需要定制的样式\n│   │   │   └── palette.styl  //配置页面主题颜色的文件\n│   │   └── config.js   //设定顶部导航栏、侧边导航栏等项目配置的核心文件\n│   ├── pages   //存放markdown文件，用于设置其他页面内容\n│   ├── README.md   //首页展示用的markdown文件\n├── deploy.sh     //之后用于编写上传、发布脚本的文件\n└── package.json  //之前创建的项目描述文件\n```\n\n4、添加启动命令\n\n```json\n\"scripts\": {\n    \"dev\": \"vuepress dev docs\",         //用于实时预览\n    \"build\": \"vuepress build docs\"      //用于打包项目\n}\n```\n\n\n\n### 页面配置\n\n#### 修改页面整体设置\n\n首先我们先设定网页与浏览器标签栏相关的一些设置，直接在我们的 `config.js` 文件增添下面的代码。\n\n```js\nmodule.exports = {\n    title: '这里是标题名', // 显示在左上角的网页名称以及首页在浏览器标签显示的title名称\n    description: '这里是描述', // meta 中的描述文字，用于SEO\n    // 注入到当前页面的 HTML <head> 中的标签\n    head: [\n        ['link', \n            { rel: 'icon', href: '/icon.png' }\n            //浏览器的标签栏的网页图标，第一个'/'会遍历public文件夹的文件\n        ],  \n    ],\n}\n```\n\n修改完成后，在 `docs/.vuepress/public` 文件夹里面放置我们的logo图片。\n\n然后运行我们的 `npm run dev`，打开 `http://localhost:8080/` 就可以看到效果。\n\n#### 设置首页内容\n\n接下来我们来设置首页的内容，按照官网给的格式修改`README.md`文件，填写如下内容：\n\n```markdown\n---\nhome: true\nheroImage: /icon.png\nheroText: xxx\ntagline: xxx\nactionText: 马上进入 →\nactionLink: /xxx\nfeatures:\n- title: 简洁至上\n  details: 以 Markdown 为中心的项目结构，以最少的配置帮助你专注于写作。\n- title: Vue驱动\n  details: 享受 Vue + webpack 的开发体验，在 Markdown 中使用 Vue 组件，同时可以使用 Vue 来开发自定义主题。\n- title: 高性能\n  details: VuePress 为每个页面预渲染生成静态的 HTML，同时在页面被加载的时候，将作为 SPA 运行。\n---\n```\n\n> 注意：：heroImage的地址配置第一个'/'默认指向的是 docs/.vuepress/public，你需要在此文件夹放置你的首页图片。 actionLink地址配置第一个'/'默认指向的是 docs/，若未路径文件不存在点击进去会跳转至404。\n\n#### 修改页面导航栏、侧边导航栏\n\n导航栏修改和侧边栏修改还是在我们的 `config.js` 文件进行修改，在之前添加的moudule.exports里添加如下代码\n\n```js\nmodule.exports = {\n    //...省略部分代码\n    \n    //下面涉及到的md文件和其他文件的路径下一步再详细解释\n    themeConfig: {\n        logo: '/egg.png',  //网页顶端导航栏左上角的图标\n        \n        //顶部导航栏\n        nav: [           \n            //格式一：直接跳转，'/'为不添加路由，跳转至首页\n            { text: '首页', link: '/' },    \n            \n            //格式二：添加下拉菜单，link指向的文件路径\n            {\n                text: '分类',  //默认显示        \n                ariaLabel: '分类',   //用于识别的label\n                items: [\n                    { text: '文章', link: '/pages/folder1/test1.md' },  \n                    //点击标签会跳转至link的markdown文件生成的页面\n                    { text: '琐碎', link: '/pages/folder2/test4.md' },\n                ]\n            },\n            { text: '功能演示', link: '/pages/folder1/test3.md' },\n            \n            //格式三：跳转至外部网页，需http/https前缀\n            { text: 'Github', link: 'https://github.com/dwanda' },\n        ],\n        \n        //侧边导航栏：会根据当前的文件路径是否匹配侧边栏数据，自动显示/隐藏\n        sidebar: {\n            '/pages/folder1/':[         \n                {\n                    title: '测试菜单1',   // 一级菜单名称\n                    collapsable: false, // false为默认展开菜单, 默认值true是折叠,\n                    sidebarDepth: 1,    //  设置侧边导航自动提取markdown文件标题的层级，默认1为h2层级\n                    children: [\n                        ['test1.md', '子菜单1'],  //菜单名称为'子菜单1'，跳转至/pages/folder1/test1.md\n                        ['test3.md', '子菜单2']\n                    ]\n                },\n                {\n                    title: '测试菜单2',\n                    collapsable: false, \n                    children: [\n                        ['test2.md', '子菜单1']\n                    ]\n                }\n            ],\n            \n            //...可添加多个不同的侧边栏，不同页面会根据路径显示不同的侧边栏\n        }\n    }\n}\n```\n\n\n\n## 一键部署至github page\n\n在你的项目中，创建一个如下的 `deploy.sh` 文件：\n\n```shell\n#!/usr/bin/env sh\n\n# 确保脚本抛出遇到的错误\nset -e\n\n# 生成静态文件\nnpm run docs:build\n\n# 进入生成的文件夹\ncd docs/.vuepress/dist\n\n# 如果是发布到自定义域名\n# echo 'www.example.com' > CNAME\n\ngit init\ngit add -A\ngit commit -m 'deploy'\n\n# 如果发布到 https://<USERNAME>.github.io\n# git push -f git@github.com:<USERNAME>/<USERNAME>.github.io.git master\n\n# 如果发布到 https://<USERNAME>.github.io/<REPO>\n# git push -f git@github.com:<USERNAME>/<REPO>.git master:gh-pages\n\ncd -\n```\n\n`package.json` 中配置命令执行此shell文件：\n\n```json\n\"scripts\": {\n  \"deploy\": \"bash deploy.sh\"\n}\n```\n\n\n\n## 其他\n\n### 热编译浏览器不自动更新\n\n本地开发模式运行Vuepress 1.x 时，浏览器不能自动更新:\n\n在 package.json 中将运行命令 由\n\n```json\n\"dev\": \"vuepress dev docs\"\n```\n\n改为\n\n```json\n\"dev\": \"vuepress dev docs --temp .temp\"\n```\n\n即可解决。\n\n> 注意：运行 vuepress 会生成一个临时文件夹 .temp，可以在 .gitignore 中忽略掉该文件夹\n\n\n\n## 参考\n\n1. [VuePress](https://vuepress.vuejs.org/)\n2. [1小时搞定vuepress](https://juejin.cn/post/6844903999129436174#heading-9)\n","source":"_posts/vuepress101.md","raw":"---\ntitle: 使用 vuepress 生成静态网站\ndate: 2022-05-14 14:04:39\ntags: 博客\ncategories: 博客\ndescription: vuepress 是一个 Vue 驱动的静态网站生成器，它可以让你快速搭建一个文档/博客，后期只需要修改markdown内容和导航参数，即可一键打包生成页面。\n---\n\n# 使用 vuepress 生成静态网站\n\n## vuepress 是什么\n\nvuepress 是一个 Vue 驱动的**静态网站生成器**，它可以让你：\n\n+ **快速搭建**一个文档/博客，后期只需要修改markdown内容和导航参数，即可一键打包生成页面。\n\n+ 页面具有非常好的加载性能和搜索引擎优化（SEO），其他的页面则会只在用户浏览到的时候才按需加载。\n\n+ 自动生成全局搜索、记录上次修改时间等功能。\n\n+ 可嵌入vue组件或跳转至其他页面，可定制自己的样式模板便于扩展。\n\n+ 一键免费部署到 github.pages，**无需服务器即可拥有自己的在线文档/博客**。\n\n\n\n## 开始\n\n### 初始化\n\n1、全局安装vuepress\n\n```bash\nnpm install -g vuepress\n```\n\n2、初始化项目\n\n```bash\nnpm init -y\n```\n\n3、按 [官方](https://vuepress.vuejs.org/zh/guide/directory-structure.html) 规定创建文件和文件夹\n\n```bash\n# 下面没有文件类型后缀的都是文件夹\n# 部分内容并不是必须的，想自己定制的话可以参考官方文档。这里是按照我的思路写的。\n├── docs\n│   ├── .vuepress  //存放核心内容的文件夹\n│   │   ├── components  //存放你需要添加的vue组件\n│   │   ├── public  //存放静态文件，如图片等\n│   │   ├── styles  //存放需要定制的样式\n│   │   │   └── palette.styl  //配置页面主题颜色的文件\n│   │   └── config.js   //设定顶部导航栏、侧边导航栏等项目配置的核心文件\n│   ├── pages   //存放markdown文件，用于设置其他页面内容\n│   ├── README.md   //首页展示用的markdown文件\n├── deploy.sh     //之后用于编写上传、发布脚本的文件\n└── package.json  //之前创建的项目描述文件\n```\n\n4、添加启动命令\n\n```json\n\"scripts\": {\n    \"dev\": \"vuepress dev docs\",         //用于实时预览\n    \"build\": \"vuepress build docs\"      //用于打包项目\n}\n```\n\n\n\n### 页面配置\n\n#### 修改页面整体设置\n\n首先我们先设定网页与浏览器标签栏相关的一些设置，直接在我们的 `config.js` 文件增添下面的代码。\n\n```js\nmodule.exports = {\n    title: '这里是标题名', // 显示在左上角的网页名称以及首页在浏览器标签显示的title名称\n    description: '这里是描述', // meta 中的描述文字，用于SEO\n    // 注入到当前页面的 HTML <head> 中的标签\n    head: [\n        ['link', \n            { rel: 'icon', href: '/icon.png' }\n            //浏览器的标签栏的网页图标，第一个'/'会遍历public文件夹的文件\n        ],  \n    ],\n}\n```\n\n修改完成后，在 `docs/.vuepress/public` 文件夹里面放置我们的logo图片。\n\n然后运行我们的 `npm run dev`，打开 `http://localhost:8080/` 就可以看到效果。\n\n#### 设置首页内容\n\n接下来我们来设置首页的内容，按照官网给的格式修改`README.md`文件，填写如下内容：\n\n```markdown\n---\nhome: true\nheroImage: /icon.png\nheroText: xxx\ntagline: xxx\nactionText: 马上进入 →\nactionLink: /xxx\nfeatures:\n- title: 简洁至上\n  details: 以 Markdown 为中心的项目结构，以最少的配置帮助你专注于写作。\n- title: Vue驱动\n  details: 享受 Vue + webpack 的开发体验，在 Markdown 中使用 Vue 组件，同时可以使用 Vue 来开发自定义主题。\n- title: 高性能\n  details: VuePress 为每个页面预渲染生成静态的 HTML，同时在页面被加载的时候，将作为 SPA 运行。\n---\n```\n\n> 注意：：heroImage的地址配置第一个'/'默认指向的是 docs/.vuepress/public，你需要在此文件夹放置你的首页图片。 actionLink地址配置第一个'/'默认指向的是 docs/，若未路径文件不存在点击进去会跳转至404。\n\n#### 修改页面导航栏、侧边导航栏\n\n导航栏修改和侧边栏修改还是在我们的 `config.js` 文件进行修改，在之前添加的moudule.exports里添加如下代码\n\n```js\nmodule.exports = {\n    //...省略部分代码\n    \n    //下面涉及到的md文件和其他文件的路径下一步再详细解释\n    themeConfig: {\n        logo: '/egg.png',  //网页顶端导航栏左上角的图标\n        \n        //顶部导航栏\n        nav: [           \n            //格式一：直接跳转，'/'为不添加路由，跳转至首页\n            { text: '首页', link: '/' },    \n            \n            //格式二：添加下拉菜单，link指向的文件路径\n            {\n                text: '分类',  //默认显示        \n                ariaLabel: '分类',   //用于识别的label\n                items: [\n                    { text: '文章', link: '/pages/folder1/test1.md' },  \n                    //点击标签会跳转至link的markdown文件生成的页面\n                    { text: '琐碎', link: '/pages/folder2/test4.md' },\n                ]\n            },\n            { text: '功能演示', link: '/pages/folder1/test3.md' },\n            \n            //格式三：跳转至外部网页，需http/https前缀\n            { text: 'Github', link: 'https://github.com/dwanda' },\n        ],\n        \n        //侧边导航栏：会根据当前的文件路径是否匹配侧边栏数据，自动显示/隐藏\n        sidebar: {\n            '/pages/folder1/':[         \n                {\n                    title: '测试菜单1',   // 一级菜单名称\n                    collapsable: false, // false为默认展开菜单, 默认值true是折叠,\n                    sidebarDepth: 1,    //  设置侧边导航自动提取markdown文件标题的层级，默认1为h2层级\n                    children: [\n                        ['test1.md', '子菜单1'],  //菜单名称为'子菜单1'，跳转至/pages/folder1/test1.md\n                        ['test3.md', '子菜单2']\n                    ]\n                },\n                {\n                    title: '测试菜单2',\n                    collapsable: false, \n                    children: [\n                        ['test2.md', '子菜单1']\n                    ]\n                }\n            ],\n            \n            //...可添加多个不同的侧边栏，不同页面会根据路径显示不同的侧边栏\n        }\n    }\n}\n```\n\n\n\n## 一键部署至github page\n\n在你的项目中，创建一个如下的 `deploy.sh` 文件：\n\n```shell\n#!/usr/bin/env sh\n\n# 确保脚本抛出遇到的错误\nset -e\n\n# 生成静态文件\nnpm run docs:build\n\n# 进入生成的文件夹\ncd docs/.vuepress/dist\n\n# 如果是发布到自定义域名\n# echo 'www.example.com' > CNAME\n\ngit init\ngit add -A\ngit commit -m 'deploy'\n\n# 如果发布到 https://<USERNAME>.github.io\n# git push -f git@github.com:<USERNAME>/<USERNAME>.github.io.git master\n\n# 如果发布到 https://<USERNAME>.github.io/<REPO>\n# git push -f git@github.com:<USERNAME>/<REPO>.git master:gh-pages\n\ncd -\n```\n\n`package.json` 中配置命令执行此shell文件：\n\n```json\n\"scripts\": {\n  \"deploy\": \"bash deploy.sh\"\n}\n```\n\n\n\n## 其他\n\n### 热编译浏览器不自动更新\n\n本地开发模式运行Vuepress 1.x 时，浏览器不能自动更新:\n\n在 package.json 中将运行命令 由\n\n```json\n\"dev\": \"vuepress dev docs\"\n```\n\n改为\n\n```json\n\"dev\": \"vuepress dev docs --temp .temp\"\n```\n\n即可解决。\n\n> 注意：运行 vuepress 会生成一个临时文件夹 .temp，可以在 .gitignore 中忽略掉该文件夹\n\n\n\n## 参考\n\n1. [VuePress](https://vuepress.vuejs.org/)\n2. [1小时搞定vuepress](https://juejin.cn/post/6844903999129436174#heading-9)\n","slug":"vuepress101","published":1,"updated":"2022-05-14T06:05:59.190Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll3vjsim003fyt8we2ufb0um","content":"<h1 id=\"使用-vuepress-生成静态网站\"><a href=\"#使用-vuepress-生成静态网站\" class=\"headerlink\" title=\"使用 vuepress 生成静态网站\"></a>使用 vuepress 生成静态网站</h1><h2 id=\"vuepress-是什么\"><a href=\"#vuepress-是什么\" class=\"headerlink\" title=\"vuepress 是什么\"></a>vuepress 是什么</h2><p>vuepress 是一个 Vue 驱动的<strong>静态网站生成器</strong>，它可以让你：</p>\n<ul>\n<li><p><strong>快速搭建</strong>一个文档&#x2F;博客，后期只需要修改markdown内容和导航参数，即可一键打包生成页面。</p>\n</li>\n<li><p>页面具有非常好的加载性能和搜索引擎优化（SEO），其他的页面则会只在用户浏览到的时候才按需加载。</p>\n</li>\n<li><p>自动生成全局搜索、记录上次修改时间等功能。</p>\n</li>\n<li><p>可嵌入vue组件或跳转至其他页面，可定制自己的样式模板便于扩展。</p>\n</li>\n<li><p>一键免费部署到 github.pages，<strong>无需服务器即可拥有自己的在线文档&#x2F;博客</strong>。</p>\n</li>\n</ul>\n<h2 id=\"开始\"><a href=\"#开始\" class=\"headerlink\" title=\"开始\"></a>开始</h2><h3 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h3><p>1、全局安装vuepress</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g vuepress</span><br></pre></td></tr></table></figure>\n\n<p>2、初始化项目</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init -y</span><br></pre></td></tr></table></figure>\n\n<p>3、按 <a href=\"https://vuepress.vuejs.org/zh/guide/directory-structure.html\">官方</a> 规定创建文件和文件夹</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 下面没有文件类型后缀的都是文件夹</span></span><br><span class=\"line\"><span class=\"comment\"># 部分内容并不是必须的，想自己定制的话可以参考官方文档。这里是按照我的思路写的。</span></span><br><span class=\"line\">├── docs</span><br><span class=\"line\">│   ├── .vuepress  //存放核心内容的文件夹</span><br><span class=\"line\">│   │   ├── components  //存放你需要添加的vue组件</span><br><span class=\"line\">│   │   ├── public  //存放静态文件，如图片等</span><br><span class=\"line\">│   │   ├── styles  //存放需要定制的样式</span><br><span class=\"line\">│   │   │   └── palette.styl  //配置页面主题颜色的文件</span><br><span class=\"line\">│   │   └── config.js   //设定顶部导航栏、侧边导航栏等项目配置的核心文件</span><br><span class=\"line\">│   ├── pages   //存放markdown文件，用于设置其他页面内容</span><br><span class=\"line\">│   ├── README.md   //首页展示用的markdown文件</span><br><span class=\"line\">├── deploy.sh     //之后用于编写上传、发布脚本的文件</span><br><span class=\"line\">└── package.json  //之前创建的项目描述文件</span><br></pre></td></tr></table></figure>\n\n<p>4、添加启动命令</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;dev&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;vuepress dev docs&quot;</span><span class=\"punctuation\">,</span>         <span class=\"comment\">//用于实时预览</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;build&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;vuepress build docs&quot;</span>      <span class=\"comment\">//用于打包项目</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"页面配置\"><a href=\"#页面配置\" class=\"headerlink\" title=\"页面配置\"></a>页面配置</h3><h4 id=\"修改页面整体设置\"><a href=\"#修改页面整体设置\" class=\"headerlink\" title=\"修改页面整体设置\"></a>修改页面整体设置</h4><p>首先我们先设定网页与浏览器标签栏相关的一些设置，直接在我们的 <code>config.js</code> 文件增添下面的代码。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&#x27;这里是标题名&#x27;</span>, <span class=\"comment\">// 显示在左上角的网页名称以及首页在浏览器标签显示的title名称</span></span><br><span class=\"line\">    <span class=\"attr\">description</span>: <span class=\"string\">&#x27;这里是描述&#x27;</span>, <span class=\"comment\">// meta 中的描述文字，用于SEO</span></span><br><span class=\"line\">    <span class=\"comment\">// 注入到当前页面的 HTML &lt;head&gt; 中的标签</span></span><br><span class=\"line\">    <span class=\"attr\">head</span>: [</span><br><span class=\"line\">        [<span class=\"string\">&#x27;link&#x27;</span>, </span><br><span class=\"line\">            &#123; <span class=\"attr\">rel</span>: <span class=\"string\">&#x27;icon&#x27;</span>, <span class=\"attr\">href</span>: <span class=\"string\">&#x27;/icon.png&#x27;</span> &#125;</span><br><span class=\"line\">            <span class=\"comment\">//浏览器的标签栏的网页图标，第一个&#x27;/&#x27;会遍历public文件夹的文件</span></span><br><span class=\"line\">        ],  </span><br><span class=\"line\">    ],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>修改完成后，在 <code>docs/.vuepress/public</code> 文件夹里面放置我们的logo图片。</p>\n<p>然后运行我们的 <code>npm run dev</code>，打开 <code>http://localhost:8080/</code> 就可以看到效果。</p>\n<h4 id=\"设置首页内容\"><a href=\"#设置首页内容\" class=\"headerlink\" title=\"设置首页内容\"></a>设置首页内容</h4><p>接下来我们来设置首页的内容，按照官网给的格式修改<code>README.md</code>文件，填写如下内容：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">home: true</span><br><span class=\"line\">heroImage: /icon.png</span><br><span class=\"line\">heroText: xxx</span><br><span class=\"line\">tagline: xxx</span><br><span class=\"line\">actionText: 马上进入 →</span><br><span class=\"line\">actionLink: /xxx</span><br><span class=\"line\">features:</span><br><span class=\"line\"><span class=\"bullet\">-</span> title: 简洁至上</span><br><span class=\"line\">  details: 以 Markdown 为中心的项目结构，以最少的配置帮助你专注于写作。</span><br><span class=\"line\"><span class=\"bullet\">-</span> title: Vue驱动</span><br><span class=\"line\">  details: 享受 Vue + webpack 的开发体验，在 Markdown 中使用 Vue 组件，同时可以使用 Vue 来开发自定义主题。</span><br><span class=\"line\"><span class=\"bullet\">-</span> title: 高性能</span><br><span class=\"line\"><span class=\"section\">  details: VuePress 为每个页面预渲染生成静态的 HTML，同时在页面被加载的时候，将作为 SPA 运行。</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：：heroImage的地址配置第一个’&#x2F;‘默认指向的是 docs&#x2F;.vuepress&#x2F;public，你需要在此文件夹放置你的首页图片。 actionLink地址配置第一个’&#x2F;‘默认指向的是 docs&#x2F;，若未路径文件不存在点击进去会跳转至404。</p>\n</blockquote>\n<h4 id=\"修改页面导航栏、侧边导航栏\"><a href=\"#修改页面导航栏、侧边导航栏\" class=\"headerlink\" title=\"修改页面导航栏、侧边导航栏\"></a>修改页面导航栏、侧边导航栏</h4><p>导航栏修改和侧边栏修改还是在我们的 <code>config.js</code> 文件进行修改，在之前添加的moudule.exports里添加如下代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...省略部分代码</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//下面涉及到的md文件和其他文件的路径下一步再详细解释</span></span><br><span class=\"line\">    <span class=\"attr\">themeConfig</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">logo</span>: <span class=\"string\">&#x27;/egg.png&#x27;</span>,  <span class=\"comment\">//网页顶端导航栏左上角的图标</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//顶部导航栏</span></span><br><span class=\"line\">        <span class=\"attr\">nav</span>: [           </span><br><span class=\"line\">            <span class=\"comment\">//格式一：直接跳转，&#x27;/&#x27;为不添加路由，跳转至首页</span></span><br><span class=\"line\">            &#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;首页&#x27;</span>, <span class=\"attr\">link</span>: <span class=\"string\">&#x27;/&#x27;</span> &#125;,    </span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//格式二：添加下拉菜单，link指向的文件路径</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">text</span>: <span class=\"string\">&#x27;分类&#x27;</span>,  <span class=\"comment\">//默认显示        </span></span><br><span class=\"line\">                <span class=\"attr\">ariaLabel</span>: <span class=\"string\">&#x27;分类&#x27;</span>,   <span class=\"comment\">//用于识别的label</span></span><br><span class=\"line\">                <span class=\"attr\">items</span>: [</span><br><span class=\"line\">                    &#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;文章&#x27;</span>, <span class=\"attr\">link</span>: <span class=\"string\">&#x27;/pages/folder1/test1.md&#x27;</span> &#125;,  </span><br><span class=\"line\">                    <span class=\"comment\">//点击标签会跳转至link的markdown文件生成的页面</span></span><br><span class=\"line\">                    &#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;琐碎&#x27;</span>, <span class=\"attr\">link</span>: <span class=\"string\">&#x27;/pages/folder2/test4.md&#x27;</span> &#125;,</span><br><span class=\"line\">                ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;功能演示&#x27;</span>, <span class=\"attr\">link</span>: <span class=\"string\">&#x27;/pages/folder1/test3.md&#x27;</span> &#125;,</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//格式三：跳转至外部网页，需http/https前缀</span></span><br><span class=\"line\">            &#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;Github&#x27;</span>, <span class=\"attr\">link</span>: <span class=\"string\">&#x27;https://github.com/dwanda&#x27;</span> &#125;,</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//侧边导航栏：会根据当前的文件路径是否匹配侧边栏数据，自动显示/隐藏</span></span><br><span class=\"line\">        <span class=\"attr\">sidebar</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;/pages/folder1/&#x27;</span>:[         </span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"attr\">title</span>: <span class=\"string\">&#x27;测试菜单1&#x27;</span>,   <span class=\"comment\">// 一级菜单名称</span></span><br><span class=\"line\">                    <span class=\"attr\">collapsable</span>: <span class=\"literal\">false</span>, <span class=\"comment\">// false为默认展开菜单, 默认值true是折叠,</span></span><br><span class=\"line\">                    <span class=\"attr\">sidebarDepth</span>: <span class=\"number\">1</span>,    <span class=\"comment\">//  设置侧边导航自动提取markdown文件标题的层级，默认1为h2层级</span></span><br><span class=\"line\">                    <span class=\"attr\">children</span>: [</span><br><span class=\"line\">                        [<span class=\"string\">&#x27;test1.md&#x27;</span>, <span class=\"string\">&#x27;子菜单1&#x27;</span>],  <span class=\"comment\">//菜单名称为&#x27;子菜单1&#x27;，跳转至/pages/folder1/test1.md</span></span><br><span class=\"line\">                        [<span class=\"string\">&#x27;test3.md&#x27;</span>, <span class=\"string\">&#x27;子菜单2&#x27;</span>]</span><br><span class=\"line\">                    ]</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"attr\">title</span>: <span class=\"string\">&#x27;测试菜单2&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">collapsable</span>: <span class=\"literal\">false</span>, </span><br><span class=\"line\">                    <span class=\"attr\">children</span>: [</span><br><span class=\"line\">                        [<span class=\"string\">&#x27;test2.md&#x27;</span>, <span class=\"string\">&#x27;子菜单1&#x27;</span>]</span><br><span class=\"line\">                    ]</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//...可添加多个不同的侧边栏，不同页面会根据路径显示不同的侧边栏</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"一键部署至github-page\"><a href=\"#一键部署至github-page\" class=\"headerlink\" title=\"一键部署至github page\"></a>一键部署至github page</h2><p>在你的项目中，创建一个如下的 <code>deploy.sh</code> 文件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/usr/bin/env sh</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">确保脚本抛出遇到的错误</span></span><br><span class=\"line\">set -e</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">生成静态文件</span></span><br><span class=\"line\">npm run docs:build</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入生成的文件夹</span></span><br><span class=\"line\">cd docs/.vuepress/dist</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如果是发布到自定义域名</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;www.example.com&#x27;</span> &gt; CNAME</span></span><br><span class=\"line\"></span><br><span class=\"line\">git init</span><br><span class=\"line\">git add -A</span><br><span class=\"line\">git commit -m &#x27;deploy&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如果发布到 https://&lt;USERNAME&gt;.github.io</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">git push -f git@github.com:&lt;USERNAME&gt;/&lt;USERNAME&gt;.github.io.git master</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如果发布到 https://&lt;USERNAME&gt;.github.io/&lt;REPO&gt;</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">git push -f git@github.com:&lt;USERNAME&gt;/&lt;REPO&gt;.git master:gh-pages</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd -</span><br></pre></td></tr></table></figure>\n\n<p><code>package.json</code> 中配置命令执行此shell文件：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;deploy&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;bash deploy.sh&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><h3 id=\"热编译浏览器不自动更新\"><a href=\"#热编译浏览器不自动更新\" class=\"headerlink\" title=\"热编译浏览器不自动更新\"></a>热编译浏览器不自动更新</h3><p>本地开发模式运行Vuepress 1.x 时，浏览器不能自动更新:</p>\n<p>在 package.json 中将运行命令 由</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;dev&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;vuepress dev docs&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>改为</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;dev&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;vuepress dev docs --temp .temp&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>即可解决。</p>\n<blockquote>\n<p>注意：运行 vuepress 会生成一个临时文件夹 .temp，可以在 .gitignore 中忽略掉该文件夹</p>\n</blockquote>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ol>\n<li><a href=\"https://vuepress.vuejs.org/\">VuePress</a></li>\n<li><a href=\"https://juejin.cn/post/6844903999129436174#heading-9\">1小时搞定vuepress</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"使用-vuepress-生成静态网站\"><a href=\"#使用-vuepress-生成静态网站\" class=\"headerlink\" title=\"使用 vuepress 生成静态网站\"></a>使用 vuepress 生成静态网站</h1><h2 id=\"vuepress-是什么\"><a href=\"#vuepress-是什么\" class=\"headerlink\" title=\"vuepress 是什么\"></a>vuepress 是什么</h2><p>vuepress 是一个 Vue 驱动的<strong>静态网站生成器</strong>，它可以让你：</p>\n<ul>\n<li><p><strong>快速搭建</strong>一个文档&#x2F;博客，后期只需要修改markdown内容和导航参数，即可一键打包生成页面。</p>\n</li>\n<li><p>页面具有非常好的加载性能和搜索引擎优化（SEO），其他的页面则会只在用户浏览到的时候才按需加载。</p>\n</li>\n<li><p>自动生成全局搜索、记录上次修改时间等功能。</p>\n</li>\n<li><p>可嵌入vue组件或跳转至其他页面，可定制自己的样式模板便于扩展。</p>\n</li>\n<li><p>一键免费部署到 github.pages，<strong>无需服务器即可拥有自己的在线文档&#x2F;博客</strong>。</p>\n</li>\n</ul>\n<h2 id=\"开始\"><a href=\"#开始\" class=\"headerlink\" title=\"开始\"></a>开始</h2><h3 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h3><p>1、全局安装vuepress</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g vuepress</span><br></pre></td></tr></table></figure>\n\n<p>2、初始化项目</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init -y</span><br></pre></td></tr></table></figure>\n\n<p>3、按 <a href=\"https://vuepress.vuejs.org/zh/guide/directory-structure.html\">官方</a> 规定创建文件和文件夹</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 下面没有文件类型后缀的都是文件夹</span></span><br><span class=\"line\"><span class=\"comment\"># 部分内容并不是必须的，想自己定制的话可以参考官方文档。这里是按照我的思路写的。</span></span><br><span class=\"line\">├── docs</span><br><span class=\"line\">│   ├── .vuepress  //存放核心内容的文件夹</span><br><span class=\"line\">│   │   ├── components  //存放你需要添加的vue组件</span><br><span class=\"line\">│   │   ├── public  //存放静态文件，如图片等</span><br><span class=\"line\">│   │   ├── styles  //存放需要定制的样式</span><br><span class=\"line\">│   │   │   └── palette.styl  //配置页面主题颜色的文件</span><br><span class=\"line\">│   │   └── config.js   //设定顶部导航栏、侧边导航栏等项目配置的核心文件</span><br><span class=\"line\">│   ├── pages   //存放markdown文件，用于设置其他页面内容</span><br><span class=\"line\">│   ├── README.md   //首页展示用的markdown文件</span><br><span class=\"line\">├── deploy.sh     //之后用于编写上传、发布脚本的文件</span><br><span class=\"line\">└── package.json  //之前创建的项目描述文件</span><br></pre></td></tr></table></figure>\n\n<p>4、添加启动命令</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;dev&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;vuepress dev docs&quot;</span><span class=\"punctuation\">,</span>         <span class=\"comment\">//用于实时预览</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;build&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;vuepress build docs&quot;</span>      <span class=\"comment\">//用于打包项目</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"页面配置\"><a href=\"#页面配置\" class=\"headerlink\" title=\"页面配置\"></a>页面配置</h3><h4 id=\"修改页面整体设置\"><a href=\"#修改页面整体设置\" class=\"headerlink\" title=\"修改页面整体设置\"></a>修改页面整体设置</h4><p>首先我们先设定网页与浏览器标签栏相关的一些设置，直接在我们的 <code>config.js</code> 文件增添下面的代码。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&#x27;这里是标题名&#x27;</span>, <span class=\"comment\">// 显示在左上角的网页名称以及首页在浏览器标签显示的title名称</span></span><br><span class=\"line\">    <span class=\"attr\">description</span>: <span class=\"string\">&#x27;这里是描述&#x27;</span>, <span class=\"comment\">// meta 中的描述文字，用于SEO</span></span><br><span class=\"line\">    <span class=\"comment\">// 注入到当前页面的 HTML &lt;head&gt; 中的标签</span></span><br><span class=\"line\">    <span class=\"attr\">head</span>: [</span><br><span class=\"line\">        [<span class=\"string\">&#x27;link&#x27;</span>, </span><br><span class=\"line\">            &#123; <span class=\"attr\">rel</span>: <span class=\"string\">&#x27;icon&#x27;</span>, <span class=\"attr\">href</span>: <span class=\"string\">&#x27;/icon.png&#x27;</span> &#125;</span><br><span class=\"line\">            <span class=\"comment\">//浏览器的标签栏的网页图标，第一个&#x27;/&#x27;会遍历public文件夹的文件</span></span><br><span class=\"line\">        ],  </span><br><span class=\"line\">    ],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>修改完成后，在 <code>docs/.vuepress/public</code> 文件夹里面放置我们的logo图片。</p>\n<p>然后运行我们的 <code>npm run dev</code>，打开 <code>http://localhost:8080/</code> 就可以看到效果。</p>\n<h4 id=\"设置首页内容\"><a href=\"#设置首页内容\" class=\"headerlink\" title=\"设置首页内容\"></a>设置首页内容</h4><p>接下来我们来设置首页的内容，按照官网给的格式修改<code>README.md</code>文件，填写如下内容：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">home: true</span><br><span class=\"line\">heroImage: /icon.png</span><br><span class=\"line\">heroText: xxx</span><br><span class=\"line\">tagline: xxx</span><br><span class=\"line\">actionText: 马上进入 →</span><br><span class=\"line\">actionLink: /xxx</span><br><span class=\"line\">features:</span><br><span class=\"line\"><span class=\"bullet\">-</span> title: 简洁至上</span><br><span class=\"line\">  details: 以 Markdown 为中心的项目结构，以最少的配置帮助你专注于写作。</span><br><span class=\"line\"><span class=\"bullet\">-</span> title: Vue驱动</span><br><span class=\"line\">  details: 享受 Vue + webpack 的开发体验，在 Markdown 中使用 Vue 组件，同时可以使用 Vue 来开发自定义主题。</span><br><span class=\"line\"><span class=\"bullet\">-</span> title: 高性能</span><br><span class=\"line\"><span class=\"section\">  details: VuePress 为每个页面预渲染生成静态的 HTML，同时在页面被加载的时候，将作为 SPA 运行。</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：：heroImage的地址配置第一个’&#x2F;‘默认指向的是 docs&#x2F;.vuepress&#x2F;public，你需要在此文件夹放置你的首页图片。 actionLink地址配置第一个’&#x2F;‘默认指向的是 docs&#x2F;，若未路径文件不存在点击进去会跳转至404。</p>\n</blockquote>\n<h4 id=\"修改页面导航栏、侧边导航栏\"><a href=\"#修改页面导航栏、侧边导航栏\" class=\"headerlink\" title=\"修改页面导航栏、侧边导航栏\"></a>修改页面导航栏、侧边导航栏</h4><p>导航栏修改和侧边栏修改还是在我们的 <code>config.js</code> 文件进行修改，在之前添加的moudule.exports里添加如下代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...省略部分代码</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//下面涉及到的md文件和其他文件的路径下一步再详细解释</span></span><br><span class=\"line\">    <span class=\"attr\">themeConfig</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">logo</span>: <span class=\"string\">&#x27;/egg.png&#x27;</span>,  <span class=\"comment\">//网页顶端导航栏左上角的图标</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//顶部导航栏</span></span><br><span class=\"line\">        <span class=\"attr\">nav</span>: [           </span><br><span class=\"line\">            <span class=\"comment\">//格式一：直接跳转，&#x27;/&#x27;为不添加路由，跳转至首页</span></span><br><span class=\"line\">            &#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;首页&#x27;</span>, <span class=\"attr\">link</span>: <span class=\"string\">&#x27;/&#x27;</span> &#125;,    </span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//格式二：添加下拉菜单，link指向的文件路径</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">text</span>: <span class=\"string\">&#x27;分类&#x27;</span>,  <span class=\"comment\">//默认显示        </span></span><br><span class=\"line\">                <span class=\"attr\">ariaLabel</span>: <span class=\"string\">&#x27;分类&#x27;</span>,   <span class=\"comment\">//用于识别的label</span></span><br><span class=\"line\">                <span class=\"attr\">items</span>: [</span><br><span class=\"line\">                    &#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;文章&#x27;</span>, <span class=\"attr\">link</span>: <span class=\"string\">&#x27;/pages/folder1/test1.md&#x27;</span> &#125;,  </span><br><span class=\"line\">                    <span class=\"comment\">//点击标签会跳转至link的markdown文件生成的页面</span></span><br><span class=\"line\">                    &#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;琐碎&#x27;</span>, <span class=\"attr\">link</span>: <span class=\"string\">&#x27;/pages/folder2/test4.md&#x27;</span> &#125;,</span><br><span class=\"line\">                ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;功能演示&#x27;</span>, <span class=\"attr\">link</span>: <span class=\"string\">&#x27;/pages/folder1/test3.md&#x27;</span> &#125;,</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//格式三：跳转至外部网页，需http/https前缀</span></span><br><span class=\"line\">            &#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;Github&#x27;</span>, <span class=\"attr\">link</span>: <span class=\"string\">&#x27;https://github.com/dwanda&#x27;</span> &#125;,</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//侧边导航栏：会根据当前的文件路径是否匹配侧边栏数据，自动显示/隐藏</span></span><br><span class=\"line\">        <span class=\"attr\">sidebar</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;/pages/folder1/&#x27;</span>:[         </span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"attr\">title</span>: <span class=\"string\">&#x27;测试菜单1&#x27;</span>,   <span class=\"comment\">// 一级菜单名称</span></span><br><span class=\"line\">                    <span class=\"attr\">collapsable</span>: <span class=\"literal\">false</span>, <span class=\"comment\">// false为默认展开菜单, 默认值true是折叠,</span></span><br><span class=\"line\">                    <span class=\"attr\">sidebarDepth</span>: <span class=\"number\">1</span>,    <span class=\"comment\">//  设置侧边导航自动提取markdown文件标题的层级，默认1为h2层级</span></span><br><span class=\"line\">                    <span class=\"attr\">children</span>: [</span><br><span class=\"line\">                        [<span class=\"string\">&#x27;test1.md&#x27;</span>, <span class=\"string\">&#x27;子菜单1&#x27;</span>],  <span class=\"comment\">//菜单名称为&#x27;子菜单1&#x27;，跳转至/pages/folder1/test1.md</span></span><br><span class=\"line\">                        [<span class=\"string\">&#x27;test3.md&#x27;</span>, <span class=\"string\">&#x27;子菜单2&#x27;</span>]</span><br><span class=\"line\">                    ]</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"attr\">title</span>: <span class=\"string\">&#x27;测试菜单2&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">collapsable</span>: <span class=\"literal\">false</span>, </span><br><span class=\"line\">                    <span class=\"attr\">children</span>: [</span><br><span class=\"line\">                        [<span class=\"string\">&#x27;test2.md&#x27;</span>, <span class=\"string\">&#x27;子菜单1&#x27;</span>]</span><br><span class=\"line\">                    ]</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//...可添加多个不同的侧边栏，不同页面会根据路径显示不同的侧边栏</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"一键部署至github-page\"><a href=\"#一键部署至github-page\" class=\"headerlink\" title=\"一键部署至github page\"></a>一键部署至github page</h2><p>在你的项目中，创建一个如下的 <code>deploy.sh</code> 文件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/usr/bin/env sh</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">确保脚本抛出遇到的错误</span></span><br><span class=\"line\">set -e</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">生成静态文件</span></span><br><span class=\"line\">npm run docs:build</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入生成的文件夹</span></span><br><span class=\"line\">cd docs/.vuepress/dist</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如果是发布到自定义域名</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;www.example.com&#x27;</span> &gt; CNAME</span></span><br><span class=\"line\"></span><br><span class=\"line\">git init</span><br><span class=\"line\">git add -A</span><br><span class=\"line\">git commit -m &#x27;deploy&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如果发布到 https://&lt;USERNAME&gt;.github.io</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">git push -f git@github.com:&lt;USERNAME&gt;/&lt;USERNAME&gt;.github.io.git master</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如果发布到 https://&lt;USERNAME&gt;.github.io/&lt;REPO&gt;</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">git push -f git@github.com:&lt;USERNAME&gt;/&lt;REPO&gt;.git master:gh-pages</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd -</span><br></pre></td></tr></table></figure>\n\n<p><code>package.json</code> 中配置命令执行此shell文件：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;deploy&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;bash deploy.sh&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><h3 id=\"热编译浏览器不自动更新\"><a href=\"#热编译浏览器不自动更新\" class=\"headerlink\" title=\"热编译浏览器不自动更新\"></a>热编译浏览器不自动更新</h3><p>本地开发模式运行Vuepress 1.x 时，浏览器不能自动更新:</p>\n<p>在 package.json 中将运行命令 由</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;dev&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;vuepress dev docs&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>改为</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;dev&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;vuepress dev docs --temp .temp&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>即可解决。</p>\n<blockquote>\n<p>注意：运行 vuepress 会生成一个临时文件夹 .temp，可以在 .gitignore 中忽略掉该文件夹</p>\n</blockquote>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ol>\n<li><a href=\"https://vuepress.vuejs.org/\">VuePress</a></li>\n<li><a href=\"https://juejin.cn/post/6844903999129436174#heading-9\">1小时搞定vuepress</a></li>\n</ol>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cll3vjsh20001yt8wg1ua3sws","category_id":"cll3vjsh90004yt8w81w17bzo","_id":"cll3vjshj000hyt8w3l588akt"},{"post_id":"cll3vjshh000fyt8wamb23mh0","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjshp000nyt8w7s046oye"},{"post_id":"cll3vjsh70003yt8wfh7q8c0h","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjshq000ryt8wgy6t3cn2"},{"post_id":"cll3vjshi000gyt8w9d5w4lkk","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjshs000uyt8wdesb97yw"},{"post_id":"cll3vjshd0007yt8w8d9b5v04","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjshu000yyt8wgiakh0di"},{"post_id":"cll3vjsho000myt8w01rbf1pv","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjshu0010yt8wbx006dha"},{"post_id":"cll3vjshe0009yt8w3skm3th2","category_id":"cll3vjshp000oyt8wf0jkaua4","_id":"cll3vjshw0015yt8w6rit3rut"},{"post_id":"cll3vjsht000xyt8wcjzhac08","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjshx0018yt8wfs5l02lc"},{"post_id":"cll3vjshf000byt8w097m1y3l","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjshy001cyt8w55zk1rps"},{"post_id":"cll3vjshm000kyt8w7ufp6bp6","category_id":"cll3vjshv0011yt8wgt6fb1oa","_id":"cll3vjshz001gyt8w9w0e49wp"},{"post_id":"cll3vjshx001byt8w854vbcg9","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsi1001lyt8wecudhzm3"},{"post_id":"cll3vjshy001fyt8w3xrb4t9m","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsi2001oyt8w0firb5dc"},{"post_id":"cll3vjshq000qyt8wd7xy2iox","category_id":"cll3vjshx001ayt8wgme7c144","_id":"cll3vjsi3001tyt8wfrlrabxj"},{"post_id":"cll3vjsi0001hyt8w09yt0x64","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsi4001wyt8wgftz6107"},{"post_id":"cll3vjsi1001kyt8wf7zjc050","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsi50020yt8w2tadcbpi"},{"post_id":"cll3vjshr000tyt8w0tnefxdj","category_id":"cll3vjsi0001iyt8wa9qx6p4x","_id":"cll3vjsi60023yt8wgxkah3kr"},{"post_id":"cll3vjshv0014yt8w94gg1kzw","category_id":"cll3vjsi0001iyt8wa9qx6p4x","_id":"cll3vjsi70027yt8wcktgaomq"},{"post_id":"cll3vjsi4001vyt8wgjengaa7","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsi8002ayt8w1dl5d1zh"},{"post_id":"cll3vjsi5001zyt8waisr4dy0","category_id":"cll3vjsi0001iyt8wa9qx6p4x","_id":"cll3vjsi9002eyt8w7cu9er56"},{"post_id":"cll3vjshw0017yt8w0pzx2yxk","category_id":"cll3vjsi4001xyt8wbeagdrql","_id":"cll3vjsib002hyt8w2aku18vd"},{"post_id":"cll3vjsi60022yt8whbweggfa","category_id":"cll3vjshp000oyt8wf0jkaua4","_id":"cll3vjsic002kyt8w65hc6hzp"},{"post_id":"cll3vjsi70026yt8w0tqu7pqt","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsid002oyt8w2tfrd92w"},{"post_id":"cll3vjsi1001nyt8w2wfud3nw","category_id":"cll3vjsi60024yt8w9b5d9yrl","_id":"cll3vjsie002qyt8w3ct42og5"},{"post_id":"cll3vjsi9002dyt8wf6okb2ep","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsif002vyt8wgcfx4jyw"},{"post_id":"cll3vjsia002gyt8w7o02fyp7","category_id":"cll3vjsi8002byt8w7nbe5pl0","_id":"cll3vjsig002yyt8w4ajp4rry"},{"post_id":"cll3vjsi3001syt8whr6lbd9r","category_id":"cll3vjsi8002byt8w7nbe5pl0","_id":"cll3vjsii0031yt8w74ev7j1a"},{"post_id":"cll3vjsic002nyt8wg51zgd4q","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsij0034yt8whfjx6i7x"},{"post_id":"cll3vjsi80029yt8w1nlo5wkf","category_id":"cll3vjsic002lyt8w92azhnco","_id":"cll3vjsik0037yt8w2v5y3rjs"},{"post_id":"cll3vjsid002pyt8wely54sbo","category_id":"cll3vjsi0001iyt8wa9qx6p4x","_id":"cll3vjsil003ayt8w0iar64ar"},{"post_id":"cll3vjsie002uyt8w1pqh4ztg","category_id":"cll3vjsi4001xyt8wbeagdrql","_id":"cll3vjsim003dyt8wdw6pg756"},{"post_id":"cll3vjsib002jyt8wc4ne1x81","category_id":"cll3vjsie002syt8wg5p268yk","_id":"cll3vjsin003gyt8wb3wt5k0b"},{"post_id":"cll3vjsig002xyt8whvdn948f","category_id":"cll3vjsi4001xyt8wbeagdrql","_id":"cll3vjsio003hyt8w87njbokv"},{"post_id":"cll3vjsih0030yt8w3uqi1c63","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsio003kyt8weef30ds1"},{"post_id":"cll3vjsii0033yt8wfznhhifm","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsio003lyt8wakym0ktq"},{"post_id":"cll3vjsij0036yt8wg4mt2hsn","category_id":"cll3vjsic002lyt8w92azhnco","_id":"cll3vjsip003nyt8w770gdylr"},{"post_id":"cll3vjsik0039yt8w0rj93lve","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsip003pyt8wcdzc5mmr"},{"post_id":"cll3vjsil003cyt8w6yngglxl","category_id":"cll3vjshg000cyt8w8kkkg3pf","_id":"cll3vjsip003ryt8w6kqn97x9"},{"post_id":"cll3vjsim003fyt8we2ufb0um","category_id":"cll3vjshp000oyt8wf0jkaua4","_id":"cll3vjsip003tyt8w2pdufwyl"}],"PostTag":[{"post_id":"cll3vjsh20001yt8wg1ua3sws","tag_id":"cll3vjshb0005yt8w5nf44o5k","_id":"cll3vjshh000eyt8wfrn42m82"},{"post_id":"cll3vjsh70003yt8wfh7q8c0h","tag_id":"cll3vjshh000dyt8we17p1c5z","_id":"cll3vjshn000lyt8w1gkl9q21"},{"post_id":"cll3vjshf000byt8w097m1y3l","tag_id":"cll3vjshh000dyt8we17p1c5z","_id":"cll3vjshq000syt8w1pm96ewo"},{"post_id":"cll3vjsht000xyt8wcjzhac08","tag_id":"cll3vjshs000wyt8w6tmz2osz","_id":"cll3vjshv0012yt8wdm2k4jep"},{"post_id":"cll3vjshh000fyt8wamb23mh0","tag_id":"cll3vjshp000pyt8w3ed89pxj","_id":"cll3vjshw0016yt8wa899geyb"},{"post_id":"cll3vjshh000fyt8wamb23mh0","tag_id":"cll3vjshs000wyt8w6tmz2osz","_id":"cll3vjshx0019yt8w1zo9hhll"},{"post_id":"cll3vjshm000kyt8w7ufp6bp6","tag_id":"cll3vjshv0013yt8w23r26wj1","_id":"cll3vjshy001eyt8w4dv97uvy"},{"post_id":"cll3vjshq000qyt8wd7xy2iox","tag_id":"cll3vjshy001dyt8wh3v437oq","_id":"cll3vjsi1001myt8w12j0arla"},{"post_id":"cll3vjshq000qyt8wd7xy2iox","tag_id":"cll3vjshh000dyt8we17p1c5z","_id":"cll3vjsi2001pyt8w73shdom1"},{"post_id":"cll3vjshv0014yt8w94gg1kzw","tag_id":"cll3vjsi0001jyt8wdpds7opw","_id":"cll3vjsi4001uyt8w08u1cnyt"},{"post_id":"cll3vjshx001byt8w854vbcg9","tag_id":"cll3vjsi2001ryt8w9ogtbkw1","_id":"cll3vjsi60021yt8wcgj38ep9"},{"post_id":"cll3vjshy001fyt8w3xrb4t9m","tag_id":"cll3vjsi2001ryt8w9ogtbkw1","_id":"cll3vjsi80028yt8wcg29ek7c"},{"post_id":"cll3vjsi0001hyt8w09yt0x64","tag_id":"cll3vjsi2001ryt8w9ogtbkw1","_id":"cll3vjsia002fyt8wbbudegrw"},{"post_id":"cll3vjsi1001kyt8wf7zjc050","tag_id":"cll3vjsi2001ryt8w9ogtbkw1","_id":"cll3vjsic002myt8wcbzm5q2p"},{"post_id":"cll3vjsi1001nyt8w2wfud3nw","tag_id":"cll3vjsib002iyt8w3u80fp7r","_id":"cll3vjsie002tyt8w2ajhdren"},{"post_id":"cll3vjsid002pyt8wely54sbo","tag_id":"cll3vjshy001dyt8wh3v437oq","_id":"cll3vjsig002wyt8w89hy5e6l"},{"post_id":"cll3vjsi3001syt8whr6lbd9r","tag_id":"cll3vjsie002ryt8wh7lw8rux","_id":"cll3vjsii0032yt8w9letgpy3"},{"post_id":"cll3vjsi4001vyt8wgjengaa7","tag_id":"cll3vjsig002zyt8wh4fc5z5i","_id":"cll3vjsik0038yt8w796c3qv7"},{"post_id":"cll3vjsi5001zyt8waisr4dy0","tag_id":"cll3vjsij0035yt8w4fpo0umg","_id":"cll3vjsim003eyt8was0m4z5r"},{"post_id":"cll3vjsi70026yt8w0tqu7pqt","tag_id":"cll3vjsil003byt8weh9zd1mn","_id":"cll3vjsio003jyt8whwml4sl0"},{"post_id":"cll3vjsi80029yt8w1nlo5wkf","tag_id":"cll3vjsio003iyt8wdarff60l","_id":"cll3vjsip003oyt8w5jq79ugj"},{"post_id":"cll3vjsi9002dyt8wf6okb2ep","tag_id":"cll3vjsio003myt8we0p384iy","_id":"cll3vjsip003syt8wb5bj8oq0"},{"post_id":"cll3vjsia002gyt8w7o02fyp7","tag_id":"cll3vjsip003qyt8w3y0240ke","_id":"cll3vjsir003vyt8w6sn62ht4"},{"post_id":"cll3vjsib002jyt8wc4ne1x81","tag_id":"cll3vjsip003uyt8w6inebygi","_id":"cll3vjsis003xyt8w08xi8may"},{"post_id":"cll3vjsie002uyt8w1pqh4ztg","tag_id":"cll3vjsis003wyt8w67fg1r82","_id":"cll3vjsis003zyt8w9u0ucx7z"},{"post_id":"cll3vjsig002xyt8whvdn948f","tag_id":"cll3vjsis003wyt8w67fg1r82","_id":"cll3vjsit0041yt8wfer3ae1p"},{"post_id":"cll3vjsih0030yt8w3uqi1c63","tag_id":"cll3vjsis0040yt8w7xlh19j8","_id":"cll3vjsit0043yt8w4ecl32dy"},{"post_id":"cll3vjsii0033yt8wfznhhifm","tag_id":"cll3vjsis0040yt8w7xlh19j8","_id":"cll3vjsiu0045yt8w04u72plm"},{"post_id":"cll3vjsij0036yt8wg4mt2hsn","tag_id":"cll3vjsil003byt8weh9zd1mn","_id":"cll3vjsiu0047yt8wf5u544t2"},{"post_id":"cll3vjsik0039yt8w0rj93lve","tag_id":"cll3vjsil003byt8weh9zd1mn","_id":"cll3vjsiv0049yt8w59hb4g4o"},{"post_id":"cll3vjsil003cyt8w6yngglxl","tag_id":"cll3vjsil003byt8weh9zd1mn","_id":"cll3vjsiv004byt8w6qz1ccxo"},{"post_id":"cll3vjsim003fyt8we2ufb0um","tag_id":"cll3vjsiv004ayt8wcp5hcqm8","_id":"cll3vjsiv004cyt8w8bnh7382"}],"Tag":[{"name":"算法","_id":"cll3vjshb0005yt8w5nf44o5k"},{"name":"JavaScript","_id":"cll3vjshh000dyt8we17p1c5z"},{"name":"HTTP","_id":"cll3vjshp000pyt8w3ed89pxj"},{"name":"高频","_id":"cll3vjshs000wyt8w6tmz2osz"},{"name":"服务器","_id":"cll3vjshv0013yt8w23r26wj1"},{"name":"浏览器","_id":"cll3vjshy001dyt8wh3v437oq"},{"name":"前端","_id":"cll3vjsi0001jyt8wdpds7opw"},{"name":"手写","_id":"cll3vjsi2001ryt8w9ogtbkw1"},{"name":"Node.js","_id":"cll3vjsib002iyt8w3u80fp7r"},{"name":"npm","_id":"cll3vjsie002ryt8wh7lw8rux"},{"name":"pdfs","_id":"cll3vjsig002zyt8wh4fc5z5i"},{"name":"office加载项","_id":"cll3vjsij0035yt8w4fpo0umg"},{"name":"Vue.js","_id":"cll3vjsil003byt8weh9zd1mn"},{"name":"工具","_id":"cll3vjsio003iyt8wdarff60l"},{"name":"react","_id":"cll3vjsio003myt8we0p384iy"},{"name":"工程化","_id":"cll3vjsip003qyt8w3y0240ke"},{"name":"golang","_id":"cll3vjsip003uyt8w6inebygi"},{"name":"CSS","_id":"cll3vjsis003wyt8w67fg1r82"},{"name":"TypeScript","_id":"cll3vjsis0040yt8w7xlh19j8"},{"name":"博客","_id":"cll3vjsiv004ayt8wcp5hcqm8"}]}}